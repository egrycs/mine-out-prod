"use strict";(self.webpackChunkmine_out=self.webpackChunkmine_out||[]).push([[179],{733:()=>{function yt(n){return"function"==typeof n}function ec(n){const t=n(i=>{Error.call(i),i.stack=(new Error).stack});return t.prototype=Object.create(Error.prototype),t.prototype.constructor=t,t}const ud=ec(n=>function(t){n(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((i,r)=>`${r+1}) ${i.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t});function tc(n,e){if(n){const t=n.indexOf(e);0<=t&&n.splice(t,1)}}class Mi{constructor(e){this.initialTeardown=e,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let e;if(!this.closed){this.closed=!0;const{_parentage:t}=this;if(t)if(this._parentage=null,Array.isArray(t))for(const s of t)s.remove(this);else t.remove(this);const{initialTeardown:i}=this;if(yt(i))try{i()}catch(s){e=s instanceof ud?s.errors:[s]}const{_finalizers:r}=this;if(r){this._finalizers=null;for(const s of r)try{sb(s)}catch(o){e=e??[],o instanceof ud?e=[...e,...o.errors]:e.push(o)}}if(e)throw new ud(e)}}add(e){var t;if(e&&e!==this)if(this.closed)sb(e);else{if(e instanceof Mi){if(e.closed||e._hasParent(this))return;e._addParent(this)}(this._finalizers=null!==(t=this._finalizers)&&void 0!==t?t:[]).push(e)}}_hasParent(e){const{_parentage:t}=this;return t===e||Array.isArray(t)&&t.includes(e)}_addParent(e){const{_parentage:t}=this;this._parentage=Array.isArray(t)?(t.push(e),t):t?[t,e]:e}_removeParent(e){const{_parentage:t}=this;t===e?this._parentage=null:Array.isArray(t)&&tc(t,e)}remove(e){const{_finalizers:t}=this;t&&tc(t,e),e instanceof Mi&&e._removeParent(this)}}Mi.EMPTY=(()=>{const n=new Mi;return n.closed=!0,n})();const ib=Mi.EMPTY;function rb(n){return n instanceof Mi||n&&"closed"in n&&yt(n.remove)&&yt(n.add)&&yt(n.unsubscribe)}function sb(n){yt(n)?n():n.unsubscribe()}const Xs={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1},dd={setTimeout(n,e,...t){const{delegate:i}=dd;return i?.setTimeout?i.setTimeout(n,e,...t):setTimeout(n,e,...t)},clearTimeout(n){const{delegate:e}=dd;return(e?.clearTimeout||clearTimeout)(n)},delegate:void 0};function ob(n){dd.setTimeout(()=>{const{onUnhandledError:e}=Xs;if(!e)throw n;e(n)})}function ab(){}const fR=qp("C",void 0,void 0);function qp(n,e,t){return{kind:n,value:e,error:t}}let Zs=null;function hd(n){if(Xs.useDeprecatedSynchronousErrorHandling){const e=!Zs;if(e&&(Zs={errorThrown:!1,error:null}),n(),e){const{errorThrown:t,error:i}=Zs;if(Zs=null,t)throw i}}else n()}class Yp extends Mi{constructor(e){super(),this.isStopped=!1,e?(this.destination=e,rb(e)&&e.add(this)):this.destination=bR}static create(e,t,i){return new nc(e,t,i)}next(e){this.isStopped?Zp(function mR(n){return qp("N",n,void 0)}(e),this):this._next(e)}error(e){this.isStopped?Zp(function pR(n){return qp("E",void 0,n)}(e),this):(this.isStopped=!0,this._error(e))}complete(){this.isStopped?Zp(fR,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(e){this.destination.next(e)}_error(e){try{this.destination.error(e)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const yR=Function.prototype.bind;function Xp(n,e){return yR.call(n,e)}class _R{constructor(e){this.partialObserver=e}next(e){const{partialObserver:t}=this;if(t.next)try{t.next(e)}catch(i){fd(i)}}error(e){const{partialObserver:t}=this;if(t.error)try{t.error(e)}catch(i){fd(i)}else fd(e)}complete(){const{partialObserver:e}=this;if(e.complete)try{e.complete()}catch(t){fd(t)}}}class nc extends Yp{constructor(e,t,i){let r;if(super(),yt(e)||!e)r={next:e??void 0,error:t??void 0,complete:i??void 0};else{let s;this&&Xs.useDeprecatedNextContext?(s=Object.create(e),s.unsubscribe=()=>this.unsubscribe(),r={next:e.next&&Xp(e.next,s),error:e.error&&Xp(e.error,s),complete:e.complete&&Xp(e.complete,s)}):r=e}this.destination=new _R(r)}}function fd(n){Xs.useDeprecatedSynchronousErrorHandling?function gR(n){Xs.useDeprecatedSynchronousErrorHandling&&Zs&&(Zs.errorThrown=!0,Zs.error=n)}(n):ob(n)}function Zp(n,e){const{onStoppedNotification:t}=Xs;t&&dd.setTimeout(()=>t(n,e))}const bR={closed:!0,next:ab,error:function vR(n){throw n},complete:ab},Kp="function"==typeof Symbol&&Symbol.observable||"@@observable";function ps(n){return n}function lb(n){return 0===n.length?ps:1===n.length?n[0]:function(t){return n.reduce((i,r)=>r(i),t)}}let nn=(()=>{class n{constructor(t){t&&(this._subscribe=t)}lift(t){const i=new n;return i.source=this,i.operator=t,i}subscribe(t,i,r){const s=function wR(n){return n&&n instanceof Yp||function SR(n){return n&&yt(n.next)&&yt(n.error)&&yt(n.complete)}(n)&&rb(n)}(t)?t:new nc(t,i,r);return hd(()=>{const{operator:o,source:a}=this;s.add(o?o.call(s,a):a?this._subscribe(s):this._trySubscribe(s))}),s}_trySubscribe(t){try{return this._subscribe(t)}catch(i){t.error(i)}}forEach(t,i){return new(i=cb(i))((r,s)=>{const o=new nc({next:a=>{try{t(a)}catch(l){s(l),o.unsubscribe()}},error:s,complete:r});this.subscribe(o)})}_subscribe(t){var i;return null===(i=this.source)||void 0===i?void 0:i.subscribe(t)}[Kp](){return this}pipe(...t){return lb(t)(this)}toPromise(t){return new(t=cb(t))((i,r)=>{let s;this.subscribe(o=>s=o,o=>r(o),()=>i(s))})}}return n.create=e=>new n(e),n})();function cb(n){var e;return null!==(e=n??Xs.Promise)&&void 0!==e?e:Promise}const MR=ec(n=>function(){n(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});let li=(()=>{class n extends nn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(t){const i=new ub(this,this);return i.operator=t,i}_throwIfClosed(){if(this.closed)throw new MR}next(t){hd(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const i of this.currentObservers)i.next(t)}})}error(t){hd(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=t;const{observers:i}=this;for(;i.length;)i.shift().error(t)}})}complete(){hd(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:t}=this;for(;t.length;)t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var t;return(null===(t=this.observers)||void 0===t?void 0:t.length)>0}_trySubscribe(t){return this._throwIfClosed(),super._trySubscribe(t)}_subscribe(t){return this._throwIfClosed(),this._checkFinalizedStatuses(t),this._innerSubscribe(t)}_innerSubscribe(t){const{hasError:i,isStopped:r,observers:s}=this;return i||r?ib:(this.currentObservers=null,s.push(t),new Mi(()=>{this.currentObservers=null,tc(s,t)}))}_checkFinalizedStatuses(t){const{hasError:i,thrownError:r,isStopped:s}=this;i?t.error(r):s&&t.complete()}asObservable(){const t=new nn;return t.source=this,t}}return n.create=(e,t)=>new ub(e,t),n})();class ub extends li{constructor(e,t){super(),this.destination=e,this.source=t}next(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.next)||void 0===i||i.call(t,e)}error(e){var t,i;null===(i=null===(t=this.destination)||void 0===t?void 0:t.error)||void 0===i||i.call(t,e)}complete(){var e,t;null===(t=null===(e=this.destination)||void 0===e?void 0:e.complete)||void 0===t||t.call(e)}_subscribe(e){var t,i;return null!==(i=null===(t=this.source)||void 0===t?void 0:t.subscribe(e))&&void 0!==i?i:ib}}function db(n){return yt(n?.lift)}function dn(n){return e=>{if(db(e))return e.lift(function(t){try{return n(t,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function hn(n,e,t,i,r){return new ER(n,e,t,i,r)}class ER extends Yp{constructor(e,t,i,r,s,o){super(e),this.onFinalize=s,this.shouldUnsubscribe=o,this._next=t?function(a){try{t(a)}catch(l){e.error(l)}}:super._next,this._error=r?function(a){try{r(a)}catch(l){e.error(l)}finally{this.unsubscribe()}}:super._error,this._complete=i?function(){try{i()}catch(a){e.error(a)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:t}=this;super.unsubscribe(),!t&&(null===(e=this.onFinalize)||void 0===e||e.call(this))}}}function Je(n,e){return dn((t,i)=>{let r=0;t.subscribe(hn(i,s=>{i.next(n.call(e,s,r++))}))})}function Ks(n){return this instanceof Ks?(this.v=n,this):new Ks(n)}function TR(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=t.apply(n,e||[]),s=[];return r={},o("next"),o("throw"),o("return"),r[Symbol.asyncIterator]=function(){return this},r;function o(h){i[h]&&(r[h]=function(f){return new Promise(function(p,g){s.push([h,f,p,g])>1||a(h,f)})})}function a(h,f){try{!function l(h){h.value instanceof Ks?Promise.resolve(h.value.v).then(c,u):d(s[0][2],h)}(i[h](f))}catch(p){d(s[0][3],p)}}function c(h){a("next",h)}function u(h){a("throw",h)}function d(h,f){h(f),s.shift(),s.length&&a(s[0][0],s[0][1])}}function AR(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,e=n[Symbol.asyncIterator];return e?e.call(n):(n=function pb(n){var e="function"==typeof Symbol&&Symbol.iterator,t=e&&n[e],i=0;if(t)return t.call(n);if(n&&"number"==typeof n.length)return{next:function(){return n&&i>=n.length&&(n=void 0),{value:n&&n[i++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}(n),t={},i("next"),i("throw"),i("return"),t[Symbol.asyncIterator]=function(){return this},t);function i(s){t[s]=n[s]&&function(o){return new Promise(function(a,l){!function r(s,o,a,l){Promise.resolve(l).then(function(c){s({value:c,done:a})},o)}(a,l,(o=n[s](o)).done,o.value)})}}}const Jp=n=>n&&"number"==typeof n.length&&"function"!=typeof n;function mb(n){return yt(n?.then)}function gb(n){return yt(n[Kp])}function yb(n){return Symbol.asyncIterator&&yt(n?.[Symbol.asyncIterator])}function _b(n){return new TypeError(`You provided ${null!==n&&"object"==typeof n?"an invalid object":`'${n}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}const vb=function PR(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}();function bb(n){return yt(n?.[vb])}function xb(n){return TR(this,arguments,function*(){const t=n.getReader();try{for(;;){const{value:i,done:r}=yield Ks(t.read());if(r)return yield Ks(void 0);yield yield Ks(i)}}finally{t.releaseLock()}})}function Sb(n){return yt(n?.getReader)}function Hi(n){if(n instanceof nn)return n;if(null!=n){if(gb(n))return function RR(n){return new nn(e=>{const t=n[Kp]();if(yt(t.subscribe))return t.subscribe(e);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(n);if(Jp(n))return function LR(n){return new nn(e=>{for(let t=0;t<n.length&&!e.closed;t++)e.next(n[t]);e.complete()})}(n);if(mb(n))return function NR(n){return new nn(e=>{n.then(t=>{e.closed||(e.next(t),e.complete())},t=>e.error(t)).then(null,ob)})}(n);if(yb(n))return wb(n);if(bb(n))return function OR(n){return new nn(e=>{for(const t of n)if(e.next(t),e.closed)return;e.complete()})}(n);if(Sb(n))return function FR(n){return wb(xb(n))}(n)}throw _b(n)}function wb(n){return new nn(e=>{(function kR(n,e){var t,i,r,s;return function CR(n,e,t,i){return new(t||(t=Promise))(function(s,o){function a(u){try{c(i.next(u))}catch(d){o(d)}}function l(u){try{c(i.throw(u))}catch(d){o(d)}}function c(u){u.done?s(u.value):function r(s){return s instanceof t?s:new t(function(o){o(s)})}(u.value).then(a,l)}c((i=i.apply(n,e||[])).next())})}(this,void 0,void 0,function*(){try{for(t=AR(n);!(i=yield t.next()).done;)if(e.next(i.value),e.closed)return}catch(o){r={error:o}}finally{try{i&&!i.done&&(s=t.return)&&(yield s.call(t))}finally{if(r)throw r.error}}e.complete()})})(n,e).catch(t=>e.error(t))})}function Dr(n,e,t,i=0,r=!1){const s=e.schedule(function(){t(),r?n.add(this.schedule(null,i)):this.unsubscribe()},i);if(n.add(s),!r)return s}function Sn(n,e,t=1/0){return yt(e)?Sn((i,r)=>Je((s,o)=>e(i,s,r,o))(Hi(n(i,r))),t):("number"==typeof e&&(t=e),dn((i,r)=>function BR(n,e,t,i,r,s,o,a){const l=[];let c=0,u=0,d=!1;const h=()=>{d&&!l.length&&!c&&e.complete()},f=g=>c<i?p(g):l.push(g),p=g=>{s&&e.next(g),c++;let m=!1;Hi(t(g,u++)).subscribe(hn(e,y=>{r?.(y),s?f(y):e.next(y)},()=>{m=!0},void 0,()=>{if(m)try{for(c--;l.length&&c<i;){const y=l.shift();o?Dr(e,o,()=>p(y)):p(y)}h()}catch(y){e.error(y)}}))};return n.subscribe(hn(e,f,()=>{d=!0,h()})),()=>{a?.()}}(i,r,n,t)))}function ra(n=1/0){return Sn(ps,n)}const Tr=new nn(n=>n.complete());function em(n){return n[n.length-1]}function ic(n){return function zR(n){return n&&yt(n.schedule)}(em(n))?n.pop():void 0}function Mb(n,e=0){return dn((t,i)=>{t.subscribe(hn(i,r=>Dr(i,n,()=>i.next(r),e),()=>Dr(i,n,()=>i.complete(),e),r=>Dr(i,n,()=>i.error(r),e)))})}function Eb(n,e=0){return dn((t,i)=>{i.add(n.schedule(()=>t.subscribe(i),e))})}function Cb(n,e){if(!n)throw new Error("Iterable cannot be null");return new nn(t=>{Dr(t,e,()=>{const i=n[Symbol.asyncIterator]();Dr(t,e,()=>{i.next().then(r=>{r.done?t.complete():t.next(r.value)})},0,!0)})})}function fn(n,e){return e?function YR(n,e){if(null!=n){if(gb(n))return function GR(n,e){return Hi(n).pipe(Eb(e),Mb(e))}(n,e);if(Jp(n))return function jR(n,e){return new nn(t=>{let i=0;return e.schedule(function(){i===n.length?t.complete():(t.next(n[i++]),t.closed||this.schedule())})})}(n,e);if(mb(n))return function WR(n,e){return Hi(n).pipe(Eb(e),Mb(e))}(n,e);if(yb(n))return Cb(n,e);if(bb(n))return function $R(n,e){return new nn(t=>{let i;return Dr(t,e,()=>{i=n[vb](),Dr(t,e,()=>{let r,s;try{({value:r,done:s}=i.next())}catch(o){return void t.error(o)}s?t.complete():t.next(r)},0,!0)}),()=>yt(i?.return)&&i.return()})}(n,e);if(Sb(n))return function qR(n,e){return Cb(xb(n),e)}(n,e)}throw _b(n)}(n,e):Hi(n)}function Db(n={}){const{connector:e=(()=>new li),resetOnError:t=!0,resetOnComplete:i=!0,resetOnRefCountZero:r=!0}=n;return s=>{let o,a,l,c=0,u=!1,d=!1;const h=()=>{a?.unsubscribe(),a=void 0},f=()=>{h(),o=l=void 0,u=d=!1},p=()=>{const g=o;f(),g?.unsubscribe()};return dn((g,m)=>{c++,!d&&!u&&h();const y=l=l??e();m.add(()=>{c--,0===c&&!d&&!u&&(a=tm(p,r))}),y.subscribe(m),!o&&c>0&&(o=new nc({next:b=>y.next(b),error:b=>{d=!0,h(),a=tm(f,t,b),y.error(b)},complete:()=>{u=!0,h(),a=tm(f,i),y.complete()}}),Hi(g).subscribe(o))})(s)}}function tm(n,e,...t){if(!0===e)return void n();if(!1===e)return;const i=new nc({next:()=>{i.unsubscribe(),n()}});return e(...t).subscribe(i)}function It(n){for(let e in n)if(n[e]===It)return e;throw Error("Could not find renamed property on target object.")}function Pt(n){if("string"==typeof n)return n;if(Array.isArray(n))return"["+n.map(Pt).join(", ")+"]";if(null==n)return""+n;if(n.overriddenName)return`${n.overriddenName}`;if(n.name)return`${n.name}`;const e=n.toString();if(null==e)return""+e;const t=e.indexOf("\n");return-1===t?e:e.substring(0,t)}function im(n,e){return null==n||""===n?null===e?"":e:null==e||""===e?n:n+" "+e}const ZR=It({__forward_ref__:It});function rm(n){return n.__forward_ref__=rm,n.toString=function(){return Pt(this())},n}function Ue(n){return sm(n)?n():n}function sm(n){return"function"==typeof n&&n.hasOwnProperty(ZR)&&n.__forward_ref__===rm}function om(n){return n&&!!n.\u0275providers}const Tb="https://g.co/ng/security#xss";class ie extends Error{constructor(e,t){super(function pd(n,e){return`NG0${Math.abs(n)}${e?": "+e.trim():""}`}(e,t)),this.code=e}}function je(n){return"string"==typeof n?n:null==n?"":String(n)}function md(n,e){throw new ie(-201,!1)}function Ei(n,e){null==n&&function wt(n,e,t,i){throw new Error(`ASSERTION ERROR: ${n}`+(null==i?"":` [Expected=> ${t} ${i} ${e} <=Actual]`))}(e,n,null,"!=")}function Ae(n){return{token:n.token,providedIn:n.providedIn||null,factory:n.factory,value:void 0}}function Ci(n){return{providers:n.providers||[],imports:n.imports||[]}}function gd(n){return Ab(n,yd)||Ab(n,Pb)}function Ab(n,e){return n.hasOwnProperty(e)?n[e]:null}function Ib(n){return n&&(n.hasOwnProperty(am)||n.hasOwnProperty(sL))?n[am]:null}const yd=It({\u0275prov:It}),am=It({\u0275inj:It}),Pb=It({ngInjectableDef:It}),sL=It({ngInjectorDef:It});var ze=(()=>((ze=ze||{})[ze.Default=0]="Default",ze[ze.Host=1]="Host",ze[ze.Self=2]="Self",ze[ze.SkipSelf=4]="SkipSelf",ze[ze.Optional=8]="Optional",ze))();let lm;function Di(n){const e=lm;return lm=n,e}function Rb(n,e,t){const i=gd(n);return i&&"root"==i.providedIn?void 0===i.value?i.value=i.factory():i.value:t&ze.Optional?null:void 0!==e?e:void md(Pt(n))}const Lt=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),rc={},cm="__NG_DI_FLAG__",_d="ngTempTokenPath",lL=/\n/gm,Lb="__source";let sc;function sa(n){const e=sc;return sc=n,e}function uL(n,e=ze.Default){if(void 0===sc)throw new ie(-203,!1);return null===sc?Rb(n,void 0,e):sc.get(n,e&ze.Optional?null:void 0,e)}function pe(n,e=ze.Default){return(function oL(){return lm}()||uL)(Ue(n),e)}function ut(n,e=ze.Default){return pe(n,vd(e))}function vd(n){return typeof n>"u"||"number"==typeof n?n:0|(n.optional&&8)|(n.host&&1)|(n.self&&2)|(n.skipSelf&&4)}function um(n){const e=[];for(let t=0;t<n.length;t++){const i=Ue(n[t]);if(Array.isArray(i)){if(0===i.length)throw new ie(900,!1);let r,s=ze.Default;for(let o=0;o<i.length;o++){const a=i[o],l=dL(a);"number"==typeof l?-1===l?r=a.token:s|=l:r=a}e.push(pe(r,s))}else e.push(pe(i))}return e}function oc(n,e){return n[cm]=e,n.prototype[cm]=e,n}function dL(n){return n[cm]}function gs(n){return{toString:n}.toString()}var Gi=(()=>((Gi=Gi||{})[Gi.OnPush=0]="OnPush",Gi[Gi.Default=1]="Default",Gi))(),Wi=(()=>{return(n=Wi||(Wi={}))[n.Emulated=0]="Emulated",n[n.None=2]="None",n[n.ShadowDom=3]="ShadowDom",Wi;var n})();const Ar={},xt=[],bd=It({\u0275cmp:It}),dm=It({\u0275dir:It}),hm=It({\u0275pipe:It}),Ob=It({\u0275mod:It}),Ir=It({\u0275fac:It}),ac=It({__NG_ELEMENT_ID__:It});let pL=0;function oa(n){return gs(()=>{const t=!0===n.standalone,i={},r={type:n.type,providersResolver:null,decls:n.decls,vars:n.vars,factory:null,template:n.template||null,consts:n.consts||null,ngContentSelectors:n.ngContentSelectors,hostBindings:n.hostBindings||null,hostVars:n.hostVars||0,hostAttrs:n.hostAttrs||null,contentQueries:n.contentQueries||null,declaredInputs:i,inputs:null,outputs:null,exportAs:n.exportAs||null,onPush:n.changeDetection===Gi.OnPush,directiveDefs:null,pipeDefs:null,standalone:t,dependencies:t&&n.dependencies||null,getStandaloneInjector:null,selectors:n.selectors||xt,viewQuery:n.viewQuery||null,features:n.features||null,data:n.data||{},encapsulation:n.encapsulation||Wi.Emulated,id:"c"+pL++,styles:n.styles||xt,_:null,setInput:null,schemas:n.schemas||null,tView:null,findHostDirectiveDefs:null,hostDirectives:null},s=n.dependencies,o=n.features;return r.inputs=Bb(n.inputs,i),r.outputs=Bb(n.outputs),o&&o.forEach(a=>a(r)),r.directiveDefs=s?()=>("function"==typeof s?s():s).map(Fb).filter(kb):null,r.pipeDefs=s?()=>("function"==typeof s?s():s).map(Vn).filter(kb):null,r})}function Fb(n){return Mt(n)||Pn(n)}function kb(n){return null!==n}function ji(n){return gs(()=>({type:n.type,bootstrap:n.bootstrap||xt,declarations:n.declarations||xt,imports:n.imports||xt,exports:n.exports||xt,transitiveCompileScopes:null,schemas:n.schemas||null,id:n.id||null}))}function Bb(n,e){if(null==n)return Ar;const t={};for(const i in n)if(n.hasOwnProperty(i)){let r=n[i],s=r;Array.isArray(r)&&(s=r[1],r=r[0]),t[r]=i,e&&(e[r]=s)}return t}const zn=oa;function ni(n){return{type:n.type,name:n.name,factory:null,pure:!1!==n.pure,standalone:!0===n.standalone,onDestroy:n.type.prototype.ngOnDestroy||null}}function Mt(n){return n[bd]||null}function Pn(n){return n[dm]||null}function Vn(n){return n[hm]||null}function ui(n,e){const t=n[Ob]||null;if(!t&&!0===e)throw new Error(`Type ${Pt(n)} does not have '\u0275mod' property.`);return t}function di(n){return Array.isArray(n)&&"object"==typeof n[1]}function qi(n){return Array.isArray(n)&&!0===n[1]}function mm(n){return 0!=(4&n.flags)}function dc(n){return n.componentOffset>-1}function Ed(n){return 1==(1&n.flags)}function Yi(n){return null!==n.template}function yL(n){return 0!=(256&n[2])}function Js(n,e){return n.hasOwnProperty(Ir)?n[Ir]:null}class bL{constructor(e,t,i){this.previousValue=e,this.currentValue=t,this.firstChange=i}isFirstChange(){return this.firstChange}}function eo(){return Wb}function Wb(n){return n.type.prototype.ngOnChanges&&(n.setInput=SL),xL}function xL(){const n=$b(this),e=n?.current;if(e){const t=n.previous;if(t===Ar)n.previous=e;else for(let i in e)t[i]=e[i];n.current=null,this.ngOnChanges(e)}}function SL(n,e,t,i){const r=this.declaredInputs[t],s=$b(n)||function wL(n,e){return n[jb]=e}(n,{previous:Ar,current:null}),o=s.current||(s.current={}),a=s.previous,l=a[r];o[r]=new bL(l&&l.currentValue,e,a===Ar),n[i]=e}eo.ngInherit=!0;const jb="__ngSimpleChanges__";function $b(n){return n[jb]||null}function Dn(n){for(;Array.isArray(n);)n=n[0];return n}function hi(n,e){return Dn(e[n.index])}function Xb(n,e){return n.data[e]}function fi(n,e){const t=e[n];return di(t)?t:t[0]}function Dd(n){return 64==(64&n[2])}function ys(n,e){return null==e?null:n[e]}function Zb(n){n[18]=0}function ym(n,e){n[5]+=e;let t=n,i=n[3];for(;null!==i&&(1===e&&1===t[5]||-1===e&&0===t[5]);)i[5]+=e,t=i,i=i[3]}const $e={lFrame:lx(null),bindingsEnabled:!0};function Qb(){return $e.bindingsEnabled}function re(){return $e.lFrame.lView}function dt(){return $e.lFrame.tView}function Tn(){let n=tx();for(;null!==n&&64===n.type;)n=n.parent;return n}function tx(){return $e.lFrame.currentTNode}function hr(n,e){const t=$e.lFrame;t.currentTNode=n,t.isParent=e}function _m(){return $e.lFrame.isParent}function vm(){$e.lFrame.isParent=!1}function fa(){return $e.lFrame.bindingIndex++}function FL(n,e){const t=$e.lFrame;t.bindingIndex=t.bindingRootIndex=n,bm(e)}function bm(n){$e.lFrame.currentDirectiveIndex=n}function Sm(n){$e.lFrame.currentQueryIndex=n}function BL(n){const e=n[1];return 2===e.type?e.declTNode:1===e.type?n[6]:null}function ox(n,e,t){if(t&ze.SkipSelf){let r=e,s=n;for(;!(r=r.parent,null!==r||t&ze.Host||(r=BL(s),null===r||(s=s[15],10&r.type))););if(null===r)return!1;e=r,n=s}const i=$e.lFrame=ax();return i.currentTNode=e,i.lView=n,!0}function wm(n){const e=ax(),t=n[1];$e.lFrame=e,e.currentTNode=t.firstChild,e.lView=n,e.tView=t,e.contextLView=n,e.bindingIndex=t.bindingStartIndex,e.inI18n=!1}function ax(){const n=$e.lFrame,e=null===n?null:n.child;return null===e?lx(n):e}function lx(n){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:n,child:null,inI18n:!1};return null!==n&&(n.child=e),e}function cx(){const n=$e.lFrame;return $e.lFrame=n.parent,n.currentTNode=null,n.lView=null,n}const ux=cx;function Mm(){const n=cx();n.isParent=!0,n.tView=null,n.selectedIndex=-1,n.contextLView=null,n.elementDepthCount=0,n.currentDirectiveIndex=-1,n.currentNamespace=null,n.bindingRootIndex=-1,n.bindingIndex=-1,n.currentQueryIndex=0}function Wn(){return $e.lFrame.selectedIndex}function to(n){$e.lFrame.selectedIndex=n}function Vt(){const n=$e.lFrame;return Xb(n.tView,n.selectedIndex)}function Td(n,e){for(let t=e.directiveStart,i=e.directiveEnd;t<i;t++){const s=n.data[t].type.prototype,{ngAfterContentInit:o,ngAfterContentChecked:a,ngAfterViewInit:l,ngAfterViewChecked:c,ngOnDestroy:u}=s;o&&(n.contentHooks||(n.contentHooks=[])).push(-t,o),a&&((n.contentHooks||(n.contentHooks=[])).push(t,a),(n.contentCheckHooks||(n.contentCheckHooks=[])).push(t,a)),l&&(n.viewHooks||(n.viewHooks=[])).push(-t,l),c&&((n.viewHooks||(n.viewHooks=[])).push(t,c),(n.viewCheckHooks||(n.viewCheckHooks=[])).push(t,c)),null!=u&&(n.destroyHooks||(n.destroyHooks=[])).push(t,u)}}function Ad(n,e,t){dx(n,e,3,t)}function Id(n,e,t,i){(3&n[2])===t&&dx(n,e,t,i)}function Em(n,e){let t=n[2];(3&t)===e&&(t&=2047,t+=1,n[2]=t)}function dx(n,e,t,i){const s=i??-1,o=e.length-1;let a=0;for(let l=void 0!==i?65535&n[18]:0;l<o;l++)if("number"==typeof e[l+1]){if(a=e[l],null!=i&&a>=i)break}else e[l]<0&&(n[18]+=65536),(a<s||-1==s)&&(qL(n,t,e,l),n[18]=(4294901760&n[18])+l+2),l++}function qL(n,e,t,i){const r=t[i]<0,s=t[i+1],a=n[r?-t[i]:t[i]];if(r){if(n[2]>>11<n[18]>>16&&(3&n[2])===e){n[2]+=2048;try{s.call(a)}finally{}}}else try{s.call(a)}finally{}}class fc{constructor(e,t,i){this.factory=e,this.resolving=!1,this.canSeeViewProviders=t,this.injectImpl=i}}function Dm(n,e,t){let i=0;for(;i<t.length;){const r=t[i];if("number"==typeof r){if(0!==r)break;i++;const s=t[i++],o=t[i++],a=t[i++];n.setAttribute(e,o,a,s)}else{const s=r,o=t[++i];fx(s)?n.setProperty(e,s,o):n.setAttribute(e,s,o),i++}}return i}function hx(n){return 3===n||4===n||6===n}function fx(n){return 64===n.charCodeAt(0)}function pc(n,e){if(null!==e&&0!==e.length)if(null===n||0===n.length)n=e.slice();else{let t=-1;for(let i=0;i<e.length;i++){const r=e[i];"number"==typeof r?t=r:0===t||px(n,t,r,null,-1===t||2===t?e[++i]:null)}}return n}function px(n,e,t,i,r){let s=0,o=n.length;if(-1===e)o=-1;else for(;s<n.length;){const a=n[s++];if("number"==typeof a){if(a===e){o=-1;break}if(a>e){o=s-1;break}}}for(;s<n.length;){const a=n[s];if("number"==typeof a)break;if(a===t){if(null===i)return void(null!==r&&(n[s+1]=r));if(i===n[s+1])return void(n[s+2]=r)}s++,null!==i&&s++,null!==r&&s++}-1!==o&&(n.splice(o,0,e),s=o+1),n.splice(s++,0,t),null!==i&&n.splice(s++,0,i),null!==r&&n.splice(s++,0,r)}function mx(n){return-1!==n}function Pd(n){return 32767&n}function Rd(n,e){let t=function KL(n){return n>>16}(n),i=e;for(;t>0;)i=i[15],t--;return i}let Tm=!0;function Ld(n){const e=Tm;return Tm=n,e}let QL=0;const fr={};function Nd(n,e){const t=_x(n,e);if(-1!==t)return t;const i=e[1];i.firstCreatePass&&(n.injectorIndex=e.length,Am(i.data,n),Am(e,null),Am(i.blueprint,null));const r=Im(n,e),s=n.injectorIndex;if(mx(r)){const o=Pd(r),a=Rd(r,e),l=a[1].data;for(let c=0;c<8;c++)e[s+c]=a[o+c]|l[o+c]}return e[s+8]=r,s}function Am(n,e){n.push(0,0,0,0,0,0,0,0,e)}function _x(n,e){return-1===n.injectorIndex||n.parent&&n.parent.injectorIndex===n.injectorIndex||null===e[n.injectorIndex+8]?-1:n.injectorIndex}function Im(n,e){if(n.parent&&-1!==n.parent.injectorIndex)return n.parent.injectorIndex;let t=0,i=null,r=e;for(;null!==r;){if(i=Cx(r),null===i)return-1;if(t++,r=r[15],-1!==i.injectorIndex)return i.injectorIndex|t<<16}return-1}function Pm(n,e,t){!function JL(n,e,t){let i;"string"==typeof t?i=t.charCodeAt(0)||0:t.hasOwnProperty(ac)&&(i=t[ac]),null==i&&(i=t[ac]=QL++);const r=255&i;e.data[n+(r>>5)]|=1<<r}(n,e,t)}function vx(n,e,t){if(t&ze.Optional||void 0!==n)return n;md()}function bx(n,e,t,i){if(t&ze.Optional&&void 0===i&&(i=null),0==(t&(ze.Self|ze.Host))){const r=n[9],s=Di(void 0);try{return r?r.get(e,i,t&ze.Optional):Rb(e,i,t&ze.Optional)}finally{Di(s)}}return vx(i,0,t)}function xx(n,e,t,i=ze.Default,r){if(null!==n){if(1024&e[2]){const o=function r2(n,e,t,i,r){let s=n,o=e;for(;null!==s&&null!==o&&1024&o[2]&&!(256&o[2]);){const a=Sx(s,o,t,i|ze.Self,fr);if(a!==fr)return a;let l=s.parent;if(!l){const c=o[21];if(c){const u=c.get(t,fr,i);if(u!==fr)return u}l=Cx(o),o=o[15]}s=l}return r}(n,e,t,i,fr);if(o!==fr)return o}const s=Sx(n,e,t,i,fr);if(s!==fr)return s}return bx(e,t,i,r)}function Sx(n,e,t,i,r){const s=function n2(n){if("string"==typeof n)return n.charCodeAt(0)||0;const e=n.hasOwnProperty(ac)?n[ac]:void 0;return"number"==typeof e?e>=0?255&e:i2:e}(t);if("function"==typeof s){if(!ox(e,n,i))return i&ze.Host?vx(r,0,i):bx(e,t,i,r);try{const o=s(i);if(null!=o||i&ze.Optional)return o;md()}finally{ux()}}else if("number"==typeof s){let o=null,a=_x(n,e),l=-1,c=i&ze.Host?e[16][6]:null;for((-1===a||i&ze.SkipSelf)&&(l=-1===a?Im(n,e):e[a+8],-1!==l&&Mx(i,!1)?(o=e[1],a=Pd(l),e=Rd(l,e)):a=-1);-1!==a;){const u=e[1];if(wx(s,a,u.data)){const d=t2(a,e,t,o,i,c);if(d!==fr)return d}l=e[a+8],-1!==l&&Mx(i,e[1].data[a+8]===c)&&wx(s,a,e)?(o=u,a=Pd(l),e=Rd(l,e)):a=-1}}return r}function t2(n,e,t,i,r,s){const o=e[1],a=o.data[n+8],u=function Od(n,e,t,i,r){const s=n.providerIndexes,o=e.data,a=1048575&s,l=n.directiveStart,u=s>>20,h=r?a+u:n.directiveEnd;for(let f=i?a:a+u;f<h;f++){const p=o[f];if(f<l&&t===p||f>=l&&p.type===t)return f}if(r){const f=o[l];if(f&&Yi(f)&&f.type===t)return l}return null}(a,o,t,null==i?dc(a)&&Tm:i!=o&&0!=(3&a.type),r&ze.Host&&s===a);return null!==u?no(e,o,u,a):fr}function no(n,e,t,i){let r=n[t];const s=e.data;if(function YL(n){return n instanceof fc}(r)){const o=r;o.resolving&&function KR(n,e){const t=e?`. Dependency path: ${e.join(" > ")} > ${n}`:"";throw new ie(-200,`Circular dependency in DI detected for ${n}${t}`)}(function St(n){return"function"==typeof n?n.name||n.toString():"object"==typeof n&&null!=n&&"function"==typeof n.type?n.type.name||n.type.toString():je(n)}(s[t]));const a=Ld(o.canSeeViewProviders);o.resolving=!0;const l=o.injectImpl?Di(o.injectImpl):null;ox(n,i,ze.Default);try{r=n[t]=o.factory(void 0,s,n,i),e.firstCreatePass&&t>=i.directiveStart&&function $L(n,e,t){const{ngOnChanges:i,ngOnInit:r,ngDoCheck:s}=e.type.prototype;if(i){const o=Wb(e);(t.preOrderHooks||(t.preOrderHooks=[])).push(n,o),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,o)}r&&(t.preOrderHooks||(t.preOrderHooks=[])).push(0-n,r),s&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n,s),(t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n,s))}(t,s[t],e)}finally{null!==l&&Di(l),Ld(a),o.resolving=!1,ux()}}return r}function wx(n,e,t){return!!(t[e+(n>>5)]&1<<n)}function Mx(n,e){return!(n&ze.Self||n&ze.Host&&e)}class ma{constructor(e,t){this._tNode=e,this._lView=t}get(e,t,i){return xx(this._tNode,this._lView,e,vd(i),t)}}function i2(){return new ma(Tn(),re())}function Rm(n){return sm(n)?()=>{const e=Rm(Ue(n));return e&&e()}:Js(n)}function Cx(n){const e=n[1],t=e.type;return 2===t?e.declTNode:1===t?n[6]:null}const ya="__parameters__";function va(n,e,t){return gs(()=>{const i=function Lm(n){return function(...t){if(n){const i=n(...t);for(const r in i)this[r]=i[r]}}}(e);function r(...s){if(this instanceof r)return i.apply(this,s),this;const o=new r(...s);return a.annotation=o,a;function a(l,c,u){const d=l.hasOwnProperty(ya)?l[ya]:Object.defineProperty(l,ya,{value:[]})[ya];for(;d.length<=u;)d.push(null);return(d[u]=d[u]||[]).push(o),l}}return t&&(r.prototype=Object.create(t.prototype)),r.prototype.ngMetadataName=n,r.annotationCls=r,r})}class Ne{constructor(e,t){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof t?this.__NG_ELEMENT_ID__=t:void 0!==t&&(this.\u0275prov=Ae({token:this,providedIn:t.providedIn||"root",factory:t.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function io(n,e){n.forEach(t=>Array.isArray(t)?io(t,e):e(t))}function Tx(n,e,t){e>=n.length?n.push(t):n.splice(e,0,t)}function kd(n,e){return e>=n.length-1?n.pop():n.splice(e,1)[0]}const _c=oc(va("Optional"),8),vc=oc(va("SkipSelf"),4);var ii=(()=>((ii=ii||{})[ii.Important=1]="Important",ii[ii.DashCase=2]="DashCase",ii))();const Vm=new Map;let I2=0;const Gm="__ngContext__";function Nn(n,e){di(e)?(n[Gm]=e[20],function R2(n){Vm.set(n[20],n)}(e)):n[Gm]=e}function jm(n,e){return undefined(n,e)}function wc(n){const e=n[3];return qi(e)?e[3]:e}function $m(n){return Xx(n[13])}function qm(n){return Xx(n[4])}function Xx(n){for(;null!==n&&!qi(n);)n=n[4];return n}function Sa(n,e,t,i,r){if(null!=i){let s,o=!1;qi(i)?s=i:di(i)&&(o=!0,i=i[0]);const a=Dn(i);0===n&&null!==t?null==r?tS(e,t,a):ro(e,t,a,r||null,!0):1===n&&null!==t?ro(e,t,a,r||null,!0):2===n?function eg(n,e,t){const i=Vd(n,e);i&&function Q2(n,e,t,i){n.removeChild(e,t,i)}(n,i,e,t)}(e,a,o):3===n&&e.destroyNode(a),null!=s&&function tN(n,e,t,i,r){const s=t[7];s!==Dn(t)&&Sa(e,n,i,s,r);for(let a=10;a<t.length;a++){const l=t[a];Mc(l[1],l,n,e,i,s)}}(e,n,s,t,r)}}function Xm(n,e,t){return n.createElement(e,t)}function Kx(n,e){const t=n[9],i=t.indexOf(e),r=e[3];512&e[2]&&(e[2]&=-513,ym(r,-1)),t.splice(i,1)}function Zm(n,e){if(n.length<=10)return;const t=10+e,i=n[t];if(i){const r=i[17];null!==r&&r!==n&&Kx(r,i),e>0&&(n[t-1][4]=i[4]);const s=kd(n,10+e);!function W2(n,e){Mc(n,e,e[11],2,null,null),e[0]=null,e[6]=null}(i[1],i);const o=s[19];null!==o&&o.detachView(s[1]),i[3]=null,i[4]=null,i[2]&=-65}return i}function Qx(n,e){if(!(128&e[2])){const t=e[11];t.destroyNode&&Mc(n,e,t,3,null,null),function q2(n){let e=n[13];if(!e)return Km(n[1],n);for(;e;){let t=null;if(di(e))t=e[13];else{const i=e[10];i&&(t=i)}if(!t){for(;e&&!e[4]&&e!==n;)di(e)&&Km(e[1],e),e=e[3];null===e&&(e=n),di(e)&&Km(e[1],e),t=e&&e[4]}e=t}}(e)}}function Km(n,e){if(!(128&e[2])){e[2]&=-65,e[2]|=128,function K2(n,e){let t;if(null!=n&&null!=(t=n.destroyHooks))for(let i=0;i<t.length;i+=2){const r=e[t[i]];if(!(r instanceof fc)){const s=t[i+1];if(Array.isArray(s))for(let o=0;o<s.length;o+=2){const a=r[s[o]],l=s[o+1];try{l.call(a)}finally{}}else try{s.call(r)}finally{}}}}(n,e),function Z2(n,e){const t=n.cleanup,i=e[7];let r=-1;if(null!==t)for(let s=0;s<t.length-1;s+=2)if("string"==typeof t[s]){const o=t[s+3];o>=0?i[r=o]():i[r=-o].unsubscribe(),s+=2}else{const o=i[r=t[s+1]];t[s].call(o)}if(null!==i){for(let s=r+1;s<i.length;s++)(0,i[s])();e[7]=null}}(n,e),1===e[1].type&&e[11].destroy();const t=e[17];if(null!==t&&qi(e[3])){t!==e[3]&&Kx(t,e);const i=e[19];null!==i&&i.detachView(n)}!function L2(n){Vm.delete(n[20])}(e)}}function Jx(n,e,t){return function eS(n,e,t){let i=e;for(;null!==i&&40&i.type;)i=(e=i).parent;if(null===i)return t[0];{const{componentOffset:r}=i;if(r>-1){const{encapsulation:s}=n.data[i.directiveStart+r];if(s===Wi.None||s===Wi.Emulated)return null}return hi(i,t)}}(n,e.parent,t)}function ro(n,e,t,i,r){n.insertBefore(e,t,i,r)}function tS(n,e,t){n.appendChild(e,t)}function nS(n,e,t,i,r){null!==i?ro(n,e,t,i,r):tS(n,e,t)}function Vd(n,e){return n.parentNode(e)}let Wd,ig,jd,sS=function rS(n,e,t){return 40&n.type?hi(n,t):null};function Hd(n,e,t,i){const r=Jx(n,i,e),s=e[11],a=function iS(n,e,t){return sS(n,e,t)}(i.parent||e[6],i,e);if(null!=r)if(Array.isArray(t))for(let l=0;l<t.length;l++)nS(s,r,t[l],a,!1);else nS(s,r,t,a,!1)}function Gd(n,e){if(null!==e){const t=e.type;if(3&t)return hi(e,n);if(4&t)return Jm(-1,n[e.index]);if(8&t){const i=e.child;if(null!==i)return Gd(n,i);{const r=n[e.index];return qi(r)?Jm(-1,r):Dn(r)}}if(32&t)return jm(e,n)()||Dn(n[e.index]);{const i=aS(n,e);return null!==i?Array.isArray(i)?i[0]:Gd(wc(n[16]),i):Gd(n,e.next)}}return null}function aS(n,e){return null!==e?n[16][6].projection[e.projection]:null}function Jm(n,e){const t=10+n+1;if(t<e.length){const i=e[t],r=i[1].firstChild;if(null!==r)return Gd(i,r)}return e[7]}function tg(n,e,t,i,r,s,o){for(;null!=t;){const a=i[t.index],l=t.type;if(o&&0===e&&(a&&Nn(Dn(a),i),t.flags|=2),32!=(32&t.flags))if(8&l)tg(n,e,t.child,i,r,s,!1),Sa(e,n,r,a,s);else if(32&l){const c=jm(t,i);let u;for(;u=c();)Sa(e,n,r,u,s);Sa(e,n,r,a,s)}else 16&l?lS(n,e,i,t,r,s):Sa(e,n,r,a,s);t=o?t.projectionNext:t.next}}function Mc(n,e,t,i,r,s){tg(t,i,n.firstChild,e,r,s,!1)}function lS(n,e,t,i,r,s){const o=t[16],l=o[6].projection[i.projection];if(Array.isArray(l))for(let c=0;c<l.length;c++)Sa(e,n,r,l[c],s);else tg(n,e,l,o[3],r,s,!0)}function cS(n,e,t){""===t?n.removeAttribute(e,"class"):n.setAttribute(e,"class",t)}function uS(n,e,t){const{mergedAttrs:i,classes:r,styles:s}=t;null!==i&&Dm(n,e,i),null!==r&&cS(n,e,r),null!==s&&function iN(n,e,t){n.setAttribute(e,"style",t)}(n,e,s)}function so(n){return function ng(){if(void 0===Wd&&(Wd=null,Lt.trustedTypes))try{Wd=Lt.trustedTypes.createPolicy("angular",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return Wd}()?.createHTML(n)||n}function rg(){if(void 0===jd&&(jd=null,Lt.trustedTypes))try{jd=Lt.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:n=>n,createScript:n=>n,createScriptURL:n=>n})}catch{}return jd}function hS(n){return rg()?.createHTML(n)||n}function pS(n){return rg()?.createScriptURL(n)||n}class mS{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Tb})`}}function _s(n){return n instanceof mS?n.changingThisBreaksApplicationSecurity:n}function Ec(n,e){const t=function fN(n){return n instanceof mS&&n.getTypeName()||null}(n);if(null!=t&&t!==e){if("ResourceURL"===t&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${t} (see ${Tb})`)}return t===e}class pN{constructor(e){this.inertDocumentHelper=e}getInertBodyElement(e){e="<body><remove></remove>"+e;try{const t=(new window.DOMParser).parseFromString(so(e),"text/html").body;return null===t?this.inertDocumentHelper.getInertBodyElement(e):(t.removeChild(t.firstChild),t)}catch{return null}}}class mN{constructor(e){if(this.defaultDoc=e,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const i=this.inertDocument.createElement("body");t.appendChild(i)}}getInertBodyElement(e){const t=this.inertDocument.createElement("template");if("content"in t)return t.innerHTML=so(e),t;const i=this.inertDocument.createElement("body");return i.innerHTML=so(e),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(i),i}stripCustomNsAttrs(e){const t=e.attributes;for(let r=t.length-1;0<r;r--){const o=t.item(r).name;("xmlns:ns1"===o||0===o.indexOf("ns1:"))&&e.removeAttribute(o)}let i=e.firstChild;for(;i;)i.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(i),i=i.nextSibling}}const yN=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;function sg(n){return(n=String(n)).match(yN)?n:"unsafe:"+n}function Nr(n){const e={};for(const t of n.split(","))e[t]=!0;return e}function Cc(...n){const e={};for(const t of n)for(const i in t)t.hasOwnProperty(i)&&(e[i]=!0);return e}const yS=Nr("area,br,col,hr,img,wbr"),_S=Nr("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),vS=Nr("rp,rt"),og=Cc(yS,Cc(_S,Nr("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Cc(vS,Nr("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Cc(vS,_S)),ag=Nr("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),bS=Cc(ag,Nr("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,srcset,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Nr("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),_N=Nr("script,style,template");class vN{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(e){let t=e.firstChild,i=!0;for(;t;)if(t.nodeType===Node.ELEMENT_NODE?i=this.startElement(t):t.nodeType===Node.TEXT_NODE?this.chars(t.nodeValue):this.sanitizedSomething=!0,i&&t.firstChild)t=t.firstChild;else for(;t;){t.nodeType===Node.ELEMENT_NODE&&this.endElement(t);let r=this.checkClobberedElement(t,t.nextSibling);if(r){t=r;break}t=this.checkClobberedElement(t,t.parentNode)}return this.buf.join("")}startElement(e){const t=e.nodeName.toLowerCase();if(!og.hasOwnProperty(t))return this.sanitizedSomething=!0,!_N.hasOwnProperty(t);this.buf.push("<"),this.buf.push(t);const i=e.attributes;for(let r=0;r<i.length;r++){const s=i.item(r),o=s.name,a=o.toLowerCase();if(!bS.hasOwnProperty(a)){this.sanitizedSomething=!0;continue}let l=s.value;ag[a]&&(l=sg(l)),this.buf.push(" ",o,'="',xS(l),'"')}return this.buf.push(">"),!0}endElement(e){const t=e.nodeName.toLowerCase();og.hasOwnProperty(t)&&!yS.hasOwnProperty(t)&&(this.buf.push("</"),this.buf.push(t),this.buf.push(">"))}chars(e){this.buf.push(xS(e))}checkClobberedElement(e,t){if(t&&(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${e.outerHTML}`);return t}}const bN=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,xN=/([^\#-~ |!])/g;function xS(n){return n.replace(/&/g,"&amp;").replace(bN,function(e){return"&#"+(1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320)+65536)+";"}).replace(xN,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let $d;function lg(n){return"content"in n&&function wN(n){return n.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===n.nodeName}(n)?n.content:null}var rn=(()=>((rn=rn||{})[rn.NONE=0]="NONE",rn[rn.HTML=1]="HTML",rn[rn.STYLE=2]="STYLE",rn[rn.SCRIPT=3]="SCRIPT",rn[rn.URL=4]="URL",rn[rn.RESOURCE_URL=5]="RESOURCE_URL",rn))();function SS(n){const e=Dc();return e?hS(e.sanitize(rn.HTML,n)||""):Ec(n,"HTML")?hS(_s(n)):function SN(n,e){let t=null;try{$d=$d||function gS(n){const e=new mN(n);return function gN(){try{return!!(new window.DOMParser).parseFromString(so(""),"text/html")}catch{return!1}}()?new pN(e):e}(n);let i=e?String(e):"";t=$d.getInertBodyElement(i);let r=5,s=i;do{if(0===r)throw new Error("Failed to sanitize html because the input is unstable");r--,i=s,s=t.innerHTML,t=$d.getInertBodyElement(i)}while(i!==s);return so((new vN).sanitizeChildren(lg(t)||t))}finally{if(t){const i=lg(t)||t;for(;i.firstChild;)i.removeChild(i.firstChild)}}}(function dS(){return void 0!==ig?ig:typeof document<"u"?document:void 0}(),je(n))}function oo(n){const e=Dc();return e?e.sanitize(rn.URL,n)||"":Ec(n,"URL")?_s(n):sg(je(n))}function wS(n){const e=Dc();if(e)return pS(e.sanitize(rn.RESOURCE_URL,n)||"");if(Ec(n,"ResourceURL"))return pS(_s(n));throw new ie(904,!1)}function Dc(){const n=re();return n&&n[12]}const qd=new Ne("ENVIRONMENT_INITIALIZER"),ES=new Ne("INJECTOR",-1),CS=new Ne("INJECTOR_DEF_TYPES");class DS{get(e,t=rc){if(t===rc){const i=new Error(`NullInjectorError: No provider for ${Pt(e)}!`);throw i.name="NullInjectorError",i}return t}}function AN(...n){return{\u0275providers:TS(0,n),\u0275fromNgModule:!0}}function TS(n,...e){const t=[],i=new Set;let r;return io(e,s=>{const o=s;cg(o,t,[],i)&&(r||(r=[]),r.push(o))}),void 0!==r&&AS(r,t),t}function AS(n,e){for(let t=0;t<n.length;t++){const{providers:r}=n[t];ug(r,s=>{e.push(s)})}}function cg(n,e,t,i){if(!(n=Ue(n)))return!1;let r=null,s=Ib(n);const o=!s&&Mt(n);if(s||o){if(o&&!o.standalone)return!1;r=n}else{const l=n.ngModule;if(s=Ib(l),!s)return!1;r=l}const a=i.has(r);if(o){if(a)return!1;if(i.add(r),o.dependencies){const l="function"==typeof o.dependencies?o.dependencies():o.dependencies;for(const c of l)cg(c,e,t,i)}}else{if(!s)return!1;{if(null!=s.imports&&!a){let c;i.add(r);try{io(s.imports,u=>{cg(u,e,t,i)&&(c||(c=[]),c.push(u))})}finally{}void 0!==c&&AS(c,e)}if(!a){const c=Js(r)||(()=>new r);e.push({provide:r,useFactory:c,deps:xt},{provide:CS,useValue:r,multi:!0},{provide:qd,useValue:()=>pe(r),multi:!0})}const l=s.providers;null==l||a||ug(l,u=>{e.push(u)})}}return r!==n&&void 0!==n.providers}function ug(n,e){for(let t of n)om(t)&&(t=t.\u0275providers),Array.isArray(t)?ug(t,e):e(t)}const IN=It({provide:String,useValue:It});function dg(n){return null!==n&&"object"==typeof n&&IN in n}function ao(n){return"function"==typeof n}const hg=new Ne("Set Injector scope."),Yd={},RN={};let fg;function Xd(){return void 0===fg&&(fg=new DS),fg}class Or{}class RS extends Or{constructor(e,t,i,r){super(),this.parent=t,this.source=i,this.scopes=r,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,mg(e,o=>this.processProvider(o)),this.records.set(ES,wa(void 0,this)),r.has("environment")&&this.records.set(Or,wa(void 0,this));const s=this.records.get(hg);null!=s&&"string"==typeof s.value&&this.scopes.add(s.value),this.injectorDefTypes=new Set(this.get(CS.multi,xt,ze.Self))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const e of this._ngOnDestroyHooks)e.ngOnDestroy();for(const e of this._onDestroyHooks)e()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(e){this._onDestroyHooks.push(e)}runInContext(e){this.assertNotDestroyed();const t=sa(this),i=Di(void 0);try{return e()}finally{sa(t),Di(i)}}get(e,t=rc,i=ze.Default){this.assertNotDestroyed(),i=vd(i);const r=sa(this),s=Di(void 0);try{if(!(i&ze.SkipSelf)){let a=this.records.get(e);if(void 0===a){const l=function kN(n){return"function"==typeof n||"object"==typeof n&&n instanceof Ne}(e)&&gd(e);a=l&&this.injectableDefInScope(l)?wa(pg(e),Yd):null,this.records.set(e,a)}if(null!=a)return this.hydrate(e,a)}return(i&ze.Self?Xd():this.parent).get(e,t=i&ze.Optional&&t===rc?null:t)}catch(o){if("NullInjectorError"===o.name){if((o[_d]=o[_d]||[]).unshift(Pt(e)),r)throw o;return function hL(n,e,t,i){const r=n[_d];throw e[Lb]&&r.unshift(e[Lb]),n.message=function fL(n,e,t,i=null){n=n&&"\n"===n.charAt(0)&&"\u0275"==n.charAt(1)?n.slice(2):n;let r=Pt(e);if(Array.isArray(e))r=e.map(Pt).join(" -> ");else if("object"==typeof e){let s=[];for(let o in e)if(e.hasOwnProperty(o)){let a=e[o];s.push(o+":"+("string"==typeof a?JSON.stringify(a):Pt(a)))}r=`{${s.join(", ")}}`}return`${t}${i?"("+i+")":""}[${r}]: ${n.replace(lL,"\n  ")}`}("\n"+n.message,r,t,i),n.ngTokenPath=r,n[_d]=null,n}(o,e,"R3InjectorError",this.source)}throw o}finally{Di(s),sa(r)}}resolveInjectorInitializers(){const e=sa(this),t=Di(void 0);try{const i=this.get(qd.multi,xt,ze.Self);for(const r of i)r()}finally{sa(e),Di(t)}}toString(){const e=[],t=this.records;for(const i of t.keys())e.push(Pt(i));return`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new ie(205,!1)}processProvider(e){let t=ao(e=Ue(e))?e:Ue(e&&e.provide);const i=function NN(n){return dg(n)?wa(void 0,n.useValue):wa(function LS(n,e,t){let i;if(ao(n)){const r=Ue(n);return Js(r)||pg(r)}if(dg(n))i=()=>Ue(n.useValue);else if(function PS(n){return!(!n||!n.useFactory)}(n))i=()=>n.useFactory(...um(n.deps||[]));else if(function IS(n){return!(!n||!n.useExisting)}(n))i=()=>pe(Ue(n.useExisting));else{const r=Ue(n&&(n.useClass||n.provide));if(!function ON(n){return!!n.deps}(n))return Js(r)||pg(r);i=()=>new r(...um(n.deps))}return i}(n),Yd)}(e);if(ao(e)||!0!==e.multi)this.records.get(t);else{let r=this.records.get(t);r||(r=wa(void 0,Yd,!0),r.factory=()=>um(r.multi),this.records.set(t,r)),t=e,r.multi.push(e)}this.records.set(t,i)}hydrate(e,t){return t.value===Yd&&(t.value=RN,t.value=t.factory()),"object"==typeof t.value&&t.value&&function FN(n){return null!==n&&"object"==typeof n&&"function"==typeof n.ngOnDestroy}(t.value)&&this._ngOnDestroyHooks.add(t.value),t.value}injectableDefInScope(e){if(!e.providedIn)return!1;const t=Ue(e.providedIn);return"string"==typeof t?"any"===t||this.scopes.has(t):this.injectorDefTypes.has(t)}}function pg(n){const e=gd(n),t=null!==e?e.factory:Js(n);if(null!==t)return t;if(n instanceof Ne)throw new ie(204,!1);if(n instanceof Function)return function LN(n){const e=n.length;if(e>0)throw function yc(n,e){const t=[];for(let i=0;i<n;i++)t.push(e);return t}(e,"?"),new ie(204,!1);const t=function iL(n){const e=n&&(n[yd]||n[Pb]);if(e){const t=function rL(n){if(n.hasOwnProperty("name"))return n.name;const e=(""+n).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(n);return console.warn(`DEPRECATED: DI is instantiating a token "${t}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${t}" class.`),e}return null}(n);return null!==t?()=>t.factory(n):()=>new n}(n);throw new ie(204,!1)}function wa(n,e,t=!1){return{factory:n,value:e,multi:t?[]:void 0}}function mg(n,e){for(const t of n)Array.isArray(t)?mg(t,e):t&&om(t)?mg(t.\u0275providers,e):e(t)}class BN{}class NS{}class zN{resolveComponentFactory(e){throw function UN(n){const e=Error(`No component factory found for ${Pt(n)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=n,e}(e)}}let Tc=(()=>{class n{}return n.NULL=new zN,n})();function VN(){return Ma(Tn(),re())}function Ma(n,e){return new vs(hi(n,e))}let vs=(()=>{class n{constructor(t){this.nativeElement=t}}return n.__NG_ELEMENT_ID__=VN,n})();class Ac{}let Zd=(()=>{class n{}return n.__NG_ELEMENT_ID__=()=>function GN(){const n=re(),t=fi(Tn().index,n);return(di(t)?t:n)[11]}(),n})(),WN=(()=>{class n{}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:()=>null}),n})();class Kd{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const jN=new Kd("15.0.4"),gg={};function _g(n){return n.ngOriginalError}class Ea{constructor(){this._console=console}handleError(e){const t=this._findOriginalError(e);this._console.error("ERROR",e),t&&this._console.error("ORIGINAL ERROR",t)}_findOriginalError(e){let t=e&&_g(e);for(;t&&_g(t);)t=_g(t);return t||null}}function Fr(n){return n instanceof Function?n():n}function kS(n,e,t){let i=n.length;for(;;){const r=n.indexOf(e,t);if(-1===r)return r;if(0===r||n.charCodeAt(r-1)<=32){const s=e.length;if(r+s===i||n.charCodeAt(r+s)<=32)return r}t=r+1}}const BS="ng-template";function nO(n,e,t){let i=0;for(;i<n.length;){let r=n[i++];if(t&&"class"===r){if(r=n[i],-1!==kS(r.toLowerCase(),e,0))return!0}else if(1===r){for(;i<n.length&&"string"==typeof(r=n[i++]);)if(r.toLowerCase()===e)return!0;return!1}}return!1}function US(n){return 4===n.type&&n.value!==BS}function iO(n,e,t){return e===(4!==n.type||t?n.value:BS)}function rO(n,e,t){let i=4;const r=n.attrs||[],s=function aO(n){for(let e=0;e<n.length;e++)if(hx(n[e]))return e;return n.length}(r);let o=!1;for(let a=0;a<e.length;a++){const l=e[a];if("number"!=typeof l){if(!o)if(4&i){if(i=2|1&i,""!==l&&!iO(n,l,t)||""===l&&1===e.length){if(Xi(i))return!1;o=!0}}else{const c=8&i?l:e[++a];if(8&i&&null!==n.attrs){if(!nO(n.attrs,c,t)){if(Xi(i))return!1;o=!0}continue}const d=sO(8&i?"class":l,r,US(n),t);if(-1===d){if(Xi(i))return!1;o=!0;continue}if(""!==c){let h;h=d>s?"":r[d+1].toLowerCase();const f=8&i?h:null;if(f&&-1!==kS(f,c,0)||2&i&&c!==h){if(Xi(i))return!1;o=!0}}}}else{if(!o&&!Xi(i)&&!Xi(l))return!1;if(o&&Xi(l))continue;o=!1,i=l|1&i}}return Xi(i)||o}function Xi(n){return 0==(1&n)}function sO(n,e,t,i){if(null===e)return-1;let r=0;if(i||!t){let s=!1;for(;r<e.length;){const o=e[r];if(o===n)return r;if(3===o||6===o)s=!0;else{if(1===o||2===o){let a=e[++r];for(;"string"==typeof a;)a=e[++r];continue}if(4===o)break;if(0===o){r+=4;continue}}r+=s?1:2}return-1}return function lO(n,e){let t=n.indexOf(4);if(t>-1)for(t++;t<n.length;){const i=n[t];if("number"==typeof i)return-1;if(i===e)return t;t++}return-1}(e,n)}function zS(n,e,t=!1){for(let i=0;i<e.length;i++)if(rO(n,e[i],t))return!0;return!1}function VS(n,e){return n?":not("+e.trim()+")":e}function uO(n){let e=n[0],t=1,i=2,r="",s=!1;for(;t<n.length;){let o=n[t];if("string"==typeof o)if(2&i){const a=n[++t];r+="["+o+(a.length>0?'="'+a+'"':"")+"]"}else 8&i?r+="."+o:4&i&&(r+=" "+o);else""!==r&&!Xi(o)&&(e+=VS(s,r),r=""),i=o,s=s||!Xi(i);t++}return""!==r&&(e+=VS(s,r)),e}const qe={};function _t(n){HS(dt(),re(),Wn()+n,!1)}function HS(n,e,t,i){if(!i)if(3==(3&e[2])){const s=n.preOrderCheckHooks;null!==s&&Ad(e,s,t)}else{const s=n.preOrderHooks;null!==s&&Id(e,s,0,t)}to(t)}function $S(n,e=null,t=null,i){const r=qS(n,e,t,i);return r.resolveInjectorInitializers(),r}function qS(n,e=null,t=null,i,r=new Set){const s=[t||xt,AN(n)];return i=i||("object"==typeof n?void 0:Pt(n)),new RS(s,e||Xd(),i||null,r)}let pr=(()=>{class n{static create(t,i){if(Array.isArray(t))return $S({name:""},i,t,"");{const r=t.name??"";return $S({name:r},t.parent,t.providers,r)}}}return n.THROW_IF_NOT_FOUND=rc,n.NULL=new DS,n.\u0275prov=Ae({token:n,providedIn:"any",factory:()=>pe(ES)}),n.__NG_ELEMENT_ID__=-1,n})();function Re(n,e=ze.Default){const t=re();return null===t?pe(n,e):xx(Tn(),t,Ue(n),e)}function tw(n,e){const t=n.contentQueries;if(null!==t)for(let i=0;i<t.length;i+=2){const r=t[i],s=t[i+1];if(-1!==s){const o=n.data[s];Sm(r),o.contentQueries(2,e[s],s)}}}function Jd(n,e,t,i,r,s,o,a,l,c,u){const d=e.blueprint.slice();return d[0]=r,d[2]=76|i,(null!==u||n&&1024&n[2])&&(d[2]|=1024),Zb(d),d[3]=d[15]=n,d[8]=t,d[10]=o||n&&n[10],d[11]=a||n&&n[11],d[12]=l||n&&n[12]||null,d[9]=c||n&&n[9]||null,d[6]=s,d[20]=function P2(){return I2++}(),d[21]=u,d[16]=2==e.type?n[16]:d,d}function Ta(n,e,t,i,r){let s=n.data[e];if(null===s)s=function wg(n,e,t,i,r){const s=tx(),o=_m(),l=n.data[e]=function FO(n,e,t,i,r,s){return{type:t,index:i,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:r,attrs:s,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,o?s:s&&s.parent,t,e,i,r);return null===n.firstChild&&(n.firstChild=l),null!==s&&(o?null==s.child&&null!==l.parent&&(s.child=l):null===s.next&&(s.next=l)),l}(n,e,t,i,r),function OL(){return $e.lFrame.inI18n}()&&(s.flags|=32);else if(64&s.type){s.type=t,s.value=i,s.attrs=r;const o=function hc(){const n=$e.lFrame,e=n.currentTNode;return n.isParent?e:e.parent}();s.injectorIndex=null===o?-1:o.injectorIndex}return hr(s,!0),s}function Ic(n,e,t,i){if(0===t)return-1;const r=e.length;for(let s=0;s<t;s++)e.push(i),n.blueprint.push(i),n.data.push(null);return r}function Mg(n,e,t){wm(e);try{const i=n.viewQuery;null!==i&&Ng(1,i,t);const r=n.template;null!==r&&nw(n,e,r,1,t),n.firstCreatePass&&(n.firstCreatePass=!1),n.staticContentQueries&&tw(n,e),n.staticViewQueries&&Ng(2,n.viewQuery,t);const s=n.components;null!==s&&function LO(n,e){for(let t=0;t<e.length;t++)tF(n,e[t])}(e,s)}catch(i){throw n.firstCreatePass&&(n.incompleteFirstPass=!0,n.firstCreatePass=!1),i}finally{e[2]&=-5,Mm()}}function eh(n,e,t,i){const r=e[2];if(128!=(128&r)){wm(e);try{Zb(e),function ix(n){return $e.lFrame.bindingIndex=n}(n.bindingStartIndex),null!==t&&nw(n,e,t,2,i);const o=3==(3&r);if(o){const c=n.preOrderCheckHooks;null!==c&&Ad(e,c,null)}else{const c=n.preOrderHooks;null!==c&&Id(e,c,0,null),Em(e,0)}if(function JO(n){for(let e=$m(n);null!==e;e=qm(e)){if(!e[2])continue;const t=e[9];for(let i=0;i<t.length;i++){const r=t[i],s=r[3];0==(512&r[2])&&ym(s,1),r[2]|=512}}}(e),function QO(n){for(let e=$m(n);null!==e;e=qm(e))for(let t=10;t<e.length;t++){const i=e[t],r=i[1];Dd(i)&&eh(r,i,r.template,i[8])}}(e),null!==n.contentQueries&&tw(n,e),o){const c=n.contentCheckHooks;null!==c&&Ad(e,c)}else{const c=n.contentHooks;null!==c&&Id(e,c,1),Em(e,1)}!function PO(n,e){const t=n.hostBindingOpCodes;if(null!==t)try{for(let i=0;i<t.length;i++){const r=t[i];if(r<0)to(~r);else{const s=r,o=t[++i],a=t[++i];FL(o,s),a(2,e[s])}}}finally{to(-1)}}(n,e);const a=n.components;null!==a&&function RO(n,e){for(let t=0;t<e.length;t++)eF(n,e[t])}(e,a);const l=n.viewQuery;if(null!==l&&Ng(2,l,i),o){const c=n.viewCheckHooks;null!==c&&Ad(e,c)}else{const c=n.viewHooks;null!==c&&Id(e,c,2),Em(e,2)}!0===n.firstUpdatePass&&(n.firstUpdatePass=!1),e[2]&=-41,512&e[2]&&(e[2]&=-513,ym(e[3],-1))}finally{Mm()}}}function nw(n,e,t,i,r){const s=Wn(),o=2&i;try{to(-1),o&&e.length>22&&HS(n,e,22,!1),t(i,r)}finally{to(s)}}function Eg(n,e,t){if(mm(e)){const r=e.directiveEnd;for(let s=e.directiveStart;s<r;s++){const o=n.data[s];o.contentQueries&&o.contentQueries(1,t[s],s)}}}function Cg(n,e,t){!Qb()||(function HO(n,e,t,i){const r=t.directiveStart,s=t.directiveEnd;dc(t)&&function XO(n,e,t){const i=hi(e,n),r=iw(t),s=n[10],o=th(n,Jd(n,r,null,t.onPush?32:16,i,e,s,s.createRenderer(i,t),null,null,null));n[e.index]=o}(e,t,n.data[r+t.componentOffset]),n.firstCreatePass||Nd(t,e),Nn(i,e);const o=t.initialInputs;for(let a=r;a<s;a++){const l=n.data[a],c=no(e,n,a,t);Nn(c,e),null!==o&&ZO(0,a-r,c,l,0,o),Yi(l)&&(fi(t.index,e)[8]=no(e,n,a,t))}}(n,e,t,hi(t,e)),64==(64&t.flags)&&cw(n,e,t))}function Dg(n,e,t=hi){const i=e.localNames;if(null!==i){let r=e.index+1;for(let s=0;s<i.length;s+=2){const o=i[s+1],a=-1===o?t(e,n):n[o];n[r++]=a}}}function iw(n){const e=n.tView;return null===e||e.incompleteFirstPass?n.tView=Tg(1,null,n.template,n.decls,n.vars,n.directiveDefs,n.pipeDefs,n.viewQuery,n.schemas,n.consts):e}function Tg(n,e,t,i,r,s,o,a,l,c){const u=22+i,d=u+r,h=function NO(n,e){const t=[];for(let i=0;i<e;i++)t.push(i<n?null:qe);return t}(u,d),f="function"==typeof c?c():c;return h[1]={type:n,blueprint:h,template:t,queries:null,viewQuery:a,declTNode:e,data:h.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:d,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof s?s():s,pipeRegistry:"function"==typeof o?o():o,firstChild:null,schemas:l,consts:f,incompleteFirstPass:!1}}function sw(n,e,t,i){for(let r in n)if(n.hasOwnProperty(r)){t=null===t?{}:t;const s=n[r];null===i?ow(t,e,r,s):i.hasOwnProperty(r)&&ow(t,e,i[r],s)}return t}function ow(n,e,t,i){n.hasOwnProperty(t)?n[t].push(e,i):n[t]=[e,i]}function aw(n,e){const t=fi(e,n);16&t[2]||(t[2]|=32)}function Ag(n,e,t,i){let r=!1;if(Qb()){const s=null===i?null:{"":-1},o=function WO(n,e){const t=n.directiveRegistry;let i=null,r=null;if(t)for(let s=0;s<t.length;s++){const o=t[s];if(zS(e,o.selectors,!1))if(i||(i=[]),Yi(o))if(null!==o.findHostDirectiveDefs){const a=[];r=r||new Map,o.findHostDirectiveDefs(o,a,r),i.unshift(...a,o),Ig(n,e,a.length)}else i.unshift(o),Ig(n,e,0);else r=r||new Map,o.findHostDirectiveDefs?.(o,i,r),i.push(o)}return null===i?null:[i,r]}(n,t);let a,l;null===o?a=l=null:[a,l]=o,null!==a&&(r=!0,lw(n,e,t,a,s,l)),s&&function jO(n,e,t){if(e){const i=n.localNames=[];for(let r=0;r<e.length;r+=2){const s=t[e[r+1]];if(null==s)throw new ie(-301,!1);i.push(e[r],s)}}}(t,i,s)}return t.mergedAttrs=pc(t.mergedAttrs,t.attrs),r}function lw(n,e,t,i,r,s){for(let c=0;c<i.length;c++)Pm(Nd(t,e),n,i[c].type);!function qO(n,e,t){n.flags|=1,n.directiveStart=e,n.directiveEnd=e+t,n.providerIndexes=e}(t,n.data.length,i.length);for(let c=0;c<i.length;c++){const u=i[c];u.providersResolver&&u.providersResolver(u)}let o=!1,a=!1,l=Ic(n,e,i.length,null);for(let c=0;c<i.length;c++){const u=i[c];t.mergedAttrs=pc(t.mergedAttrs,u.hostAttrs),YO(n,t,e,l,u),$O(l,u,r),null!==u.contentQueries&&(t.flags|=4),(null!==u.hostBindings||null!==u.hostAttrs||0!==u.hostVars)&&(t.flags|=64);const d=u.type.prototype;!o&&(d.ngOnChanges||d.ngOnInit||d.ngDoCheck)&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t.index),o=!0),!a&&(d.ngOnChanges||d.ngDoCheck)&&((n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t.index),a=!0),l++}!function kO(n,e,t){const r=e.directiveEnd,s=n.data,o=e.attrs,a=[];let l=null,c=null;for(let u=e.directiveStart;u<r;u++){const d=s[u],h=t?t.get(d):null,p=h?h.outputs:null;l=sw(d.inputs,u,l,h?h.inputs:null),c=sw(d.outputs,u,c,p);const g=null===l||null===o||US(e)?null:KO(l,u,o);a.push(g)}null!==l&&(l.hasOwnProperty("class")&&(e.flags|=8),l.hasOwnProperty("style")&&(e.flags|=16)),e.initialInputs=a,e.inputs=l,e.outputs=c}(n,t,s)}function cw(n,e,t){const i=t.directiveStart,r=t.directiveEnd,s=t.index,o=function kL(){return $e.lFrame.currentDirectiveIndex}();try{to(s);for(let a=i;a<r;a++){const l=n.data[a],c=e[a];bm(a),(null!==l.hostBindings||0!==l.hostVars||null!==l.hostAttrs)&&GO(l,c)}}finally{to(-1),bm(o)}}function GO(n,e){null!==n.hostBindings&&n.hostBindings(1,e)}function Ig(n,e,t){e.componentOffset=t,(n.components||(n.components=[])).push(e.index)}function $O(n,e,t){if(t){if(e.exportAs)for(let i=0;i<e.exportAs.length;i++)t[e.exportAs[i]]=n;Yi(e)&&(t[""]=n)}}function YO(n,e,t,i,r){n.data[i]=r;const s=r.factory||(r.factory=Js(r.type)),o=new fc(s,Yi(r),Re);n.blueprint[i]=o,t[i]=o,function zO(n,e,t,i,r){const s=r.hostBindings;if(s){let o=n.hostBindingOpCodes;null===o&&(o=n.hostBindingOpCodes=[]);const a=~e.index;(function VO(n){let e=n.length;for(;e>0;){const t=n[--e];if("number"==typeof t&&t<0)return t}return 0})(o)!=a&&o.push(a),o.push(t,i,s)}}(n,e,i,Ic(n,t,r.hostVars,qe),r)}function mr(n,e,t,i,r,s){const o=hi(n,e);!function Pg(n,e,t,i,r,s,o){if(null==s)n.removeAttribute(e,r,t);else{const a=null==o?je(s):o(s,i||"",r);n.setAttribute(e,r,a,t)}}(e[11],o,s,n.value,t,i,r)}function ZO(n,e,t,i,r,s){const o=s[e];if(null!==o){const a=i.setInput;for(let l=0;l<o.length;){const c=o[l++],u=o[l++],d=o[l++];null!==a?i.setInput(t,d,c,u):t[u]=d}}}function KO(n,e,t){let i=null,r=0;for(;r<t.length;){const s=t[r];if(0!==s)if(5!==s){if("number"==typeof s)break;if(n.hasOwnProperty(s)){null===i&&(i=[]);const o=n[s];for(let a=0;a<o.length;a+=2)if(o[a]===e){i.push(s,o[a+1],t[r+1]);break}}r+=2}else r+=2;else r+=4}return i}function uw(n,e,t,i){return[n,!0,!1,e,null,0,i,t,null,null]}function eF(n,e){const t=fi(e,n);if(Dd(t)){const i=t[1];48&t[2]?eh(i,t,i.template,t[8]):t[5]>0&&Rg(t)}}function Rg(n){for(let i=$m(n);null!==i;i=qm(i))for(let r=10;r<i.length;r++){const s=i[r];if(Dd(s))if(512&s[2]){const o=s[1];eh(o,s,o.template,s[8])}else s[5]>0&&Rg(s)}const t=n[1].components;if(null!==t)for(let i=0;i<t.length;i++){const r=fi(t[i],n);Dd(r)&&r[5]>0&&Rg(r)}}function tF(n,e){const t=fi(e,n),i=t[1];(function nF(n,e){for(let t=e.length;t<n.blueprint.length;t++)e.push(n.blueprint[t])})(i,t),Mg(i,t,t[8])}function th(n,e){return n[13]?n[14][4]=e:n[13]=e,n[14]=e,e}function Lg(n){for(;n;){n[2]|=32;const e=wc(n);if(yL(n)&&!e)return n;n=e}return null}function nh(n,e,t,i=!0){const r=e[10];r.begin&&r.begin();try{eh(n,e,n.template,t)}catch(o){throw i&&pw(e,o),o}finally{r.end&&r.end()}}function Ng(n,e,t){Sm(0),e(n,t)}function dw(n){return n[7]||(n[7]=[])}function hw(n){return n.cleanup||(n.cleanup=[])}function pw(n,e){const t=n[9],i=t?t.get(Ea,null):null;i&&i.handleError(e)}function Og(n,e,t,i,r){for(let s=0;s<t.length;){const o=t[s++],a=t[s++],l=e[o],c=n.data[o];null!==c.setInput?c.setInput(l,r,i,a):l[a]=r}}function kr(n,e,t){const i=function Cd(n,e){return Dn(e[n])}(e,n);!function Zx(n,e,t){n.setValue(e,t)}(n[11],i,t)}function ih(n,e,t){let i=t?n.styles:null,r=t?n.classes:null,s=0;if(null!==e)for(let o=0;o<e.length;o++){const a=e[o];"number"==typeof a?s=a:1==s?r=im(r,a):2==s&&(i=im(i,a+": "+e[++o]+";"))}t?n.styles=i:n.stylesWithoutHost=i,t?n.classes=r:n.classesWithoutHost=r}function rh(n,e,t,i,r=!1){for(;null!==t;){const s=e[t.index];if(null!==s&&i.push(Dn(s)),qi(s))for(let a=10;a<s.length;a++){const l=s[a],c=l[1].firstChild;null!==c&&rh(l[1],l,c,i)}const o=t.type;if(8&o)rh(n,e,t.child,i);else if(32&o){const a=jm(t,e);let l;for(;l=a();)i.push(l)}else if(16&o){const a=aS(e,t);if(Array.isArray(a))i.push(...a);else{const l=wc(e[16]);rh(l[1],l,a,i,!0)}}t=r?t.projectionNext:t.next}return i}class Pc{constructor(e,t){this._lView=e,this._cdRefInjectingView=t,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,t=e[1];return rh(t,e,t.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 128==(128&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(qi(e)){const t=e[8],i=t?t.indexOf(this):-1;i>-1&&(Zm(e,i),kd(t,i))}this._attachedToViewContainer=!1}Qx(this._lView[1],this._lView)}onDestroy(e){!function rw(n,e,t,i){const r=dw(e);null===t?r.push(i):(r.push(t),n.firstCreatePass&&hw(n).push(i,r.length-1))}(this._lView[1],this._lView,null,e)}markForCheck(){Lg(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-65}reattach(){this._lView[2]|=64}detectChanges(){nh(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new ie(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function $2(n,e){Mc(n,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new ie(902,!1);this._appRef=e}}class iF extends Pc{constructor(e){super(e),this._view=e}detectChanges(){const e=this._view;nh(e[1],e,e[8],!1)}checkNoChanges(){}get context(){return null}}class mw extends Tc{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const t=Mt(e);return new Rc(t,this.ngModule)}}function gw(n){const e=[];for(let t in n)n.hasOwnProperty(t)&&e.push({propName:n[t],templateName:t});return e}class sF{constructor(e,t){this.injector=e,this.parentInjector=t}get(e,t,i){i=vd(i);const r=this.injector.get(e,gg,i);return r!==gg||t===gg?r:this.parentInjector.get(e,t,i)}}class Rc extends NS{constructor(e,t){super(),this.componentDef=e,this.ngModule=t,this.componentType=e.type,this.selector=function dO(n){return n.map(uO).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!t}get inputs(){return gw(this.componentDef.inputs)}get outputs(){return gw(this.componentDef.outputs)}create(e,t,i,r){let s=(r=r||this.ngModule)instanceof Or?r:r?.injector;s&&null!==this.componentDef.getStandaloneInjector&&(s=this.componentDef.getStandaloneInjector(s)||s);const o=s?new sF(e,s):e,a=o.get(Ac,null);if(null===a)throw new ie(407,!1);const l=o.get(WN,null),c=a.createRenderer(null,this.componentDef),u=this.componentDef.selectors[0][0]||"div",d=i?function OO(n,e,t){return n.selectRootElement(e,t===Wi.ShadowDom)}(c,i,this.componentDef.encapsulation):Xm(c,u,function rF(n){const e=n.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(u)),h=this.componentDef.onPush?288:272,f=Tg(0,null,null,1,0,null,null,null,null,null),p=Jd(null,f,null,h,null,null,a,c,l,o,null);let g,m;wm(p);try{const y=this.componentDef;let b,_=null;y.findHostDirectiveDefs?(b=[],_=new Map,y.findHostDirectiveDefs(y,b,_),b.push(y)):b=[y];const v=function aF(n,e){const t=n[1];return n[22]=e,Ta(t,22,2,"#host",null)}(p,d),S=function lF(n,e,t,i,r,s,o,a){const l=r[1];!function cF(n,e,t,i){for(const r of n)e.mergedAttrs=pc(e.mergedAttrs,r.hostAttrs);null!==e.mergedAttrs&&(ih(e,e.mergedAttrs,!0),null!==t&&uS(i,t,e))}(i,n,e,o);const c=s.createRenderer(e,t),u=Jd(r,iw(t),null,t.onPush?32:16,r[n.index],n,s,c,a||null,null,null);return l.firstCreatePass&&Ig(l,n,i.length-1),th(r,u),r[n.index]=u}(v,d,y,b,p,a,c);m=Xb(f,22),d&&function dF(n,e,t,i){if(i)Dm(n,t,["ng-version",jN.full]);else{const{attrs:r,classes:s}=function hO(n){const e=[],t=[];let i=1,r=2;for(;i<n.length;){let s=n[i];if("string"==typeof s)2===r?""!==s&&e.push(s,n[++i]):8===r&&t.push(s);else{if(!Xi(r))break;r=s}i++}return{attrs:e,classes:t}}(e.selectors[0]);r&&Dm(n,t,r),s&&s.length>0&&cS(n,t,s.join(" "))}}(c,y,d,i),void 0!==t&&function hF(n,e,t){const i=n.projection=[];for(let r=0;r<e.length;r++){const s=t[r];i.push(null!=s?Array.from(s):null)}}(m,this.ngContentSelectors,t),g=function uF(n,e,t,i,r,s){const o=Tn(),a=r[1],l=hi(o,r);lw(a,r,o,t,null,i);for(let u=0;u<t.length;u++)Nn(no(r,a,o.directiveStart+u,o),r);cw(a,r,o),l&&Nn(l,r);const c=no(r,a,o.directiveStart+o.componentOffset,o);if(n[8]=r[8]=c,null!==s)for(const u of s)u(c,e);return Eg(a,o,n),c}(S,y,b,_,p,[fF]),Mg(f,p,null)}finally{Mm()}return new oF(this.componentType,g,Ma(m,p),p,m)}}class oF extends BN{constructor(e,t,i,r,s){super(),this.location=i,this._rootLView=r,this._tNode=s,this.instance=t,this.hostView=this.changeDetectorRef=new iF(r),this.componentType=e}setInput(e,t){const i=this._tNode.inputs;let r;if(null!==i&&(r=i[e])){const s=this._rootLView;Og(s[1],s,r,e,t),aw(s,this._tNode.index)}}get injector(){return new ma(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}function fF(){const n=Tn();Td(re()[1],n)}let sh=null;function lo(){if(!sh){const n=Lt.Symbol;if(n&&n.iterator)sh=n.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let t=0;t<e.length;++t){const i=e[t];"entries"!==i&&"size"!==i&&Map.prototype[i]===Map.prototype.entries&&(sh=i)}}}return sh}function Lc(n){return!!function kg(n){return null!==n&&("function"==typeof n||"object"==typeof n)}(n)&&(Array.isArray(n)||!(n instanceof Map)&&lo()in n)}function On(n,e,t){return!Object.is(n[e],t)&&(n[e]=t,!0)}function Bg(n,e,t,i){const r=re();return On(r,fa(),e)&&(dt(),mr(Vt(),r,n,e,t,i)),Bg}function si(n,e,t,i,r,s,o,a){const l=re(),c=dt(),u=n+22,d=c.firstCreatePass?function DF(n,e,t,i,r,s,o,a,l){const c=e.consts,u=Ta(e,n,4,o||null,ys(c,a));Ag(e,t,u,ys(c,l)),Td(e,u);const d=u.tViews=Tg(2,u,i,r,s,e.directiveRegistry,e.pipeRegistry,null,e.schemas,c);return null!==e.queries&&(e.queries.template(e,u),d.queries=e.queries.embeddedTView(u)),u}(u,c,l,e,t,i,r,s,o):c.data[u];hr(d,!1);const h=l[11].createComment("");Hd(c,l,h,d),Nn(h,l),th(l,l[u]=uw(h,l,h,d)),Ed(d)&&Cg(c,l,d),null!=o&&Dg(l,d,a)}function Et(n,e,t){const i=re();return On(i,fa(),e)&&function mi(n,e,t,i,r,s,o,a){const l=hi(e,t);let u,c=e.inputs;!a&&null!=c&&(u=c[i])?(Og(n,t,u,i,r),dc(e)&&aw(t,e.index)):3&e.type&&(i=function BO(n){return"class"===n?"className":"for"===n?"htmlFor":"formaction"===n?"formAction":"innerHtml"===n?"innerHTML":"readonly"===n?"readOnly":"tabindex"===n?"tabIndex":n}(i),r=null!=o?o(r,e.value||"",i):r,s.setProperty(l,i,r))}(dt(),Vt(),i,n,e,i[11],t,!1),Et}function Ug(n,e,t,i,r){const o=r?"class":"style";Og(n,t,e.inputs[o],o,i)}function Xe(n,e,t,i){const r=re(),s=dt(),o=22+n,a=r[11],l=r[o]=Xm(a,e,function jL(){return $e.lFrame.currentNamespace}()),c=s.firstCreatePass?function IF(n,e,t,i,r,s,o){const a=e.consts,c=Ta(e,n,2,r,ys(a,s));return Ag(e,t,c,ys(a,o)),null!==c.attrs&&ih(c,c.attrs,!1),null!==c.mergedAttrs&&ih(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(o,s,r,0,e,t,i):s.data[o];return hr(c,!0),uS(a,l,c),32!=(32&c.flags)&&Hd(s,r,l,c),0===function AL(){return $e.lFrame.elementDepthCount}()&&Nn(l,r),function IL(){$e.lFrame.elementDepthCount++}(),Ed(c)&&(Cg(s,r,c),Eg(s,c,r)),null!==i&&Dg(r,c),Xe}function lt(){let n=Tn();_m()?vm():(n=n.parent,hr(n,!1));const e=n;!function PL(){$e.lFrame.elementDepthCount--}();const t=dt();return t.firstCreatePass&&(Td(t,n),mm(n)&&t.queries.elementEnd(n)),null!=e.classesWithoutHost&&function XL(n){return 0!=(8&n.flags)}(e)&&Ug(t,e,re(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function ZL(n){return 0!=(16&n.flags)}(e)&&Ug(t,e,re(),e.stylesWithoutHost,!1),lt}function ht(n,e,t,i){return Xe(n,e,t,i),lt(),ht}function Zi(n,e,t){const i=re(),r=dt(),s=n+22,o=r.firstCreatePass?function PF(n,e,t,i,r){const s=e.consts,o=ys(s,i),a=Ta(e,n,8,"ng-container",o);return null!==o&&ih(a,o,!0),Ag(e,t,a,ys(s,r)),null!==e.queries&&e.queries.elementStart(e,a),a}(s,r,i,e,t):r.data[s];hr(o,!0);const a=i[s]=i[11].createComment("");return Hd(r,i,a,o),Nn(a,i),Ed(o)&&(Cg(r,i,o),Eg(r,o,i)),null!=t&&Dg(i,o),Zi}function Ki(){let n=Tn();const e=dt();return _m()?vm():(n=n.parent,hr(n,!1)),e.firstCreatePass&&(Td(e,n),mm(n)&&e.queries.elementEnd(n)),Ki}function ah(n){return!!n&&"function"==typeof n.then}function Lw(n){return!!n&&"function"==typeof n.subscribe}const Nw=Lw;function Qi(n,e,t,i){const r=re(),s=dt(),o=Tn();return function Fw(n,e,t,i,r,s,o){const a=Ed(i),c=n.firstCreatePass&&hw(n),u=e[8],d=dw(e);let h=!0;if(3&i.type||o){const g=hi(i,e),m=o?o(g):g,y=d.length,b=o?v=>o(Dn(v[i.index])):i.index;let _=null;if(!o&&a&&(_=function RF(n,e,t,i){const r=n.cleanup;if(null!=r)for(let s=0;s<r.length-1;s+=2){const o=r[s];if(o===t&&r[s+1]===i){const a=e[7],l=r[s+2];return a.length>l?a[l]:null}"string"==typeof o&&(s+=2)}return null}(n,e,r,i.index)),null!==_)(_.__ngLastListenerFn__||_).__ngNextListenerFn__=s,_.__ngLastListenerFn__=s,h=!1;else{s=Bw(i,e,u,s,!1);const v=t.listen(m,r,s);d.push(s,v),c&&c.push(r,b,y,y+1)}}else s=Bw(i,e,u,s,!1);const f=i.outputs;let p;if(h&&null!==f&&(p=f[r])){const g=p.length;if(g)for(let m=0;m<g;m+=2){const S=e[p[m]][p[m+1]].subscribe(s),M=d.length;d.push(s,S),c&&c.push(r,i.index,M,-(M+1))}}}(s,r,r[11],o,n,e,i),Qi}function kw(n,e,t,i){try{return!1!==t(i)}catch(r){return pw(n,r),!1}}function Bw(n,e,t,i,r){return function s(o){if(o===Function)return i;Lg(n.componentOffset>-1?fi(n.index,e):e);let l=kw(e,0,i,o),c=s.__ngNextListenerFn__;for(;c;)l=kw(e,0,c,o)&&l,c=c.__ngNextListenerFn__;return r&&!1===l&&(o.preventDefault(),o.returnValue=!1),l}}function Oc(n=1){return function UL(n){return($e.lFrame.contextLView=function zL(n,e){for(;n>0;)e=e[15],n--;return e}(n,$e.lFrame.contextLView))[8]}(n)}function Br(n,e=""){const t=re(),i=dt(),r=n+22,s=i.firstCreatePass?Ta(i,r,1,e,null):i.data[r],o=t[r]=function Ym(n,e){return n.createText(e)}(t[11],e);Hd(i,t,o,s),hr(s,!1)}function Ua(n){return kc("",n,""),Ua}function kc(n,e,t){const i=re(),r=function Ia(n,e,t,i){return On(n,fa(),t)?e+je(t)+i:qe}(i,n,e,t);return r!==qe&&kr(i,Wn(),r),kc}const Va="en-US";let IM=Va;class Ha{}class nE{}class iE extends Ha{constructor(e,t){super(),this._parent=t,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new mw(this);const i=ui(e);this._bootstrapComponents=Fr(i.bootstrap),this._r3Injector=qS(e,t,[{provide:Ha,useValue:this},{provide:Tc,useValue:this.componentFactoryResolver}],Pt(e),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(e)}get injector(){return this._r3Injector}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Kg extends nE{constructor(e){super(),this.moduleType=e}create(e){return new iE(this.moduleType,e)}}class wk extends Ha{constructor(e,t,i){super(),this.componentFactoryResolver=new mw(this),this.instance=null;const r=new RS([...e,{provide:Ha,useValue:this},{provide:Tc,useValue:this.componentFactoryResolver}],t||Xd(),i,new Set(["environment"]));this.injector=r,r.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(e){this.injector.onDestroy(e)}}function ph(n,e,t=null){return new wk(n,e,t).injector}let Mk=(()=>{class n{constructor(t){this._injector=t,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(t){if(!t.standalone)return null;if(!this.cachedInjectors.has(t.id)){const i=TS(0,t.type),r=i.length>0?ph([i],this._injector,`Standalone[${t.type.name}]`):null;this.cachedInjectors.set(t.id,r)}return this.cachedInjectors.get(t.id)}ngOnDestroy(){try{for(const t of this.cachedInjectors.values())null!==t&&t.destroy()}finally{this.cachedInjectors.clear()}}}return n.\u0275prov=Ae({token:n,providedIn:"environment",factory:()=>new n(pe(Or))}),n})();function rE(n){n.getStandaloneInjector=e=>e.get(Mk).getOrCreateStandaloneInjector(n)}function dE(n,e,t,i,r,s){const o=e+t;return On(n,o,r)?function gr(n,e,t){return n[e]=t}(n,o+1,s?i.call(s,r):i(r)):function Gc(n,e){const t=n[e];return t===qe?void 0:t}(n,o+1)}function qt(n,e){const t=dt();let i;const r=n+22;t.firstCreatePass?(i=function Gk(n,e){if(e)for(let t=e.length-1;t>=0;t--){const i=e[t];if(n===i.name)return i}}(e,t.pipeRegistry),t.data[r]=i,i.onDestroy&&(t.destroyHooks||(t.destroyHooks=[])).push(r,i.onDestroy)):i=t.data[r];const s=i.factory||(i.factory=Js(i.type)),o=Di(Re);try{const a=Ld(!1),l=s();return Ld(a),function TF(n,e,t,i){t>=n.data.length&&(n.data[t]=null,n.blueprint[t]=null),e[t]=i}(t,re(),r,l),l}finally{Di(o)}}function Yt(n,e,t){const i=n+22,r=re(),s=function ha(n,e){return n[e]}(r,i);return function Wc(n,e){return n[1].data[e].pure}(r,i)?dE(r,function Gn(){const n=$e.lFrame;let e=n.bindingRootIndex;return-1===e&&(e=n.bindingRootIndex=n.tView.bindingStartIndex),e}(),e,s.transform,t,s):s.transform(t)}function Jg(n){return e=>{setTimeout(n,void 0,e)}}const $n=class Yk extends li{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,t,i){let r=e,s=t||(()=>null),o=i;if(e&&"object"==typeof e){const l=e;r=l.next?.bind(l),s=l.error?.bind(l),o=l.complete?.bind(l)}this.__isAsync&&(s=Jg(s),r&&(r=Jg(r)),o&&(o=Jg(o)));const a=super.subscribe({next:r,error:s,complete:o});return e instanceof Mi&&e.add(a),a}};let Ur=(()=>{class n{}return n.__NG_ELEMENT_ID__=Qk,n})();const Zk=Ur,Kk=class extends Zk{constructor(e,t,i){super(),this._declarationLView=e,this._declarationTContainer=t,this.elementRef=i}createEmbeddedView(e,t){const i=this._declarationTContainer.tViews,r=Jd(this._declarationLView,i,e,16,null,i.declTNode,null,null,null,null,t||null);r[17]=this._declarationLView[this._declarationTContainer.index];const o=this._declarationLView[19];return null!==o&&(r[19]=o.createEmbeddedView(i)),Mg(i,r,e),new Pc(r)}};function Qk(){return function mh(n,e){return 4&n.type?new Kk(e,n,Ma(n,e)):null}(Tn(),re())}let tr=(()=>{class n{}return n.__NG_ELEMENT_ID__=Jk,n})();function Jk(){return function _E(n,e){let t;const i=e[n.index];if(qi(i))t=i;else{let r;if(8&n.type)r=Dn(i);else{const s=e[11];r=s.createComment("");const o=hi(n,e);ro(s,Vd(s,o),r,function J2(n,e){return n.nextSibling(e)}(s,o),!1)}e[n.index]=t=uw(i,e,r,n),th(e,t)}return new gE(t,n,e)}(Tn(),re())}const eB=tr,gE=class extends eB{constructor(e,t,i){super(),this._lContainer=e,this._hostTNode=t,this._hostLView=i}get element(){return Ma(this._hostTNode,this._hostLView)}get injector(){return new ma(this._hostTNode,this._hostLView)}get parentInjector(){const e=Im(this._hostTNode,this._hostLView);if(mx(e)){const t=Rd(e,this._hostLView),i=Pd(e);return new ma(t[1].data[i+8],t)}return new ma(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const t=yE(this._lContainer);return null!==t&&t[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,t,i){let r,s;"number"==typeof i?r=i:null!=i&&(r=i.index,s=i.injector);const o=e.createEmbeddedView(t||{},s);return this.insert(o,r),o}createComponent(e,t,i,r,s){const o=e&&!function gc(n){return"function"==typeof n}(e);let a;if(o)a=t;else{const d=t||{};a=d.index,i=d.injector,r=d.projectableNodes,s=d.environmentInjector||d.ngModuleRef}const l=o?e:new Rc(Mt(e)),c=i||this.parentInjector;if(!s&&null==l.ngModule){const h=(o?c:this.parentInjector).get(Or,null);h&&(s=h)}const u=l.create(c,r,void 0,s);return this.insert(u.hostView,a),u}insert(e,t){const i=e._lView,r=i[1];if(function TL(n){return qi(n[3])}(i)){const u=this.indexOf(e);if(-1!==u)this.detach(u);else{const d=i[3],h=new gE(d,d[6],d[3]);h.detach(h.indexOf(e))}}const s=this._adjustIndex(t),o=this._lContainer;!function Y2(n,e,t,i){const r=10+i,s=t.length;i>0&&(t[r-1][4]=e),i<s-10?(e[4]=t[r],Tx(t,10+i,e)):(t.push(e),e[4]=null),e[3]=t;const o=e[17];null!==o&&t!==o&&function X2(n,e){const t=n[9];e[16]!==e[3][3][16]&&(n[2]=!0),null===t?n[9]=[e]:t.push(e)}(o,e);const a=e[19];null!==a&&a.insertView(n),e[2]|=64}(r,i,o,s);const a=Jm(s,o),l=i[11],c=Vd(l,o[7]);return null!==c&&function j2(n,e,t,i,r,s){i[0]=r,i[6]=e,Mc(n,i,t,1,r,s)}(r,o[6],l,i,c,a),e.attachToViewContainerRef(),Tx(ty(o),s,e),e}move(e,t){return this.insert(e,t)}indexOf(e){const t=yE(this._lContainer);return null!==t?t.indexOf(e):-1}remove(e){const t=this._adjustIndex(e,-1),i=Zm(this._lContainer,t);i&&(kd(ty(this._lContainer),t),Qx(i[1],i))}detach(e){const t=this._adjustIndex(e,-1),i=Zm(this._lContainer,t);return i&&null!=kd(ty(this._lContainer),t)?new Pc(i):null}_adjustIndex(e,t=0){return e??this.length+t}};function yE(n){return n[8]}function ty(n){return n[8]||(n[8]=[])}function yh(...n){}const $c=new Ne("Application Initializer");let _h=(()=>{class n{constructor(t){this.appInits=t,this.resolve=yh,this.reject=yh,this.initialized=!1,this.done=!1,this.donePromise=new Promise((i,r)=>{this.resolve=i,this.reject=r})}runInitializers(){if(this.initialized)return;const t=[],i=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let r=0;r<this.appInits.length;r++){const s=this.appInits[r]();if(ah(s))t.push(s);else if(Nw(s)){const o=new Promise((a,l)=>{s.subscribe({complete:a,error:l})});t.push(o)}}Promise.all(t).then(()=>{i()}).catch(r=>{this.reject(r)}),0===t.length&&i(),this.initialized=!0}}return n.\u0275fac=function(t){return new(t||n)(pe($c,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const qc=new Ne("AppId",{providedIn:"root",factory:function jE(){return`${dy()}${dy()}${dy()}`}});function dy(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const $E=new Ne("Platform Initializer"),vh=new Ne("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),qE=new Ne("appBootstrapListener"),YE=new Ne("AnimationModuleType");let TB=(()=>{class n{log(t){console.log(t)}warn(t){console.warn(t)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();const zr=new Ne("LocaleId",{providedIn:"root",factory:()=>ut(zr,ze.Optional|ze.SkipSelf)||function AB(){return typeof $localize<"u"&&$localize.locale||Va}()});class PB{constructor(e,t){this.ngModuleFactory=e,this.componentFactories=t}}let XE=(()=>{class n{compileModuleSync(t){return new Kg(t)}compileModuleAsync(t){return Promise.resolve(this.compileModuleSync(t))}compileModuleAndAllComponentsSync(t){const i=this.compileModuleSync(t),s=Fr(ui(t).declarations).reduce((o,a)=>{const l=Mt(a);return l&&o.push(new Rc(l)),o},[]);return new PB(i,s)}compileModuleAndAllComponentsAsync(t){return Promise.resolve(this.compileModuleAndAllComponentsSync(t))}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const NB=(()=>Promise.resolve(0))();function hy(n){typeof Zone>"u"?NB.then(()=>{n&&n.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",n)}class Ut{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:t=!1,shouldCoalesceRunChangeDetection:i=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new $n(!1),this.onMicrotaskEmpty=new $n(!1),this.onStable=new $n(!1),this.onError=new $n(!1),typeof Zone>"u")throw new ie(908,!1);Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!i&&t,r.shouldCoalesceRunChangeDetection=i,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function OB(){let n=Lt.requestAnimationFrame,e=Lt.cancelAnimationFrame;if(typeof Zone<"u"&&n&&e){const t=n[Zone.__symbol__("OriginalDelegate")];t&&(n=t);const i=e[Zone.__symbol__("OriginalDelegate")];i&&(e=i)}return{nativeRequestAnimationFrame:n,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function BB(n){const e=()=>{!function kB(n){n.isCheckStableRunning||-1!==n.lastRequestAnimationFrameId||(n.lastRequestAnimationFrameId=n.nativeRequestAnimationFrame.call(Lt,()=>{n.fakeTopEventTask||(n.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{n.lastRequestAnimationFrameId=-1,py(n),n.isCheckStableRunning=!0,fy(n),n.isCheckStableRunning=!1},void 0,()=>{},()=>{})),n.fakeTopEventTask.invoke()}),py(n))}(n)};n._inner=n._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(t,i,r,s,o,a)=>{try{return QE(n),t.invokeTask(r,s,o,a)}finally{(n.shouldCoalesceEventChangeDetection&&"eventTask"===s.type||n.shouldCoalesceRunChangeDetection)&&e(),JE(n)}},onInvoke:(t,i,r,s,o,a,l)=>{try{return QE(n),t.invoke(r,s,o,a,l)}finally{n.shouldCoalesceRunChangeDetection&&e(),JE(n)}},onHasTask:(t,i,r,s)=>{t.hasTask(r,s),i===r&&("microTask"==s.change?(n._hasPendingMicrotasks=s.microTask,py(n),fy(n)):"macroTask"==s.change&&(n.hasPendingMacrotasks=s.macroTask))},onHandleError:(t,i,r,s)=>(t.handleError(r,s),n.runOutsideAngular(()=>n.onError.emit(s)),!1)})}(r)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ut.isInAngularZone())throw new ie(909,!1)}static assertNotInAngularZone(){if(Ut.isInAngularZone())throw new ie(909,!1)}run(e,t,i){return this._inner.run(e,t,i)}runTask(e,t,i,r){const s=this._inner,o=s.scheduleEventTask("NgZoneEvent: "+r,e,FB,yh,yh);try{return s.runTask(o,t,i)}finally{s.cancelTask(o)}}runGuarded(e,t,i){return this._inner.runGuarded(e,t,i)}runOutsideAngular(e){return this._outer.run(e)}}const FB={};function fy(n){if(0==n._nesting&&!n.hasPendingMicrotasks&&!n.isStable)try{n._nesting++,n.onMicrotaskEmpty.emit(null)}finally{if(n._nesting--,!n.hasPendingMicrotasks)try{n.runOutsideAngular(()=>n.onStable.emit(null))}finally{n.isStable=!0}}}function py(n){n.hasPendingMicrotasks=!!(n._hasPendingMicrotasks||(n.shouldCoalesceEventChangeDetection||n.shouldCoalesceRunChangeDetection)&&-1!==n.lastRequestAnimationFrameId)}function QE(n){n._nesting++,n.isStable&&(n.isStable=!1,n.onUnstable.emit(null))}function JE(n){n._nesting--,fy(n)}class UB{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new $n,this.onMicrotaskEmpty=new $n,this.onStable=new $n,this.onError=new $n}run(e,t,i){return e.apply(t,i)}runGuarded(e,t,i){return e.apply(t,i)}runOutsideAngular(e){return e()}runTask(e,t,i,r){return e.apply(t,i)}}const eC=new Ne(""),bh=new Ne("");let yy,my=(()=>{class n{constructor(t,i,r){this._ngZone=t,this.registry=i,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,yy||(function zB(n){yy=n}(r),r.addToWindow(i)),this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ut.assertNotInAngularZone(),hy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())hy(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(i=>!i.updateCb||!i.updateCb(t)||(clearTimeout(i.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,i,r){let s=-1;i&&i>0&&(s=setTimeout(()=>{this._callbacks=this._callbacks.filter(o=>o.timeoutId!==s),t(this._didWork,this.getPendingTasks())},i)),this._callbacks.push({doneCb:t,timeoutId:s,updateCb:r})}whenStable(t,i,r){if(r&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(t,i,r),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(t){this.registry.registerApplication(t,this)}unregisterApplication(t){this.registry.unregisterApplication(t)}findProviders(t,i,r){return[]}}return n.\u0275fac=function(t){return new(t||n)(pe(Ut),pe(gy),pe(bh))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),gy=(()=>{class n{constructor(){this._applications=new Map}registerApplication(t,i){this._applications.set(t,i)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,i=!0){return yy?.findTestabilityInTree(this,t,i)??null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})(),xs=null;const tC=new Ne("AllowMultipleToken"),_y=new Ne("PlatformDestroyListeners");class nC{constructor(e,t){this.name=e,this.token=t}}function rC(n,e,t=[]){const i=`Platform: ${e}`,r=new Ne(i);return(s=[])=>{let o=vy();if(!o||o.injector.get(tC,!1)){const a=[...t,...s,{provide:r,useValue:!0}];n?n(a):function GB(n){if(xs&&!xs.get(tC,!1))throw new ie(400,!1);xs=n;const e=n.get(oC);(function iC(n){const e=n.get($E,null);e&&e.forEach(t=>t())})(n)}(function sC(n=[],e){return pr.create({name:e,providers:[{provide:hg,useValue:"platform"},{provide:_y,useValue:new Set([()=>xs=null])},...n]})}(a,i))}return function jB(n){const e=vy();if(!e)throw new ie(401,!1);return e}()}}function vy(){return xs?.get(oC)??null}let oC=(()=>{class n{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,i){const r=function lC(n,e){let t;return t="noop"===n?new UB:("zone.js"===n?void 0:n)||new Ut(e),t}(i?.ngZone,function aC(n){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!n||!n.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!n||!n.ngZoneRunCoalescing)||!1}}(i)),s=[{provide:Ut,useValue:r}];return r.run(()=>{const o=pr.create({providers:s,parent:this.injector,name:t.moduleType.name}),a=t.create(o),l=a.injector.get(Ea,null);if(!l)throw new ie(402,!1);return r.runOutsideAngular(()=>{const c=r.onError.subscribe({next:u=>{l.handleError(u)}});a.onDestroy(()=>{xh(this._modules,a),c.unsubscribe()})}),function cC(n,e,t){try{const i=t();return ah(i)?i.catch(r=>{throw e.runOutsideAngular(()=>n.handleError(r)),r}):i}catch(i){throw e.runOutsideAngular(()=>n.handleError(i)),i}}(l,r,()=>{const c=a.injector.get(_h);return c.runInitializers(),c.donePromise.then(()=>(function PM(n){Ei(n,"Expected localeId to be defined"),"string"==typeof n&&(IM=n.toLowerCase().replace(/_/g,"-"))}(a.injector.get(zr,Va)||Va),this._moduleDoBootstrap(a),a))})})}bootstrapModule(t,i=[]){const r=uC({},i);return function VB(n,e,t){const i=new Kg(t);return Promise.resolve(i)}(0,0,t).then(s=>this.bootstrapModuleFactory(s,r))}_moduleDoBootstrap(t){const i=t.injector.get(Yc);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(r=>i.bootstrap(r));else{if(!t.instance.ngDoBootstrap)throw new ie(403,!1);t.instance.ngDoBootstrap(i)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new ie(404,!1);this._modules.slice().forEach(i=>i.destroy()),this._destroyListeners.forEach(i=>i());const t=this._injector.get(_y,null);t&&(t.forEach(i=>i()),t.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return n.\u0275fac=function(t){return new(t||n)(pe(pr))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"platform"}),n})();function uC(n,e){return Array.isArray(e)?e.reduce(uC,n):{...n,...e}}let Yc=(()=>{class n{constructor(t,i,r){this._zone=t,this._injector=i,this._exceptionHandler=r,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const s=new nn(a=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{a.next(this._stable),a.complete()})}),o=new nn(a=>{let l;this._zone.runOutsideAngular(()=>{l=this._zone.onStable.subscribe(()=>{Ut.assertNotInAngularZone(),hy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,a.next(!0))})})});const c=this._zone.onUnstable.subscribe(()=>{Ut.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{a.next(!1)}))});return()=>{l.unsubscribe(),c.unsubscribe()}});this.isStable=function XR(...n){const e=ic(n),t=function HR(n,e){return"number"==typeof em(n)?n.pop():e}(n,1/0),i=n;return i.length?1===i.length?Hi(i[0]):ra(t)(fn(i,e)):Tr}(s,o.pipe(Db()))}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(t,i){const r=t instanceof NS;if(!this._injector.get(_h).done)throw!r&&function aa(n){const e=Mt(n)||Pn(n)||Vn(n);return null!==e&&e.standalone}(t),new ie(405,false);let o;o=r?t:this._injector.get(Tc).resolveComponentFactory(t),this.componentTypes.push(o.componentType);const a=function HB(n){return n.isBoundToModule}(o)?void 0:this._injector.get(Ha),c=o.create(pr.NULL,[],i||o.selector,a),u=c.location.nativeElement,d=c.injector.get(eC,null);return d?.registerApplication(u),c.onDestroy(()=>{this.detachView(c.hostView),xh(this.components,c),d?.unregisterApplication(u)}),this._loadComponent(c),c}tick(){if(this._runningTick)throw new ie(101,!1);try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const i=t;this._views.push(i),i.attachToAppRef(this)}detachView(t){const i=t;xh(this._views,i),i.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t);const i=this._injector.get(qE,[]);i.push(...this._bootstrapListeners),i.forEach(r=>r(t))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(t=>t()),this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(t){return this._destroyListeners.push(t),()=>xh(this._destroyListeners,t)}destroy(){if(this._destroyed)throw new ie(406,!1);const t=this._injector;t.destroy&&!t.destroyed&&t.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return n.\u0275fac=function(t){return new(t||n)(pe(Ut),pe(Or),pe(Ea))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function xh(n,e){const t=n.indexOf(e);t>-1&&n.splice(t,1)}let by=(()=>{class n{}return n.__NG_ELEMENT_ID__=qB,n})();function qB(n){return function YB(n,e,t){if(dc(n)&&!t){const i=fi(n.index,e);return new Pc(i,i)}return 47&n.type?new Pc(e[16],e):null}(Tn(),re(),16==(16&n))}class mC{constructor(){}supports(e){return Lc(e)}create(e){return new eU(e)}}const JB=(n,e)=>e;class eU{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||JB}forEachItem(e){let t;for(t=this._itHead;null!==t;t=t._next)e(t)}forEachOperation(e){let t=this._itHead,i=this._removalsHead,r=0,s=null;for(;t||i;){const o=!i||t&&t.currentIndex<yC(i,r,s)?t:i,a=yC(o,r,s),l=o.currentIndex;if(o===i)r--,i=i._nextRemoved;else if(t=t._next,null==o.previousIndex)r++;else{s||(s=[]);const c=a-r,u=l-r;if(c!=u){for(let h=0;h<c;h++){const f=h<s.length?s[h]:s[h]=0,p=f+h;u<=p&&p<c&&(s[h]=f+1)}s[o.previousIndex]=u-c}}a!==l&&e(o,a,l)}}forEachPreviousItem(e){let t;for(t=this._previousItHead;null!==t;t=t._nextPrevious)e(t)}forEachAddedItem(e){let t;for(t=this._additionsHead;null!==t;t=t._nextAdded)e(t)}forEachMovedItem(e){let t;for(t=this._movesHead;null!==t;t=t._nextMoved)e(t)}forEachRemovedItem(e){let t;for(t=this._removalsHead;null!==t;t=t._nextRemoved)e(t)}forEachIdentityChange(e){let t;for(t=this._identityChangesHead;null!==t;t=t._nextIdentityChange)e(t)}diff(e){if(null==e&&(e=[]),!Lc(e))throw new ie(900,!1);return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let r,s,o,t=this._itHead,i=!1;if(Array.isArray(e)){this.length=e.length;for(let a=0;a<this.length;a++)s=e[a],o=this._trackByFn(a,s),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,s,o,a)),Object.is(t.item,s)||this._addIdentityChange(t,s)):(t=this._mismatch(t,s,o,a),i=!0),t=t._next}else r=0,function MF(n,e){if(Array.isArray(n))for(let t=0;t<n.length;t++)e(n[t]);else{const t=n[lo()]();let i;for(;!(i=t.next()).done;)e(i.value)}}(e,a=>{o=this._trackByFn(r,a),null!==t&&Object.is(t.trackById,o)?(i&&(t=this._verifyReinsertion(t,a,o,r)),Object.is(t.item,a)||this._addIdentityChange(t,a)):(t=this._mismatch(t,a,o,r),i=!0),t=t._next,r++}),this.length=r;return this._truncate(t),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,t,i,r){let s;return null===e?s=this._itTail:(s=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._reinsertAfter(e,s,r)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(i,r))?(Object.is(e.item,t)||this._addIdentityChange(e,t),this._moveAfter(e,s,r)):e=this._addAfter(new tU(t,i),s,r),e}_verifyReinsertion(e,t,i,r){let s=null===this._unlinkedRecords?null:this._unlinkedRecords.get(i,null);return null!==s?e=this._reinsertAfter(s,e._prev,r):e.currentIndex!=r&&(e.currentIndex=r,this._addToMoves(e,r)),e}_truncate(e){for(;null!==e;){const t=e._next;this._addToRemovals(this._unlink(e)),e=t}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,t,i){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const r=e._prevRemoved,s=e._nextRemoved;return null===r?this._removalsHead=s:r._nextRemoved=s,null===s?this._removalsTail=r:s._prevRemoved=r,this._insertAfter(e,t,i),this._addToMoves(e,i),e}_moveAfter(e,t,i){return this._unlink(e),this._insertAfter(e,t,i),this._addToMoves(e,i),e}_addAfter(e,t,i){return this._insertAfter(e,t,i),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,t,i){const r=null===t?this._itHead:t._next;return e._next=r,e._prev=t,null===r?this._itTail=e:r._prev=e,null===t?this._itHead=e:t._next=e,null===this._linkedRecords&&(this._linkedRecords=new gC),this._linkedRecords.put(e),e.currentIndex=i,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const t=e._prev,i=e._next;return null===t?this._itHead=i:t._next=i,null===i?this._itTail=t:i._prev=t,e}_addToMoves(e,t){return e.previousIndex===t||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new gC),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,t){return e.item=t,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class tU{constructor(e,t){this.item=e,this.trackById=t,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class nU{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,t){let i;for(i=this._head;null!==i;i=i._nextDup)if((null===t||t<=i.currentIndex)&&Object.is(i.trackById,e))return i;return null}remove(e){const t=e._prevDup,i=e._nextDup;return null===t?this._head=i:t._nextDup=i,null===i?this._tail=t:i._prevDup=t,null===this._head}}class gC{constructor(){this.map=new Map}put(e){const t=e.trackById;let i=this.map.get(t);i||(i=new nU,this.map.set(t,i)),i.add(e)}get(e,t){const r=this.map.get(e);return r?r.get(e,t):null}remove(e){const t=e.trackById;return this.map.get(t).remove(e)&&this.map.delete(t),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function yC(n,e,t){const i=n.previousIndex;if(null===i)return i;let r=0;return t&&i<t.length&&(r=t[i]),i+e+r}function vC(){return new Mh([new mC])}let Mh=(()=>{class n{constructor(t){this.factories=t}static create(t,i){if(null!=i){const r=i.factories.slice();t=t.concat(r)}return new n(t)}static extend(t){return{provide:n,useFactory:i=>n.create(t,i||vC()),deps:[[n,new vc,new _c]]}}find(t){const i=this.factories.find(r=>r.supports(t));if(null!=i)return i;throw new ie(901,!1)}}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:vC}),n})();const aU=rC(null,"core",[]);let lU=(()=>{class n{constructor(t){}}return n.\u0275fac=function(t){return new(t||n)(pe(Yc))},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({}),n})();function Ey(n){return"boolean"==typeof n?n:null!=n&&"false"!==n}let Cy=null;function Ss(){return Cy}class dU{}const Fn=new Ne("DocumentToken");let Dy=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return function hU(){return pe(xC)}()},providedIn:"platform"}),n})();const fU=new Ne("Location Initialized");let xC=(()=>{class n extends Dy{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ss().getBaseHref(this._doc)}onPopState(t){const i=Ss().getGlobalEventTarget(this._doc,"window");return i.addEventListener("popstate",t,!1),()=>i.removeEventListener("popstate",t)}onHashChange(t){const i=Ss().getGlobalEventTarget(this._doc,"window");return i.addEventListener("hashchange",t,!1),()=>i.removeEventListener("hashchange",t)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,i,r){SC()?this._history.pushState(t,i,r):this.location.hash=r}replaceState(t,i,r){SC()?this._history.replaceState(t,i,r):this.location.hash=r}forward(){this._history.forward()}back(){this._history.back()}historyGo(t=0){this._history.go(t)}getState(){return this._history.state}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn))},n.\u0275prov=Ae({token:n,factory:function(){return function pU(){return new xC(pe(Fn))}()},providedIn:"platform"}),n})();function SC(){return!!window.history.pushState}function Ty(n,e){if(0==n.length)return e;if(0==e.length)return n;let t=0;return n.endsWith("/")&&t++,e.startsWith("/")&&t++,2==t?n+e.substring(1):1==t?n+e:n+"/"+e}function wC(n){const e=n.match(/#|\?|$/),t=e&&e.index||n.length;return n.slice(0,t-("/"===n[t-1]?1:0))+n.slice(t)}function Hr(n){return n&&"?"!==n[0]?"?"+n:n}let po=(()=>{class n{historyGo(t){throw new Error("Not implemented")}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ut(EC)},providedIn:"root"}),n})();const MC=new Ne("appBaseHref");let EC=(()=>{class n extends po{constructor(t,i){super(),this._platformLocation=t,this._removeListenerFns=[],this._baseHref=i??this._platformLocation.getBaseHrefFromDOM()??ut(Fn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return Ty(this._baseHref,t)}path(t=!1){const i=this._platformLocation.pathname+Hr(this._platformLocation.search),r=this._platformLocation.hash;return r&&t?`${i}${r}`:i}pushState(t,i,r,s){const o=this.prepareExternalUrl(r+Hr(s));this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){const o=this.prepareExternalUrl(r+Hr(s));this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(pe(Dy),pe(MC,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),mU=(()=>{class n extends po{constructor(t,i){super(),this._platformLocation=t,this._baseHref="",this._removeListenerFns=[],null!=i&&(this._baseHref=i)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(t){this._removeListenerFns.push(this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t))}getBaseHref(){return this._baseHref}path(t=!1){let i=this._platformLocation.hash;return null==i&&(i="#"),i.length>0?i.substring(1):i}prepareExternalUrl(t){const i=Ty(this._baseHref,t);return i.length>0?"#"+i:i}pushState(t,i,r,s){let o=this.prepareExternalUrl(r+Hr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.pushState(t,i,o)}replaceState(t,i,r,s){let o=this.prepareExternalUrl(r+Hr(s));0==o.length&&(o=this._platformLocation.pathname),this._platformLocation.replaceState(t,i,o)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(t=0){this._platformLocation.historyGo?.(t)}}return n.\u0275fac=function(t){return new(t||n)(pe(Dy),pe(MC,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),Ay=(()=>{class n{constructor(t){this._subject=new $n,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=t;const i=this._locationStrategy.getBaseHref();this._basePath=function _U(n){if(new RegExp("^(https?:)?//").test(n)){const[,t]=n.split(/\/\/[^\/]+/);return t}return n}(wC(CC(i))),this._locationStrategy.onPopState(r=>{this._subject.emit({url:this.path(!0),pop:!0,state:r.state,type:r.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(t=!1){return this.normalize(this._locationStrategy.path(t))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(t,i=""){return this.path()==this.normalize(t+Hr(i))}normalize(t){return n.stripTrailingSlash(function yU(n,e){return n&&e.startsWith(n)?e.substring(n.length):e}(this._basePath,CC(t)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._locationStrategy.prepareExternalUrl(t)}go(t,i="",r=null){this._locationStrategy.pushState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Hr(i)),r)}replaceState(t,i="",r=null){this._locationStrategy.replaceState(r,"",t,i),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+Hr(i)),r)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(t=0){this._locationStrategy.historyGo?.(t)}onUrlChange(t){return this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(i=>{this._notifyUrlChangeListeners(i.url,i.state)})),()=>{const i=this._urlChangeListeners.indexOf(t);this._urlChangeListeners.splice(i,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(t="",i){this._urlChangeListeners.forEach(r=>r(t,i))}subscribe(t,i,r){return this._subject.subscribe({next:t,error:i,complete:r})}}return n.normalizeQueryParams=Hr,n.joinWithSlash=Ty,n.stripTrailingSlash=wC,n.\u0275fac=function(t){return new(t||n)(pe(po))},n.\u0275prov=Ae({token:n,factory:function(){return function gU(){return new Ay(pe(po))}()},providedIn:"root"}),n})();function CC(n){return n.replace(/\/index.html$/,"")}class rz{constructor(e,t,i,r){this.$implicit=e,this.ngForOf=t,this.index=i,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let kC=(()=>{class n{constructor(t,i,r){this._viewContainer=t,this._template=i,this._differs=r,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const t=this._ngForOf;!this._differ&&t&&(this._differ=this._differs.find(t).create(this.ngForTrackBy))}if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const i=this._viewContainer;t.forEachOperation((r,s,o)=>{if(null==r.previousIndex)i.createEmbeddedView(this._template,new rz(r.item,this._ngForOf,-1,-1),null===o?void 0:o);else if(null==o)i.remove(null===s?void 0:s);else if(null!==s){const a=i.get(s);i.move(a,o),BC(a,r)}});for(let r=0,s=i.length;r<s;r++){const a=i.get(r).context;a.index=r,a.count=s,a.ngForOf=this._ngForOf}t.forEachIdentityChange(r=>{BC(i.get(r.currentIndex),r)})}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Re(tr),Re(Ur),Re(Mh))},n.\u0275dir=zn({type:n,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),n})();function BC(n,e){n.context.$implicit=e.item}let UC=(()=>{class n{constructor(t,i){this._viewContainer=t,this._context=new oz,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=i}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){zC("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){zC("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,i){return!0}}return n.\u0275fac=function(t){return new(t||n)(Re(tr),Re(Ur))},n.\u0275dir=zn({type:n,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),n})();class oz{constructor(){this.$implicit=null,this.ngIf=null}}function zC(n,e){if(e&&!e.createEmbeddedView)throw new Error(`${n} must be a TemplateRef, but received '${Pt(e)}'.`)}class hz{createSubscription(e,t){return e.subscribe({next:t,error:i=>{throw i}})}dispose(e){e.unsubscribe()}}class fz{createSubscription(e,t){return e.then(t,i=>{throw i})}dispose(e){}}const pz=new fz,mz=new hz;let Vy=(()=>{class n{constructor(t){this._latestValue=null,this._subscription=null,this._obj=null,this._strategy=null,this._ref=t}ngOnDestroy(){this._subscription&&this._dispose(),this._ref=null}transform(t){return this._obj?t!==this._obj?(this._dispose(),this.transform(t)):this._latestValue:(t&&this._subscribe(t),this._latestValue)}_subscribe(t){this._obj=t,this._strategy=this._selectStrategy(t),this._subscription=this._strategy.createSubscription(t,i=>this._updateLatestValue(t,i))}_selectStrategy(t){if(ah(t))return pz;if(Lw(t))return mz;throw function rr(n,e){return new ie(2100,!1)}()}_dispose(){this._strategy.dispose(this._subscription),this._latestValue=null,this._subscription=null,this._obj=null}_updateLatestValue(t,i){t===this._obj&&(this._latestValue=i,this._ref.markForCheck())}}return n.\u0275fac=function(t){return new(t||n)(Re(by,16))},n.\u0275pipe=ni({name:"async",type:n,pure:!1,standalone:!0}),n})(),GC=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({}),n})();const WC="browser";function jC(n){return n===WC}let kz=(()=>{class n{}return n.\u0275prov=Ae({token:n,providedIn:"root",factory:()=>new Bz(pe(Fn),window)}),n})();class Bz{constructor(e,t){this.document=e,this.window=t,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const t=function Uz(n,e){const t=n.getElementById(e)||n.getElementsByName(e)[0];if(t)return t;if("function"==typeof n.createTreeWalker&&n.body&&(n.body.createShadowRoot||n.body.attachShadow)){const i=n.createTreeWalker(n.body,NodeFilter.SHOW_ELEMENT);let r=i.currentNode;for(;r;){const s=r.shadowRoot;if(s){const o=s.getElementById(e)||s.querySelector(`[name="${e}"]`);if(o)return o}r=i.nextNode()}}return null}(this.document,e);t&&(this.scrollToElement(t),t.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const t=this.window.history;t&&t.scrollRestoration&&(t.scrollRestoration=e)}}scrollToElement(e){const t=e.getBoundingClientRect(),i=t.left+this.window.pageXOffset,r=t.top+this.window.pageYOffset,s=this.offset();this.window.scrollTo(i-s[0],r-s[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=$C(this.window.history)||$C(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function $C(n){return Object.getOwnPropertyDescriptor(n,"scrollRestoration")}class fV extends dU{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class $y extends fV{static makeCurrent(){!function uU(n){Cy||(Cy=n)}(new $y)}onAndCancel(e,t,i){return e.addEventListener(t,i,!1),()=>{e.removeEventListener(t,i,!1)}}dispatchEvent(e,t){e.dispatchEvent(t)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,t){return(t=t||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,t){return"window"===t?window:"document"===t?e:"body"===t?e.body:null}getBaseHref(e){const t=function pV(){return Jc=Jc||document.querySelector("base"),Jc?Jc.getAttribute("href"):null}();return null==t?null:function mV(n){Oh=Oh||document.createElement("a"),Oh.setAttribute("href",n);const e=Oh.pathname;return"/"===e.charAt(0)?e:`/${e}`}(t)}resetBaseElement(){Jc=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return function tz(n,e){e=encodeURIComponent(e);for(const t of n.split(";")){const i=t.indexOf("="),[r,s]=-1==i?[t,""]:[t.slice(0,i),t.slice(i+1)];if(r.trim()===e)return decodeURIComponent(s)}return null}(document.cookie,e)}}let Oh,Jc=null;const QC=new Ne("TRANSITION_ID"),yV=[{provide:$c,useFactory:function gV(n,e,t){return()=>{t.get(_h).donePromise.then(()=>{const i=Ss(),r=e.querySelectorAll(`style[ng-transition="${n}"]`);for(let s=0;s<r.length;s++)i.remove(r[s])})}},deps:[QC,Fn,pr],multi:!0}];let vV=(()=>{class n{build(){return new XMLHttpRequest}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const Fh=new Ne("EventManagerPlugins");let kh=(()=>{class n{constructor(t,i){this._zone=i,this._eventNameToPlugin=new Map,t.forEach(r=>r.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,i,r){return this._findPluginFor(i).addEventListener(t,i,r)}addGlobalEventListener(t,i,r){return this._findPluginFor(i).addGlobalEventListener(t,i,r)}getZone(){return this._zone}_findPluginFor(t){const i=this._eventNameToPlugin.get(t);if(i)return i;const r=this._plugins;for(let s=0;s<r.length;s++){const o=r[s];if(o.supports(t))return this._eventNameToPlugin.set(t,o),o}throw new Error(`No event manager plugin found for event ${t}`)}}return n.\u0275fac=function(t){return new(t||n)(pe(Fh),pe(Ut))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class JC{constructor(e){this._doc=e}addGlobalEventListener(e,t,i){const r=Ss().getGlobalEventTarget(this._doc,e);if(!r)throw new Error(`Unsupported event target ${r} for event ${t}`);return this.addEventListener(r,t,i)}}let eD=(()=>{class n{constructor(){this._stylesSet=new Set}addStyles(t){const i=new Set;t.forEach(r=>{this._stylesSet.has(r)||(this._stylesSet.add(r),i.add(r))}),this.onStylesAdded(i)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),eu=(()=>{class n extends eD{constructor(t){super(),this._doc=t,this._hostNodes=new Map,this._hostNodes.set(t.head,[])}_addStylesToHost(t,i,r){t.forEach(s=>{const o=this._doc.createElement("style");o.textContent=s,r.push(i.appendChild(o))})}addHost(t){const i=[];this._addStylesToHost(this._stylesSet,t,i),this._hostNodes.set(t,i)}removeHost(t){const i=this._hostNodes.get(t);i&&i.forEach(tD),this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach((i,r)=>{this._addStylesToHost(t,r,i)})}ngOnDestroy(){this._hostNodes.forEach(t=>t.forEach(tD))}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();function tD(n){Ss().remove(n)}const qy={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Yy=/%COMP%/g;function Xy(n,e){return e.flat(100).map(t=>t.replace(Yy,n))}function rD(n){return e=>{if("__ngUnwrap__"===e)return n;!1===n(e)&&(e.preventDefault(),e.returnValue=!1)}}let Bh=(()=>{class n{constructor(t,i,r){this.eventManager=t,this.sharedStylesHost=i,this.appId=r,this.rendererByCompId=new Map,this.defaultRenderer=new Zy(t)}createRenderer(t,i){if(!t||!i)return this.defaultRenderer;switch(i.encapsulation){case Wi.Emulated:{let r=this.rendererByCompId.get(i.id);return r||(r=new EV(this.eventManager,this.sharedStylesHost,i,this.appId),this.rendererByCompId.set(i.id,r)),r.applyToHost(t),r}case 1:case Wi.ShadowDom:return new CV(this.eventManager,this.sharedStylesHost,t,i);default:if(!this.rendererByCompId.has(i.id)){const r=Xy(i.id,i.styles);this.sharedStylesHost.addStyles(r),this.rendererByCompId.set(i.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return n.\u0275fac=function(t){return new(t||n)(pe(kh),pe(eu),pe(qc))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class Zy{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,t){return t?document.createElementNS(qy[t]||t,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,t){(oD(e)?e.content:e).appendChild(t)}insertBefore(e,t,i){e&&(oD(e)?e.content:e).insertBefore(t,i)}removeChild(e,t){e&&e.removeChild(t)}selectRootElement(e,t){let i="string"==typeof e?document.querySelector(e):e;if(!i)throw new Error(`The selector "${e}" did not match any elements`);return t||(i.textContent=""),i}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,t,i,r){if(r){t=r+":"+t;const s=qy[r];s?e.setAttributeNS(s,t,i):e.setAttribute(t,i)}else e.setAttribute(t,i)}removeAttribute(e,t,i){if(i){const r=qy[i];r?e.removeAttributeNS(r,t):e.removeAttribute(`${i}:${t}`)}else e.removeAttribute(t)}addClass(e,t){e.classList.add(t)}removeClass(e,t){e.classList.remove(t)}setStyle(e,t,i,r){r&(ii.DashCase|ii.Important)?e.style.setProperty(t,i,r&ii.Important?"important":""):e.style[t]=i}removeStyle(e,t,i){i&ii.DashCase?e.style.removeProperty(t):e.style[t]=""}setProperty(e,t,i){e[t]=i}setValue(e,t){e.nodeValue=t}listen(e,t,i){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,t,rD(i)):this.eventManager.addEventListener(e,t,rD(i))}}function oD(n){return"TEMPLATE"===n.tagName&&void 0!==n.content}class EV extends Zy{constructor(e,t,i,r){super(e),this.component=i;const s=Xy(r+"-"+i.id,i.styles);t.addStyles(s),this.contentAttr=function SV(n){return"_ngcontent-%COMP%".replace(Yy,n)}(r+"-"+i.id),this.hostAttr=function wV(n){return"_nghost-%COMP%".replace(Yy,n)}(r+"-"+i.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,t){const i=super.createElement(e,t);return super.setAttribute(i,this.contentAttr,""),i}}class CV extends Zy{constructor(e,t,i,r){super(e),this.sharedStylesHost=t,this.hostEl=i,this.shadowRoot=i.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const s=Xy(r.id,r.styles);for(let o=0;o<s.length;o++){const a=document.createElement("style");a.textContent=s[o],this.shadowRoot.appendChild(a)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,t){return super.appendChild(this.nodeOrShadowRoot(e),t)}insertBefore(e,t,i){return super.insertBefore(this.nodeOrShadowRoot(e),t,i)}removeChild(e,t){return super.removeChild(this.nodeOrShadowRoot(e),t)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let DV=(()=>{class n extends JC{constructor(t){super(t)}supports(t){return!0}addEventListener(t,i,r){return t.addEventListener(i,r,!1),()=>this.removeEventListener(t,i,r)}removeEventListener(t,i,r){return t.removeEventListener(i,r)}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const aD=["alt","control","meta","shift"],TV={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},AV={alt:n=>n.altKey,control:n=>n.ctrlKey,meta:n=>n.metaKey,shift:n=>n.shiftKey};let IV=(()=>{class n extends JC{constructor(t){super(t)}supports(t){return null!=n.parseEventName(t)}addEventListener(t,i,r){const s=n.parseEventName(i),o=n.eventCallback(s.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>Ss().onAndCancel(t,s.domEventName,o))}static parseEventName(t){const i=t.toLowerCase().split("."),r=i.shift();if(0===i.length||"keydown"!==r&&"keyup"!==r)return null;const s=n._normalizeKey(i.pop());let o="",a=i.indexOf("code");if(a>-1&&(i.splice(a,1),o="code."),aD.forEach(c=>{const u=i.indexOf(c);u>-1&&(i.splice(u,1),o+=c+".")}),o+=s,0!=i.length||0===s.length)return null;const l={};return l.domEventName=r,l.fullKey=o,l}static matchEventFullKeyCode(t,i){let r=TV[t.key]||t.key,s="";return i.indexOf("code.")>-1&&(r=t.code,s="code."),!(null==r||!r)&&(r=r.toLowerCase()," "===r?r="space":"."===r&&(r="dot"),aD.forEach(o=>{o!==r&&(0,AV[o])(t)&&(s+=o+".")}),s+=r,s===i)}static eventCallback(t,i,r){return s=>{n.matchEventFullKeyCode(s,t)&&r.runGuarded(()=>i(s))}}static _normalizeKey(t){return"esc"===t?"escape":t}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const cD=[{provide:vh,useValue:WC},{provide:$E,useValue:function PV(){$y.makeCurrent()},multi:!0},{provide:Fn,useFactory:function LV(){return function aN(n){ig=n}(document),document},deps:[]}],NV=rC(aU,"browser",cD),uD=new Ne(""),dD=[{provide:bh,useClass:class _V{addToWindow(e){Lt.getAngularTestability=(i,r=!0)=>{const s=e.findTestabilityInTree(i,r);if(null==s)throw new Error("Could not find testability for element.");return s},Lt.getAllAngularTestabilities=()=>e.getAllTestabilities(),Lt.getAllAngularRootElements=()=>e.getAllRootElements(),Lt.frameworkStabilizers||(Lt.frameworkStabilizers=[]),Lt.frameworkStabilizers.push(i=>{const r=Lt.getAllAngularTestabilities();let s=r.length,o=!1;const a=function(l){o=o||l,s--,0==s&&i(o)};r.forEach(function(l){l.whenStable(a)})})}findTestabilityInTree(e,t,i){return null==t?null:e.getTestability(t)??(i?Ss().isShadowRoot(t)?this.findTestabilityInTree(e,t.host,!0):this.findTestabilityInTree(e,t.parentElement,!0):null)}},deps:[]},{provide:eC,useClass:my,deps:[Ut,gy,bh]},{provide:my,useClass:my,deps:[Ut,gy,bh]}],hD=[{provide:hg,useValue:"root"},{provide:Ea,useFactory:function RV(){return new Ea},deps:[]},{provide:Fh,useClass:DV,multi:!0,deps:[Fn,Ut,vh]},{provide:Fh,useClass:IV,multi:!0,deps:[Fn]},{provide:Bh,useClass:Bh,deps:[kh,eu,qc]},{provide:Ac,useExisting:Bh},{provide:eD,useExisting:eu},{provide:eu,useClass:eu,deps:[Fn]},{provide:kh,useClass:kh,deps:[Fh,Ut]},{provide:class zz{},useClass:vV,deps:[]},[]];let fD=(()=>{class n{constructor(t){}static withServerTransition(t){return{ngModule:n,providers:[{provide:qc,useValue:t.appId},{provide:QC,useExisting:qc},yV]}}}return n.\u0275fac=function(t){return new(t||n)(pe(uD,12))},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({providers:[...hD,...dD],imports:[GC,lU]}),n})(),pD=(()=>{class n{constructor(t){this._doc=t}getTitle(){return this._doc.title}setTitle(t){this._doc.title=t||""}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn))},n.\u0275prov=Ae({token:n,factory:function(t){let i=null;return i=t?new t:function FV(){return new pD(pe(Fn))}(),i},providedIn:"root"}),n})();typeof window<"u"&&window;class yD{}class WV{}const Wr="*";function Uh(n,e=null){return{type:4,styles:e,timings:n}}function _D(n,e=null){return{type:2,steps:n,options:e}}function jr(n){return{type:6,styles:n,offset:null}}function vD(n,e,t=null){return{type:1,expr:n,animation:e,options:t}}function zh(n,e,t=null){return{type:11,selector:n,animation:e,options:t}}function bD(n){Promise.resolve().then(n)}class tu{constructor(e=0,t=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=e+t}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){bD(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(e=>e()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(e){this._position=this.totalTime?e*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class xD{constructor(e){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=e;let t=0,i=0,r=0;const s=this.players.length;0==s?bD(()=>this._onFinish()):this.players.forEach(o=>{o.onDone(()=>{++t==s&&this._onFinish()}),o.onDestroy(()=>{++i==s&&this._onDestroy()}),o.onStart(()=>{++r==s&&this._onStart()})}),this.totalTime=this.players.reduce((o,a)=>Math.max(o,a.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this.players.forEach(e=>e.init())}onStart(e){this._onStartFns.push(e)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(e=>e()),this._onStartFns=[])}onDone(e){this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(e=>e.play())}pause(){this.players.forEach(e=>e.pause())}restart(){this.players.forEach(e=>e.restart())}finish(){this._onFinish(),this.players.forEach(e=>e.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(e=>e.destroy()),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}reset(){this.players.forEach(e=>e.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(e){const t=e*this.totalTime;this.players.forEach(i=>{const r=i.totalTime?Math.min(1,t/i.totalTime):1;i.setPosition(r)})}getPosition(){const e=this.players.reduce((t,i)=>null===t||i.totalTime>t.totalTime?i:t,null);return null!=e?e.getPosition():0}beforeDestroy(){this.players.forEach(e=>{e.beforeDestroy&&e.beforeDestroy()})}triggerCallback(e){const t="start"==e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}function SD(n){return new ie(3e3,!1)}function CH(){return typeof window<"u"&&typeof window.document<"u"}function e_(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function Ms(n){switch(n.length){case 0:return new tu;case 1:return n[0];default:return new xD(n)}}function wD(n,e,t,i,r=new Map,s=new Map){const o=[],a=[];let l=-1,c=null;if(i.forEach(u=>{const d=u.get("offset"),h=d==l,f=h&&c||new Map;u.forEach((p,g)=>{let m=g,y=p;if("offset"!==g)switch(m=e.normalizePropertyName(m,o),y){case"!":y=r.get(g);break;case Wr:y=s.get(g);break;default:y=e.normalizeStyleValue(g,m,y,o)}f.set(m,y)}),h||a.push(f),c=f,l=d}),o.length)throw function pH(n){return new ie(3502,!1)}();return a}function t_(n,e,t,i){switch(e){case"start":n.onStart(()=>i(t&&n_(t,"start",n)));break;case"done":n.onDone(()=>i(t&&n_(t,"done",n)));break;case"destroy":n.onDestroy(()=>i(t&&n_(t,"destroy",n)))}}function n_(n,e,t){const s=i_(n.element,n.triggerName,n.fromState,n.toState,e||n.phaseName,t.totalTime??n.totalTime,!!t.disabled),o=n._data;return null!=o&&(s._data=o),s}function i_(n,e,t,i,r="",s=0,o){return{element:n,triggerName:e,fromState:t,toState:i,phaseName:r,totalTime:s,disabled:!!o}}function gi(n,e,t){let i=n.get(e);return i||n.set(e,i=t),i}function MD(n){const e=n.indexOf(":");return[n.substring(1,e),n.slice(e+1)]}let r_=(n,e)=>!1,ED=(n,e,t)=>[],CD=null;function s_(n){const e=n.parentNode||n.host;return e===CD?null:e}(e_()||typeof Element<"u")&&(CH()?(CD=(()=>document.documentElement)(),r_=(n,e)=>{for(;e;){if(e===n)return!0;e=s_(e)}return!1}):r_=(n,e)=>n.contains(e),ED=(n,e,t)=>{if(t)return Array.from(n.querySelectorAll(e));const i=n.querySelector(e);return i?[i]:[]});let mo=null,DD=!1;const TD=r_,AD=ED;let ID=(()=>{class n{validateStyleProperty(t){return function TH(n){mo||(mo=function AH(){return typeof document<"u"?document.body:null}()||{},DD=!!mo.style&&"WebkitAppearance"in mo.style);let e=!0;return mo.style&&!function DH(n){return"ebkit"==n.substring(1,6)}(n)&&(e=n in mo.style,!e&&DD&&(e="Webkit"+n.charAt(0).toUpperCase()+n.slice(1)in mo.style)),e}(t)}matchesElement(t,i){return!1}containsElement(t,i){return TD(t,i)}getParentElement(t){return s_(t)}query(t,i,r){return AD(t,i,r)}computeStyle(t,i,r){return r||""}animate(t,i,r,s,o,a=[],l){return new tu(r,s)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),o_=(()=>{class n{}return n.NOOP=new ID,n})();const a_="ng-enter",Vh="ng-leave",Hh="ng-trigger",Gh=".ng-trigger",RD="ng-animating",l_=".ng-animating";function $r(n){if("number"==typeof n)return n;const e=n.match(/^(-?[\.\d]+)(m?s)/);return!e||e.length<2?0:c_(parseFloat(e[1]),e[2])}function c_(n,e){return"s"===e?1e3*n:n}function Wh(n,e,t){return n.hasOwnProperty("duration")?n:function RH(n,e,t){let r,s=0,o="";if("string"==typeof n){const a=n.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===a)return e.push(SD()),{duration:0,delay:0,easing:""};r=c_(parseFloat(a[1]),a[2]);const l=a[3];null!=l&&(s=c_(parseFloat(l),a[4]));const c=a[5];c&&(o=c)}else r=n;if(!t){let a=!1,l=e.length;r<0&&(e.push(function $V(){return new ie(3100,!1)}()),a=!0),s<0&&(e.push(function qV(){return new ie(3101,!1)}()),a=!0),a&&e.splice(l,0,SD())}return{duration:r,delay:s,easing:o}}(n,e,t)}function nu(n,e={}){return Object.keys(n).forEach(t=>{e[t]=n[t]}),e}function LD(n){const e=new Map;return Object.keys(n).forEach(t=>{e.set(t,n[t])}),e}function Es(n,e=new Map,t){if(t)for(let[i,r]of t)e.set(i,r);for(let[i,r]of n)e.set(i,r);return e}function OD(n,e,t){return t?e+":"+t+";":""}function FD(n){let e="";for(let t=0;t<n.style.length;t++){const i=n.style.item(t);e+=OD(0,i,n.style.getPropertyValue(i))}for(const t in n.style)n.style.hasOwnProperty(t)&&!t.startsWith("_")&&(e+=OD(0,FH(t),n.style[t]));n.setAttribute("style",e)}function vr(n,e,t){n.style&&(e.forEach((i,r)=>{const s=d_(r);t&&!t.has(r)&&t.set(r,n.style[s]),n.style[s]=i}),e_()&&FD(n))}function go(n,e){n.style&&(e.forEach((t,i)=>{const r=d_(i);n.style[r]=""}),e_()&&FD(n))}function iu(n){return Array.isArray(n)?1==n.length?n[0]:_D(n):n}const u_=new RegExp("{{\\s*(.+?)\\s*}}","g");function kD(n){let e=[];if("string"==typeof n){let t;for(;t=u_.exec(n);)e.push(t[1]);u_.lastIndex=0}return e}function ru(n,e,t){const i=n.toString(),r=i.replace(u_,(s,o)=>{let a=e[o];return null==a&&(t.push(function XV(n){return new ie(3003,!1)}()),a=""),a.toString()});return r==i?n:r}function jh(n){const e=[];let t=n.next();for(;!t.done;)e.push(t.value),t=n.next();return e}const OH=/-+([a-z0-9])/g;function d_(n){return n.replace(OH,(...e)=>e[1].toUpperCase())}function FH(n){return n.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function yi(n,e,t){switch(e.type){case 7:return n.visitTrigger(e,t);case 0:return n.visitState(e,t);case 1:return n.visitTransition(e,t);case 2:return n.visitSequence(e,t);case 3:return n.visitGroup(e,t);case 4:return n.visitAnimate(e,t);case 5:return n.visitKeyframes(e,t);case 6:return n.visitStyle(e,t);case 8:return n.visitReference(e,t);case 9:return n.visitAnimateChild(e,t);case 10:return n.visitAnimateRef(e,t);case 11:return n.visitQuery(e,t);case 12:return n.visitStagger(e,t);default:throw function ZV(n){return new ie(3004,!1)}()}}function BD(n,e){return window.getComputedStyle(n)[e]}function HH(n,e){const t=[];return"string"==typeof n?n.split(/\s*,\s*/).forEach(i=>function GH(n,e,t){if(":"==n[0]){const l=function WH(n,e){switch(n){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(t,i)=>parseFloat(i)>parseFloat(t);case":decrement":return(t,i)=>parseFloat(i)<parseFloat(t);default:return e.push(function uH(n){return new ie(3016,!1)}()),"* => *"}}(n,t);if("function"==typeof l)return void e.push(l);n=l}const i=n.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==i||i.length<4)return t.push(function cH(n){return new ie(3015,!1)}()),e;const r=i[1],s=i[2],o=i[3];e.push(UD(r,o));"<"==s[0]&&!("*"==r&&"*"==o)&&e.push(UD(o,r))}(i,t,e)):t.push(n),t}const Xh=new Set(["true","1"]),Zh=new Set(["false","0"]);function UD(n,e){const t=Xh.has(n)||Zh.has(n),i=Xh.has(e)||Zh.has(e);return(r,s)=>{let o="*"==n||n==r,a="*"==e||e==s;return!o&&t&&"boolean"==typeof r&&(o=r?Xh.has(n):Zh.has(n)),!a&&i&&"boolean"==typeof s&&(a=s?Xh.has(e):Zh.has(e)),o&&a}}const jH=new RegExp("s*:selfs*,?","g");function h_(n,e,t,i){return new $H(n).build(e,t,i)}class $H{constructor(e){this._driver=e}build(e,t,i){const r=new XH(t);return this._resetContextStyleTimingState(r),yi(this,iu(e),r)}_resetContextStyleTimingState(e){e.currentQuerySelector="",e.collectedStyles=new Map,e.collectedStyles.set("",new Map),e.currentTime=0}visitTrigger(e,t){let i=t.queryCount=0,r=t.depCount=0;const s=[],o=[];return"@"==e.name.charAt(0)&&t.errors.push(function QV(){return new ie(3006,!1)}()),e.definitions.forEach(a=>{if(this._resetContextStyleTimingState(t),0==a.type){const l=a,c=l.name;c.toString().split(/\s*,\s*/).forEach(u=>{l.name=u,s.push(this.visitState(l,t))}),l.name=c}else if(1==a.type){const l=this.visitTransition(a,t);i+=l.queryCount,r+=l.depCount,o.push(l)}else t.errors.push(function JV(){return new ie(3007,!1)}())}),{type:7,name:e.name,states:s,transitions:o,queryCount:i,depCount:r,options:null}}visitState(e,t){const i=this.visitStyle(e.styles,t),r=e.options&&e.options.params||null;if(i.containsDynamicStyles){const s=new Set,o=r||{};i.styles.forEach(a=>{a instanceof Map&&a.forEach(l=>{kD(l).forEach(c=>{o.hasOwnProperty(c)||s.add(c)})})}),s.size&&(jh(s.values()),t.errors.push(function eH(n,e){return new ie(3008,!1)}()))}return{type:0,name:e.name,style:i,options:r?{params:r}:null}}visitTransition(e,t){t.queryCount=0,t.depCount=0;const i=yi(this,iu(e.animation),t);return{type:1,matchers:HH(e.expr,t.errors),animation:i,queryCount:t.queryCount,depCount:t.depCount,options:yo(e.options)}}visitSequence(e,t){return{type:2,steps:e.steps.map(i=>yi(this,i,t)),options:yo(e.options)}}visitGroup(e,t){const i=t.currentTime;let r=0;const s=e.steps.map(o=>{t.currentTime=i;const a=yi(this,o,t);return r=Math.max(r,t.currentTime),a});return t.currentTime=r,{type:3,steps:s,options:yo(e.options)}}visitAnimate(e,t){const i=function KH(n,e){if(n.hasOwnProperty("duration"))return n;if("number"==typeof n)return f_(Wh(n,e).duration,0,"");const t=n;if(t.split(/\s+/).some(s=>"{"==s.charAt(0)&&"{"==s.charAt(1))){const s=f_(0,0,"");return s.dynamic=!0,s.strValue=t,s}const r=Wh(t,e);return f_(r.duration,r.delay,r.easing)}(e.timings,t.errors);t.currentAnimateTimings=i;let r,s=e.styles?e.styles:jr({});if(5==s.type)r=this.visitKeyframes(s,t);else{let o=e.styles,a=!1;if(!o){a=!0;const c={};i.easing&&(c.easing=i.easing),o=jr(c)}t.currentTime+=i.duration+i.delay;const l=this.visitStyle(o,t);l.isEmptyStep=a,r=l}return t.currentAnimateTimings=null,{type:4,timings:i,style:r,options:null}}visitStyle(e,t){const i=this._makeStyleAst(e,t);return this._validateStyleAst(i,t),i}_makeStyleAst(e,t){const i=[],r=Array.isArray(e.styles)?e.styles:[e.styles];for(let a of r)"string"==typeof a?a===Wr?i.push(a):t.errors.push(new ie(3002,!1)):i.push(LD(a));let s=!1,o=null;return i.forEach(a=>{if(a instanceof Map&&(a.has("easing")&&(o=a.get("easing"),a.delete("easing")),!s))for(let l of a.values())if(l.toString().indexOf("{{")>=0){s=!0;break}}),{type:6,styles:i,easing:o,offset:e.offset,containsDynamicStyles:s,options:null}}_validateStyleAst(e,t){const i=t.currentAnimateTimings;let r=t.currentTime,s=t.currentTime;i&&s>0&&(s-=i.duration+i.delay),e.styles.forEach(o=>{"string"!=typeof o&&o.forEach((a,l)=>{const c=t.collectedStyles.get(t.currentQuerySelector),u=c.get(l);let d=!0;u&&(s!=r&&s>=u.startTime&&r<=u.endTime&&(t.errors.push(function nH(n,e,t,i,r){return new ie(3010,!1)}()),d=!1),s=u.startTime),d&&c.set(l,{startTime:s,endTime:r}),t.options&&function NH(n,e,t){const i=e.params||{},r=kD(n);r.length&&r.forEach(s=>{i.hasOwnProperty(s)||t.push(function YV(n){return new ie(3001,!1)}())})}(a,t.options,t.errors)})})}visitKeyframes(e,t){const i={type:5,styles:[],options:null};if(!t.currentAnimateTimings)return t.errors.push(function iH(){return new ie(3011,!1)}()),i;let s=0;const o=[];let a=!1,l=!1,c=0;const u=e.steps.map(y=>{const b=this._makeStyleAst(y,t);let _=null!=b.offset?b.offset:function ZH(n){if("string"==typeof n)return null;let e=null;if(Array.isArray(n))n.forEach(t=>{if(t instanceof Map&&t.has("offset")){const i=t;e=parseFloat(i.get("offset")),i.delete("offset")}});else if(n instanceof Map&&n.has("offset")){const t=n;e=parseFloat(t.get("offset")),t.delete("offset")}return e}(b.styles),v=0;return null!=_&&(s++,v=b.offset=_),l=l||v<0||v>1,a=a||v<c,c=v,o.push(v),b});l&&t.errors.push(function rH(){return new ie(3012,!1)}()),a&&t.errors.push(function sH(){return new ie(3200,!1)}());const d=e.steps.length;let h=0;s>0&&s<d?t.errors.push(function oH(){return new ie(3202,!1)}()):0==s&&(h=1/(d-1));const f=d-1,p=t.currentTime,g=t.currentAnimateTimings,m=g.duration;return u.forEach((y,b)=>{const _=h>0?b==f?1:h*b:o[b],v=_*m;t.currentTime=p+g.delay+v,g.duration=v,this._validateStyleAst(y,t),y.offset=_,i.styles.push(y)}),i}visitReference(e,t){return{type:8,animation:yi(this,iu(e.animation),t),options:yo(e.options)}}visitAnimateChild(e,t){return t.depCount++,{type:9,options:yo(e.options)}}visitAnimateRef(e,t){return{type:10,animation:this.visitReference(e.animation,t),options:yo(e.options)}}visitQuery(e,t){const i=t.currentQuerySelector,r=e.options||{};t.queryCount++,t.currentQuery=e;const[s,o]=function qH(n){const e=!!n.split(/\s*,\s*/).find(t=>":self"==t);return e&&(n=n.replace(jH,"")),n=n.replace(/@\*/g,Gh).replace(/@\w+/g,t=>Gh+"-"+t.slice(1)).replace(/:animating/g,l_),[n,e]}(e.selector);t.currentQuerySelector=i.length?i+" "+s:s,gi(t.collectedStyles,t.currentQuerySelector,new Map);const a=yi(this,iu(e.animation),t);return t.currentQuery=null,t.currentQuerySelector=i,{type:11,selector:s,limit:r.limit||0,optional:!!r.optional,includeSelf:o,animation:a,originalSelector:e.selector,options:yo(e.options)}}visitStagger(e,t){t.currentQuery||t.errors.push(function aH(){return new ie(3013,!1)}());const i="full"===e.timings?{duration:0,delay:0,easing:"full"}:Wh(e.timings,t.errors,!0);return{type:12,animation:yi(this,iu(e.animation),t),timings:i,options:null}}}class XH{constructor(e){this.errors=e,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function yo(n){return n?(n=nu(n)).params&&(n.params=function YH(n){return n?nu(n):null}(n.params)):n={},n}function f_(n,e,t){return{duration:n,delay:e,easing:t}}function p_(n,e,t,i,r,s,o=null,a=!1){return{type:1,element:n,keyframes:e,preStyleProps:t,postStyleProps:i,duration:r,delay:s,totalTime:r+s,easing:o,subTimeline:a}}class Kh{constructor(){this._map=new Map}get(e){return this._map.get(e)||[]}append(e,t){let i=this._map.get(e);i||this._map.set(e,i=[]),i.push(...t)}has(e){return this._map.has(e)}clear(){this._map.clear()}}const e4=new RegExp(":enter","g"),n4=new RegExp(":leave","g");function m_(n,e,t,i,r,s=new Map,o=new Map,a,l,c=[]){return(new i4).buildKeyframes(n,e,t,i,r,s,o,a,l,c)}class i4{buildKeyframes(e,t,i,r,s,o,a,l,c,u=[]){c=c||new Kh;const d=new g_(e,t,c,r,s,u,[]);d.options=l;const h=l.delay?$r(l.delay):0;d.currentTimeline.delayNextStep(h),d.currentTimeline.setStyles([o],null,d.errors,l),yi(this,i,d);const f=d.timelines.filter(p=>p.containsAnimation());if(f.length&&a.size){let p;for(let g=f.length-1;g>=0;g--){const m=f[g];if(m.element===t){p=m;break}}p&&!p.allowOnlyTimelineStyles()&&p.setStyles([a],null,d.errors,l)}return f.length?f.map(p=>p.buildKeyframes()):[p_(t,[],[],[],0,h,"",!1)]}visitTrigger(e,t){}visitState(e,t){}visitTransition(e,t){}visitAnimateChild(e,t){const i=t.subInstructions.get(t.element);if(i){const r=t.createSubContext(e.options),s=t.currentTimeline.currentTime,o=this._visitSubInstructions(i,r,r.options);s!=o&&t.transformIntoNewTimeline(o)}t.previousNode=e}visitAnimateRef(e,t){const i=t.createSubContext(e.options);i.transformIntoNewTimeline(),this._applyAnimationRefDelays([e.options,e.animation.options],t,i),this.visitReference(e.animation,i),t.transformIntoNewTimeline(i.currentTimeline.currentTime),t.previousNode=e}_applyAnimationRefDelays(e,t,i){for(const r of e){const s=r?.delay;if(s){const o="number"==typeof s?s:$r(ru(s,r?.params??{},t.errors));i.delayNextStep(o)}}}_visitSubInstructions(e,t,i){let s=t.currentTimeline.currentTime;const o=null!=i.duration?$r(i.duration):null,a=null!=i.delay?$r(i.delay):null;return 0!==o&&e.forEach(l=>{const c=t.appendInstructionToTimeline(l,o,a);s=Math.max(s,c.duration+c.delay)}),s}visitReference(e,t){t.updateOptions(e.options,!0),yi(this,e.animation,t),t.previousNode=e}visitSequence(e,t){const i=t.subContextCount;let r=t;const s=e.options;if(s&&(s.params||s.delay)&&(r=t.createSubContext(s),r.transformIntoNewTimeline(),null!=s.delay)){6==r.previousNode.type&&(r.currentTimeline.snapshotCurrentStyles(),r.previousNode=Qh);const o=$r(s.delay);r.delayNextStep(o)}e.steps.length&&(e.steps.forEach(o=>yi(this,o,r)),r.currentTimeline.applyStylesToKeyframe(),r.subContextCount>i&&r.transformIntoNewTimeline()),t.previousNode=e}visitGroup(e,t){const i=[];let r=t.currentTimeline.currentTime;const s=e.options&&e.options.delay?$r(e.options.delay):0;e.steps.forEach(o=>{const a=t.createSubContext(e.options);s&&a.delayNextStep(s),yi(this,o,a),r=Math.max(r,a.currentTimeline.currentTime),i.push(a.currentTimeline)}),i.forEach(o=>t.currentTimeline.mergeTimelineCollectedStyles(o)),t.transformIntoNewTimeline(r),t.previousNode=e}_visitTiming(e,t){if(e.dynamic){const i=e.strValue;return Wh(t.params?ru(i,t.params,t.errors):i,t.errors)}return{duration:e.duration,delay:e.delay,easing:e.easing}}visitAnimate(e,t){const i=t.currentAnimateTimings=this._visitTiming(e.timings,t),r=t.currentTimeline;i.delay&&(t.incrementTime(i.delay),r.snapshotCurrentStyles());const s=e.style;5==s.type?this.visitKeyframes(s,t):(t.incrementTime(i.duration),this.visitStyle(s,t),r.applyStylesToKeyframe()),t.currentAnimateTimings=null,t.previousNode=e}visitStyle(e,t){const i=t.currentTimeline,r=t.currentAnimateTimings;!r&&i.hasCurrentStyleProperties()&&i.forwardFrame();const s=r&&r.easing||e.easing;e.isEmptyStep?i.applyEmptyStep(s):i.setStyles(e.styles,s,t.errors,t.options),t.previousNode=e}visitKeyframes(e,t){const i=t.currentAnimateTimings,r=t.currentTimeline.duration,s=i.duration,a=t.createSubContext().currentTimeline;a.easing=i.easing,e.styles.forEach(l=>{a.forwardTime((l.offset||0)*s),a.setStyles(l.styles,l.easing,t.errors,t.options),a.applyStylesToKeyframe()}),t.currentTimeline.mergeTimelineCollectedStyles(a),t.transformIntoNewTimeline(r+s),t.previousNode=e}visitQuery(e,t){const i=t.currentTimeline.currentTime,r=e.options||{},s=r.delay?$r(r.delay):0;s&&(6===t.previousNode.type||0==i&&t.currentTimeline.hasCurrentStyleProperties())&&(t.currentTimeline.snapshotCurrentStyles(),t.previousNode=Qh);let o=i;const a=t.invokeQuery(e.selector,e.originalSelector,e.limit,e.includeSelf,!!r.optional,t.errors);t.currentQueryTotal=a.length;let l=null;a.forEach((c,u)=>{t.currentQueryIndex=u;const d=t.createSubContext(e.options,c);s&&d.delayNextStep(s),c===t.element&&(l=d.currentTimeline),yi(this,e.animation,d),d.currentTimeline.applyStylesToKeyframe(),o=Math.max(o,d.currentTimeline.currentTime)}),t.currentQueryIndex=0,t.currentQueryTotal=0,t.transformIntoNewTimeline(o),l&&(t.currentTimeline.mergeTimelineCollectedStyles(l),t.currentTimeline.snapshotCurrentStyles()),t.previousNode=e}visitStagger(e,t){const i=t.parentContext,r=t.currentTimeline,s=e.timings,o=Math.abs(s.duration),a=o*(t.currentQueryTotal-1);let l=o*t.currentQueryIndex;switch(s.duration<0?"reverse":s.easing){case"reverse":l=a-l;break;case"full":l=i.currentStaggerTime}const u=t.currentTimeline;l&&u.delayNextStep(l);const d=u.currentTime;yi(this,e.animation,t),t.previousNode=e,i.currentStaggerTime=r.currentTime-d+(r.startTime-i.currentTimeline.startTime)}}const Qh={};class g_{constructor(e,t,i,r,s,o,a,l){this._driver=e,this.element=t,this.subInstructions=i,this._enterClassName=r,this._leaveClassName=s,this.errors=o,this.timelines=a,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Qh,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=l||new Jh(this._driver,t,0),a.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(e,t){if(!e)return;const i=e;let r=this.options;null!=i.duration&&(r.duration=$r(i.duration)),null!=i.delay&&(r.delay=$r(i.delay));const s=i.params;if(s){let o=r.params;o||(o=this.options.params={}),Object.keys(s).forEach(a=>{(!t||!o.hasOwnProperty(a))&&(o[a]=ru(s[a],o,this.errors))})}}_copyOptions(){const e={};if(this.options){const t=this.options.params;if(t){const i=e.params={};Object.keys(t).forEach(r=>{i[r]=t[r]})}}return e}createSubContext(e=null,t,i){const r=t||this.element,s=new g_(this._driver,r,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(r,i||0));return s.previousNode=this.previousNode,s.currentAnimateTimings=this.currentAnimateTimings,s.options=this._copyOptions(),s.updateOptions(e),s.currentQueryIndex=this.currentQueryIndex,s.currentQueryTotal=this.currentQueryTotal,s.parentContext=this,this.subContextCount++,s}transformIntoNewTimeline(e){return this.previousNode=Qh,this.currentTimeline=this.currentTimeline.fork(this.element,e),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(e,t,i){const r={duration:t??e.duration,delay:this.currentTimeline.currentTime+(i??0)+e.delay,easing:""},s=new r4(this._driver,e.element,e.keyframes,e.preStyleProps,e.postStyleProps,r,e.stretchStartingKeyframe);return this.timelines.push(s),r}incrementTime(e){this.currentTimeline.forwardTime(this.currentTimeline.duration+e)}delayNextStep(e){e>0&&this.currentTimeline.delayNextStep(e)}invokeQuery(e,t,i,r,s,o){let a=[];if(r&&a.push(this.element),e.length>0){e=(e=e.replace(e4,"."+this._enterClassName)).replace(n4,"."+this._leaveClassName);let c=this._driver.query(this.element,e,1!=i);0!==i&&(c=i<0?c.slice(c.length+i,c.length):c.slice(0,i)),a.push(...c)}return!s&&0==a.length&&o.push(function lH(n){return new ie(3014,!1)}()),a}}class Jh{constructor(e,t,i,r){this._driver=e,this.element=t,this.startTime=i,this._elementTimelineStylesLookup=r,this.duration=0,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(t),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(t,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(e){const t=1===this._keyframes.size&&this._pendingStyles.size;this.duration||t?(this.forwardTime(this.currentTime+e),t&&this.snapshotCurrentStyles()):this.startTime+=e}fork(e,t){return this.applyStylesToKeyframe(),new Jh(this._driver,e,t||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(e){this.applyStylesToKeyframe(),this.duration=e,this._loadKeyframe()}_updateStyle(e,t){this._localTimelineStyles.set(e,t),this._globalTimelineStyles.set(e,t),this._styleSummary.set(e,{time:this.currentTime,value:t})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(e){e&&this._previousKeyframe.set("easing",e);for(let[t,i]of this._globalTimelineStyles)this._backFill.set(t,i||Wr),this._currentKeyframe.set(t,Wr);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(e,t,i,r){t&&this._previousKeyframe.set("easing",t);const s=r&&r.params||{},o=function s4(n,e){const t=new Map;let i;return n.forEach(r=>{if("*"===r){i=i||e.keys();for(let s of i)t.set(s,Wr)}else Es(r,t)}),t}(e,this._globalTimelineStyles);for(let[a,l]of o){const c=ru(l,s,i);this._pendingStyles.set(a,c),this._localTimelineStyles.has(a)||this._backFill.set(a,this._globalTimelineStyles.get(a)??Wr),this._updateStyle(a,c)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((e,t)=>{this._currentKeyframe.set(t,e)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((e,t)=>{this._currentKeyframe.has(t)||this._currentKeyframe.set(t,e)}))}snapshotCurrentStyles(){for(let[e,t]of this._localTimelineStyles)this._pendingStyles.set(e,t),this._updateStyle(e,t)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const e=[];for(let t in this._currentKeyframe)e.push(t);return e}mergeTimelineCollectedStyles(e){e._styleSummary.forEach((t,i)=>{const r=this._styleSummary.get(i);(!r||t.time>r.time)&&this._updateStyle(i,t.value)})}buildKeyframes(){this.applyStylesToKeyframe();const e=new Set,t=new Set,i=1===this._keyframes.size&&0===this.duration;let r=[];this._keyframes.forEach((a,l)=>{const c=Es(a,new Map,this._backFill);c.forEach((u,d)=>{"!"===u?e.add(d):u===Wr&&t.add(d)}),i||c.set("offset",l/this.duration),r.push(c)});const s=e.size?jh(e.values()):[],o=t.size?jh(t.values()):[];if(i){const a=r[0],l=new Map(a);a.set("offset",0),l.set("offset",1),r=[a,l]}return p_(this.element,r,s,o,this.duration,this.startTime,this.easing,!1)}}class r4 extends Jh{constructor(e,t,i,r,s,o,a=!1){super(e,t,o.delay),this.keyframes=i,this.preStyleProps=r,this.postStyleProps=s,this._stretchStartingKeyframe=a,this.timings={duration:o.duration,delay:o.delay,easing:o.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let e=this.keyframes,{delay:t,duration:i,easing:r}=this.timings;if(this._stretchStartingKeyframe&&t){const s=[],o=i+t,a=t/o,l=Es(e[0]);l.set("offset",0),s.push(l);const c=Es(e[0]);c.set("offset",HD(a)),s.push(c);const u=e.length-1;for(let d=1;d<=u;d++){let h=Es(e[d]);const f=h.get("offset");h.set("offset",HD((t+f*i)/o)),s.push(h)}i=o,t=0,r="",e=s}return p_(this.element,e,this.preStyleProps,this.postStyleProps,i,t,r,!0)}}function HD(n,e=3){const t=Math.pow(10,e-1);return Math.round(n*t)/t}class y_{}const o4=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class a4 extends y_{normalizePropertyName(e,t){return d_(e)}normalizeStyleValue(e,t,i,r){let s="";const o=i.toString().trim();if(o4.has(t)&&0!==i&&"0"!==i)if("number"==typeof i)s="px";else{const a=i.match(/^[+-]?[\d\.]+([a-z]*)$/);a&&0==a[1].length&&r.push(function KV(n,e){return new ie(3005,!1)}())}return o+s}}function GD(n,e,t,i,r,s,o,a,l,c,u,d,h){return{type:0,element:n,triggerName:e,isRemovalTransition:r,fromState:t,fromStyles:s,toState:i,toStyles:o,timelines:a,queriedElements:l,preStyleProps:c,postStyleProps:u,totalTime:d,errors:h}}const __={};class WD{constructor(e,t,i){this._triggerName=e,this.ast=t,this._stateStyles=i}match(e,t,i,r){return function l4(n,e,t,i,r){return n.some(s=>s(e,t,i,r))}(this.ast.matchers,e,t,i,r)}buildStyles(e,t,i){let r=this._stateStyles.get("*");return void 0!==e&&(r=this._stateStyles.get(e?.toString())||r),r?r.buildStyles(t,i):new Map}build(e,t,i,r,s,o,a,l,c,u){const d=[],h=this.ast.options&&this.ast.options.params||__,p=this.buildStyles(i,a&&a.params||__,d),g=l&&l.params||__,m=this.buildStyles(r,g,d),y=new Set,b=new Map,_=new Map,v="void"===r,S={params:c4(g,h),delay:this.ast.options?.delay},M=u?[]:m_(e,t,this.ast.animation,s,o,p,m,S,c,d);let I=0;if(M.forEach(D=>{I=Math.max(D.duration+D.delay,I)}),d.length)return GD(t,this._triggerName,i,r,v,p,m,[],[],b,_,I,d);M.forEach(D=>{const P=D.element,V=gi(b,P,new Set);D.preStyleProps.forEach(z=>V.add(z));const ne=gi(_,P,new Set);D.postStyleProps.forEach(z=>ne.add(z)),P!==t&&y.add(P)});const x=jh(y.values());return GD(t,this._triggerName,i,r,v,p,m,M,x,b,_,I)}}function c4(n,e){const t=nu(e);for(const i in n)n.hasOwnProperty(i)&&null!=n[i]&&(t[i]=n[i]);return t}class u4{constructor(e,t,i){this.styles=e,this.defaultParams=t,this.normalizer=i}buildStyles(e,t){const i=new Map,r=nu(this.defaultParams);return Object.keys(e).forEach(s=>{const o=e[s];null!==o&&(r[s]=o)}),this.styles.styles.forEach(s=>{"string"!=typeof s&&s.forEach((o,a)=>{o&&(o=ru(o,r,t));const l=this.normalizer.normalizePropertyName(a,t);o=this.normalizer.normalizeStyleValue(a,l,o,t),i.set(a,o)})}),i}}class h4{constructor(e,t,i){this.name=e,this.ast=t,this._normalizer=i,this.transitionFactories=[],this.states=new Map,t.states.forEach(r=>{this.states.set(r.name,new u4(r.style,r.options&&r.options.params||{},i))}),jD(this.states,"true","1"),jD(this.states,"false","0"),t.transitions.forEach(r=>{this.transitionFactories.push(new WD(e,r,this.states))}),this.fallbackTransition=function f4(n,e,t){return new WD(n,{type:1,animation:{type:2,steps:[],options:null},matchers:[(o,a)=>!0],options:null,queryCount:0,depCount:0},e)}(e,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(e,t,i,r){return this.transitionFactories.find(o=>o.match(e,t,i,r))||null}matchStyles(e,t,i){return this.fallbackTransition.buildStyles(e,t,i)}}function jD(n,e,t){n.has(e)?n.has(t)||n.set(t,n.get(e)):n.has(t)&&n.set(e,n.get(t))}const p4=new Kh;class m4{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._animations=new Map,this._playersById=new Map,this.players=[]}register(e,t){const i=[],s=h_(this._driver,t,i,[]);if(i.length)throw function mH(n){return new ie(3503,!1)}();this._animations.set(e,s)}_buildPlayer(e,t,i){const r=e.element,s=wD(0,this._normalizer,0,e.keyframes,t,i);return this._driver.animate(r,s,e.duration,e.delay,e.easing,[],!0)}create(e,t,i={}){const r=[],s=this._animations.get(e);let o;const a=new Map;if(s?(o=m_(this._driver,t,s,a_,Vh,new Map,new Map,i,p4,r),o.forEach(u=>{const d=gi(a,u.element,new Map);u.postStyleProps.forEach(h=>d.set(h,null))})):(r.push(function gH(){return new ie(3300,!1)}()),o=[]),r.length)throw function yH(n){return new ie(3504,!1)}();a.forEach((u,d)=>{u.forEach((h,f)=>{u.set(f,this._driver.computeStyle(d,f,Wr))})});const c=Ms(o.map(u=>{const d=a.get(u.element);return this._buildPlayer(u,new Map,d)}));return this._playersById.set(e,c),c.onDestroy(()=>this.destroy(e)),this.players.push(c),c}destroy(e){const t=this._getPlayer(e);t.destroy(),this._playersById.delete(e);const i=this.players.indexOf(t);i>=0&&this.players.splice(i,1)}_getPlayer(e){const t=this._playersById.get(e);if(!t)throw function _H(n){return new ie(3301,!1)}();return t}listen(e,t,i,r){const s=i_(t,"","","");return t_(this._getPlayer(e),i,s,r),()=>{}}command(e,t,i,r){if("register"==i)return void this.register(e,r[0]);if("create"==i)return void this.create(e,t,r[0]||{});const s=this._getPlayer(e);switch(i){case"play":s.play();break;case"pause":s.pause();break;case"reset":s.reset();break;case"restart":s.restart();break;case"finish":s.finish();break;case"init":s.init();break;case"setPosition":s.setPosition(parseFloat(r[0]));break;case"destroy":this.destroy(e)}}}const $D="ng-animate-queued",v_="ng-animate-disabled",b4=[],qD={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},x4={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Li="__ng_removed";class b_{constructor(e,t=""){this.namespaceId=t;const i=e&&e.hasOwnProperty("value");if(this.value=function E4(n){return n??null}(i?e.value:e),i){const s=nu(e);delete s.value,this.options=s}else this.options={};this.options.params||(this.options.params={})}get params(){return this.options.params}absorbOptions(e){const t=e.params;if(t){const i=this.options.params;Object.keys(t).forEach(r=>{null==i[r]&&(i[r]=t[r])})}}}const su="void",x_=new b_(su);class S4{constructor(e,t,i){this.id=e,this.hostElement=t,this._engine=i,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+e,Ni(t,this._hostClassName)}listen(e,t,i,r){if(!this._triggers.has(t))throw function vH(n,e){return new ie(3302,!1)}();if(null==i||0==i.length)throw function bH(n){return new ie(3303,!1)}();if(!function C4(n){return"start"==n||"done"==n}(i))throw function xH(n,e){return new ie(3400,!1)}();const s=gi(this._elementListeners,e,[]),o={name:t,phase:i,callback:r};s.push(o);const a=gi(this._engine.statesByElement,e,new Map);return a.has(t)||(Ni(e,Hh),Ni(e,Hh+"-"+t),a.set(t,x_)),()=>{this._engine.afterFlush(()=>{const l=s.indexOf(o);l>=0&&s.splice(l,1),this._triggers.has(t)||a.delete(t)})}}register(e,t){return!this._triggers.has(e)&&(this._triggers.set(e,t),!0)}_getTrigger(e){const t=this._triggers.get(e);if(!t)throw function SH(n){return new ie(3401,!1)}();return t}trigger(e,t,i,r=!0){const s=this._getTrigger(t),o=new S_(this.id,t,e);let a=this._engine.statesByElement.get(e);a||(Ni(e,Hh),Ni(e,Hh+"-"+t),this._engine.statesByElement.set(e,a=new Map));let l=a.get(t);const c=new b_(i,this.id);if(!(i&&i.hasOwnProperty("value"))&&l&&c.absorbOptions(l.options),a.set(t,c),l||(l=x_),c.value!==su&&l.value===c.value){if(!function A4(n,e){const t=Object.keys(n),i=Object.keys(e);if(t.length!=i.length)return!1;for(let r=0;r<t.length;r++){const s=t[r];if(!e.hasOwnProperty(s)||n[s]!==e[s])return!1}return!0}(l.params,c.params)){const g=[],m=s.matchStyles(l.value,l.params,g),y=s.matchStyles(c.value,c.params,g);g.length?this._engine.reportError(g):this._engine.afterFlush(()=>{go(e,m),vr(e,y)})}return}const h=gi(this._engine.playersByElement,e,[]);h.forEach(g=>{g.namespaceId==this.id&&g.triggerName==t&&g.queued&&g.destroy()});let f=s.matchTransition(l.value,c.value,e,c.params),p=!1;if(!f){if(!r)return;f=s.fallbackTransition,p=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:t,transition:f,fromState:l,toState:c,player:o,isFallbackTransition:p}),p||(Ni(e,$D),o.onStart(()=>{ja(e,$D)})),o.onDone(()=>{let g=this.players.indexOf(o);g>=0&&this.players.splice(g,1);const m=this._engine.playersByElement.get(e);if(m){let y=m.indexOf(o);y>=0&&m.splice(y,1)}}),this.players.push(o),h.push(o),o}deregister(e){this._triggers.delete(e),this._engine.statesByElement.forEach(t=>t.delete(e)),this._elementListeners.forEach((t,i)=>{this._elementListeners.set(i,t.filter(r=>r.name!=e))})}clearElementCache(e){this._engine.statesByElement.delete(e),this._elementListeners.delete(e);const t=this._engine.playersByElement.get(e);t&&(t.forEach(i=>i.destroy()),this._engine.playersByElement.delete(e))}_signalRemovalForInnerTriggers(e,t){const i=this._engine.driver.query(e,Gh,!0);i.forEach(r=>{if(r[Li])return;const s=this._engine.fetchNamespacesByElement(r);s.size?s.forEach(o=>o.triggerLeaveAnimation(r,t,!1,!0)):this.clearElementCache(r)}),this._engine.afterFlushAnimationsDone(()=>i.forEach(r=>this.clearElementCache(r)))}triggerLeaveAnimation(e,t,i,r){const s=this._engine.statesByElement.get(e),o=new Map;if(s){const a=[];if(s.forEach((l,c)=>{if(o.set(c,l.value),this._triggers.has(c)){const u=this.trigger(e,c,su,r);u&&a.push(u)}}),a.length)return this._engine.markElementAsRemoved(this.id,e,!0,t,o),i&&Ms(a).onDone(()=>this._engine.processLeaveNode(e)),!0}return!1}prepareLeaveAnimationListeners(e){const t=this._elementListeners.get(e),i=this._engine.statesByElement.get(e);if(t&&i){const r=new Set;t.forEach(s=>{const o=s.name;if(r.has(o))return;r.add(o);const l=this._triggers.get(o).fallbackTransition,c=i.get(o)||x_,u=new b_(su),d=new S_(this.id,o,e);this._engine.totalQueuedPlayers++,this._queue.push({element:e,triggerName:o,transition:l,fromState:c,toState:u,player:d,isFallbackTransition:!0})})}}removeNode(e,t){const i=this._engine;if(e.childElementCount&&this._signalRemovalForInnerTriggers(e,t),this.triggerLeaveAnimation(e,t,!0))return;let r=!1;if(i.totalAnimations){const s=i.players.length?i.playersByQueriedElement.get(e):[];if(s&&s.length)r=!0;else{let o=e;for(;o=o.parentNode;)if(i.statesByElement.get(o)){r=!0;break}}}if(this.prepareLeaveAnimationListeners(e),r)i.markElementAsRemoved(this.id,e,!1,t);else{const s=e[Li];(!s||s===qD)&&(i.afterFlush(()=>this.clearElementCache(e)),i.destroyInnerAnimations(e),i._onRemovalComplete(e,t))}}insertNode(e,t){Ni(e,this._hostClassName)}drainQueuedTransitions(e){const t=[];return this._queue.forEach(i=>{const r=i.player;if(r.destroyed)return;const s=i.element,o=this._elementListeners.get(s);o&&o.forEach(a=>{if(a.name==i.triggerName){const l=i_(s,i.triggerName,i.fromState.value,i.toState.value);l._data=e,t_(i.player,a.phase,l,a.callback)}}),r.markedForDestroy?this._engine.afterFlush(()=>{r.destroy()}):t.push(i)}),this._queue=[],t.sort((i,r)=>{const s=i.transition.ast.depCount,o=r.transition.ast.depCount;return 0==s||0==o?s-o:this._engine.driver.containsElement(i.element,r.element)?1:-1})}destroy(e){this.players.forEach(t=>t.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,e)}elementContainsData(e){let t=!1;return this._elementListeners.has(e)&&(t=!0),t=!!this._queue.find(i=>i.element===e)||t,t}}class w4{constructor(e,t,i){this.bodyNode=e,this.driver=t,this._normalizer=i,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(r,s)=>{}}_onRemovalComplete(e,t){this.onRemovalComplete(e,t)}get queuedPlayers(){const e=[];return this._namespaceList.forEach(t=>{t.players.forEach(i=>{i.queued&&e.push(i)})}),e}createNamespace(e,t){const i=new S4(e,t,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,t)?this._balanceNamespaceList(i,t):(this.newHostElements.set(t,i),this.collectEnterElement(t)),this._namespaceLookup[e]=i}_balanceNamespaceList(e,t){const i=this._namespaceList,r=this.namespacesByHostElement;if(i.length-1>=0){let o=!1,a=this.driver.getParentElement(t);for(;a;){const l=r.get(a);if(l){const c=i.indexOf(l);i.splice(c+1,0,e),o=!0;break}a=this.driver.getParentElement(a)}o||i.unshift(e)}else i.push(e);return r.set(t,e),e}register(e,t){let i=this._namespaceLookup[e];return i||(i=this.createNamespace(e,t)),i}registerTrigger(e,t,i){let r=this._namespaceLookup[e];r&&r.register(t,i)&&this.totalAnimations++}destroy(e,t){if(!e)return;const i=this._fetchNamespace(e);this.afterFlush(()=>{this.namespacesByHostElement.delete(i.hostElement),delete this._namespaceLookup[e];const r=this._namespaceList.indexOf(i);r>=0&&this._namespaceList.splice(r,1)}),this.afterFlushAnimationsDone(()=>i.destroy(t))}_fetchNamespace(e){return this._namespaceLookup[e]}fetchNamespacesByElement(e){const t=new Set,i=this.statesByElement.get(e);if(i)for(let r of i.values())if(r.namespaceId){const s=this._fetchNamespace(r.namespaceId);s&&t.add(s)}return t}trigger(e,t,i,r){if(ef(t)){const s=this._fetchNamespace(e);if(s)return s.trigger(t,i,r),!0}return!1}insertNode(e,t,i,r){if(!ef(t))return;const s=t[Li];if(s&&s.setForRemoval){s.setForRemoval=!1,s.setForMove=!0;const o=this.collectedLeaveElements.indexOf(t);o>=0&&this.collectedLeaveElements.splice(o,1)}if(e){const o=this._fetchNamespace(e);o&&o.insertNode(t,i)}r&&this.collectEnterElement(t)}collectEnterElement(e){this.collectedEnterElements.push(e)}markElementAsDisabled(e,t){t?this.disabledNodes.has(e)||(this.disabledNodes.add(e),Ni(e,v_)):this.disabledNodes.has(e)&&(this.disabledNodes.delete(e),ja(e,v_))}removeNode(e,t,i,r){if(ef(t)){const s=e?this._fetchNamespace(e):null;if(s?s.removeNode(t,r):this.markElementAsRemoved(e,t,!1,r),i){const o=this.namespacesByHostElement.get(t);o&&o.id!==e&&o.removeNode(t,r)}}else this._onRemovalComplete(t,r)}markElementAsRemoved(e,t,i,r,s){this.collectedLeaveElements.push(t),t[Li]={namespaceId:e,setForRemoval:r,hasAnimation:i,removedBeforeQueried:!1,previousTriggersValues:s}}listen(e,t,i,r,s){return ef(t)?this._fetchNamespace(e).listen(t,i,r,s):()=>{}}_buildInstruction(e,t,i,r,s){return e.transition.build(this.driver,e.element,e.fromState.value,e.toState.value,i,r,e.fromState.options,e.toState.options,t,s)}destroyInnerAnimations(e){let t=this.driver.query(e,Gh,!0);t.forEach(i=>this.destroyActiveAnimationsForElement(i)),0!=this.playersByQueriedElement.size&&(t=this.driver.query(e,l_,!0),t.forEach(i=>this.finishActiveQueriedAnimationOnElement(i)))}destroyActiveAnimationsForElement(e){const t=this.playersByElement.get(e);t&&t.forEach(i=>{i.queued?i.markedForDestroy=!0:i.destroy()})}finishActiveQueriedAnimationOnElement(e){const t=this.playersByQueriedElement.get(e);t&&t.forEach(i=>i.finish())}whenRenderingDone(){return new Promise(e=>{if(this.players.length)return Ms(this.players).onDone(()=>e());e()})}processLeaveNode(e){const t=e[Li];if(t&&t.setForRemoval){if(e[Li]=qD,t.namespaceId){this.destroyInnerAnimations(e);const i=this._fetchNamespace(t.namespaceId);i&&i.clearElementCache(e)}this._onRemovalComplete(e,t.setForRemoval)}e.classList?.contains(v_)&&this.markElementAsDisabled(e,!1),this.driver.query(e,".ng-animate-disabled",!0).forEach(i=>{this.markElementAsDisabled(i,!1)})}flush(e=-1){let t=[];if(this.newHostElements.size&&(this.newHostElements.forEach((i,r)=>this._balanceNamespaceList(i,r)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let i=0;i<this.collectedEnterElements.length;i++)Ni(this.collectedEnterElements[i],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const i=[];try{t=this._flushAnimations(i,e)}finally{for(let r=0;r<i.length;r++)i[r]()}}else for(let i=0;i<this.collectedLeaveElements.length;i++)this.processLeaveNode(this.collectedLeaveElements[i]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(i=>i()),this._flushFns=[],this._whenQuietFns.length){const i=this._whenQuietFns;this._whenQuietFns=[],t.length?Ms(t).onDone(()=>{i.forEach(r=>r())}):i.forEach(r=>r())}}reportError(e){throw function wH(n){return new ie(3402,!1)}()}_flushAnimations(e,t){const i=new Kh,r=[],s=new Map,o=[],a=new Map,l=new Map,c=new Map,u=new Set;this.disabledNodes.forEach(N=>{u.add(N);const U=this.driver.query(N,".ng-animate-queued",!0);for(let O=0;O<U.length;O++)u.add(U[O])});const d=this.bodyNode,h=Array.from(this.statesByElement.keys()),f=ZD(h,this.collectedEnterElements),p=new Map;let g=0;f.forEach((N,U)=>{const O=a_+g++;p.set(U,O),N.forEach($=>Ni($,O))});const m=[],y=new Set,b=new Set;for(let N=0;N<this.collectedLeaveElements.length;N++){const U=this.collectedLeaveElements[N],O=U[Li];O&&O.setForRemoval&&(m.push(U),y.add(U),O.hasAnimation?this.driver.query(U,".ng-star-inserted",!0).forEach($=>y.add($)):b.add(U))}const _=new Map,v=ZD(h,Array.from(y));v.forEach((N,U)=>{const O=Vh+g++;_.set(U,O),N.forEach($=>Ni($,O))}),e.push(()=>{f.forEach((N,U)=>{const O=p.get(U);N.forEach($=>ja($,O))}),v.forEach((N,U)=>{const O=_.get(U);N.forEach($=>ja($,O))}),m.forEach(N=>{this.processLeaveNode(N)})});const S=[],M=[];for(let N=this._namespaceList.length-1;N>=0;N--)this._namespaceList[N].drainQueuedTransitions(t).forEach(O=>{const $=O.player,q=O.element;if(S.push($),this.collectedEnterElements.length){const Me=q[Li];if(Me&&Me.setForMove){if(Me.previousTriggersValues&&Me.previousTriggersValues.has(O.triggerName)){const ye=Me.previousTriggersValues.get(O.triggerName),Ce=this.statesByElement.get(O.element);if(Ce&&Ce.has(O.triggerName)){const de=Ce.get(O.triggerName);de.value=ye,Ce.set(O.triggerName,de)}}return void $.destroy()}}const G=!d||!this.driver.containsElement(d,q),H=_.get(q),oe=p.get(q),te=this._buildInstruction(O,i,oe,H,G);if(te.errors&&te.errors.length)return void M.push(te);if(G)return $.onStart(()=>go(q,te.fromStyles)),$.onDestroy(()=>vr(q,te.toStyles)),void r.push($);if(O.isFallbackTransition)return $.onStart(()=>go(q,te.fromStyles)),$.onDestroy(()=>vr(q,te.toStyles)),void r.push($);const ue=[];te.timelines.forEach(Me=>{Me.stretchStartingKeyframe=!0,this.disabledNodes.has(Me.element)||ue.push(Me)}),te.timelines=ue,i.append(q,te.timelines),o.push({instruction:te,player:$,element:q}),te.queriedElements.forEach(Me=>gi(a,Me,[]).push($)),te.preStyleProps.forEach((Me,ye)=>{if(Me.size){let Ce=l.get(ye);Ce||l.set(ye,Ce=new Set),Me.forEach((de,We)=>Ce.add(We))}}),te.postStyleProps.forEach((Me,ye)=>{let Ce=c.get(ye);Ce||c.set(ye,Ce=new Set),Me.forEach((de,We)=>Ce.add(We))})});if(M.length){const N=[];M.forEach(U=>{N.push(function MH(n,e){return new ie(3505,!1)}())}),S.forEach(U=>U.destroy()),this.reportError(N)}const I=new Map,x=new Map;o.forEach(N=>{const U=N.element;i.has(U)&&(x.set(U,U),this._beforeAnimationBuild(N.player.namespaceId,N.instruction,I))}),r.forEach(N=>{const U=N.element;this._getPreviousPlayers(U,!1,N.namespaceId,N.triggerName,null).forEach($=>{gi(I,U,[]).push($),$.destroy()})});const D=m.filter(N=>QD(N,l,c)),P=new Map;XD(P,this.driver,b,c,Wr).forEach(N=>{QD(N,l,c)&&D.push(N)});const ne=new Map;f.forEach((N,U)=>{XD(ne,this.driver,new Set(N),l,"!")}),D.forEach(N=>{const U=P.get(N),O=ne.get(N);P.set(N,new Map([...Array.from(U?.entries()??[]),...Array.from(O?.entries()??[])]))});const z=[],L=[],j={};o.forEach(N=>{const{element:U,player:O,instruction:$}=N;if(i.has(U)){if(u.has(U))return O.onDestroy(()=>vr(U,$.toStyles)),O.disabled=!0,O.overrideTotalTime($.totalTime),void r.push(O);let q=j;if(x.size>1){let H=U;const oe=[];for(;H=H.parentNode;){const te=x.get(H);if(te){q=te;break}oe.push(H)}oe.forEach(te=>x.set(te,q))}const G=this._buildAnimation(O.namespaceId,$,I,s,ne,P);if(O.setRealPlayer(G),q===j)z.push(O);else{const H=this.playersByElement.get(q);H&&H.length&&(O.parentPlayer=Ms(H)),r.push(O)}}else go(U,$.fromStyles),O.onDestroy(()=>vr(U,$.toStyles)),L.push(O),u.has(U)&&r.push(O)}),L.forEach(N=>{const U=s.get(N.element);if(U&&U.length){const O=Ms(U);N.setRealPlayer(O)}}),r.forEach(N=>{N.parentPlayer?N.syncPlayerEvents(N.parentPlayer):N.destroy()});for(let N=0;N<m.length;N++){const U=m[N],O=U[Li];if(ja(U,Vh),O&&O.hasAnimation)continue;let $=[];if(a.size){let G=a.get(U);G&&G.length&&$.push(...G);let H=this.driver.query(U,l_,!0);for(let oe=0;oe<H.length;oe++){let te=a.get(H[oe]);te&&te.length&&$.push(...te)}}const q=$.filter(G=>!G.destroyed);q.length?D4(this,U,q):this.processLeaveNode(U)}return m.length=0,z.forEach(N=>{this.players.push(N),N.onDone(()=>{N.destroy();const U=this.players.indexOf(N);this.players.splice(U,1)}),N.play()}),z}elementContainsData(e,t){let i=!1;const r=t[Li];return r&&r.setForRemoval&&(i=!0),this.playersByElement.has(t)&&(i=!0),this.playersByQueriedElement.has(t)&&(i=!0),this.statesByElement.has(t)&&(i=!0),this._fetchNamespace(e).elementContainsData(t)||i}afterFlush(e){this._flushFns.push(e)}afterFlushAnimationsDone(e){this._whenQuietFns.push(e)}_getPreviousPlayers(e,t,i,r,s){let o=[];if(t){const a=this.playersByQueriedElement.get(e);a&&(o=a)}else{const a=this.playersByElement.get(e);if(a){const l=!s||s==su;a.forEach(c=>{c.queued||!l&&c.triggerName!=r||o.push(c)})}}return(i||r)&&(o=o.filter(a=>!(i&&i!=a.namespaceId||r&&r!=a.triggerName))),o}_beforeAnimationBuild(e,t,i){const s=t.element,o=t.isRemovalTransition?void 0:e,a=t.isRemovalTransition?void 0:t.triggerName;for(const l of t.timelines){const c=l.element,u=c!==s,d=gi(i,c,[]);this._getPreviousPlayers(c,u,o,a,t.toState).forEach(f=>{const p=f.getRealPlayer();p.beforeDestroy&&p.beforeDestroy(),f.destroy(),d.push(f)})}go(s,t.fromStyles)}_buildAnimation(e,t,i,r,s,o){const a=t.triggerName,l=t.element,c=[],u=new Set,d=new Set,h=t.timelines.map(p=>{const g=p.element;u.add(g);const m=g[Li];if(m&&m.removedBeforeQueried)return new tu(p.duration,p.delay);const y=g!==l,b=function T4(n){const e=[];return KD(n,e),e}((i.get(g)||b4).map(I=>I.getRealPlayer())).filter(I=>!!I.element&&I.element===g),_=s.get(g),v=o.get(g),S=wD(0,this._normalizer,0,p.keyframes,_,v),M=this._buildPlayer(p,S,b);if(p.subTimeline&&r&&d.add(g),y){const I=new S_(e,a,g);I.setRealPlayer(M),c.push(I)}return M});c.forEach(p=>{gi(this.playersByQueriedElement,p.element,[]).push(p),p.onDone(()=>function M4(n,e,t){let i=n.get(e);if(i){if(i.length){const r=i.indexOf(t);i.splice(r,1)}0==i.length&&n.delete(e)}return i}(this.playersByQueriedElement,p.element,p))}),u.forEach(p=>Ni(p,RD));const f=Ms(h);return f.onDestroy(()=>{u.forEach(p=>ja(p,RD)),vr(l,t.toStyles)}),d.forEach(p=>{gi(r,p,[]).push(f)}),f}_buildPlayer(e,t,i){return t.length>0?this.driver.animate(e.element,t,e.duration,e.delay,e.easing,i):new tu(e.duration,e.delay)}}class S_{constructor(e,t,i){this.namespaceId=e,this.triggerName=t,this.element=i,this._player=new tu,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(e){this._containsRealPlayer||(this._player=e,this._queuedCallbacks.forEach((t,i)=>{t.forEach(r=>t_(e,i,void 0,r))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(e.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(e){this.totalTime=e}syncPlayerEvents(e){const t=this._player;t.triggerCallback&&e.onStart(()=>t.triggerCallback("start")),e.onDone(()=>this.finish()),e.onDestroy(()=>this.destroy())}_queueEvent(e,t){gi(this._queuedCallbacks,e,[]).push(t)}onDone(e){this.queued&&this._queueEvent("done",e),this._player.onDone(e)}onStart(e){this.queued&&this._queueEvent("start",e),this._player.onStart(e)}onDestroy(e){this.queued&&this._queueEvent("destroy",e),this._player.onDestroy(e)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(e){this.queued||this._player.setPosition(e)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(e){const t=this._player;t.triggerCallback&&t.triggerCallback(e)}}function ef(n){return n&&1===n.nodeType}function YD(n,e){const t=n.style.display;return n.style.display=e??"none",t}function XD(n,e,t,i,r){const s=[];t.forEach(l=>s.push(YD(l)));const o=[];i.forEach((l,c)=>{const u=new Map;l.forEach(d=>{const h=e.computeStyle(c,d,r);u.set(d,h),(!h||0==h.length)&&(c[Li]=x4,o.push(c))}),n.set(c,u)});let a=0;return t.forEach(l=>YD(l,s[a++])),o}function ZD(n,e){const t=new Map;if(n.forEach(a=>t.set(a,[])),0==e.length)return t;const r=new Set(e),s=new Map;function o(a){if(!a)return 1;let l=s.get(a);if(l)return l;const c=a.parentNode;return l=t.has(c)?c:r.has(c)?1:o(c),s.set(a,l),l}return e.forEach(a=>{const l=o(a);1!==l&&t.get(l).push(a)}),t}function Ni(n,e){n.classList?.add(e)}function ja(n,e){n.classList?.remove(e)}function D4(n,e,t){Ms(t).onDone(()=>n.processLeaveNode(e))}function KD(n,e){for(let t=0;t<n.length;t++){const i=n[t];i instanceof xD?KD(i.players,e):e.push(i)}}function QD(n,e,t){const i=t.get(n);if(!i)return!1;let r=e.get(n);return r?i.forEach(s=>r.add(s)):e.set(n,i),t.delete(n),!0}class tf{constructor(e,t,i){this.bodyNode=e,this._driver=t,this._normalizer=i,this._triggerCache={},this.onRemovalComplete=(r,s)=>{},this._transitionEngine=new w4(e,t,i),this._timelineEngine=new m4(e,t,i),this._transitionEngine.onRemovalComplete=(r,s)=>this.onRemovalComplete(r,s)}registerTrigger(e,t,i,r,s){const o=e+"-"+r;let a=this._triggerCache[o];if(!a){const l=[],u=h_(this._driver,s,l,[]);if(l.length)throw function fH(n,e){return new ie(3404,!1)}();a=function d4(n,e,t){return new h4(n,e,t)}(r,u,this._normalizer),this._triggerCache[o]=a}this._transitionEngine.registerTrigger(t,r,a)}register(e,t){this._transitionEngine.register(e,t)}destroy(e,t){this._transitionEngine.destroy(e,t)}onInsert(e,t,i,r){this._transitionEngine.insertNode(e,t,i,r)}onRemove(e,t,i,r){this._transitionEngine.removeNode(e,t,r||!1,i)}disableAnimations(e,t){this._transitionEngine.markElementAsDisabled(e,t)}process(e,t,i,r){if("@"==i.charAt(0)){const[s,o]=MD(i);this._timelineEngine.command(s,t,o,r)}else this._transitionEngine.trigger(e,t,i,r)}listen(e,t,i,r,s){if("@"==i.charAt(0)){const[o,a]=MD(i);return this._timelineEngine.listen(o,t,a,s)}return this._transitionEngine.listen(e,t,i,r,s)}flush(e=-1){this._transitionEngine.flush(e)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let P4=(()=>{class n{constructor(t,i,r){this._element=t,this._startStyles=i,this._endStyles=r,this._state=0;let s=n.initialStylesByElement.get(t);s||n.initialStylesByElement.set(t,s=new Map),this._initialStyles=s}start(){this._state<1&&(this._startStyles&&vr(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(vr(this._element,this._initialStyles),this._endStyles&&(vr(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(n.initialStylesByElement.delete(this._element),this._startStyles&&(go(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(go(this._element,this._endStyles),this._endStyles=null),vr(this._element,this._initialStyles),this._state=3)}}return n.initialStylesByElement=new WeakMap,n})();function w_(n){let e=null;return n.forEach((t,i)=>{(function R4(n){return"display"===n||"position"===n})(i)&&(e=e||new Map,e.set(i,t))}),e}class JD{constructor(e,t,i,r){this.element=e,this.keyframes=t,this.options=i,this._specialStyles=r,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=i.duration,this._delay=i.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(e=>e()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const e=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,e,this.options),this._finalKeyframe=e.length?e[e.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(e){const t=[];return e.forEach(i=>{t.push(Object.fromEntries(i))}),t}_triggerWebAnimation(e,t,i){return e.animate(this._convertKeyframesToObject(t),i)}onStart(e){this._originalOnStartFns.push(e),this._onStartFns.push(e)}onDone(e){this._originalOnDoneFns.push(e),this._onDoneFns.push(e)}onDestroy(e){this._onDestroyFns.push(e)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(e=>e()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(e=>e()),this._onDestroyFns=[])}setPosition(e){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=e*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const e=new Map;this.hasStarted()&&this._finalKeyframe.forEach((i,r)=>{"offset"!==r&&e.set(r,this._finished?i:BD(this.element,r))}),this.currentSnapshot=e}triggerCallback(e){const t="start"===e?this._onStartFns:this._onDoneFns;t.forEach(i=>i()),t.length=0}}class L4{validateStyleProperty(e){return!0}validateAnimatableStyleProperty(e){return!0}matchesElement(e,t){return!1}containsElement(e,t){return TD(e,t)}getParentElement(e){return s_(e)}query(e,t,i){return AD(e,t,i)}computeStyle(e,t,i){return window.getComputedStyle(e)[t]}animate(e,t,i,r,s,o=[]){const l={duration:i,delay:r,fill:0==r?"both":"forwards"};s&&(l.easing=s);const c=new Map,u=o.filter(f=>f instanceof JD);(function kH(n,e){return 0===n||0===e})(i,r)&&u.forEach(f=>{f.currentSnapshot.forEach((p,g)=>c.set(g,p))});let d=function LH(n){return n.length?n[0]instanceof Map?n:n.map(e=>LD(e)):[]}(t).map(f=>Es(f));d=function BH(n,e,t){if(t.size&&e.length){let i=e[0],r=[];if(t.forEach((s,o)=>{i.has(o)||r.push(o),i.set(o,s)}),r.length)for(let s=1;s<e.length;s++){let o=e[s];r.forEach(a=>o.set(a,BD(n,a)))}}return e}(e,d,c);const h=function I4(n,e){let t=null,i=null;return Array.isArray(e)&&e.length?(t=w_(e[0]),e.length>1&&(i=w_(e[e.length-1]))):e instanceof Map&&(t=w_(e)),t||i?new P4(n,t,i):null}(e,d);return new JD(e,d,l,h)}}let N4=(()=>{class n extends yD{constructor(t,i){super(),this._nextAnimationId=0,this._renderer=t.createRenderer(i.body,{id:"0",encapsulation:Wi.None,styles:[],data:{animation:[]}})}build(t){const i=this._nextAnimationId.toString();this._nextAnimationId++;const r=Array.isArray(t)?_D(t):t;return eT(this._renderer,null,i,"register",[r]),new O4(i,this._renderer)}}return n.\u0275fac=function(t){return new(t||n)(pe(Ac),pe(Fn))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class O4 extends WV{constructor(e,t){super(),this._id=e,this._renderer=t}create(e,t){return new F4(this._id,e,t||{},this._renderer)}}class F4{constructor(e,t,i,r){this.id=e,this.element=t,this._renderer=r,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",i)}_listen(e,t){return this._renderer.listen(this.element,`@@${this.id}:${e}`,t)}_command(e,...t){return eT(this._renderer,this.element,this.id,e,t)}onDone(e){this._listen("done",e)}onStart(e){this._listen("start",e)}onDestroy(e){this._listen("destroy",e)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(e){this._command("setPosition",e)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function eT(n,e,t,i,r){return n.setProperty(e,`@@${t}:${i}`,r)}const tT="@.disabled";let k4=(()=>{class n{constructor(t,i,r){this.delegate=t,this.engine=i,this._zone=r,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),i.onRemovalComplete=(s,o)=>{const a=o?.parentNode(s);a&&o.removeChild(a,s)}}createRenderer(t,i){const s=this.delegate.createRenderer(t,i);if(!(t&&i&&i.data&&i.data.animation)){let u=this._rendererCache.get(s);return u||(u=new nT("",s,this.engine,()=>this._rendererCache.delete(s)),this._rendererCache.set(s,u)),u}const o=i.id,a=i.id+"-"+this._currentId;this._currentId++,this.engine.register(a,t);const l=u=>{Array.isArray(u)?u.forEach(l):this.engine.registerTrigger(o,a,t,u.name,u)};return i.data.animation.forEach(l),new B4(this,a,s,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(t,i,r){t>=0&&t<this._microtaskId?this._zone.run(()=>i(r)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(s=>{const[o,a]=s;o(a)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([i,r]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return n.\u0275fac=function(t){return new(t||n)(pe(Ac),pe(tf),pe(Ut))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();class nT{constructor(e,t,i,r){this.namespaceId=e,this.delegate=t,this.engine=i,this._onDestroy=r,this.destroyNode=this.delegate.destroyNode?s=>t.destroyNode(s):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(e,t){return this.delegate.createElement(e,t)}createComment(e){return this.delegate.createComment(e)}createText(e){return this.delegate.createText(e)}appendChild(e,t){this.delegate.appendChild(e,t),this.engine.onInsert(this.namespaceId,t,e,!1)}insertBefore(e,t,i,r=!0){this.delegate.insertBefore(e,t,i),this.engine.onInsert(this.namespaceId,t,e,r)}removeChild(e,t,i){this.engine.onRemove(this.namespaceId,t,this.delegate,i)}selectRootElement(e,t){return this.delegate.selectRootElement(e,t)}parentNode(e){return this.delegate.parentNode(e)}nextSibling(e){return this.delegate.nextSibling(e)}setAttribute(e,t,i,r){this.delegate.setAttribute(e,t,i,r)}removeAttribute(e,t,i){this.delegate.removeAttribute(e,t,i)}addClass(e,t){this.delegate.addClass(e,t)}removeClass(e,t){this.delegate.removeClass(e,t)}setStyle(e,t,i,r){this.delegate.setStyle(e,t,i,r)}removeStyle(e,t,i){this.delegate.removeStyle(e,t,i)}setProperty(e,t,i){"@"==t.charAt(0)&&t==tT?this.disableAnimations(e,!!i):this.delegate.setProperty(e,t,i)}setValue(e,t){this.delegate.setValue(e,t)}listen(e,t,i){return this.delegate.listen(e,t,i)}disableAnimations(e,t){this.engine.disableAnimations(e,t)}}class B4 extends nT{constructor(e,t,i,r,s){super(t,i,r,s),this.factory=e,this.namespaceId=t}setProperty(e,t,i){"@"==t.charAt(0)?"."==t.charAt(1)&&t==tT?this.disableAnimations(e,i=void 0===i||!!i):this.engine.process(this.namespaceId,e,t.slice(1),i):this.delegate.setProperty(e,t,i)}listen(e,t,i){if("@"==t.charAt(0)){const r=function U4(n){switch(n){case"body":return document.body;case"document":return document;case"window":return window;default:return n}}(e);let s=t.slice(1),o="";return"@"!=s.charAt(0)&&([s,o]=function z4(n){const e=n.indexOf(".");return[n.substring(0,e),n.slice(e+1)]}(s)),this.engine.listen(this.namespaceId,r,s,o,a=>{this.factory.scheduleListenerCallback(a._data||-1,i,a)})}return this.delegate.listen(e,t,i)}}let V4=(()=>{class n extends tf{constructor(t,i,r,s){super(t.body,i,r)}ngOnDestroy(){this.flush()}}return n.\u0275fac=function(t){return new(t||n)(pe(Fn),pe(o_),pe(y_),pe(Yc))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();const iT=[{provide:yD,useClass:N4},{provide:y_,useFactory:function H4(){return new a4}},{provide:tf,useClass:V4},{provide:Ac,useFactory:function G4(n,e,t){return new k4(n,e,t)},deps:[Bh,tf,Ut]}],M_=[{provide:o_,useFactory:()=>new L4},{provide:YE,useValue:"BrowserAnimations"},...iT],rT=[{provide:o_,useClass:ID},{provide:YE,useValue:"NoopAnimations"},...iT];let W4=(()=>{class n{static withConfig(t){return{ngModule:n,providers:t.disableAnimations?rT:M_}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({providers:M_,imports:[fD]}),n})();function qr(n,e){return dn((t,i)=>{let r=0;t.subscribe(hn(i,s=>n.call(e,s,r++)&&i.next(s)))})}function sr(n,e){return dn((t,i)=>{let r=null,s=0,o=!1;const a=()=>o&&!r&&i.complete();t.subscribe(hn(i,l=>{r?.unsubscribe();let c=0;const u=s++;Hi(n(l,u)).subscribe(r=hn(i,d=>i.next(e?e(l,d,u,c++):d),()=>{r=null,a()}))},()=>{o=!0,a()}))})}function $4(n,e){return n===e}const sT={now:()=>(sT.delegate||Date).now(),delegate:void 0};class q4 extends li{constructor(e=1/0,t=1/0,i=sT){super(),this._bufferSize=e,this._windowTime=t,this._timestampProvider=i,this._buffer=[],this._infiniteTimeWindow=!0,this._infiniteTimeWindow=t===1/0,this._bufferSize=Math.max(1,e),this._windowTime=Math.max(1,t)}next(e){const{isStopped:t,_buffer:i,_infiniteTimeWindow:r,_timestampProvider:s,_windowTime:o}=this;t||(i.push(e),!r&&i.push(s.now()+o)),this._trimBuffer(),super.next(e)}_subscribe(e){this._throwIfClosed(),this._trimBuffer();const t=this._innerSubscribe(e),{_infiniteTimeWindow:i,_buffer:r}=this,s=r.slice();for(let o=0;o<s.length&&!e.closed;o+=i?1:2)e.next(s[o]);return this._checkFinalizedStatuses(e),t}_trimBuffer(){const{_bufferSize:e,_timestampProvider:t,_buffer:i,_infiniteTimeWindow:r}=this,s=(r?1:2)*e;if(e<1/0&&s<i.length&&i.splice(0,i.length-s),!r){const o=t.now();let a=0;for(let l=1;l<i.length&&i[l]<=o;l+=2)a=l;a&&i.splice(0,a+1)}}}function De(...n){return fn(n,ic(n))}var or=(()=>{return(n=or||(or={})).Local="local_strategy",n.Session="session_strategy",n.InMemory="in_memory_strategy",or;var n})();class X4{static isStorageAvailable(e){let t=!0;try{"object"==typeof e?(e.setItem("test-storage","foobar"),e.removeItem("test-storage")):t=!1}catch{t=!1}return t}}function rf(){}let br=(()=>{class n{static normalize(t){return t=n.isCaseSensitive?t:t.toLowerCase(),`${n.prefix}${n.separator}${t}`}static isNormalizedKey(t){return 0===t.indexOf(n.prefix+n.separator)}static setPrefix(t){n.prefix=t}static setSeparator(t){n.separator=t}static setCaseSensitive(t){n.isCaseSensitive=t}static consumeConfiguration(t){"prefix"in t&&this.setPrefix(t.prefix),"separator"in t&&this.setSeparator(t.separator),"caseSensitive"in t&&this.setCaseSensitive(t.caseSensitive)}}return n.prefix="ngx-webstorage",n.separator="|",n.isCaseSensitive=!1,n})();class sf{constructor(e){this.strategy=e}retrieve(e){let t;return this.strategy.get(br.normalize(e)).subscribe(i=>t=typeof i>"u"?null:i),t}store(e,t){return this.strategy.set(br.normalize(e),t).subscribe(rf),t}clear(e){void 0!==e?this.strategy.del(br.normalize(e)).subscribe(rf):this.strategy.clear().subscribe(rf)}getStrategyName(){return this.strategy.name}observe(e){return e=br.normalize(e),this.strategy.keyChanges.pipe(qr(t=>null===t||t===e),sr(()=>this.strategy.get(e)),function j4(n,e=ps){return n=n??$4,dn((t,i)=>{let r,s=!0;t.subscribe(hn(i,o=>{const a=e(o);(s||!n(r,a))&&(s=!1,r=a,i.next(o))}))})}(),function Y4(n,e,t){let i,r=!1;return n&&"object"==typeof n?({bufferSize:i=1/0,windowTime:e=1/0,refCount:r=!1,scheduler:t}=n):i=n??1/0,Db({connector:()=>new q4(i,e,t),resetOnError:!0,resetOnComplete:!1,resetOnRefCountZero:r})}({refCount:!0,bufferSize:1}))}}let E_=(()=>{class n{constructor(){this.caches={}}get(t,i){return this.getCacheStore(t)[i]}set(t,i,r){this.getCacheStore(t)[i]=r}del(t,i){delete this.getCacheStore(t)[i]}clear(t){this.caches[t]={}}getCacheStore(t){return t in this.caches?this.caches[t]:this.caches[t]={}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const oT=new Ne("window_local_storage"),e5={provide:oT,useFactory:function J4(){return typeof window<"u"?window.localStorage:null}},aT=new Ne("window_session_storage"),n5={provide:aT,useFactory:function t5(){return typeof window<"u"?window.sessionStorage:null}};class lT{constructor(e,t){this.storage=e,this.cache=t,this.keyChanges=new li}get isAvailable(){return void 0===this._isAvailable&&(this._isAvailable=X4.isStorageAvailable(this.storage)),this._isAvailable}get(e){let t=this.cache.get(this.name,e);if(void 0!==t)return De(t);try{const i=this.storage.getItem(e);null!==i&&(t=JSON.parse(i),this.cache.set(this.name,e,t))}catch(i){console.warn(i)}return De(t)}set(e,t){const i=JSON.stringify(t);return this.storage.setItem(e,i),this.cache.set(this.name,e,t),this.keyChanges.next(e),De(t)}del(e){return this.storage.removeItem(e),this.cache.del(this.name,e),this.keyChanges.next(e),De(null)}clear(){return this.storage.clear(),this.cache.clear(this.name),this.keyChanges.next(null),De(null)}}class Yr extends lT{constructor(e,t,i,r){super(e,t),this.storage=e,this.cache=t,this.platformId=i,this.zone=r,this.name=Yr.strategyName,jC(this.platformId)&&this.listenExternalChanges()}listenExternalChanges(){window.addEventListener("storage",e=>this.zone.run(()=>{if(e.storageArea!==this.storage)return;const t=e.key;null!==t?this.cache.del(this.name,e.key):this.cache.clear(this.name),this.keyChanges.next(t)}))}}Yr.strategyName=or.Local,Yr.\u0275fac=function(e){return new(e||Yr)(pe(oT),pe(E_),pe(vh),pe(Ut))},Yr.\u0275prov=Ae({token:Yr,factory:Yr.\u0275fac});class Xr extends lT{constructor(e,t,i,r){super(e,t),this.storage=e,this.cache=t,this.platformId=i,this.zone=r,this.name=Xr.strategyName,jC(this.platformId)&&this.listenExternalChanges()}listenExternalChanges(){window.addEventListener("storage",e=>this.zone.run(()=>{if(e.storageArea!==this.storage)return;const t=e.key;null!==e.key?this.cache.del(this.name,e.key):this.cache.clear(this.name),this.keyChanges.next(t)}))}}Xr.strategyName=or.Session,Xr.\u0275fac=function(e){return new(e||Xr)(pe(aT),pe(E_),pe(vh),pe(Ut))},Xr.\u0275prov=Ae({token:Xr,factory:Xr.\u0275fac});class Zr{constructor(e){this.cache=e,this.keyChanges=new li,this.isAvailable=!0,this.name=Zr.strategyName}get(e){return De(this.cache.get(this.name,e))}set(e,t){return this.cache.set(this.name,e,t),this.keyChanges.next(e),De(t)}del(e){return this.cache.del(this.name,e),this.keyChanges.next(e),De(null)}clear(){return this.cache.clear(this.name),this.keyChanges.next(null),De(null)}}Zr.strategyName=or.InMemory,Zr.\u0275fac=function(e){return new(e||Zr)(pe(E_))},Zr.\u0275prov=Ae({token:Zr,factory:Zr.\u0275fac});const af=new Ne("STORAGE_STRATEGIES"),i5=[{provide:af,useClass:Zr,multi:!0},{provide:af,useClass:Yr,multi:!0},{provide:af,useClass:Xr,multi:!0}],cT="invalid_strategy";let _o=(()=>{class n{constructor(t){this.strategies=t,this.registration$=new li,t||(t=[]),this.strategies=t.reverse().map((i,r,s)=>i.name).map((i,r,s)=>s.indexOf(i)===r?r:null).filter(i=>null!==i).map(i=>t[i])}static get(t){if(!this.isStrategyRegistered(t))throw Error(cT);let i=this.index[t];return i.isAvailable||(i=this.index[or.InMemory]),i}static set(t,i){this.index[t]=i}static clear(t){void 0!==t?delete this.index[t]:this.index={}}static isStrategyRegistered(t){return t in this.index}static hasRegistredStrategies(){return Object.keys(this.index).length>0}getStrategy(t){return n.get(t)}indexStrategies(){this.strategies.forEach(t=>this.register(t.name,t))}indexStrategy(t,i=!1){if(n.isStrategyRegistered(t)&&!i)return n.get(t);const r=this.strategies.find(s=>s.name===t);if(!r)throw new Error(cT);return this.register(t,r,i),r}register(t,i,r=!1){(!n.isStrategyRegistered(t)||r)&&(n.set(t,i),this.registration$.next(t))}}return n.index={},n.\u0275fac=function(t){return new(t||n)(pe(af,8))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();class uT extends sf{}const o5={provide:uT,useFactory:function s5(n){const e=n.indexStrategy(or.Local);return new sf(e)},deps:[_o]},c5={provide:class a5 extends sf{},useFactory:function l5(n){const e=n.indexStrategy(or.Session);return new sf(e)},deps:[_o]},u5=[o5,c5],hT=new Ne("ngx_webstorage_config");function d5(n){return n.indexStrategies(),()=>_o.index}let h5=(()=>{class n{constructor(t,i){i?br.consumeConfiguration(i):console.error("NgxWebstorage : Possible misconfiguration (The forRoot method usage is mandatory since the 3.0.0)")}static forRoot(t={}){return{ngModule:n,providers:[{provide:hT,useValue:t},e5,n5,...u5,...i5,{provide:$c,useFactory:d5,deps:[_o],multi:!0}]}}}return n.\u0275fac=function(t){return new(t||n)(pe(_o),pe(hT,8))},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({}),n})();class Oi extends li{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const t=super._subscribe(e);return!t.closed&&e.next(this._value),t}getValue(){const{hasError:e,thrownError:t,_value:i}=this;if(e)throw t;return this._throwIfClosed(),i}next(e){super.next(this._value=e)}}const lf=ec(n=>function(){n(this),this.name="EmptyError",this.message="no elements in sequence"}),{isArray:f5}=Array,{getPrototypeOf:p5,prototype:m5,keys:g5}=Object;const{isArray:v5}=Array;function fT(n){return Je(e=>function b5(n,e){return v5(e)?n(...e):n(e)}(n,e))}function pT(...n){const e=ic(n),t=function VR(n){return yt(em(n))?n.pop():void 0}(n),{args:i,keys:r}=function y5(n){if(1===n.length){const e=n[0];if(f5(e))return{args:e,keys:null};if(function _5(n){return n&&"object"==typeof n&&p5(n)===m5}(e)){const t=g5(e);return{args:t.map(i=>e[i]),keys:t}}}return{args:n,keys:null}}(n);if(0===i.length)return fn([],e);const s=new nn(function S5(n,e,t=ps){return i=>{mT(e,()=>{const{length:r}=n,s=new Array(r);let o=r,a=r;for(let l=0;l<r;l++)mT(e,()=>{const c=fn(n[l],e);let u=!1;c.subscribe(hn(i,d=>{s[l]=d,u||(u=!0,a--),a||i.next(t(s.slice()))},()=>{--o||i.complete()}))},i)},i)}}(i,e,r?o=>function x5(n,e){return n.reduce((t,i,r)=>(t[i]=e[r],t),{})}(r,o):ps));return t?s.pipe(fT(t)):s}function mT(n,e,t){n?Dr(t,n,e):e()}function C_(...n){return function w5(){return ra(1)}()(fn(n,ic(n)))}function gT(n){return new nn(e=>{Hi(n()).subscribe(e)})}function ou(n,e){const t=yt(n)?n:()=>n,i=r=>r.error(t());return new nn(e?r=>e.schedule(i,0,r):i)}function D_(){return dn((n,e)=>{let t=null;n._refCount++;const i=hn(e,void 0,void 0,void 0,()=>{if(!n||n._refCount<=0||0<--n._refCount)return void(t=null);const r=n._connection,s=t;t=null,r&&(!s||r===s)&&r.unsubscribe(),e.unsubscribe()});n.subscribe(i),i.closed||(t=n.connect())})}class yT extends nn{constructor(e,t){super(),this.source=e,this.subjectFactory=t,this._subject=null,this._refCount=0,this._connection=null,db(e)&&(this.lift=e.lift)}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:e}=this;this._subject=this._connection=null,e?.unsubscribe()}connect(){let e=this._connection;if(!e){e=this._connection=new Mi;const t=this.getSubject();e.add(this.source.subscribe(hn(t,void 0,()=>{this._teardown(),t.complete()},i=>{this._teardown(),t.error(i)},()=>this._teardown()))),e.closed&&(this._connection=null,e=Mi.EMPTY)}return e}refCount(){return D_()(this)}}function au(n){return n<=0?()=>Tr:dn((e,t)=>{let i=0;e.subscribe(hn(t,r=>{++i<=n&&(t.next(r),n<=i&&t.complete())}))})}function cf(n){return dn((e,t)=>{let i=!1;e.subscribe(hn(t,r=>{i=!0,t.next(r)},()=>{i||t.next(n),t.complete()}))})}function _T(n=E5){return dn((e,t)=>{let i=!1;e.subscribe(hn(t,r=>{i=!0,t.next(r)},()=>i?t.complete():t.error(n())))})}function E5(){return new lf}function Cs(n,e){const t=arguments.length>=2;return i=>i.pipe(n?qr((r,s)=>n(r,s,i)):ps,au(1),t?cf(e):_T(()=>new lf))}function vo(n,e){return yt(e)?Sn(n,e,1):Sn(n,1)}function Xt(n,e,t){const i=yt(n)||e||t?{next:n,error:e,complete:t}:n;return i?dn((r,s)=>{var o;null===(o=i.subscribe)||void 0===o||o.call(i);let a=!0;r.subscribe(hn(s,l=>{var c;null===(c=i.next)||void 0===c||c.call(i,l),s.next(l)},()=>{var l;a=!1,null===(l=i.complete)||void 0===l||l.call(i),s.complete()},l=>{var c;a=!1,null===(c=i.error)||void 0===c||c.call(i,l),s.error(l)},()=>{var l,c;a&&(null===(l=i.unsubscribe)||void 0===l||l.call(i)),null===(c=i.finalize)||void 0===c||c.call(i)}))}):ps}function Ds(n){return dn((e,t)=>{let s,i=null,r=!1;i=e.subscribe(hn(t,void 0,void 0,o=>{s=Hi(n(o,Ds(n)(e))),i?(i.unsubscribe(),i=null,s.subscribe(t)):r=!0})),r&&(i.unsubscribe(),i=null,s.subscribe(t))})}function C5(n,e,t,i,r){return(s,o)=>{let a=t,l=e,c=0;s.subscribe(hn(o,u=>{const d=c++;l=a?n(l,u,d):(a=!0,u),i&&o.next(l)},r&&(()=>{a&&o.next(l),o.complete()})))}}function vT(n,e){return dn(C5(n,e,arguments.length>=2,!0))}function T_(n){return n<=0?()=>Tr:dn((e,t)=>{let i=[];e.subscribe(hn(t,r=>{i.push(r),n<i.length&&i.shift()},()=>{for(const r of i)t.next(r);t.complete()},void 0,()=>{i=null}))})}function bT(n,e){const t=arguments.length>=2;return i=>i.pipe(n?qr((r,s)=>n(r,s,i)):ps,T_(1),t?cf(e):_T(()=>new lf))}function A_(n){return dn((e,t)=>{try{e.subscribe(t)}finally{t.add(n)}})}const tt="primary",lu=Symbol("RouteTitle");class A5{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t[0]:t}return null}getAll(e){if(this.has(e)){const t=this.params[e];return Array.isArray(t)?t:[t]}return[]}get keys(){return Object.keys(this.params)}}function $a(n){return new A5(n)}function I5(n,e,t){const i=t.path.split("/");if(i.length>n.length||"full"===t.pathMatch&&(e.hasChildren()||i.length<n.length))return null;const r={};for(let s=0;s<i.length;s++){const o=i[s],a=n[s];if(o.startsWith(":"))r[o.substring(1)]=a;else if(o!==a.path)return null}return{consumed:n.slice(0,i.length),posParams:r}}function xr(n,e){const t=n?Object.keys(n):void 0,i=e?Object.keys(e):void 0;if(!t||!i||t.length!=i.length)return!1;let r;for(let s=0;s<t.length;s++)if(r=t[s],!xT(n[r],e[r]))return!1;return!0}function xT(n,e){if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;const t=[...n].sort(),i=[...e].sort();return t.every((r,s)=>i[s]===r)}return n===e}function ST(n){return Array.prototype.concat.apply([],n)}function wT(n){return n.length>0?n[n.length-1]:null}function An(n,e){for(const t in n)n.hasOwnProperty(t)&&e(n[t],t)}function Ts(n){return Nw(n)?n:ah(n)?fn(Promise.resolve(n)):De(n)}const uf=!1,R5={exact:function CT(n,e,t){if(!xo(n.segments,e.segments)||!df(n.segments,e.segments,t)||n.numberOfChildren!==e.numberOfChildren)return!1;for(const i in e.children)if(!n.children[i]||!CT(n.children[i],e.children[i],t))return!1;return!0},subset:DT},MT={exact:function L5(n,e){return xr(n,e)},subset:function N5(n,e){return Object.keys(e).length<=Object.keys(n).length&&Object.keys(e).every(t=>xT(n[t],e[t]))},ignored:()=>!0};function ET(n,e,t){return R5[t.paths](n.root,e.root,t.matrixParams)&&MT[t.queryParams](n.queryParams,e.queryParams)&&!("exact"===t.fragment&&n.fragment!==e.fragment)}function DT(n,e,t){return TT(n,e,e.segments,t)}function TT(n,e,t,i){if(n.segments.length>t.length){const r=n.segments.slice(0,t.length);return!(!xo(r,t)||e.hasChildren()||!df(r,t,i))}if(n.segments.length===t.length){if(!xo(n.segments,t)||!df(n.segments,t,i))return!1;for(const r in e.children)if(!n.children[r]||!DT(n.children[r],e.children[r],i))return!1;return!0}{const r=t.slice(0,n.segments.length),s=t.slice(n.segments.length);return!!(xo(n.segments,r)&&df(n.segments,r,i)&&n.children[tt])&&TT(n.children[tt],e,s,i)}}function df(n,e,t){return e.every((i,r)=>MT[t](n[r].parameters,i.parameters))}class bo{constructor(e=new it([],{}),t={},i=null){this.root=e,this.queryParams=t,this.fragment=i}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$a(this.queryParams)),this._queryParamMap}toString(){return k5.serialize(this)}}class it{constructor(e,t){this.segments=e,this.children=t,this.parent=null,An(t,(i,r)=>i.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return hf(this)}}class cu{constructor(e,t){this.path=e,this.parameters=t}get parameterMap(){return this._parameterMap||(this._parameterMap=$a(this.parameters)),this._parameterMap}toString(){return PT(this)}}function xo(n,e){return n.length===e.length&&n.every((t,i)=>t.path===e[i].path)}let uu=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return new I_},providedIn:"root"}),n})();class I_{parse(e){const t=new $5(e);return new bo(t.parseRootSegment(),t.parseQueryParams(),t.parseFragment())}serialize(e){const t=`/${du(e.root,!0)}`,i=function z5(n){const e=Object.keys(n).map(t=>{const i=n[t];return Array.isArray(i)?i.map(r=>`${ff(t)}=${ff(r)}`).join("&"):`${ff(t)}=${ff(i)}`}).filter(t=>!!t);return e.length?`?${e.join("&")}`:""}(e.queryParams);return`${t}${i}${"string"==typeof e.fragment?`#${function B5(n){return encodeURI(n)}(e.fragment)}`:""}`}}const k5=new I_;function hf(n){return n.segments.map(e=>PT(e)).join("/")}function du(n,e){if(!n.hasChildren())return hf(n);if(e){const t=n.children[tt]?du(n.children[tt],!1):"",i=[];return An(n.children,(r,s)=>{s!==tt&&i.push(`${s}:${du(r,!1)}`)}),i.length>0?`${t}(${i.join("//")})`:t}{const t=function F5(n,e){let t=[];return An(n.children,(i,r)=>{r===tt&&(t=t.concat(e(i,r)))}),An(n.children,(i,r)=>{r!==tt&&(t=t.concat(e(i,r)))}),t}(n,(i,r)=>r===tt?[du(n.children[tt],!1)]:[`${r}:${du(i,!1)}`]);return 1===Object.keys(n.children).length&&null!=n.children[tt]?`${hf(n)}/${t[0]}`:`${hf(n)}/(${t.join("//")})`}}function AT(n){return encodeURIComponent(n).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ff(n){return AT(n).replace(/%3B/gi,";")}function P_(n){return AT(n).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function pf(n){return decodeURIComponent(n)}function IT(n){return pf(n.replace(/\+/g,"%20"))}function PT(n){return`${P_(n.path)}${function U5(n){return Object.keys(n).map(e=>`;${P_(e)}=${P_(n[e])}`).join("")}(n.parameters)}`}const V5=/^[^\/()?;=#]+/;function mf(n){const e=n.match(V5);return e?e[0]:""}const H5=/^[^=?&#]+/,W5=/^[^&#]+/;class $5{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new it([],{}):new it([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let t={};this.peekStartsWith("/(")&&(this.capture("/"),t=this.parseParens(!0));let i={};return this.peekStartsWith("(")&&(i=this.parseParens(!1)),(e.length>0||Object.keys(t).length>0)&&(i[tt]=new it(e,t)),i}parseSegment(){const e=mf(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new ie(4009,uf);return this.capture(e),new cu(pf(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const t=mf(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const r=mf(this.remaining);r&&(i=r,this.capture(i))}e[pf(t)]=pf(i)}parseQueryParam(e){const t=function G5(n){const e=n.match(H5);return e?e[0]:""}(this.remaining);if(!t)return;this.capture(t);let i="";if(this.consumeOptional("=")){const o=function j5(n){const e=n.match(W5);return e?e[0]:""}(this.remaining);o&&(i=o,this.capture(i))}const r=IT(t),s=IT(i);if(e.hasOwnProperty(r)){let o=e[r];Array.isArray(o)||(o=[o],e[r]=o),o.push(s)}else e[r]=s}parseParens(e){const t={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const i=mf(this.remaining),r=this.remaining[i.length];if("/"!==r&&")"!==r&&";"!==r)throw new ie(4010,uf);let s;i.indexOf(":")>-1?(s=i.slice(0,i.indexOf(":")),this.capture(s),this.capture(":")):e&&(s=tt);const o=this.parseChildren();t[s]=1===Object.keys(o).length?o[tt]:new it([],o),this.consumeOptional("//")}return t}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new ie(4011,uf)}}function R_(n){return n.segments.length>0?new it([],{[tt]:n}):n}function gf(n){const e={};for(const i of Object.keys(n.children)){const s=gf(n.children[i]);(s.segments.length>0||s.hasChildren())&&(e[i]=s)}return function q5(n){if(1===n.numberOfChildren&&n.children[tt]){const e=n.children[tt];return new it(n.segments.concat(e.segments),e.children)}return n}(new it(n.segments,e))}function So(n){return n instanceof bo}function Z5(n,e,t,i,r){if(0===t.length)return qa(e.root,e.root,e.root,i,r);const s=function NT(n){if("string"==typeof n[0]&&1===n.length&&"/"===n[0])return new LT(!0,0,n);let e=0,t=!1;const i=n.reduce((r,s,o)=>{if("object"==typeof s&&null!=s){if(s.outlets){const a={};return An(s.outlets,(l,c)=>{a[c]="string"==typeof l?l.split("/"):l}),[...r,{outlets:a}]}if(s.segmentPath)return[...r,s.segmentPath]}return"string"!=typeof s?[...r,s]:0===o?(s.split("/").forEach((a,l)=>{0==l&&"."===a||(0==l&&""===a?t=!0:".."===a?e++:""!=a&&r.push(a))}),r):[...r,s]},[]);return new LT(t,e,i)}(t);return s.toRoot()?qa(e.root,e.root,new it([],{}),i,r):function o(l){const c=function Q5(n,e,t,i){if(n.isAbsolute)return new Ya(e.root,!0,0);if(-1===i)return new Ya(t,t===e.root,0);return function OT(n,e,t){let i=n,r=e,s=t;for(;s>r;){if(s-=r,i=i.parent,!i)throw new ie(4005,!1);r=i.segments.length}return new Ya(i,!1,r-s)}(t,i+(hu(n.commands[0])?0:1),n.numberOfDoubleDots)}(s,e,n.snapshot?._urlSegment,l),u=c.processChildren?pu(c.segmentGroup,c.index,s.commands):N_(c.segmentGroup,c.index,s.commands);return qa(e.root,c.segmentGroup,u,i,r)}(n.snapshot?._lastPathIndex)}function hu(n){return"object"==typeof n&&null!=n&&!n.outlets&&!n.segmentPath}function fu(n){return"object"==typeof n&&null!=n&&n.outlets}function qa(n,e,t,i,r){let o,s={};i&&An(i,(l,c)=>{s[c]=Array.isArray(l)?l.map(u=>`${u}`):`${l}`}),o=n===e?t:RT(n,e,t);const a=R_(gf(o));return new bo(a,s,r)}function RT(n,e,t){const i={};return An(n.children,(r,s)=>{i[s]=r===e?t:RT(r,e,t)}),new it(n.segments,i)}class LT{constructor(e,t,i){if(this.isAbsolute=e,this.numberOfDoubleDots=t,this.commands=i,e&&i.length>0&&hu(i[0]))throw new ie(4003,!1);const r=i.find(fu);if(r&&r!==wT(i))throw new ie(4004,!1)}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Ya{constructor(e,t,i){this.segmentGroup=e,this.processChildren=t,this.index=i}}function N_(n,e,t){if(n||(n=new it([],{})),0===n.segments.length&&n.hasChildren())return pu(n,e,t);const i=function eG(n,e,t){let i=0,r=e;const s={match:!1,pathIndex:0,commandIndex:0};for(;r<n.segments.length;){if(i>=t.length)return s;const o=n.segments[r],a=t[i];if(fu(a))break;const l=`${a}`,c=i<t.length-1?t[i+1]:null;if(r>0&&void 0===l)break;if(l&&c&&"object"==typeof c&&void 0===c.outlets){if(!kT(l,c,o))return s;i+=2}else{if(!kT(l,{},o))return s;i++}r++}return{match:!0,pathIndex:r,commandIndex:i}}(n,e,t),r=t.slice(i.commandIndex);if(i.match&&i.pathIndex<n.segments.length){const s=new it(n.segments.slice(0,i.pathIndex),{});return s.children[tt]=new it(n.segments.slice(i.pathIndex),n.children),pu(s,0,r)}return i.match&&0===r.length?new it(n.segments,{}):i.match&&!n.hasChildren()?O_(n,e,t):i.match?pu(n,0,r):O_(n,e,t)}function pu(n,e,t){if(0===t.length)return new it(n.segments,{});{const i=function J5(n){return fu(n[0])?n[0].outlets:{[tt]:n}}(t),r={};return An(i,(s,o)=>{"string"==typeof s&&(s=[s]),null!==s&&(r[o]=N_(n.children[o],e,s))}),An(n.children,(s,o)=>{void 0===i[o]&&(r[o]=s)}),new it(n.segments,r)}}function O_(n,e,t){const i=n.segments.slice(0,e);let r=0;for(;r<t.length;){const s=t[r];if(fu(s)){const l=tG(s.outlets);return new it(i,l)}if(0===r&&hu(t[0])){i.push(new cu(n.segments[e].path,FT(t[0]))),r++;continue}const o=fu(s)?s.outlets[tt]:`${s}`,a=r<t.length-1?t[r+1]:null;o&&a&&hu(a)?(i.push(new cu(o,FT(a))),r+=2):(i.push(new cu(o,{})),r++)}return new it(i,{})}function tG(n){const e={};return An(n,(t,i)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[i]=O_(new it([],{}),0,t))}),e}function FT(n){const e={};return An(n,(t,i)=>e[i]=`${t}`),e}function kT(n,e,t){return n==t.path&&xr(e,t.parameters)}class Kr{constructor(e,t){this.id=e,this.url=t}}class F_ extends Kr{constructor(e,t,i="imperative",r=null){super(e,t),this.type=0,this.navigationTrigger=i,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class As extends Kr{constructor(e,t,i){super(e,t),this.urlAfterRedirects=i,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class yf extends Kr{constructor(e,t,i,r){super(e,t),this.reason=i,this.code=r,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class BT extends Kr{constructor(e,t,i,r){super(e,t),this.error=i,this.target=r,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class nG extends Kr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class iG extends Kr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class rG extends Kr{constructor(e,t,i,r,s){super(e,t),this.urlAfterRedirects=i,this.state=r,this.shouldActivate=s,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class sG extends Kr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class oG extends Kr{constructor(e,t,i,r){super(e,t),this.urlAfterRedirects=i,this.state=r,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class aG{constructor(e){this.route=e,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class lG{constructor(e){this.route=e,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class cG{constructor(e){this.snapshot=e,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uG{constructor(e){this.snapshot=e,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class dG{constructor(e){this.snapshot=e,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hG{constructor(e){this.snapshot=e,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class UT{constructor(e,t,i){this.routerEvent=e,this.position=t,this.anchor=i,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let pG=(()=>{class n{createUrlTree(t,i,r,s,o,a){return Z5(t||i.root,r,s,o,a)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})(),mG=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(e){return pG.\u0275fac(e)},providedIn:"root"}),n})();class zT{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const t=this.pathFromRoot(e);return t.length>1?t[t.length-2]:null}children(e){const t=k_(e,this._root);return t?t.children.map(i=>i.value):[]}firstChild(e){const t=k_(e,this._root);return t&&t.children.length>0?t.children[0].value:null}siblings(e){const t=B_(e,this._root);return t.length<2?[]:t[t.length-2].children.map(r=>r.value).filter(r=>r!==e)}pathFromRoot(e){return B_(e,this._root).map(t=>t.value)}}function k_(n,e){if(n===e.value)return e;for(const t of e.children){const i=k_(n,t);if(i)return i}return null}function B_(n,e){if(n===e.value)return[e];for(const t of e.children){const i=B_(n,t);if(i.length)return i.unshift(e),i}return[]}class Qr{constructor(e,t){this.value=e,this.children=t}toString(){return`TreeNode(${this.value})`}}function Xa(n){const e={};return n&&n.children.forEach(t=>e[t.value.outlet]=t),e}class VT extends zT{constructor(e,t){super(e),this.snapshot=t,U_(this,e)}toString(){return this.snapshot.toString()}}function HT(n,e){const t=function gG(n,e){const o=new _f([],{},{},"",{},tt,e,null,n.root,-1,{});return new WT("",new Qr(o,[]))}(n,e),i=new Oi([new cu("",{})]),r=new Oi({}),s=new Oi({}),o=new Oi({}),a=new Oi(""),l=new Za(i,r,o,a,s,tt,e,t.root);return l.snapshot=t.root,new VT(new Qr(l,[]),t)}class Za{constructor(e,t,i,r,s,o,a,l){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.title=this.data?.pipe(Je(c=>c[lu]))??De(void 0),this._futureSnapshot=l}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Je(e=>$a(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Je(e=>$a(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function GT(n,e="emptyOnly"){const t=n.pathFromRoot;let i=0;if("always"!==e)for(i=t.length-1;i>=1;){const r=t[i],s=t[i-1];if(r.routeConfig&&""===r.routeConfig.path)i--;else{if(s.component)break;i--}}return function yG(n){return n.reduce((e,t)=>({params:{...e.params,...t.params},data:{...e.data,...t.data},resolve:{...t.data,...e.resolve,...t.routeConfig?.data,...t._resolvedData}}),{params:{},data:{},resolve:{}})}(t.slice(i))}class _f{constructor(e,t,i,r,s,o,a,l,c,u,d){this.url=e,this.params=t,this.queryParams=i,this.fragment=r,this.data=s,this.outlet=o,this.component=a,this.routeConfig=l,this._urlSegment=c,this._lastPathIndex=u,this._resolve=d}get title(){return this.data?.[lu]}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=$a(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=$a(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(i=>i.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class WT extends zT{constructor(e,t){super(t),this.url=e,U_(this,t)}toString(){return jT(this._root)}}function U_(n,e){e.value._routerState=n,e.children.forEach(t=>U_(n,t))}function jT(n){const e=n.children.length>0?` { ${n.children.map(jT).join(", ")} } `:"";return`${n.value}${e}`}function z_(n){if(n.snapshot){const e=n.snapshot,t=n._futureSnapshot;n.snapshot=t,xr(e.queryParams,t.queryParams)||n.queryParams.next(t.queryParams),e.fragment!==t.fragment&&n.fragment.next(t.fragment),xr(e.params,t.params)||n.params.next(t.params),function P5(n,e){if(n.length!==e.length)return!1;for(let t=0;t<n.length;++t)if(!xr(n[t],e[t]))return!1;return!0}(e.url,t.url)||n.url.next(t.url),xr(e.data,t.data)||n.data.next(t.data)}else n.snapshot=n._futureSnapshot,n.data.next(n._futureSnapshot.data)}function V_(n,e){const t=xr(n.params,e.params)&&function O5(n,e){return xo(n,e)&&n.every((t,i)=>xr(t.parameters,e[i].parameters))}(n.url,e.url);return t&&!(!n.parent!=!e.parent)&&(!n.parent||V_(n.parent,e.parent))}function mu(n,e,t){if(t&&n.shouldReuseRoute(e.value,t.value.snapshot)){const i=t.value;i._futureSnapshot=e.value;const r=function vG(n,e,t){return e.children.map(i=>{for(const r of t.children)if(n.shouldReuseRoute(i.value,r.value.snapshot))return mu(n,i,r);return mu(n,i)})}(n,e,t);return new Qr(i,r)}{if(n.shouldAttach(e.value)){const s=n.retrieve(e.value);if(null!==s){const o=s.route;return o.value._futureSnapshot=e.value,o.children=e.children.map(a=>mu(n,a)),o}}const i=function bG(n){return new Za(new Oi(n.url),new Oi(n.params),new Oi(n.queryParams),new Oi(n.fragment),new Oi(n.data),n.outlet,n.component,n)}(e.value),r=e.children.map(s=>mu(n,s));return new Qr(i,r)}}const H_="ngNavigationCancelingError";function $T(n,e){const{redirectTo:t,navigationBehaviorOptions:i}=So(e)?{redirectTo:e,navigationBehaviorOptions:void 0}:e,r=qT(!1,0,e);return r.url=t,r.navigationBehaviorOptions=i,r}function qT(n,e,t){const i=new Error("NavigationCancelingError: "+(n||""));return i[H_]=!0,i.cancellationCode=e,t&&(i.url=t),i}function YT(n){return XT(n)&&So(n.url)}function XT(n){return n&&n[H_]}class xG{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new gu,this.attachRef=null}}let gu=(()=>{class n{constructor(){this.contexts=new Map}onChildOutletCreated(t,i){const r=this.getOrCreateContext(t);r.outlet=i,this.contexts.set(t,r)}onChildOutletDestroyed(t){const i=this.getContext(t);i&&(i.outlet=null,i.attachRef=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let i=this.getContext(t);return i||(i=new xG,this.contexts.set(t,i)),i}getContext(t){return this.contexts.get(t)||null}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const vf=!1;let G_=(()=>{class n{constructor(){this.activated=null,this._activatedRoute=null,this.name=tt,this.activateEvents=new $n,this.deactivateEvents=new $n,this.attachEvents=new $n,this.detachEvents=new $n,this.parentContexts=ut(gu),this.location=ut(tr),this.changeDetector=ut(by),this.environmentInjector=ut(Or)}ngOnChanges(t){if(t.name){const{firstChange:i,previousValue:r}=t.name;if(i)return;this.isTrackedInParentContexts(r)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(r)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(t){return this.parentContexts.getContext(t)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const t=this.parentContexts.getContext(this.name);t?.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new ie(4012,vf);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new ie(4012,vf);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new ie(4012,vf);this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(t.instance),t}attach(t,i){this.activated=t,this._activatedRoute=i,this.location.insert(t.hostView),this.attachEvents.emit(t.instance)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,i){if(this.isActivated)throw new ie(4013,vf);this._activatedRoute=t;const r=this.location,o=t.snapshot.component,a=this.parentContexts.getOrCreateContext(this.name).children,l=new SG(t,a,r.injector);if(i&&function wG(n){return!!n.resolveComponentFactory}(i)){const c=i.resolveComponentFactory(o);this.activated=r.createComponent(c,r.length,l)}else this.activated=r.createComponent(o,{index:r.length,injector:l,environmentInjector:i??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275dir=zn({type:n,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[eo]}),n})();class SG{constructor(e,t,i){this.route=e,this.childContexts=t,this.parent=i}get(e,t){return e===Za?this.route:e===gu?this.childContexts:this.parent.get(e,t)}}let W_=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275cmp=oa({type:n,selectors:[["ng-component"]],standalone:!0,features:[rE],decls:1,vars:0,template:function(t,i){1&t&&ht(0,"router-outlet")},dependencies:[G_],encapsulation:2}),n})();function ZT(n,e){return n.providers&&!n._injector&&(n._injector=ph(n.providers,e,`Route: ${n.path}`)),n._injector??e}function $_(n){const e=n.children&&n.children.map($_),t=e?{...n,children:e}:{...n};return!t.component&&!t.loadComponent&&(e||t.loadChildren)&&t.outlet&&t.outlet!==tt&&(t.component=W_),t}function Fi(n){return n.outlet||tt}function KT(n,e){const t=n.filter(i=>Fi(i)===e);return t.push(...n.filter(i=>Fi(i)!==e)),t}function yu(n){if(!n)return null;if(n.routeConfig?._injector)return n.routeConfig._injector;for(let e=n.parent;e;e=e.parent){const t=e.routeConfig;if(t?._loadedInjector)return t._loadedInjector;if(t?._injector)return t._injector}return null}class TG{constructor(e,t,i,r){this.routeReuseStrategy=e,this.futureState=t,this.currState=i,this.forwardEvent=r}activate(e){const t=this.futureState._root,i=this.currState?this.currState._root:null;this.deactivateChildRoutes(t,i,e),z_(this.futureState.root),this.activateChildRoutes(t,i,e)}deactivateChildRoutes(e,t,i){const r=Xa(t);e.children.forEach(s=>{const o=s.value.outlet;this.deactivateRoutes(s,r[o],i),delete r[o]}),An(r,(s,o)=>{this.deactivateRouteAndItsChildren(s,i)})}deactivateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(r===s)if(r.component){const o=i.getContext(r.outlet);o&&this.deactivateChildRoutes(e,t,o.children)}else this.deactivateChildRoutes(e,t,i);else s&&this.deactivateRouteAndItsChildren(t,i)}deactivateRouteAndItsChildren(e,t){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,t):this.deactivateRouteAndOutlet(e,t)}detachAndStoreRouteSubtree(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Xa(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);if(i&&i.outlet){const o=i.outlet.detach(),a=i.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:o,route:e,contexts:a})}}deactivateRouteAndOutlet(e,t){const i=t.getContext(e.value.outlet),r=i&&e.value.component?i.children:t,s=Xa(e);for(const o of Object.keys(s))this.deactivateRouteAndItsChildren(s[o],r);i&&i.outlet&&(i.outlet.deactivate(),i.children.onOutletDeactivated(),i.attachRef=null,i.resolver=null,i.route=null)}activateChildRoutes(e,t,i){const r=Xa(t);e.children.forEach(s=>{this.activateRoutes(s,r[s.value.outlet],i),this.forwardEvent(new hG(s.value.snapshot))}),e.children.length&&this.forwardEvent(new uG(e.value.snapshot))}activateRoutes(e,t,i){const r=e.value,s=t?t.value:null;if(z_(r),r===s)if(r.component){const o=i.getOrCreateContext(r.outlet);this.activateChildRoutes(e,t,o.children)}else this.activateChildRoutes(e,t,i);else if(r.component){const o=i.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const a=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),o.children.onOutletReAttached(a.contexts),o.attachRef=a.componentRef,o.route=a.route.value,o.outlet&&o.outlet.attach(a.componentRef,a.route.value),z_(a.route.value),this.activateChildRoutes(e,null,o.children)}else{const a=yu(r.snapshot),l=a?.get(Tc)??null;o.attachRef=null,o.route=r,o.resolver=l,o.injector=a,o.outlet&&o.outlet.activateWith(r,o.injector),this.activateChildRoutes(e,null,o.children)}}else this.activateChildRoutes(e,null,i)}}class QT{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class bf{constructor(e,t){this.component=e,this.route=t}}function AG(n,e,t){const i=n._root;return _u(i,e?e._root:null,t,[i.value])}function Ka(n,e){const t=Symbol(),i=e.get(n,t);return i===t?"function"!=typeof n||function nL(n){return null!==gd(n)}(n)?e.get(n):n:i}function _u(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=Xa(e);return n.children.forEach(o=>{(function PG(n,e,t,i,r={canDeactivateChecks:[],canActivateChecks:[]}){const s=n.value,o=e?e.value:null,a=t?t.getContext(n.value.outlet):null;if(o&&s.routeConfig===o.routeConfig){const l=function RG(n,e,t){if("function"==typeof t)return t(n,e);switch(t){case"pathParamsChange":return!xo(n.url,e.url);case"pathParamsOrQueryParamsChange":return!xo(n.url,e.url)||!xr(n.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!V_(n,e)||!xr(n.queryParams,e.queryParams);default:return!V_(n,e)}}(o,s,s.routeConfig.runGuardsAndResolvers);l?r.canActivateChecks.push(new QT(i)):(s.data=o.data,s._resolvedData=o._resolvedData),_u(n,e,s.component?a?a.children:null:t,i,r),l&&a&&a.outlet&&a.outlet.isActivated&&r.canDeactivateChecks.push(new bf(a.outlet.component,o))}else o&&vu(e,a,r),r.canActivateChecks.push(new QT(i)),_u(n,null,s.component?a?a.children:null:t,i,r)})(o,s[o.value.outlet],t,i.concat([o.value]),r),delete s[o.value.outlet]}),An(s,(o,a)=>vu(o,t.getContext(a),r)),r}function vu(n,e,t){const i=Xa(n),r=n.value;An(i,(s,o)=>{vu(s,r.component?e?e.children.getContext(o):null:e,t)}),t.canDeactivateChecks.push(new bf(r.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,r))}function bu(n){return"function"==typeof n}function q_(n){return n instanceof lf||"EmptyError"===n?.name}const xf=Symbol("INITIAL_VALUE");function Qa(){return sr(n=>pT(n.map(e=>e.pipe(au(1),function M5(...n){const e=ic(n);return dn((t,i)=>{(e?C_(n,t,e):C_(n,t)).subscribe(i)})}(xf)))).pipe(Je(e=>{for(const t of e)if(!0!==t){if(t===xf)return xf;if(!1===t||t instanceof bo)return t}return!0}),qr(e=>e!==xf),au(1)))}function JT(n){return function xR(...n){return lb(n)}(Xt(e=>{if(So(e))throw $T(0,e)}),Je(e=>!0===e))}const Y_={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function e1(n,e,t,i,r){const s=X_(n,e,t);return s.matched?function XG(n,e,t,i){const r=e.canMatch;return r&&0!==r.length?De(r.map(o=>{const a=Ka(o,n);return Ts(function BG(n){return n&&bu(n.canMatch)}(a)?a.canMatch(e,t):n.runInContext(()=>a(e,t)))})).pipe(Qa(),JT()):De(!0)}(i=ZT(e,i),e,t).pipe(Je(o=>!0===o?s:{...Y_})):De(s)}function X_(n,e,t){if(""===e.path)return"full"===e.pathMatch&&(n.hasChildren()||t.length>0)?{...Y_}:{matched:!0,consumedSegments:[],remainingSegments:t,parameters:{},positionalParamSegments:{}};const r=(e.matcher||I5)(t,n,e);if(!r)return{...Y_};const s={};An(r.posParams,(a,l)=>{s[l]=a.path});const o=r.consumed.length>0?{...s,...r.consumed[r.consumed.length-1].parameters}:s;return{matched:!0,consumedSegments:r.consumed,remainingSegments:t.slice(r.consumed.length),parameters:o,positionalParamSegments:r.posParams??{}}}function Sf(n,e,t,i){if(t.length>0&&function QG(n,e,t){return t.some(i=>wf(n,e,i)&&Fi(i)!==tt)}(n,t,i)){const s=new it(e,function KG(n,e,t,i){const r={};r[tt]=i,i._sourceSegment=n,i._segmentIndexShift=e.length;for(const s of t)if(""===s.path&&Fi(s)!==tt){const o=new it([],{});o._sourceSegment=n,o._segmentIndexShift=e.length,r[Fi(s)]=o}return r}(n,e,i,new it(t,n.children)));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:[]}}if(0===t.length&&function JG(n,e,t){return t.some(i=>wf(n,e,i))}(n,t,i)){const s=new it(n.segments,function ZG(n,e,t,i,r){const s={};for(const o of i)if(wf(n,t,o)&&!r[Fi(o)]){const a=new it([],{});a._sourceSegment=n,a._segmentIndexShift=e.length,s[Fi(o)]=a}return{...r,...s}}(n,e,t,i,n.children));return s._sourceSegment=n,s._segmentIndexShift=e.length,{segmentGroup:s,slicedSegments:t}}const r=new it(n.segments,n.children);return r._sourceSegment=n,r._segmentIndexShift=e.length,{segmentGroup:r,slicedSegments:t}}function wf(n,e,t){return(!(n.hasChildren()||e.length>0)||"full"!==t.pathMatch)&&""===t.path}function t1(n,e,t,i){return!!(Fi(n)===i||i!==tt&&wf(e,t,n))&&("**"===n.path||X_(e,n,t).matched)}function n1(n,e,t){return 0===e.length&&!n.children[t]}const Mf=!1;class Ef{constructor(e){this.segmentGroup=e||null}}class i1{constructor(e){this.urlTree=e}}function xu(n){return ou(new Ef(n))}function r1(n){return ou(new i1(n))}class iW{constructor(e,t,i,r,s){this.injector=e,this.configLoader=t,this.urlSerializer=i,this.urlTree=r,this.config=s,this.allowRedirects=!0}apply(){const e=Sf(this.urlTree.root,[],[],this.config).segmentGroup,t=new it(e.segments,e.children);return this.expandSegmentGroup(this.injector,this.config,t,tt).pipe(Je(s=>this.createUrlTree(gf(s),this.urlTree.queryParams,this.urlTree.fragment))).pipe(Ds(s=>{if(s instanceof i1)return this.allowRedirects=!1,this.match(s.urlTree);throw s instanceof Ef?this.noMatchError(s):s}))}match(e){return this.expandSegmentGroup(this.injector,this.config,e.root,tt).pipe(Je(r=>this.createUrlTree(gf(r),e.queryParams,e.fragment))).pipe(Ds(r=>{throw r instanceof Ef?this.noMatchError(r):r}))}noMatchError(e){return new ie(4002,Mf)}createUrlTree(e,t,i){const r=R_(e);return new bo(r,t,i)}expandSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.expandChildren(e,t,i).pipe(Je(s=>new it([],s))):this.expandSegment(e,i,t,i.segments,r,!0)}expandChildren(e,t,i){const r=[];for(const s of Object.keys(i.children))"primary"===s?r.unshift(s):r.push(s);return fn(r).pipe(vo(s=>{const o=i.children[s],a=KT(t,s);return this.expandSegmentGroup(e,a,o,s).pipe(Je(l=>({segment:l,outlet:s})))}),vT((s,o)=>(s[o.outlet]=o.segment,s),{}),bT())}expandSegment(e,t,i,r,s,o){return fn(i).pipe(vo(a=>this.expandSegmentAgainstRoute(e,t,i,a,r,s,o).pipe(Ds(c=>{if(c instanceof Ef)return De(null);throw c}))),Cs(a=>!!a),Ds((a,l)=>{if(q_(a))return n1(t,r,s)?De(new it([],{})):xu(t);throw a}))}expandSegmentAgainstRoute(e,t,i,r,s,o,a){return t1(r,t,s,o)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(e,t,r,s,o):a&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o):xu(t):xu(t)}expandSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,i,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,t,i,r){const s=this.applyRedirectCommands([],i.redirectTo,{});return i.redirectTo.startsWith("/")?r1(s):this.lineralizeSegments(i,s).pipe(Sn(o=>{const a=new it(o,{});return this.expandSegment(e,a,t,o,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,t,i,r,s,o){const{matched:a,consumedSegments:l,remainingSegments:c,positionalParamSegments:u}=X_(t,r,s);if(!a)return xu(t);const d=this.applyRedirectCommands(l,r.redirectTo,u);return r.redirectTo.startsWith("/")?r1(d):this.lineralizeSegments(r,d).pipe(Sn(h=>this.expandSegment(e,t,i,h.concat(c),o,!1)))}matchSegmentAgainstRoute(e,t,i,r,s){return"**"===i.path?(e=ZT(i,e),i.loadChildren?(i._loadedRoutes?De({routes:i._loadedRoutes,injector:i._loadedInjector}):this.configLoader.loadChildren(e,i)).pipe(Je(a=>(i._loadedRoutes=a.routes,i._loadedInjector=a.injector,new it(r,{})))):De(new it(r,{}))):e1(t,i,r,e).pipe(sr(({matched:o,consumedSegments:a,remainingSegments:l})=>o?this.getChildConfig(e=i._injector??e,i,r).pipe(Sn(u=>{const d=u.injector??e,h=u.routes,{segmentGroup:f,slicedSegments:p}=Sf(t,a,l,h),g=new it(f.segments,f.children);if(0===p.length&&g.hasChildren())return this.expandChildren(d,h,g).pipe(Je(_=>new it(a,_)));if(0===h.length&&0===p.length)return De(new it(a,{}));const m=Fi(i)===s;return this.expandSegment(d,g,h,p,m?tt:s,!0).pipe(Je(b=>new it(a.concat(b.segments),b.children)))})):xu(t)))}getChildConfig(e,t,i){return t.children?De({routes:t.children,injector:e}):t.loadChildren?void 0!==t._loadedRoutes?De({routes:t._loadedRoutes,injector:t._loadedInjector}):function YG(n,e,t,i){const r=e.canLoad;return void 0===r||0===r.length?De(!0):De(r.map(o=>{const a=Ka(o,n);return Ts(function NG(n){return n&&bu(n.canLoad)}(a)?a.canLoad(e,t):n.runInContext(()=>a(e,t)))})).pipe(Qa(),JT())}(e,t,i).pipe(Sn(r=>r?this.configLoader.loadChildren(e,t).pipe(Xt(s=>{t._loadedRoutes=s.routes,t._loadedInjector=s.injector})):function tW(n){return ou(qT(Mf,3))}())):De({routes:[],injector:e})}lineralizeSegments(e,t){let i=[],r=t.root;for(;;){if(i=i.concat(r.segments),0===r.numberOfChildren)return De(i);if(r.numberOfChildren>1||!r.children[tt])return ou(new ie(4e3,Mf));r=r.children[tt]}}applyRedirectCommands(e,t,i){return this.applyRedirectCreateUrlTree(t,this.urlSerializer.parse(t),e,i)}applyRedirectCreateUrlTree(e,t,i,r){const s=this.createSegmentGroup(e,t.root,i,r);return new bo(s,this.createQueryParams(t.queryParams,this.urlTree.queryParams),t.fragment)}createQueryParams(e,t){const i={};return An(e,(r,s)=>{if("string"==typeof r&&r.startsWith(":")){const a=r.substring(1);i[s]=t[a]}else i[s]=r}),i}createSegmentGroup(e,t,i,r){const s=this.createSegments(e,t.segments,i,r);let o={};return An(t.children,(a,l)=>{o[l]=this.createSegmentGroup(e,a,i,r)}),new it(s,o)}createSegments(e,t,i,r){return t.map(s=>s.path.startsWith(":")?this.findPosParam(e,s,r):this.findOrReturn(s,i))}findPosParam(e,t,i){const r=i[t.path.substring(1)];if(!r)throw new ie(4001,Mf);return r}findOrReturn(e,t){let i=0;for(const r of t){if(r.path===e.path)return t.splice(i),r;i++}return e}}class sW{}class lW{constructor(e,t,i,r,s,o,a){this.injector=e,this.rootComponentType=t,this.config=i,this.urlTree=r,this.url=s,this.paramsInheritanceStrategy=o,this.urlSerializer=a}recognize(){const e=Sf(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,e,tt).pipe(Je(t=>{if(null===t)return null;const i=new _f([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},tt,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Qr(i,t),s=new WT(this.url,r);return this.inheritParamsAndData(s._root),s}))}inheritParamsAndData(e){const t=e.value,i=GT(t,this.paramsInheritanceStrategy);t.params=Object.freeze(i.params),t.data=Object.freeze(i.data),e.children.forEach(r=>this.inheritParamsAndData(r))}processSegmentGroup(e,t,i,r){return 0===i.segments.length&&i.hasChildren()?this.processChildren(e,t,i):this.processSegment(e,t,i,i.segments,r)}processChildren(e,t,i){return fn(Object.keys(i.children)).pipe(vo(r=>{const s=i.children[r],o=KT(t,r);return this.processSegmentGroup(e,o,s,r)}),vT((r,s)=>r&&s?(r.push(...s),r):null),function D5(n,e=!1){return dn((t,i)=>{let r=0;t.subscribe(hn(i,s=>{const o=n(s,r++);(o||e)&&i.next(s),!o&&i.complete()}))})}(r=>null!==r),cf(null),bT(),Je(r=>{if(null===r)return null;const s=o1(r);return function cW(n){n.sort((e,t)=>e.value.outlet===tt?-1:t.value.outlet===tt?1:e.value.outlet.localeCompare(t.value.outlet))}(s),s}))}processSegment(e,t,i,r,s){return fn(t).pipe(vo(o=>this.processSegmentAgainstRoute(o._injector??e,o,i,r,s)),Cs(o=>!!o),Ds(o=>{if(q_(o))return n1(i,r,s)?De([]):De(null);throw o}))}processSegmentAgainstRoute(e,t,i,r,s){if(t.redirectTo||!t1(t,i,r,s))return De(null);let o;if("**"===t.path){const a=r.length>0?wT(r).parameters:{},l=l1(i)+r.length;o=De({snapshot:new _f(r,a,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,c1(t),Fi(t),t.component??t._loadedComponent??null,t,a1(i),l,u1(t)),consumedSegments:[],remainingSegments:[]})}else o=e1(i,t,r,e).pipe(Je(({matched:a,consumedSegments:l,remainingSegments:c,parameters:u})=>{if(!a)return null;const d=l1(i)+l.length;return{snapshot:new _f(l,u,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,c1(t),Fi(t),t.component??t._loadedComponent??null,t,a1(i),d,u1(t)),consumedSegments:l,remainingSegments:c}}));return o.pipe(sr(a=>{if(null===a)return De(null);const{snapshot:l,consumedSegments:c,remainingSegments:u}=a;e=t._injector??e;const d=t._loadedInjector??e,h=function uW(n){return n.children?n.children:n.loadChildren?n._loadedRoutes:[]}(t),{segmentGroup:f,slicedSegments:p}=Sf(i,c,u,h.filter(m=>void 0===m.redirectTo));if(0===p.length&&f.hasChildren())return this.processChildren(d,h,f).pipe(Je(m=>null===m?null:[new Qr(l,m)]));if(0===h.length&&0===p.length)return De([new Qr(l,[])]);const g=Fi(t)===s;return this.processSegment(d,h,f,p,g?tt:s).pipe(Je(m=>null===m?null:[new Qr(l,m)]))}))}}function dW(n){const e=n.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function o1(n){const e=[],t=new Set;for(const i of n){if(!dW(i)){e.push(i);continue}const r=e.find(s=>i.value.routeConfig===s.value.routeConfig);void 0!==r?(r.children.push(...i.children),t.add(r)):e.push(i)}for(const i of t){const r=o1(i.children);e.push(new Qr(i.value,r))}return e.filter(i=>!t.has(i))}function a1(n){let e=n;for(;e._sourceSegment;)e=e._sourceSegment;return e}function l1(n){let e=n,t=e._segmentIndexShift??0;for(;e._sourceSegment;)e=e._sourceSegment,t+=e._segmentIndexShift??0;return t-1}function c1(n){return n.data||{}}function u1(n){return n.resolve||{}}function d1(n){return"string"==typeof n.title||null===n.title}function Z_(n){return sr(e=>{const t=n(e);return t?fn(t).pipe(Je(()=>e)):De(e)})}const Ja=new Ne("ROUTES");let K_=(()=>{class n{constructor(t,i){this.injector=t,this.compiler=i,this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap}loadComponent(t){if(this.componentLoaders.get(t))return this.componentLoaders.get(t);if(t._loadedComponent)return De(t._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(t);const i=Ts(t.loadComponent()).pipe(Je(f1),Xt(s=>{this.onLoadEndListener&&this.onLoadEndListener(t),t._loadedComponent=s}),A_(()=>{this.componentLoaders.delete(t)})),r=new yT(i,()=>new li).pipe(D_());return this.componentLoaders.set(t,r),r}loadChildren(t,i){if(this.childrenLoaders.get(i))return this.childrenLoaders.get(i);if(i._loadedRoutes)return De({routes:i._loadedRoutes,injector:i._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(i);const s=this.loadModuleFactoryOrRoutes(i.loadChildren).pipe(Je(a=>{this.onLoadEndListener&&this.onLoadEndListener(i);let l,c,u=!1;Array.isArray(a)?c=a:(l=a.create(t).injector,c=ST(l.get(Ja,[],ze.Self|ze.Optional)));return{routes:c.map($_),injector:l}}),A_(()=>{this.childrenLoaders.delete(i)})),o=new yT(s,()=>new li).pipe(D_());return this.childrenLoaders.set(i,o),o}loadModuleFactoryOrRoutes(t){return Ts(t()).pipe(Je(f1),Sn(r=>r instanceof nE||Array.isArray(r)?De(r):fn(this.compiler.compileModuleAsync(r))))}}return n.\u0275fac=function(t){return new(t||n)(pe(pr),pe(XE))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function f1(n){return function bW(n){return n&&"object"==typeof n&&"default"in n}(n)?n.default:n}let Q_=(()=>{class n{constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new li,this.configLoader=ut(K_),this.environmentInjector=ut(Or),this.urlSerializer=ut(uu),this.rootContexts=ut(gu),this.navigationId=0,this.configLoader.onLoadEndListener=r=>this.events.next(new lG(r)),this.configLoader.onLoadStartListener=r=>this.events.next(new aG(r))}get hasRequestedNavigation(){return 0!==this.navigationId}complete(){this.transitions?.complete()}handleNavigationRequest(t){const i=++this.navigationId;this.transitions?.next({...this.transitions.value,...t,id:i})}setupNavigations(t){return this.transitions=new Oi({id:0,targetPageId:0,currentUrlTree:t.currentUrlTree,currentRawUrl:t.currentUrlTree,extractedUrl:t.urlHandlingStrategy.extract(t.currentUrlTree),urlAfterRedirects:t.urlHandlingStrategy.extract(t.currentUrlTree),rawUrl:t.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:t.routerState.snapshot,targetSnapshot:null,currentRouterState:t.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(qr(i=>0!==i.id),Je(i=>({...i,extractedUrl:t.urlHandlingStrategy.extract(i.rawUrl)})),sr(i=>{let r=!1,s=!1;return De(i).pipe(Xt(o=>{this.currentNavigation={id:o.id,initialUrl:o.rawUrl,extractedUrl:o.extractedUrl,trigger:o.source,extras:o.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),sr(o=>{const a=t.browserUrlTree.toString(),l=!t.navigated||o.extractedUrl.toString()!==a||a!==t.currentUrlTree.toString();if(("reload"===t.onSameUrlNavigation||l)&&t.urlHandlingStrategy.shouldProcessUrl(o.rawUrl))return m1(o.source)&&(t.browserUrlTree=o.extractedUrl),De(o).pipe(sr(u=>{const d=this.transitions?.getValue();return this.events.next(new F_(u.id,this.urlSerializer.serialize(u.extractedUrl),u.source,u.restoredState)),d!==this.transitions?.getValue()?Tr:Promise.resolve(u)}),function rW(n,e,t,i){return sr(r=>function nW(n,e,t,i,r){return new iW(n,e,t,i,r).apply()}(n,e,t,r.extractedUrl,i).pipe(Je(s=>({...r,urlAfterRedirects:s}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,t.config),Xt(u=>{this.currentNavigation={...this.currentNavigation,finalUrl:u.urlAfterRedirects},i.urlAfterRedirects=u.urlAfterRedirects}),function fW(n,e,t,i,r){return Sn(s=>function aW(n,e,t,i,r,s,o="emptyOnly"){return new lW(n,e,t,i,r,o,s).recognize().pipe(sr(a=>null===a?function oW(n){return new nn(e=>e.error(n))}(new sW):De(a)))}(n,e,t,s.urlAfterRedirects,i.serialize(s.urlAfterRedirects),i,r).pipe(Je(o=>({...s,targetSnapshot:o}))))}(this.environmentInjector,t.rootComponentType,t.config,this.urlSerializer,t.paramsInheritanceStrategy),Xt(u=>{if(i.targetSnapshot=u.targetSnapshot,"eager"===t.urlUpdateStrategy){if(!u.extras.skipLocationChange){const h=t.urlHandlingStrategy.merge(u.urlAfterRedirects,u.rawUrl);t.setBrowserUrl(h,u)}t.browserUrlTree=u.urlAfterRedirects}const d=new nG(u.id,this.urlSerializer.serialize(u.extractedUrl),this.urlSerializer.serialize(u.urlAfterRedirects),u.targetSnapshot);this.events.next(d)}));if(l&&t.rawUrlTree&&t.urlHandlingStrategy.shouldProcessUrl(t.rawUrlTree)){const{id:d,extractedUrl:h,source:f,restoredState:p,extras:g}=o,m=new F_(d,this.urlSerializer.serialize(h),f,p);this.events.next(m);const y=HT(h,t.rootComponentType).snapshot;return De(i={...o,targetSnapshot:y,urlAfterRedirects:h,extras:{...g,skipLocationChange:!1,replaceUrl:!1}})}return t.rawUrlTree=o.rawUrl,o.resolve(null),Tr}),Xt(o=>{const a=new iG(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot);this.events.next(a)}),Je(o=>i={...o,guards:AG(o.targetSnapshot,o.currentSnapshot,this.rootContexts)}),function zG(n,e){return Sn(t=>{const{targetSnapshot:i,currentSnapshot:r,guards:{canActivateChecks:s,canDeactivateChecks:o}}=t;return 0===o.length&&0===s.length?De({...t,guardsResult:!0}):function VG(n,e,t,i){return fn(n).pipe(Sn(r=>function qG(n,e,t,i,r){const s=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return s&&0!==s.length?De(s.map(a=>{const l=yu(e)??r,c=Ka(a,l);return Ts(function kG(n){return n&&bu(n.canDeactivate)}(c)?c.canDeactivate(n,e,t,i):l.runInContext(()=>c(n,e,t,i))).pipe(Cs())})).pipe(Qa()):De(!0)}(r.component,r.route,t,e,i)),Cs(r=>!0!==r,!0))}(o,i,r,n).pipe(Sn(a=>a&&function LG(n){return"boolean"==typeof n}(a)?function HG(n,e,t,i){return fn(e).pipe(vo(r=>C_(function WG(n,e){return null!==n&&e&&e(new cG(n)),De(!0)}(r.route.parent,i),function GG(n,e){return null!==n&&e&&e(new dG(n)),De(!0)}(r.route,i),function $G(n,e,t){const i=e[e.length-1],s=e.slice(0,e.length-1).reverse().map(o=>function IG(n){const e=n.routeConfig?n.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:n,guards:e}:null}(o)).filter(o=>null!==o).map(o=>gT(()=>De(o.guards.map(l=>{const c=yu(o.node)??t,u=Ka(l,c);return Ts(function FG(n){return n&&bu(n.canActivateChild)}(u)?u.canActivateChild(i,n):c.runInContext(()=>u(i,n))).pipe(Cs())})).pipe(Qa())));return De(s).pipe(Qa())}(n,r.path,t),function jG(n,e,t){const i=e.routeConfig?e.routeConfig.canActivate:null;if(!i||0===i.length)return De(!0);const r=i.map(s=>gT(()=>{const o=yu(e)??t,a=Ka(s,o);return Ts(function OG(n){return n&&bu(n.canActivate)}(a)?a.canActivate(e,n):o.runInContext(()=>a(e,n))).pipe(Cs())}));return De(r).pipe(Qa())}(n,r.route,t))),Cs(r=>!0!==r,!0))}(i,s,n,e):De(a)),Je(a=>({...t,guardsResult:a})))})}(this.environmentInjector,o=>this.events.next(o)),Xt(o=>{if(i.guardsResult=o.guardsResult,So(o.guardsResult))throw $T(0,o.guardsResult);const a=new rG(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(o.urlAfterRedirects),o.targetSnapshot,!!o.guardsResult);this.events.next(a)}),qr(o=>!!o.guardsResult||(t.restoreHistory(o),this.cancelNavigationTransition(o,"",3,t),!1)),Z_(o=>{if(o.guards.canActivateChecks.length)return De(o).pipe(Xt(a=>{const l=new sG(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}),sr(a=>{let l=!1;return De(a).pipe(function pW(n,e){return Sn(t=>{const{targetSnapshot:i,guards:{canActivateChecks:r}}=t;if(!r.length)return De(t);let s=0;return fn(r).pipe(vo(o=>function mW(n,e,t,i){const r=n.routeConfig,s=n._resolve;return void 0!==r?.title&&!d1(r)&&(s[lu]=r.title),function gW(n,e,t,i){const r=function yW(n){return[...Object.keys(n),...Object.getOwnPropertySymbols(n)]}(n);if(0===r.length)return De({});const s={};return fn(r).pipe(Sn(o=>function _W(n,e,t,i){const r=yu(e)??i,s=Ka(n,r);return Ts(s.resolve?s.resolve(e,t):r.runInContext(()=>s(e,t)))}(n[o],e,t,i).pipe(Cs(),Xt(a=>{s[o]=a}))),T_(1),function T5(n){return Je(()=>n)}(s),Ds(o=>q_(o)?Tr:ou(o)))}(s,n,e,i).pipe(Je(o=>(n._resolvedData=o,n.data=GT(n,t).resolve,r&&d1(r)&&(n.data[lu]=r.title),null)))}(o.route,i,n,e)),Xt(()=>s++),T_(1),Sn(o=>s===r.length?De(t):Tr))})}(t.paramsInheritanceStrategy,this.environmentInjector),Xt({next:()=>l=!0,complete:()=>{l||(t.restoreHistory(a),this.cancelNavigationTransition(a,"",2,t))}}))}),Xt(a=>{const l=new oG(a.id,this.urlSerializer.serialize(a.extractedUrl),this.urlSerializer.serialize(a.urlAfterRedirects),a.targetSnapshot);this.events.next(l)}))}),Z_(o=>{const a=l=>{const c=[];l.routeConfig?.loadComponent&&!l.routeConfig._loadedComponent&&c.push(this.configLoader.loadComponent(l.routeConfig).pipe(Xt(u=>{l.component=u}),Je(()=>{})));for(const u of l.children)c.push(...a(u));return c};return pT(a(o.targetSnapshot.root)).pipe(cf(),au(1))}),Z_(()=>t.afterPreactivation()),Je(o=>{const a=function _G(n,e,t){const i=mu(n,e._root,t?t._root:void 0);return new VT(i,e)}(t.routeReuseStrategy,o.targetSnapshot,o.currentRouterState);return i={...o,targetRouterState:a}}),Xt(o=>{t.currentUrlTree=o.urlAfterRedirects,t.rawUrlTree=t.urlHandlingStrategy.merge(o.urlAfterRedirects,o.rawUrl),t.routerState=o.targetRouterState,"deferred"===t.urlUpdateStrategy&&(o.extras.skipLocationChange||t.setBrowserUrl(t.rawUrlTree,o),t.browserUrlTree=o.urlAfterRedirects)}),((n,e,t)=>Je(i=>(new TG(e,i.targetRouterState,i.currentRouterState,t).activate(n),i)))(this.rootContexts,t.routeReuseStrategy,o=>this.events.next(o)),Xt({next:o=>{r=!0,this.lastSuccessfulNavigation=this.currentNavigation,t.navigated=!0,this.events.next(new As(o.id,this.urlSerializer.serialize(o.extractedUrl),this.urlSerializer.serialize(t.currentUrlTree))),t.titleStrategy?.updateTitle(o.targetRouterState.snapshot),o.resolve(!0)},complete:()=>{r=!0}}),A_(()=>{r||s||this.cancelNavigationTransition(i,"",1,t),this.currentNavigation?.id===i.id&&(this.currentNavigation=null)}),Ds(o=>{if(s=!0,XT(o)){YT(o)||(t.navigated=!0,t.restoreHistory(i,!0));const a=new yf(i.id,this.urlSerializer.serialize(i.extractedUrl),o.message,o.cancellationCode);if(this.events.next(a),YT(o)){const l=t.urlHandlingStrategy.merge(o.url,t.rawUrlTree),c={skipLocationChange:i.extras.skipLocationChange,replaceUrl:"eager"===t.urlUpdateStrategy||m1(i.source)};t.scheduleNavigation(l,"imperative",null,c,{resolve:i.resolve,reject:i.reject,promise:i.promise})}else i.resolve(!1)}else{t.restoreHistory(i,!0);const a=new BT(i.id,this.urlSerializer.serialize(i.extractedUrl),o,i.targetSnapshot??void 0);this.events.next(a);try{i.resolve(t.errorHandler(o))}catch(l){i.reject(l)}}return Tr}))}))}cancelNavigationTransition(t,i,r,s){const o=new yf(t.id,this.urlSerializer.serialize(t.extractedUrl),i,r);this.events.next(o),t.resolve(!1)}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function m1(n){return"imperative"!==n}let g1=(()=>{class n{buildTitle(t){let i,r=t.root;for(;void 0!==r;)i=this.getResolvedTitleForRoute(r)??i,r=r.children.find(s=>s.outlet===tt);return i}getResolvedTitleForRoute(t){return t.data[lu]}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ut(xW)},providedIn:"root"}),n})(),xW=(()=>{class n extends g1{constructor(t){super(),this.title=t}updateTitle(t){const i=this.buildTitle(t);void 0!==i&&this.title.setTitle(i)}}return n.\u0275fac=function(t){return new(t||n)(pe(pD))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),SW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ut(MW)},providedIn:"root"}),n})();class wW{shouldDetach(e){return!1}store(e,t){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,t){return e.routeConfig===t.routeConfig}}let MW=(()=>{class n extends wW{}return n.\u0275fac=function(){let e;return function(i){return(e||(e=function Ex(n){return gs(()=>{const e=n.prototype.constructor,t=e[Ir]||Rm(e),i=Object.prototype;let r=Object.getPrototypeOf(n.prototype).constructor;for(;r&&r!==i;){const s=r[Ir]||Rm(r);if(s&&s!==t)return s;r=Object.getPrototypeOf(r)}return s=>new s})}(n)))(i||n)}}(),n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const Cf=new Ne("",{providedIn:"root",factory:()=>({})});let CW=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:function(){return ut(DW)},providedIn:"root"}),n})(),DW=(()=>{class n{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,i){return t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();function TW(n){throw n}function AW(n,e,t){return e.parse("/")}const IW={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},PW={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Yn=(()=>{class n{constructor(){this.disposed=!1,this.currentPageId=0,this.console=ut(TB),this.isNgZoneEnabled=!1,this.options=ut(Cf,{optional:!0})||{},this.errorHandler=this.options.errorHandler||TW,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||AW,this.navigated=!1,this.lastSuccessfulId=-1,this.afterPreactivation=()=>De(void 0),this.urlHandlingStrategy=ut(CW),this.routeReuseStrategy=ut(SW),this.urlCreationStrategy=ut(mG),this.titleStrategy=ut(g1),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=ST(ut(Ja,{optional:!0})??[]),this.navigationTransitions=ut(Q_),this.urlSerializer=ut(uu),this.location=ut(Ay),this.rootComponentType=null,this.isNgZoneEnabled=ut(Ut)instanceof Ut&&Ut.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new bo,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=HT(this.currentUrlTree,this.rootComponentType),this.navigationTransitions.setupNavigations(this).subscribe(t=>{this.lastSuccessfulId=t.id,this.currentPageId=t.targetPageId},t=>{this.console.warn(`Unhandled Navigation Error: ${t}`)})}get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const i="popstate"===t.type?"popstate":"hashchange";"popstate"===i&&setTimeout(()=>{const r={replaceUrl:!0},s=t.state?.navigationId?t.state:null;if(t.state){const a={...t.state};delete a.navigationId,delete a.\u0275routerPageId,0!==Object.keys(a).length&&(r.state=a)}const o=this.parseUrl(t.url);this.scheduleNavigation(o,i,s,r)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(t){this.config=t.map($_),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(t,i={}){const{relativeTo:r,queryParams:s,fragment:o,queryParamsHandling:a,preserveFragment:l}=i,c=l?this.currentUrlTree.fragment:o;let u=null;switch(a){case"merge":u={...this.currentUrlTree.queryParams,...s};break;case"preserve":u=this.currentUrlTree.queryParams;break;default:u=s||null}return null!==u&&(u=this.removeEmptyProps(u)),this.urlCreationStrategy.createUrlTree(r,this.routerState,this.currentUrlTree,t,u,c??null)}navigateByUrl(t,i={skipLocationChange:!1}){const r=So(t)?t:this.parseUrl(t),s=this.urlHandlingStrategy.merge(r,this.rawUrlTree);return this.scheduleNavigation(s,"imperative",null,i)}navigate(t,i={skipLocationChange:!1}){return function RW(n){for(let e=0;e<n.length;e++){if(null==n[e])throw new ie(4008,!1)}}(t),this.navigateByUrl(this.createUrlTree(t,i),i)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let i;try{i=this.urlSerializer.parse(t)}catch(r){i=this.malformedUriErrorHandler(r,this.urlSerializer,t)}return i}isActive(t,i){let r;if(r=!0===i?{...IW}:!1===i?{...PW}:i,So(t))return ET(this.currentUrlTree,t,r);const s=this.parseUrl(t);return ET(this.currentUrlTree,s,r)}removeEmptyProps(t){return Object.keys(t).reduce((i,r)=>{const s=t[r];return null!=s&&(i[r]=s),i},{})}scheduleNavigation(t,i,r,s,o){if(this.disposed)return Promise.resolve(!1);let a,l,c,u;return o?(a=o.resolve,l=o.reject,c=o.promise):c=new Promise((d,h)=>{a=d,l=h}),"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(r=this.location.getState()),u=r&&r.\u0275routerPageId?r.\u0275routerPageId:s.replaceUrl||s.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1):u=0,this.navigationTransitions.handleNavigationRequest({targetPageId:u,source:i,restoredState:r,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:t,extras:s,resolve:a,reject:l,promise:c,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),c.catch(d=>Promise.reject(d))}setBrowserUrl(t,i){const r=this.urlSerializer.serialize(t),s={...i.extras.state,...this.generateNgRouterState(i.id,i.targetPageId)};this.location.isCurrentPathEqualTo(r)||i.extras.replaceUrl?this.location.replaceState(r,"",s):this.location.go(r,"",s)}restoreHistory(t,i=!1){if("computed"===this.canceledNavigationResolution){const r=this.currentPageId-t.targetPageId;"popstate"!==t.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===r?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===r&&(this.resetState(t),this.browserUrlTree=t.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(r)}else"replace"===this.canceledNavigationResolution&&(i&&this.resetState(t),this.resetUrlToCurrentUrlTree())}resetState(t){this.routerState=t.currentRouterState,this.currentUrlTree=t.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(t,i){return"computed"===this.canceledNavigationResolution?{navigationId:t,\u0275routerPageId:i}:{navigationId:t}}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})(),Df=(()=>{class n{constructor(t,i,r,s,o,a){this.router=t,this.route=i,this.tabIndexAttribute=r,this.renderer=s,this.el=o,this.locationStrategy=a,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new li;const l=o.nativeElement.tagName;this.isAnchorElement="A"===l||"AREA"===l,this.isAnchorElement?this.subscription=t.events.subscribe(c=>{c instanceof As&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(t){this._preserveFragment=Ey(t)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(t){this._skipLocationChange=Ey(t)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(t){this._replaceUrl=Ey(t)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(t){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",t)}ngOnChanges(t){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(t){null!=t?(this.commands=Array.isArray(t)?t:[t],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(t,i,r,s,o){return!!(null===this.urlTree||this.isAnchorElement&&(0!==t||i||r||s||o||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const t=null===this.href?null:function MS(n,e,t){return function TN(n,e){return"src"===e&&("embed"===n||"frame"===n||"iframe"===n||"media"===n||"script"===n)||"href"===e&&("base"===n||"link"===n)?wS:oo}(e,t)(n)}(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",t)}applyAttributeValue(t,i){const r=this.renderer,s=this.el.nativeElement;null!==i?r.setAttribute(s,t,i):r.removeAttribute(s,t)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return n.\u0275fac=function(t){return new(t||n)(Re(Yn),Re(Za),function Fd(n){return function e2(n,e){if("class"===e)return n.classes;if("style"===e)return n.styles;const t=n.attrs;if(t){const i=t.length;let r=0;for(;r<i;){const s=t[r];if(hx(s))break;if(0===s)r+=2;else if("number"==typeof s)for(r++;r<i&&"string"==typeof t[r];)r++;else{if(s===e)return t[r+1];r+=2}}}return null}(Tn(),n)}("tabindex"),Re(Zd),Re(vs),Re(po))},n.\u0275dir=zn({type:n,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(t,i){1&t&&Qi("click",function(s){return i.onClick(s.button,s.ctrlKey,s.shiftKey,s.altKey,s.metaKey)}),2&t&&Bg("target",i.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[eo]}),n})();class _1{}let OW=(()=>{class n{constructor(t,i,r,s,o){this.router=t,this.injector=r,this.preloadingStrategy=s,this.loader=o}setUpPreloading(){this.subscription=this.router.events.pipe(qr(t=>t instanceof As),vo(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,i){const r=[];for(const s of i){s.providers&&!s._injector&&(s._injector=ph(s.providers,t,`Route: ${s.path}`));const o=s._injector??t,a=s._loadedInjector??o;s.loadChildren&&!s._loadedRoutes&&void 0===s.canLoad||s.loadComponent&&!s._loadedComponent?r.push(this.preloadConfig(o,s)):(s.children||s._loadedRoutes)&&r.push(this.processRoutes(a,s.children??s._loadedRoutes))}return fn(r).pipe(ra())}preloadConfig(t,i){return this.preloadingStrategy.preload(i,()=>{let r;r=i.loadChildren&&void 0===i.canLoad?this.loader.loadChildren(t,i):De(null);const s=r.pipe(Sn(o=>null===o?De(void 0):(i._loadedRoutes=o.routes,i._loadedInjector=o.injector,this.processRoutes(o.injector??t,o.routes))));return i.loadComponent&&!i._loadedComponent?fn([s,this.loader.loadComponent(i)]).pipe(ra()):s})}}return n.\u0275fac=function(t){return new(t||n)(pe(Yn),pe(XE),pe(Or),pe(_1),pe(K_))},n.\u0275prov=Ae({token:n,factory:n.\u0275fac,providedIn:"root"}),n})();const J_=new Ne("");let v1=(()=>{class n{constructor(t,i,r,s,o={}){this.urlSerializer=t,this.transitions=i,this.viewportScroller=r,this.zone=s,this.options=o,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},o.scrollPositionRestoration=o.scrollPositionRestoration||"disabled",o.anchorScrolling=o.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof F_?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof As&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.urlSerializer.parse(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(t=>{t instanceof UT&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,i){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new UT(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,i))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return n.\u0275fac=function(t){!function ew(){throw new Error("invalid")}()},n.\u0275prov=Ae({token:n,factory:n.\u0275fac}),n})();function tl(n,e){return{\u0275kind:n,\u0275providers:e}}function x1(){const n=ut(pr);return e=>{const t=n.get(Yc);if(e!==t.components[0])return;const i=n.get(Yn),r=n.get(S1);1===n.get(tv)&&i.initialNavigation(),n.get(w1,null,ze.Optional)?.setUpPreloading(),n.get(J_,null,ze.Optional)?.init(),i.resetRootComponentType(t.componentTypes[0]),r.closed||(r.next(),r.unsubscribe())}}const S1=new Ne("",{factory:()=>new li}),tv=new Ne("",{providedIn:"root",factory:()=>1});const w1=new Ne("");function zW(n){return tl(0,[{provide:w1,useExisting:OW},{provide:_1,useExisting:n}])}const M1=new Ne("ROUTER_FORROOT_GUARD"),VW=[Ay,{provide:uu,useClass:I_},Yn,gu,{provide:Za,useFactory:function b1(n){return n.routerState.root},deps:[Yn]},K_,[]];function HW(){return new nC("Router",Yn)}let Tf=(()=>{class n{constructor(t){}static forRoot(t,i){return{ngModule:n,providers:[VW,[],{provide:Ja,multi:!0,useValue:t},{provide:M1,useFactory:$W,deps:[[Yn,new _c,new vc]]},{provide:Cf,useValue:i||{}},i?.useHash?{provide:po,useClass:mU}:{provide:po,useClass:EC},{provide:J_,useFactory:()=>{const n=ut(kz),e=ut(Ut),t=ut(Cf),i=ut(Q_),r=ut(uu);return t.scrollOffset&&n.setOffset(t.scrollOffset),new v1(r,i,n,e,t)}},i?.preloadingStrategy?zW(i.preloadingStrategy).\u0275providers:[],{provide:nC,multi:!0,useFactory:HW},i?.initialNavigation?qW(i):[],[{provide:E1,useFactory:x1},{provide:qE,multi:!0,useExisting:E1}]]}}static forChild(t){return{ngModule:n,providers:[{provide:Ja,multi:!0,useValue:t}]}}}return n.\u0275fac=function(t){return new(t||n)(pe(M1,8))},n.\u0275mod=ji({type:n}),n.\u0275inj=Ci({imports:[W_]}),n})();function $W(n){return"guarded"}function qW(n){return["disabled"===n.initialNavigation?tl(3,[{provide:$c,multi:!0,useFactory:()=>{const e=ut(Yn);return()=>{e.setUpLocationChangeListener()}}},{provide:tv,useValue:2}]).\u0275providers:[],"enabledBlocking"===n.initialNavigation?tl(2,[{provide:tv,useValue:0},{provide:$c,multi:!0,deps:[pr],useFactory:e=>{const t=e.get(fU,Promise.resolve());return()=>t.then(()=>new Promise(r=>{const s=e.get(Yn),o=e.get(S1);(function i(r){e.get(Yn).events.pipe(qr(o=>o instanceof As||o instanceof yf||o instanceof BT),Je(o=>o instanceof As||o instanceof yf&&(0===o.code||1===o.code)&&null),qr(o=>null!==o),au(1)).subscribe(()=>{r()})})(()=>{r(!0)}),s.afterPreactivation=()=>(r(!0),o.closed?De(void 0):o),s.initialNavigation()}))}}]).\u0275providers:[]]}const E1=new Ne("");class nl{}nl.\u0275fac=function(e){return new(e||nl)},nl.\u0275mod=ji({type:nl}),nl.\u0275inj=Ci({imports:[Tf.forRoot([{path:"",redirectTo:"shop",pathMatch:"full"},{path:"**",redirectTo:"list"}]),Tf]});const ZW=["addListener","removeListener"],KW=["addEventListener","removeEventListener"],QW=["on","off"];function wo(n,e,t,i){if(yt(t)&&(i=t,t=void 0),i)return wo(n,e,t).pipe(fT(i));const[r,s]=function t8(n){return yt(n.addEventListener)&&yt(n.removeEventListener)}(n)?KW.map(o=>a=>n[o](e,a,t)):function JW(n){return yt(n.addListener)&&yt(n.removeListener)}(n)?ZW.map(C1(n,e)):function e8(n){return yt(n.on)&&yt(n.off)}(n)?QW.map(C1(n,e)):[];if(!r&&Jp(n))return Sn(o=>wo(o,e,t))(Hi(n));if(!r)throw new TypeError("Invalid event target");return new nn(o=>{const a=(...l)=>o.next(1<l.length?l:l[0]);return r(a),()=>s(a)})}function C1(n,e){return t=>i=>n[t](e,i)}const Mo=n=>n*(Math.PI/180);class Jr{constructor(e){this.localStorage=e,this._gameState={transformerState:{side:2,size:8,isEmpty:!0,isFull:!1,quality:0},maxTransformerSide:2,storeSize:3,mergedStoreSize:0,mine:{rounds:10,qualities:[1,2],quality:"low"},coins:0,gold:0,exchangeRate:80,credit:0,inventory:{shovel1:!1,shovel2:!1,barrow:!1,wagon:!1,map:!1,compass:!1,dynamite:!1,worker:!1}},this._gameStateStream=new Oi(this._gameState),this._deafultMines=[{rounds:10,qualities:[1,2],quality:"low"},{rounds:10,qualities:[3,4],quality:"medium"},{rounds:10,qualities:[5,6],quality:"high"}];const t=this.localStorage.retrieve("gameState");t&&(this._gameState=t,this._gameState.transformerState={...t.transformerState,isEmpty:!0,isFull:!1,quality:0},this._gameStateStream.next(this._gameState)),this.gameStateStream=this._gameStateStream}getTransformerState(){return this._gameState.transformerState}setTransformerState(e){this._gameState.transformerState=e,this.saveGameState()}getMaxTransformerSide(){return this._gameState.maxTransformerSide}setMaxTransformerSide(){this._gameState.maxTransformerSide+=1,this.saveGameState()}getStoreSize(){return this._gameState.storeSize}setStoreSize(){this._gameState.storeSize+=1,this.saveGameState()}getMergedStoreSize(){return this._gameState.mergedStoreSize}setMergedStoreSize(){this._gameState.mergedStoreSize+=1,this.saveGameState()}getMine(){return this._gameState.mine}setMine(e,t){this._gameState.mine=e,["shovel1","barrow","wagon"].forEach(i=>{this._gameState.inventory[i]&&this.setMineRounds(t[i].rounds)}),this.saveGameState()}setMineRounds(e){const t=this._gameState.mine;t&&(t.rounds+=e,0===t.rounds&&(this._gameState.mine=null,this._gameState.inventory.map=!1,this._gameState.inventory.dynamite=!1,this._gameState.inventory.worker=!1),this.saveGameState())}addCoins(e){this._gameState.coins+=e,this.saveGameState()}getGold(){return this._gameState.gold}addGold(e){if(e<0){const t=this._gameState.exchangeRate+e;this._gameState.exchangeRate=t>80?t:80}this._gameState.gold+=e,this._gameState.credit=this._gameState.gold,this.saveGameState()}getCredit(){return this._gameState.credit}setCredit(e){this._gameState.credit+=e,this.saveGameState()}exchange(){const e=Math.floor(this._gameState.coins/this._gameState.exchangeRate);this.addCoins(-e*this._gameState.exchangeRate),this.addGold(e),this._gameState.exchangeRate+=e<=3?3:e+3,this.saveGameState()}getInventory(){return this._gameState.inventory}setInventory(e){this._gameState.inventory[e]=!this._gameState.inventory[e]}getDeafultMines(){return this._deafultMines}saveGameState(){this._gameStateStream.next(this._gameState),this.localStorage.store("gameState",this._gameState)}}function D1(n,e,t,i,r,s,o){try{var a=n[s](o),l=a.value}catch(c){return void t(c)}a.done?e(l):Promise.resolve(l).then(i,r)}Jr.\u0275fac=function(e){return new(e||Jr)(pe(uT))},Jr.\u0275prov=Ae({token:Jr,factory:Jr.\u0275fac,providedIn:"root"});const Xn=1001,_n=1003,an=1006,Do=1009,To=1014,Rs=1015,Eu=1016,cl=1020,Bi=1023,Ao=1026,ul=1027,Io=3e3,Gt=3001,Sr="srgb",Cu="srgb-linear";class Ls{addEventListener(e,t){void 0===this._listeners&&(this._listeners={});const i=this._listeners;void 0===i[e]&&(i[e]=[]),-1===i[e].indexOf(t)&&i[e].push(t)}hasEventListener(e,t){if(void 0===this._listeners)return!1;const i=this._listeners;return void 0!==i[e]&&-1!==i[e].indexOf(t)}removeEventListener(e,t){if(void 0===this._listeners)return;const r=this._listeners[e];if(void 0!==r){const s=r.indexOf(t);-1!==s&&r.splice(s,1)}}dispatchEvent(e){if(void 0===this._listeners)return;const i=this._listeners[e.type];if(void 0!==i){e.target=this;const r=i.slice(0);for(let s=0,o=r.length;s<o;s++)r[s].call(this,e);e.target=null}}}const kn=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],Ro=Math.PI/180,Du=180/Math.PI;function _i(){const n=4294967295*Math.random()|0,e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(kn[255&n]+kn[n>>8&255]+kn[n>>16&255]+kn[n>>24&255]+"-"+kn[255&e]+kn[e>>8&255]+"-"+kn[e>>16&15|64]+kn[e>>24&255]+"-"+kn[63&t|128]+kn[t>>8&255]+"-"+kn[t>>16&255]+kn[t>>24&255]+kn[255&i]+kn[i>>8&255]+kn[i>>16&255]+kn[i>>24&255]).toLowerCase()}function en(n,e,t){return Math.max(e,Math.min(t,n))}function Tu(n,e,t){return(1-t)*n+t*e}function gv(n){return 0==(n&n-1)&&0!==n}function Bf(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function ts(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Rt(n,e){switch(e.constructor){case Float32Array:return n;case Uint16Array:return Math.round(65535*n);case Uint8Array:return Math.round(255*n);case Int16Array:return Math.round(32767*n);case Int8Array:return Math.round(127*n);default:throw new Error("Invalid component type.")}}class K{constructor(e=0,t=0){K.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),s=this.x-e.x,o=this.y-e.y;return this.x=s*i-o*r+e.x,this.y=s*r+o*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ai{constructor(){ai.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1]}set(e,t,i,r,s,o,a,l,c){const u=this.elements;return u[0]=e,u[1]=r,u[2]=a,u[3]=t,u[4]=s,u[5]=l,u[6]=i,u[7]=o,u[8]=c,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[3],l=i[6],c=i[1],u=i[4],d=i[7],h=i[2],f=i[5],p=i[8],g=r[0],m=r[3],y=r[6],b=r[1],_=r[4],v=r[7],S=r[2],M=r[5],I=r[8];return s[0]=o*g+a*b+l*S,s[3]=o*m+a*_+l*M,s[6]=o*y+a*v+l*I,s[1]=c*g+u*b+d*S,s[4]=c*m+u*_+d*M,s[7]=c*y+u*v+d*I,s[2]=h*g+f*b+p*S,s[5]=h*m+f*_+p*M,s[8]=h*y+f*v+p*I,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8];return t*o*u-t*a*c-i*s*u+i*a*l+r*s*c-r*o*l}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=u*o-a*c,h=a*l-u*s,f=c*s-o*l,p=t*d+i*h+r*f;if(0===p)return this.set(0,0,0,0,0,0,0,0,0);const g=1/p;return e[0]=d*g,e[1]=(r*c-u*i)*g,e[2]=(a*i-r*o)*g,e[3]=h*g,e[4]=(u*t-r*l)*g,e[5]=(r*s-a*t)*g,e[6]=f*g,e[7]=(i*l-c*t)*g,e[8]=(o*t-i*s)*g,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,s,o,a){const l=Math.cos(s),c=Math.sin(s);return this.set(i*l,i*c,-i*(l*o+c*a)+o+e,-r*c,r*l,-r*(-c*o+l*a)+a+t,0,0,1),this}scale(e,t){return this.premultiply(yv.makeScale(e,t)),this}rotate(e){return this.premultiply(yv.makeRotation(-e)),this}translate(e,t){return this.premultiply(yv.makeTranslation(e,t)),this}makeTranslation(e,t){return this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return(new this.constructor).fromArray(this.elements)}}const yv=new ai;function uA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Au(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Lo(n){return n<.04045?.0773993808*n:Math.pow(.9478672986*n+.0521327014,2.4)}function Uf(n){return n<.0031308?12.92*n:1.055*Math.pow(n,.41666)-.055}Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array;const _v={[Sr]:{[Cu]:Lo},[Cu]:{[Sr]:Uf}},Zn={legacyMode:!0,get workingColorSpace(){return Cu},set workingColorSpace(n){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(n,e,t){if(this.legacyMode||e===t||!e||!t)return n;if(_v[e]&&void 0!==_v[e][t]){const i=_v[e][t];return n.r=i(n.r),n.g=i(n.g),n.b=i(n.b),n}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(n,e){return this.convert(n,this.workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this.workingColorSpace)}},dA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},vn={r:0,g:0,b:0},ar={h:0,s:0,l:0},zf={h:0,s:0,l:0};function vv(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+6*(e-n)*t:t<.5?e:t<2/3?n+6*(e-n)*(2/3-t):n}function Vf(n,e){return e.r=n.r,e.g=n.g,e.b=n.b,e}let pl,we=(()=>{class n{constructor(t,i,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===i&&void 0===r?this.set(t):this.setRGB(t,i,r)}set(t){return t&&t.isColor?this.copy(t):"number"==typeof t?this.setHex(t):"string"==typeof t&&this.setStyle(t),this}setScalar(t){return this.r=t,this.g=t,this.b=t,this}setHex(t,i=Sr){return t=Math.floor(t),this.r=(t>>16&255)/255,this.g=(t>>8&255)/255,this.b=(255&t)/255,Zn.toWorkingColorSpace(this,i),this}setRGB(t,i,r,s=Zn.workingColorSpace){return this.r=t,this.g=i,this.b=r,Zn.toWorkingColorSpace(this,s),this}setHSL(t,i,r,s=Zn.workingColorSpace){if(t=function mv(n,e){return(n%e+e)%e}(t,1),i=en(i,0,1),r=en(r,0,1),0===i)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+i):r+i-r*i,a=2*r-o;this.r=vv(a,o,t+1/3),this.g=vv(a,o,t),this.b=vv(a,o,t-1/3)}return Zn.toWorkingColorSpace(this,s),this}setStyle(t,i=Sr){function r(o){void 0!==o&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+t+" will be ignored.")}let s;if(s=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(t)){let o;const l=s[2];switch(s[1]){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(255,parseInt(o[1],10))/255,this.g=Math.min(255,parseInt(o[2],10))/255,this.b=Math.min(255,parseInt(o[3],10))/255,Zn.toWorkingColorSpace(this,i),r(o[4]),this;if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return this.r=Math.min(100,parseInt(o[1],10))/100,this.g=Math.min(100,parseInt(o[2],10))/100,this.b=Math.min(100,parseInt(o[3],10))/100,Zn.toWorkingColorSpace(this,i),r(o[4]),this;break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l)){const c=parseFloat(o[1])/360,u=parseFloat(o[2])/100,d=parseFloat(o[3])/100;return r(o[4]),this.setHSL(c,u,d,i)}}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(t)){const o=s[1],a=o.length;if(3===a)return this.r=parseInt(o.charAt(0)+o.charAt(0),16)/255,this.g=parseInt(o.charAt(1)+o.charAt(1),16)/255,this.b=parseInt(o.charAt(2)+o.charAt(2),16)/255,Zn.toWorkingColorSpace(this,i),this;if(6===a)return this.r=parseInt(o.charAt(0)+o.charAt(1),16)/255,this.g=parseInt(o.charAt(2)+o.charAt(3),16)/255,this.b=parseInt(o.charAt(4)+o.charAt(5),16)/255,Zn.toWorkingColorSpace(this,i),this}return t&&t.length>0?this.setColorName(t,i):this}setColorName(t,i=Sr){const r=dA[t.toLowerCase()];return void 0!==r?this.setHex(r,i):console.warn("THREE.Color: Unknown color "+t),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(t){return this.r=t.r,this.g=t.g,this.b=t.b,this}copySRGBToLinear(t){return this.r=Lo(t.r),this.g=Lo(t.g),this.b=Lo(t.b),this}copyLinearToSRGB(t){return this.r=Uf(t.r),this.g=Uf(t.g),this.b=Uf(t.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(t=Sr){return Zn.fromWorkingColorSpace(Vf(this,vn),t),en(255*vn.r,0,255)<<16^en(255*vn.g,0,255)<<8^en(255*vn.b,0,255)<<0}getHexString(t=Sr){return("000000"+this.getHex(t).toString(16)).slice(-6)}getHSL(t,i=Zn.workingColorSpace){Zn.fromWorkingColorSpace(Vf(this,vn),i);const r=vn.r,s=vn.g,o=vn.b,a=Math.max(r,s,o),l=Math.min(r,s,o);let c,u;const d=(l+a)/2;if(l===a)c=0,u=0;else{const h=a-l;switch(u=d<=.5?h/(a+l):h/(2-a-l),a){case r:c=(s-o)/h+(s<o?6:0);break;case s:c=(o-r)/h+2;break;case o:c=(r-s)/h+4}c/=6}return t.h=c,t.s=u,t.l=d,t}getRGB(t,i=Zn.workingColorSpace){return Zn.fromWorkingColorSpace(Vf(this,vn),i),t.r=vn.r,t.g=vn.g,t.b=vn.b,t}getStyle(t=Sr){return Zn.fromWorkingColorSpace(Vf(this,vn),t),t!==Sr?`color(${t} ${vn.r} ${vn.g} ${vn.b})`:`rgb(${255*vn.r|0},${255*vn.g|0},${255*vn.b|0})`}offsetHSL(t,i,r){return this.getHSL(ar),ar.h+=t,ar.s+=i,ar.l+=r,this.setHSL(ar.h,ar.s,ar.l),this}add(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this}addColors(t,i){return this.r=t.r+i.r,this.g=t.g+i.g,this.b=t.b+i.b,this}addScalar(t){return this.r+=t,this.g+=t,this.b+=t,this}sub(t){return this.r=Math.max(0,this.r-t.r),this.g=Math.max(0,this.g-t.g),this.b=Math.max(0,this.b-t.b),this}multiply(t){return this.r*=t.r,this.g*=t.g,this.b*=t.b,this}multiplyScalar(t){return this.r*=t,this.g*=t,this.b*=t,this}lerp(t,i){return this.r+=(t.r-this.r)*i,this.g+=(t.g-this.g)*i,this.b+=(t.b-this.b)*i,this}lerpColors(t,i,r){return this.r=t.r+(i.r-t.r)*r,this.g=t.g+(i.g-t.g)*r,this.b=t.b+(i.b-t.b)*r,this}lerpHSL(t,i){this.getHSL(ar),t.getHSL(zf);const r=Tu(ar.h,zf.h,i),s=Tu(ar.s,zf.s,i),o=Tu(ar.l,zf.l,i);return this.setHSL(r,s,o),this}equals(t){return t.r===this.r&&t.g===this.g&&t.b===this.b}fromArray(t,i=0){return this.r=t[i],this.g=t[i+1],this.b=t[i+2],this}toArray(t=[],i=0){return t[i]=this.r,t[i+1]=this.g,t[i+2]=this.b,t}fromBufferAttribute(t,i){return this.r=t.getX(i),this.g=t.getY(i),this.b=t.getZ(i),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}return n.NAMES=dA,n})();class hA{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===pl&&(pl=Au("canvas")),pl.width=e.width,pl.height=e.height;const i=pl.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=pl}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Au("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),s=r.data;for(let o=0;o<s.length;o++)s[o]=255*Lo(s[o]/255);return i.putImageData(r,0,0),t}if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t[i]=t instanceof Uint8Array||t instanceof Uint8ClampedArray?Math.floor(255*Lo(t[i]/255)):Lo(t[i]);return{data:t,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}class ml{constructor(e=null){this.isSource=!0,this.uuid=_i(),this.data=e,this.version=0}set needsUpdate(e){!0===e&&this.version++}toJSON(e){const t=void 0===e||"string"==typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(null!==r){let s;if(Array.isArray(r)){s=[];for(let o=0,a=r.length;o<a;o++)s.push(bv(r[o].isDataTexture?r[o].image:r[o]))}else s=bv(r);i.url=s}return t||(e.images[this.uuid]=i),i}}function bv(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?hA.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let m6=0,ns=(()=>{class n extends Ls{constructor(t=n.DEFAULT_IMAGE,i=n.DEFAULT_MAPPING,r=Xn,s=Xn,o=an,a=1008,l=Bi,c=Do,u=n.DEFAULT_ANISOTROPY,d=Io){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:m6++}),this.uuid=_i(),this.name="",this.source=new ml(t),this.mipmaps=[],this.mapping=i,this.wrapS=r,this.wrapT=s,this.magFilter=o,this.minFilter=a,this.anisotropy=u,this.format=l,this.internalFormat=null,this.type=c,this.offset=new K(0,0),this.repeat=new K(1,1),this.center=new K(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ai,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=d,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.needsPMREMUpdate=!1}get image(){return this.source.data}set image(t){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return(new this.constructor).copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.encoding=t.encoding,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const i=void 0===t||"string"==typeof t;if(!i&&void 0!==t.textures[this.uuid])return t.textures[this.uuid];const r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),i||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(300!==this.mapping)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case 1e3:t.x=t.x-Math.floor(t.x);break;case Xn:t.x=t.x<0?0:1;break;case 1002:t.x=1===Math.abs(Math.floor(t.x)%2)?Math.ceil(t.x)-t.x:t.x-Math.floor(t.x)}if(t.y<0||t.y>1)switch(this.wrapT){case 1e3:t.y=t.y-Math.floor(t.y);break;case Xn:t.y=t.y<0?0:1;break;case 1002:t.y=1===Math.abs(Math.floor(t.y)%2)?Math.ceil(t.y)-t.y:t.y-Math.floor(t.y)}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){!0===t&&(this.version++,this.source.needsUpdate=!0)}}return n.DEFAULT_IMAGE=null,n.DEFAULT_MAPPING=300,n.DEFAULT_ANISOTROPY=1,n})();class Dt{constructor(e=0,t=0,i=0,r=1){Dt.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=this.w,o=e.elements;return this.x=o[0]*t+o[4]*i+o[8]*r+o[12]*s,this.y=o[1]*t+o[5]*i+o[9]*r+o[13]*s,this.z=o[2]*t+o[6]*i+o[10]*r+o[14]*s,this.w=o[3]*t+o[7]*i+o[11]*r+o[15]*s,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,s;const l=e.elements,c=l[0],u=l[4],d=l[8],h=l[1],f=l[5],p=l[9],g=l[2],m=l[6],y=l[10];if(Math.abs(u-h)<.01&&Math.abs(d-g)<.01&&Math.abs(p-m)<.01){if(Math.abs(u+h)<.1&&Math.abs(d+g)<.1&&Math.abs(p+m)<.1&&Math.abs(c+f+y-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const _=(c+1)/2,v=(f+1)/2,S=(y+1)/2,M=(u+h)/4,I=(d+g)/4,x=(p+m)/4;return _>v&&_>S?_<.01?(i=0,r=.707106781,s=.707106781):(i=Math.sqrt(_),r=M/i,s=I/i):v>S?v<.01?(i=.707106781,r=0,s=.707106781):(r=Math.sqrt(v),i=M/r,s=x/r):S<.01?(i=.707106781,r=.707106781,s=0):(s=Math.sqrt(S),i=I/s,r=x/s),this.set(i,r,s,t),this}let b=Math.sqrt((m-p)*(m-p)+(d-g)*(d-g)+(h-u)*(h-u));return Math.abs(b)<.001&&(b=1),this.x=(m-p)/b,this.y=(d-g)/b,this.z=(h-u)/b,this.w=Math.acos((c+f+y-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class No extends Ls{constructor(e=1,t=1,i={}){super(),this.isWebGLRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Dt(0,0,e,t),this.scissorTest=!1,this.viewport=new Dt(0,0,e,t),this.texture=new ns({width:e,height:t,depth:1},i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),this.texture.isRenderTargetTexture=!0,this.texture.flipY=!1,this.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,this.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,this.texture.minFilter=void 0!==i.minFilter?i.minFilter:an,this.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,this.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,this.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,this.samples=void 0!==i.samples?i.samples:0}setSize(e,t,i=1){(this.width!==e||this.height!==t||this.depth!==i)&&(this.width=e,this.height=t,this.depth=i,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=i,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return(new this.constructor).copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new ml(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class xv extends ns{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_n,this.minFilter=_n,this.wrapR=Xn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class fA extends ns{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=_n,this.minFilter=_n,this.wrapR=Xn,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Kn{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,s,o,a){let l=i[r+0],c=i[r+1],u=i[r+2],d=i[r+3];const h=s[o+0],f=s[o+1],p=s[o+2],g=s[o+3];if(0===a)return e[t+0]=l,e[t+1]=c,e[t+2]=u,void(e[t+3]=d);if(1===a)return e[t+0]=h,e[t+1]=f,e[t+2]=p,void(e[t+3]=g);if(d!==g||l!==h||c!==f||u!==p){let m=1-a;const y=l*h+c*f+u*p+d*g,b=y>=0?1:-1,_=1-y*y;if(_>Number.EPSILON){const S=Math.sqrt(_),M=Math.atan2(S,y*b);m=Math.sin(m*M)/S,a=Math.sin(a*M)/S}const v=a*b;if(l=l*m+h*v,c=c*m+f*v,u=u*m+p*v,d=d*m+g*v,m===1-a){const S=1/Math.sqrt(l*l+c*c+u*u+d*d);l*=S,c*=S,u*=S,d*=S}}e[t]=l,e[t+1]=c,e[t+2]=u,e[t+3]=d}static multiplyQuaternionsFlat(e,t,i,r,s,o){const a=i[r],l=i[r+1],c=i[r+2],u=i[r+3],d=s[o],h=s[o+1],f=s[o+2],p=s[o+3];return e[t]=a*p+u*d+l*f-c*h,e[t+1]=l*p+u*h+c*d-a*f,e[t+2]=c*p+u*f+a*h-l*d,e[t+3]=u*p-a*d-l*h-c*f,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t){const i=e._x,r=e._y,s=e._z,o=e._order,a=Math.cos,l=Math.sin,c=a(i/2),u=a(r/2),d=a(s/2),h=l(i/2),f=l(r/2),p=l(s/2);switch(o){case"XYZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"YXZ":this._x=h*u*d+c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"ZXY":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d-h*f*p;break;case"ZYX":this._x=h*u*d-c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d+h*f*p;break;case"YZX":this._x=h*u*d+c*f*p,this._y=c*f*d+h*u*p,this._z=c*u*p-h*f*d,this._w=c*u*d-h*f*p;break;case"XZY":this._x=h*u*d-c*f*p,this._y=c*f*d-h*u*p,this._z=c*u*p+h*f*d,this._w=c*u*d+h*f*p;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+o)}return!1!==t&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],s=t[8],o=t[1],a=t[5],l=t[9],c=t[2],u=t[6],d=t[10],h=i+a+d;if(h>0){const f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(u-l)*f,this._y=(s-c)*f,this._z=(o-r)*f}else if(i>a&&i>d){const f=2*Math.sqrt(1+i-a-d);this._w=(u-l)/f,this._x=.25*f,this._y=(r+o)/f,this._z=(s+c)/f}else if(a>d){const f=2*Math.sqrt(1+a-i-d);this._w=(s-c)/f,this._x=(r+o)/f,this._y=.25*f,this._z=(l+u)/f}else{const f=2*Math.sqrt(1+d-i-a);this._w=(o-r)/f,this._x=(s+c)/f,this._y=(l+u)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(en(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(0===i)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,s=e._z,o=e._w,a=t._x,l=t._y,c=t._z,u=t._w;return this._x=i*u+o*a+r*c-s*l,this._y=r*u+o*l+s*a-i*c,this._z=s*u+o*c+i*l-r*a,this._w=o*u-i*a-r*l-s*c,this._onChangeCallback(),this}slerp(e,t){if(0===t)return this;if(1===t)return this.copy(e);const i=this._x,r=this._y,s=this._z,o=this._w;let a=o*e._w+i*e._x+r*e._y+s*e._z;if(a<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,a=-a):this.copy(e),a>=1)return this._w=o,this._x=i,this._y=r,this._z=s,this;const l=1-a*a;if(l<=Number.EPSILON){const f=1-t;return this._w=f*o+t*this._w,this._x=f*i+t*this._x,this._y=f*r+t*this._y,this._z=f*s+t*this._z,this.normalize(),this._onChangeCallback(),this}const c=Math.sqrt(l),u=Math.atan2(c,a),d=Math.sin((1-t)*u)/c,h=Math.sin(t*u)/c;return this._w=o*d+this._w*h,this._x=i*d+this._x*h,this._y=r*d+this._y*h,this._z=s*d+this._z*h,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=Math.random(),t=Math.sqrt(1-e),i=Math.sqrt(e),r=2*Math.PI*Math.random(),s=2*Math.PI*Math.random();return this.set(t*Math.cos(r),i*Math.sin(s),i*Math.cos(s),t*Math.sin(r))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class E{constructor(e=0,t=0,i=0){E.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return void 0===i&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(pA.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(pA.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[3]*i+s[6]*r,this.y=s[1]*t+s[4]*i+s[7]*r,this.z=s[2]*t+s[5]*i+s[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,s=e.elements,o=1/(s[3]*t+s[7]*i+s[11]*r+s[15]);return this.x=(s[0]*t+s[4]*i+s[8]*r+s[12])*o,this.y=(s[1]*t+s[5]*i+s[9]*r+s[13])*o,this.z=(s[2]*t+s[6]*i+s[10]*r+s[14])*o,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,s=e.x,o=e.y,a=e.z,l=e.w,c=l*t+o*r-a*i,u=l*i+a*t-s*r,d=l*r+s*i-o*t,h=-s*t-o*i-a*r;return this.x=c*l+h*-s+u*-a-d*-o,this.y=u*l+h*-o+d*-s-c*-a,this.z=d*l+h*-a+c*-o-u*-s,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,s=e.elements;return this.x=s[0]*t+s[4]*i+s[8]*r,this.y=s[1]*t+s[5]*i+s[9]*r,this.z=s[2]*t+s[6]*i+s[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,s=e.z,o=t.x,a=t.y,l=t.z;return this.x=r*l-s*a,this.y=s*o-i*l,this.z=i*a-r*o,this}projectOnVector(e){const t=e.lengthSq();if(0===t)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return Sv.copy(this).projectOnVector(e),this.sub(Sv)}reflect(e){return this.sub(Sv.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(en(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,4*t)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,3*t)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,i=Math.sqrt(1-e**2);return this.x=i*Math.cos(t),this.y=i*Math.sin(t),this.z=e,this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const Sv=new E,pA=new Kn;class Ns{constructor(e=new E(1/0,1/0,1/0),t=new E(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.length;l<c;l+=3){const u=e[l],d=e[l+1],h=e[l+2];u<t&&(t=u),d<i&&(i=d),h<r&&(r=h),u>s&&(s=u),d>o&&(o=d),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromBufferAttribute(e){let t=1/0,i=1/0,r=1/0,s=-1/0,o=-1/0,a=-1/0;for(let l=0,c=e.count;l<c;l++){const u=e.getX(l),d=e.getY(l),h=e.getZ(l);u<t&&(t=u),d<i&&(i=d),h<r&&(r=h),u>s&&(s=u),d>o&&(o=d),h>a&&(a=h)}return this.min.set(t,i,r),this.max.set(s,o,a),this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Oo.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return(new this.constructor).copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(void 0!==i)if(t&&null!=i.attributes&&void 0!==i.attributes.position){const s=i.attributes.position;for(let o=0,a=s.count;o<a;o++)Oo.fromBufferAttribute(s,o).applyMatrix4(e.matrixWorld),this.expandByPoint(Oo)}else null===i.boundingBox&&i.computeBoundingBox(),wv.copy(i.boundingBox),wv.applyMatrix4(e.matrixWorld),this.union(wv);const r=e.children;for(let s=0,o=r.length;s<o;s++)this.expandByObject(r[s],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Oo),Oo.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Iu),Hf.subVectors(this.max,Iu),gl.subVectors(e.a,Iu),yl.subVectors(e.b,Iu),_l.subVectors(e.c,Iu),Os.subVectors(yl,gl),Fs.subVectors(_l,yl),Fo.subVectors(gl,_l);let t=[0,-Os.z,Os.y,0,-Fs.z,Fs.y,0,-Fo.z,Fo.y,Os.z,0,-Os.x,Fs.z,0,-Fs.x,Fo.z,0,-Fo.x,-Os.y,Os.x,0,-Fs.y,Fs.x,0,-Fo.y,Fo.x,0];return!(!Mv(t,gl,yl,_l,Hf)||(t=[1,0,0,0,1,0,0,0,1],!Mv(t,gl,yl,_l,Hf)))&&(Gf.crossVectors(Os,Fs),t=[Gf.x,Gf.y,Gf.z],Mv(t,gl,yl,_l,Hf))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return Oo.copy(e).clamp(this.min,this.max).sub(e).length()}getBoundingSphere(e){return this.getCenter(e.center),e.radius=.5*this.getSize(Oo).length(),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()||(is[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),is[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),is[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),is[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),is[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),is[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),is[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),is[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(is)),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const is=[new E,new E,new E,new E,new E,new E,new E,new E],Oo=new E,wv=new Ns,gl=new E,yl=new E,_l=new E,Os=new E,Fs=new E,Fo=new E,Iu=new E,Hf=new E,Gf=new E,ko=new E;function Mv(n,e,t,i,r){for(let s=0,o=n.length-3;s<=o;s+=3){ko.fromArray(n,s);const a=r.x*Math.abs(ko.x)+r.y*Math.abs(ko.y)+r.z*Math.abs(ko.z),l=e.dot(ko),c=t.dot(ko),u=i.dot(ko);if(Math.max(-Math.max(l,c,u),Math.min(l,c,u))>a)return!1}return!0}const g6=new Ns,Pu=new E,Ev=new E;class vl{constructor(e=new E,t=-1){this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;void 0!==t?i.copy(t):g6.setFromPoints(e).getCenter(i);let r=0;for(let s=0,o=e.length;s<o;s++)r=Math.max(r,i.distanceToSquared(e[s]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Pu.subVectors(e,this.center);const t=Pu.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=.5*(i-this.radius);this.center.addScaledVector(Pu,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(!0===this.center.equals(e.center)?this.radius=Math.max(this.radius,e.radius):(Ev.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Pu.copy(e.center).add(Ev)),this.expandByPoint(Pu.copy(e.center).sub(Ev))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return(new this.constructor).copy(this)}}const rs=new E,Cv=new E,Wf=new E,ks=new E,Dv=new E,jf=new E,Tv=new E;class $f{constructor(e=new E,t=new E(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,rs)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(i).add(this.origin)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=rs.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(rs.copy(this.direction).multiplyScalar(t).add(this.origin),rs.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){Cv.copy(e).add(t).multiplyScalar(.5),Wf.copy(t).sub(e).normalize(),ks.copy(this.origin).sub(Cv);const s=.5*e.distanceTo(t),o=-this.direction.dot(Wf),a=ks.dot(this.direction),l=-ks.dot(Wf),c=ks.lengthSq(),u=Math.abs(1-o*o);let d,h,f,p;if(u>0)if(d=o*l-a,h=o*a-l,p=s*u,d>=0)if(h>=-p)if(h<=p){const g=1/u;d*=g,h*=g,f=d*(d+o*h+2*a)+h*(o*d+h+2*l)+c}else h=s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h=-s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;else h<=-p?(d=Math.max(0,-(-o*s+a)),h=d>0?-s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c):h<=p?(d=0,h=Math.min(Math.max(-s,-l),s),f=h*(h+2*l)+c):(d=Math.max(0,-(o*s+a)),h=d>0?s:Math.min(Math.max(-s,-l),s),f=-d*d+h*(h+2*l)+c);else h=o>0?-s:s,d=Math.max(0,-(o*h+a)),f=-d*d+h*(h+2*l)+c;return i&&i.copy(this.direction).multiplyScalar(d).add(this.origin),r&&r.copy(Wf).multiplyScalar(h).add(Cv),f}intersectSphere(e,t){rs.subVectors(e.center,this.origin);const i=rs.dot(this.direction),r=rs.dot(rs)-i*i,s=e.radius*e.radius;if(r>s)return null;const o=Math.sqrt(s-r),a=i-o,l=i+o;return a<0&&l<0?null:this.at(a<0?l:a,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return null===i?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,s,o,a,l;const c=1/this.direction.x,u=1/this.direction.y,d=1/this.direction.z,h=this.origin;return c>=0?(i=(e.min.x-h.x)*c,r=(e.max.x-h.x)*c):(i=(e.max.x-h.x)*c,r=(e.min.x-h.x)*c),u>=0?(s=(e.min.y-h.y)*u,o=(e.max.y-h.y)*u):(s=(e.max.y-h.y)*u,o=(e.min.y-h.y)*u),i>o||s>r||((s>i||isNaN(i))&&(i=s),(o<r||isNaN(r))&&(r=o),d>=0?(a=(e.min.z-h.z)*d,l=(e.max.z-h.z)*d):(a=(e.max.z-h.z)*d,l=(e.min.z-h.z)*d),i>l||a>r)||((a>i||i!=i)&&(i=a),(l<r||r!=r)&&(r=l),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return null!==this.intersectBox(e,rs)}intersectTriangle(e,t,i,r,s){Dv.subVectors(t,e),jf.subVectors(i,e),Tv.crossVectors(Dv,jf);let a,o=this.direction.dot(Tv);if(o>0){if(r)return null;a=1}else{if(!(o<0))return null;a=-1,o=-o}ks.subVectors(this.origin,e);const l=a*this.direction.dot(jf.crossVectors(ks,jf));if(l<0)return null;const c=a*this.direction.dot(Dv.cross(ks));if(c<0||l+c>o)return null;const u=-a*ks.dot(Tv);return u<0?null:this.at(u/o,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return(new this.constructor).copy(this)}}class Ze{constructor(){Ze.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}set(e,t,i,r,s,o,a,l,c,u,d,h,f,p,g,m){const y=this.elements;return y[0]=e,y[4]=t,y[8]=i,y[12]=r,y[1]=s,y[5]=o,y[9]=a,y[13]=l,y[2]=c,y[6]=u,y[10]=d,y[14]=h,y[3]=f,y[7]=p,y[11]=g,y[15]=m,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return(new Ze).fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/bl.setFromMatrixColumn(e,0).length(),s=1/bl.setFromMatrixColumn(e,1).length(),o=1/bl.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*s,t[5]=i[5]*s,t[6]=i[6]*s,t[7]=0,t[8]=i[8]*o,t[9]=i[9]*o,t[10]=i[10]*o,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,s=e.z,o=Math.cos(i),a=Math.sin(i),l=Math.cos(r),c=Math.sin(r),u=Math.cos(s),d=Math.sin(s);if("XYZ"===e.order){const h=o*u,f=o*d,p=a*u,g=a*d;t[0]=l*u,t[4]=-l*d,t[8]=c,t[1]=f+p*c,t[5]=h-g*c,t[9]=-a*l,t[2]=g-h*c,t[6]=p+f*c,t[10]=o*l}else if("YXZ"===e.order){const h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h+g*a,t[4]=p*a-f,t[8]=o*c,t[1]=o*d,t[5]=o*u,t[9]=-a,t[2]=f*a-p,t[6]=g+h*a,t[10]=o*l}else if("ZXY"===e.order){const h=l*u,f=l*d,p=c*u,g=c*d;t[0]=h-g*a,t[4]=-o*d,t[8]=p+f*a,t[1]=f+p*a,t[5]=o*u,t[9]=g-h*a,t[2]=-o*c,t[6]=a,t[10]=o*l}else if("ZYX"===e.order){const h=o*u,f=o*d,p=a*u,g=a*d;t[0]=l*u,t[4]=p*c-f,t[8]=h*c+g,t[1]=l*d,t[5]=g*c+h,t[9]=f*c-p,t[2]=-c,t[6]=a*l,t[10]=o*l}else if("YZX"===e.order){const h=o*l,f=o*c,p=a*l,g=a*c;t[0]=l*u,t[4]=g-h*d,t[8]=p*d+f,t[1]=d,t[5]=o*u,t[9]=-a*u,t[2]=-c*u,t[6]=f*d+p,t[10]=h-g*d}else if("XZY"===e.order){const h=o*l,f=o*c,p=a*l,g=a*c;t[0]=l*u,t[4]=-d,t[8]=c*u,t[1]=h*d+g,t[5]=o*u,t[9]=f*d-p,t[2]=p*d-f,t[6]=a*u,t[10]=g*d+h}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(y6,e,_6)}lookAt(e,t,i){const r=this.elements;return vi.subVectors(e,t),0===vi.lengthSq()&&(vi.z=1),vi.normalize(),Bs.crossVectors(i,vi),0===Bs.lengthSq()&&(1===Math.abs(i.z)?vi.x+=1e-4:vi.z+=1e-4,vi.normalize(),Bs.crossVectors(i,vi)),Bs.normalize(),qf.crossVectors(vi,Bs),r[0]=Bs.x,r[4]=qf.x,r[8]=vi.x,r[1]=Bs.y,r[5]=qf.y,r[9]=vi.y,r[2]=Bs.z,r[6]=qf.z,r[10]=vi.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,s=this.elements,o=i[0],a=i[4],l=i[8],c=i[12],u=i[1],d=i[5],h=i[9],f=i[13],p=i[2],g=i[6],m=i[10],y=i[14],b=i[3],_=i[7],v=i[11],S=i[15],M=r[0],I=r[4],x=r[8],D=r[12],P=r[1],V=r[5],ne=r[9],z=r[13],L=r[2],j=r[6],N=r[10],U=r[14],O=r[3],$=r[7],q=r[11],G=r[15];return s[0]=o*M+a*P+l*L+c*O,s[4]=o*I+a*V+l*j+c*$,s[8]=o*x+a*ne+l*N+c*q,s[12]=o*D+a*z+l*U+c*G,s[1]=u*M+d*P+h*L+f*O,s[5]=u*I+d*V+h*j+f*$,s[9]=u*x+d*ne+h*N+f*q,s[13]=u*D+d*z+h*U+f*G,s[2]=p*M+g*P+m*L+y*O,s[6]=p*I+g*V+m*j+y*$,s[10]=p*x+g*ne+m*N+y*q,s[14]=p*D+g*z+m*U+y*G,s[3]=b*M+_*P+v*L+S*O,s[7]=b*I+_*V+v*j+S*$,s[11]=b*x+_*ne+v*N+S*q,s[15]=b*D+_*z+v*U+S*G,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],s=e[12],o=e[1],a=e[5],l=e[9],c=e[13],u=e[2],d=e[6],h=e[10],f=e[14];return e[3]*(+s*l*d-r*c*d-s*a*h+i*c*h+r*a*f-i*l*f)+e[7]*(+t*l*f-t*c*h+s*o*h-r*o*f+r*c*u-s*l*u)+e[11]*(+t*c*d-t*a*f-s*o*d+i*o*f+s*a*u-i*c*u)+e[15]*(-r*a*u-t*l*d+t*a*h+r*o*d-i*o*h+i*l*u)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],s=e[3],o=e[4],a=e[5],l=e[6],c=e[7],u=e[8],d=e[9],h=e[10],f=e[11],p=e[12],g=e[13],m=e[14],y=e[15],b=d*m*c-g*h*c+g*l*f-a*m*f-d*l*y+a*h*y,_=p*h*c-u*m*c-p*l*f+o*m*f+u*l*y-o*h*y,v=u*g*c-p*d*c+p*a*f-o*g*f-u*a*y+o*d*y,S=p*d*l-u*g*l-p*a*h+o*g*h+u*a*m-o*d*m,M=t*b+i*_+r*v+s*S;if(0===M)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const I=1/M;return e[0]=b*I,e[1]=(g*h*s-d*m*s-g*r*f+i*m*f+d*r*y-i*h*y)*I,e[2]=(a*m*s-g*l*s+g*r*c-i*m*c-a*r*y+i*l*y)*I,e[3]=(d*l*s-a*h*s-d*r*c+i*h*c+a*r*f-i*l*f)*I,e[4]=_*I,e[5]=(u*m*s-p*h*s+p*r*f-t*m*f-u*r*y+t*h*y)*I,e[6]=(p*l*s-o*m*s-p*r*c+t*m*c+o*r*y-t*l*y)*I,e[7]=(o*h*s-u*l*s+u*r*c-t*h*c-o*r*f+t*l*f)*I,e[8]=v*I,e[9]=(p*d*s-u*g*s-p*i*f+t*g*f+u*i*y-t*d*y)*I,e[10]=(o*g*s-p*a*s+p*i*c-t*g*c-o*i*y+t*a*y)*I,e[11]=(u*a*s-o*d*s-u*i*c+t*d*c+o*i*f-t*a*f)*I,e[12]=S*I,e[13]=(u*g*r-p*d*r+p*i*h-t*g*h-u*i*m+t*d*m)*I,e[14]=(p*a*r-o*g*r-p*i*l+t*g*l+o*i*m-t*a*m)*I,e[15]=(o*d*r-u*a*r+u*i*l-t*d*l-o*i*h+t*a*h)*I,this}scale(e){const t=this.elements,i=e.x,r=e.y,s=e.z;return t[0]*=i,t[4]*=r,t[8]*=s,t[1]*=i,t[5]*=r,t[9]*=s,t[2]*=i,t[6]*=r,t[10]*=s,t[3]*=i,t[7]*=r,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10]))}makeTranslation(e,t,i){return this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),s=1-i,o=e.x,a=e.y,l=e.z,c=s*o,u=s*a;return this.set(c*o+i,c*a-r*l,c*l+r*a,0,c*a+r*l,u*a+i,u*l-r*o,0,c*l-r*a,u*l+r*o,s*l*l+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,s,o){return this.set(1,i,s,0,e,1,o,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,s=t._x,o=t._y,a=t._z,l=t._w,c=s+s,u=o+o,d=a+a,h=s*c,f=s*u,p=s*d,g=o*u,m=o*d,y=a*d,b=l*c,_=l*u,v=l*d,S=i.x,M=i.y,I=i.z;return r[0]=(1-(g+y))*S,r[1]=(f+v)*S,r[2]=(p-_)*S,r[3]=0,r[4]=(f-v)*M,r[5]=(1-(h+y))*M,r[6]=(m+b)*M,r[7]=0,r[8]=(p+_)*I,r[9]=(m-b)*I,r[10]=(1-(h+g))*I,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let s=bl.set(r[0],r[1],r[2]).length();const o=bl.set(r[4],r[5],r[6]).length(),a=bl.set(r[8],r[9],r[10]).length();this.determinant()<0&&(s=-s),e.x=r[12],e.y=r[13],e.z=r[14],lr.copy(this);const c=1/s,u=1/o,d=1/a;return lr.elements[0]*=c,lr.elements[1]*=c,lr.elements[2]*=c,lr.elements[4]*=u,lr.elements[5]*=u,lr.elements[6]*=u,lr.elements[8]*=d,lr.elements[9]*=d,lr.elements[10]*=d,t.setFromRotationMatrix(lr),i.x=s,i.y=o,i.z=a,this}makePerspective(e,t,i,r,s,o){const a=this.elements,c=2*s/(i-r),u=(t+e)/(t-e),d=(i+r)/(i-r),h=-(o+s)/(o-s),f=-2*o*s/(o-s);return a[0]=2*s/(t-e),a[4]=0,a[8]=u,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=h,a[14]=f,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(e,t,i,r,s,o){const a=this.elements,l=1/(t-e),c=1/(i-r),u=1/(o-s),d=(t+e)*l,h=(i+r)*c,f=(o+s)*u;return a[0]=2*l,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-h,a[2]=0,a[6]=0,a[10]=-2*u,a[14]=-f,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const bl=new E,lr=new Ze,y6=new E(0,0,0),_6=new E(1,1,1),Bs=new E,qf=new E,vi=new E,mA=new Ze,gA=new Kn;let v6=(()=>{class n{constructor(t=0,i=0,r=0,s=n.DefaultOrder){this.isEuler=!0,this._x=t,this._y=i,this._z=r,this._order=s}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,i,r,s=this._order){return this._x=t,this._y=i,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,i=this._order,r=!0){const s=t.elements,o=s[0],a=s[4],l=s[8],c=s[1],u=s[5],d=s[9],h=s[2],f=s[6],p=s[10];switch(i){case"XYZ":this._y=Math.asin(en(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-d,p),this._z=Math.atan2(-a,o)):(this._x=Math.atan2(f,u),this._z=0);break;case"YXZ":this._x=Math.asin(-en(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(l,p),this._z=Math.atan2(c,u)):(this._y=Math.atan2(-h,o),this._z=0);break;case"ZXY":this._x=Math.asin(en(f,-1,1)),Math.abs(f)<.9999999?(this._y=Math.atan2(-h,p),this._z=Math.atan2(-a,u)):(this._y=0,this._z=Math.atan2(c,o));break;case"ZYX":this._y=Math.asin(-en(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(f,p),this._z=Math.atan2(c,o)):(this._x=0,this._z=Math.atan2(-a,u));break;case"YZX":this._z=Math.asin(en(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-d,u),this._y=Math.atan2(-h,o)):(this._x=0,this._y=Math.atan2(l,p));break;case"XZY":this._z=Math.asin(-en(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(f,u),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-d,p),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+i)}return this._order=i,!0===r&&this._onChangeCallback(),this}setFromQuaternion(t,i,r){return mA.makeRotationFromQuaternion(t),this.setFromRotationMatrix(mA,i,r)}setFromVector3(t,i=this._order){return this.set(t.x,t.y,t.z,i)}reorder(t){return gA.setFromEuler(this),this.setFromQuaternion(gA,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],void 0!==t[3]&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],i=0){return t[i]=this._x,t[i+1]=this._y,t[i+2]=this._z,t[i+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}toVector3(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}return n.DefaultOrder="XYZ",n.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],n})();class Av{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return 0!=(this.mask&e.mask)}isEnabled(e){return 0!=(this.mask&(1<<e|0))}}let b6=0;const yA=new E,xl=new Kn,ss=new Ze,Yf=new E,Ru=new E,x6=new E,S6=new Kn,_A=new E(1,0,0),vA=new E(0,1,0),bA=new E(0,0,1),w6={type:"added"},xA={type:"removed"};let bi=(()=>{class n extends Ls{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:b6++}),this.uuid=_i(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=n.DefaultUp.clone();const t=new E,i=new v6,r=new Kn,s=new E(1,1,1);i._onChange(function o(){r.setFromEuler(i,!1)}),r._onChange(function a(){i.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:i},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new Ze},normalMatrix:{value:new ai}}),this.matrix=new Ze,this.matrixWorld=new Ze,this.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.matrixWorldAutoUpdate=n.DefaultMatrixWorldAutoUpdate,this.layers=new Av,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,i){this.quaternion.setFromAxisAngle(t,i)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,i){return xl.setFromAxisAngle(t,i),this.quaternion.multiply(xl),this}rotateOnWorldAxis(t,i){return xl.setFromAxisAngle(t,i),this.quaternion.premultiply(xl),this}rotateX(t){return this.rotateOnAxis(_A,t)}rotateY(t){return this.rotateOnAxis(vA,t)}rotateZ(t){return this.rotateOnAxis(bA,t)}translateOnAxis(t,i){return yA.copy(t).applyQuaternion(this.quaternion),this.position.add(yA.multiplyScalar(i)),this}translateX(t){return this.translateOnAxis(_A,t)}translateY(t){return this.translateOnAxis(vA,t)}translateZ(t){return this.translateOnAxis(bA,t)}localToWorld(t){return t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return t.applyMatrix4(ss.copy(this.matrixWorld).invert())}lookAt(t,i,r){t.isVector3?Yf.copy(t):Yf.set(t,i,r);const s=this.parent;this.updateWorldMatrix(!0,!1),Ru.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?ss.lookAt(Ru,Yf,this.up):ss.lookAt(Yf,Ru,this.up),this.quaternion.setFromRotationMatrix(ss),s&&(ss.extractRotation(s.matrixWorld),xl.setFromRotationMatrix(ss),this.quaternion.premultiply(xl.invert()))}add(t){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.add(arguments[i]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(null!==t.parent&&t.parent.remove(t),t.parent=this,this.children.push(t),t.dispatchEvent(w6)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const i=this.children.indexOf(t);return-1!==i&&(t.parent=null,this.children.splice(i,1),t.dispatchEvent(xA)),this}removeFromParent(){const t=this.parent;return null!==t&&t.remove(this),this}clear(){for(let t=0;t<this.children.length;t++){const i=this.children[t];i.parent=null,i.dispatchEvent(xA)}return this.children.length=0,this}attach(t){return this.updateWorldMatrix(!0,!1),ss.copy(this.matrixWorld).invert(),null!==t.parent&&(t.parent.updateWorldMatrix(!0,!1),ss.multiply(t.parent.matrixWorld)),t.applyMatrix4(ss),this.add(t),t.updateWorldMatrix(!1,!0),this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,i){if(this[t]===i)return this;for(let r=0,s=this.children.length;r<s;r++){const a=this.children[r].getObjectByProperty(t,i);if(void 0!==a)return a}}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ru,t,x6),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Ru,S6,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const i=this.matrixWorld.elements;return t.set(i[8],i[9],i[10]).normalize()}raycast(){}traverse(t){t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverse(t)}traverseVisible(t){if(!1===this.visible)return;t(this);const i=this.children;for(let r=0,s=i.length;r<s;r++)i[r].traverseVisible(t)}traverseAncestors(t){const i=this.parent;null!==i&&(t(i),i.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0);const i=this.children;for(let r=0,s=i.length;r<s;r++){const o=i[r];(!0===o.matrixWorldAutoUpdate||!0===t)&&o.updateMatrixWorld(t)}}updateWorldMatrix(t,i){const r=this.parent;if(!0===t&&null!==r&&!0===r.matrixWorldAutoUpdate&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===i){const s=this.children;for(let o=0,a=s.length;o<a;o++){const l=s[o];!0===l.matrixWorldAutoUpdate&&l.updateWorldMatrix(!1,!0)}}}toJSON(t){const i=void 0===t||"string"==typeof t,r={};i&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});const s={};function o(l,c){return void 0===l[c.uuid]&&(l[c.uuid]=c.toJSON(t)),c.uuid}if(s.uuid=this.uuid,s.type=this.type,""!==this.name&&(s.name=this.name),!0===this.castShadow&&(s.castShadow=!0),!0===this.receiveShadow&&(s.receiveShadow=!0),!1===this.visible&&(s.visible=!1),!1===this.frustumCulled&&(s.frustumCulled=!1),0!==this.renderOrder&&(s.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(s.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&!0!==this.environment.isRenderTargetTexture&&(s.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=o(t.geometries,this.geometry);const l=this.geometry.parameters;if(void 0!==l&&void 0!==l.shapes){const c=l.shapes;if(Array.isArray(c))for(let u=0,d=c.length;u<d;u++)o(t.shapes,c[u]);else o(t.shapes,c)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(o(t.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){const l=[];for(let c=0,u=this.material.length;c<u;c++)l.push(o(t.materials,this.material[c]));s.material=l}else s.material=o(t.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(t).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++)s.animations.push(o(t.animations,this.animations[l]))}if(i){const l=a(t.geometries),c=a(t.materials),u=a(t.textures),d=a(t.images),h=a(t.shapes),f=a(t.skeletons),p=a(t.animations),g=a(t.nodes);l.length>0&&(r.geometries=l),c.length>0&&(r.materials=c),u.length>0&&(r.textures=u),d.length>0&&(r.images=d),h.length>0&&(r.shapes=h),f.length>0&&(r.skeletons=f),p.length>0&&(r.animations=p),g.length>0&&(r.nodes=g)}return r.object=s,r;function a(l){const c=[];for(const u in l){const d=l[u];delete d.metadata,c.push(d)}return c}}clone(t){return(new this.constructor).copy(this,t)}copy(t,i=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.userData=JSON.parse(JSON.stringify(t.userData)),!0===i)for(let r=0;r<t.children.length;r++)this.add(t.children[r].clone());return this}}return n.DefaultUp=new E(0,1,0),n.DefaultMatrixAutoUpdate=!0,n.DefaultMatrixWorldAutoUpdate=!0,n})();const cr=new E,os=new E,Iv=new E,as=new E,Sl=new E,wl=new E,SA=new E,Pv=new E,Rv=new E,Lv=new E;class ur{constructor(e=new E,t=new E,i=new E){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),cr.subVectors(e,t),r.cross(cr);const s=r.lengthSq();return s>0?r.multiplyScalar(1/Math.sqrt(s)):r.set(0,0,0)}static getBarycoord(e,t,i,r,s){cr.subVectors(r,t),os.subVectors(i,t),Iv.subVectors(e,t);const o=cr.dot(cr),a=cr.dot(os),l=cr.dot(Iv),c=os.dot(os),u=os.dot(Iv),d=o*c-a*a;if(0===d)return s.set(-2,-1,-1);const h=1/d,f=(c*l-a*u)*h,p=(o*u-a*l)*h;return s.set(1-f-p,p,f)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,as),as.x>=0&&as.y>=0&&as.x+as.y<=1}static getUV(e,t,i,r,s,o,a,l){return this.getBarycoord(e,t,i,r,as),l.set(0,0),l.addScaledVector(s,as.x),l.addScaledVector(o,as.y),l.addScaledVector(a,as.z),l}static isFrontFacing(e,t,i,r){return cr.subVectors(i,t),os.subVectors(e,t),cr.cross(os).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return(new this.constructor).copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return cr.subVectors(this.c,this.b),os.subVectors(this.a,this.b),.5*cr.cross(os).length()}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ur.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ur.getBarycoord(e,this.a,this.b,this.c,t)}getUV(e,t,i,r,s){return ur.getUV(e,this.a,this.b,this.c,t,i,r,s)}containsPoint(e){return ur.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ur.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,s=this.c;let o,a;Sl.subVectors(r,i),wl.subVectors(s,i),Pv.subVectors(e,i);const l=Sl.dot(Pv),c=wl.dot(Pv);if(l<=0&&c<=0)return t.copy(i);Rv.subVectors(e,r);const u=Sl.dot(Rv),d=wl.dot(Rv);if(u>=0&&d<=u)return t.copy(r);const h=l*d-u*c;if(h<=0&&l>=0&&u<=0)return o=l/(l-u),t.copy(i).addScaledVector(Sl,o);Lv.subVectors(e,s);const f=Sl.dot(Lv),p=wl.dot(Lv);if(p>=0&&f<=p)return t.copy(s);const g=f*c-l*p;if(g<=0&&c>=0&&p<=0)return a=c/(c-p),t.copy(i).addScaledVector(wl,a);const m=u*p-f*d;if(m<=0&&d-u>=0&&f-p>=0)return SA.subVectors(s,r),a=(d-u)/(d-u+(f-p)),t.copy(r).addScaledVector(SA,a);const y=1/(m+g+h);return o=g*y,a=h*y,t.copy(i).addScaledVector(Sl,o).addScaledVector(wl,a)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}let M6=0;class Bo extends Ls{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:M6++}),this.uuid=_i(),this.name="",this.type="Material",this.blending=1,this.side=0,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.blendSrc=204,this.blendDst=205,this.blendEquation=100,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=3,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=519,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=7680,this.stencilZFail=7680,this.stencilZPass=7680,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(void 0!==e)for(const t in e){const i=e[t];if(void 0===i){console.warn("THREE.Material: '"+t+"' parameter is undefined.");continue}const r=this[t];void 0!==r?r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}}toJSON(e){const t=void 0===e||"string"==typeof e;t&&(e={textures:{},images:{}});const i={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(s){const o=[];for(const a in s){const l=s[a];delete l.metadata,o.push(l)}return o}if(i.uuid=this.uuid,i.type=this.type,""!==this.name&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),void 0!==this.roughness&&(i.roughness=this.roughness),void 0!==this.metalness&&(i.metalness=this.metalness),void 0!==this.sheen&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(i.shininess=this.shininess),void 0!==this.clearcoat&&(i.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(i.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(i.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(i.combine=this.combine)),void 0!==this.envMapIntensity&&(i.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(i.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(i.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(i.size=this.size),null!==this.shadowSide&&(i.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(i.sizeAttenuation=this.sizeAttenuation),1!==this.blending&&(i.blending=this.blending),0!==this.side&&(i.side=this.side),this.vertexColors&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),!0===this.transparent&&(i.transparent=this.transparent),i.depthFunc=this.depthFunc,i.depthTest=this.depthTest,i.depthWrite=this.depthWrite,i.colorWrite=this.colorWrite,i.stencilWrite=this.stencilWrite,i.stencilWriteMask=this.stencilWriteMask,i.stencilFunc=this.stencilFunc,i.stencilRef=this.stencilRef,i.stencilFuncMask=this.stencilFuncMask,i.stencilFail=this.stencilFail,i.stencilZFail=this.stencilZFail,i.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(i.rotation=this.rotation),!0===this.polygonOffset&&(i.polygonOffset=!0),0!==this.polygonOffsetFactor&&(i.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(i.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(i.linewidth=this.linewidth),void 0!==this.dashSize&&(i.dashSize=this.dashSize),void 0!==this.gapSize&&(i.gapSize=this.gapSize),void 0!==this.scale&&(i.scale=this.scale),!0===this.dithering&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(i.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(i.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(i.wireframe=this.wireframe),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(i.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(i.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(i.flatShading=this.flatShading),!1===this.visible&&(i.visible=!1),!1===this.toneMapped&&(i.toneMapped=!1),!1===this.fog&&(i.fog=!1),"{}"!==JSON.stringify(this.userData)&&(i.userData=this.userData),t){const s=r(e.textures),o=r(e.images);s.length>0&&(i.textures=s),o.length>0&&(i.images=o)}return i}clone(){return(new this.constructor).copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(null!==t){const r=t.length;i=new Array(r);for(let s=0;s!==r;++s)i[s]=t[s].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){!0===e&&this.version++}}class ls extends Bo{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new we(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=0,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ln=new E,Xf=new K;class wn{constructor(e,t,i){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=void 0!==e?e.length/t:0,this.normalized=!0===i,this.usage=35044,this.updateRange={offset:0,count:-1},this.version=0}onUploadCallback(){}set needsUpdate(e){!0===e&&this.version++}setUsage(e){return this.usage=e,this}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,s=this.itemSize;r<s;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(2===this.itemSize)for(let t=0,i=this.count;t<i;t++)Xf.fromBufferAttribute(this,t),Xf.applyMatrix3(e),this.setXY(t,Xf.x,Xf.y);else if(3===this.itemSize)for(let t=0,i=this.count;t<i;t++)ln.fromBufferAttribute(this,t),ln.applyMatrix3(e),this.setXYZ(t,ln.x,ln.y,ln.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ln.fromBufferAttribute(this,t),ln.applyMatrix4(e),this.setXYZ(t,ln.x,ln.y,ln.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ln.fromBufferAttribute(this,t),ln.applyNormalMatrix(e),this.setXYZ(t,ln.x,ln.y,ln.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ln.fromBufferAttribute(this,t),ln.transformDirection(e),this.setXYZ(t,ln.x,ln.y,ln.z);return this}set(e,t=0){return this.array.set(e,t),this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ts(t,this.array)),t}setX(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ts(t,this.array)),t}setY(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ts(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ts(t,this.array)),t}setW(e,t){return this.normalized&&(t=Rt(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),i=Rt(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),i=Rt(i,this.array),r=Rt(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,s){return e*=this.itemSize,this.normalized&&(t=Rt(t,this.array),i=Rt(i,this.array),r=Rt(r,this.array),s=Rt(s,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),35044!==this.usage&&(e.usage=this.usage),(0!==this.updateRange.offset||-1!==this.updateRange.count)&&(e.updateRange=this.updateRange),e}copyColorsArray(){console.error("THREE.BufferAttribute: copyColorsArray() was removed in r144.")}copyVector2sArray(){console.error("THREE.BufferAttribute: copyVector2sArray() was removed in r144.")}copyVector3sArray(){console.error("THREE.BufferAttribute: copyVector3sArray() was removed in r144.")}copyVector4sArray(){console.error("THREE.BufferAttribute: copyVector4sArray() was removed in r144.")}}class wA extends wn{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class MA extends wn{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Te extends wn{constructor(e,t,i){super(new Float32Array(e),t,i)}}let E6=0;const Ui=new Ze,Nv=new bi,Ml=new E,xi=new Ns,Lu=new Ns,Mn=new E;class ot extends Ls{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:E6++}),this.uuid=_i(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return this.index=Array.isArray(e)?new(uA(e)?MA:wA)(e,1):e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return void 0!==this.attributes[e]}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(void 0!==i){const s=(new ai).getNormalMatrix(e);i.applyNormalMatrix(s),i.needsUpdate=!0}const r=this.attributes.tangent;return void 0!==r&&(r.transformDirection(e),r.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ui.makeRotationFromQuaternion(e),this.applyMatrix4(Ui),this}rotateX(e){return Ui.makeRotationX(e),this.applyMatrix4(Ui),this}rotateY(e){return Ui.makeRotationY(e),this.applyMatrix4(Ui),this}rotateZ(e){return Ui.makeRotationZ(e),this.applyMatrix4(Ui),this}translate(e,t,i){return Ui.makeTranslation(e,t,i),this.applyMatrix4(Ui),this}scale(e,t,i){return Ui.makeScale(e,t,i),this.applyMatrix4(Ui),this}lookAt(e){return Nv.lookAt(e),Nv.updateMatrix(),this.applyMatrix4(Nv.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Ml).negate(),this.translate(Ml.x,Ml.y,Ml.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const s=e[i];t.push(s.x,s.y,s.z||0)}return this.setAttribute("position",new Te(t,3)),this}computeBoundingBox(){null===this.boundingBox&&(this.boundingBox=new Ns);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new E(-1/0,-1/0,-1/0),new E(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++)xi.setFromBufferAttribute(t[i]),this.morphTargetsRelative?(Mn.addVectors(this.boundingBox.min,xi.min),this.boundingBox.expandByPoint(Mn),Mn.addVectors(this.boundingBox.max,xi.max),this.boundingBox.expandByPoint(Mn)):(this.boundingBox.expandByPoint(xi.min),this.boundingBox.expandByPoint(xi.max))}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){null===this.boundingSphere&&(this.boundingSphere=new vl);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new E,1/0);if(e){const i=this.boundingSphere.center;if(xi.setFromBufferAttribute(e),t)for(let s=0,o=t.length;s<o;s++)Lu.setFromBufferAttribute(t[s]),this.morphTargetsRelative?(Mn.addVectors(xi.min,Lu.min),xi.expandByPoint(Mn),Mn.addVectors(xi.max,Lu.max),xi.expandByPoint(Mn)):(xi.expandByPoint(Lu.min),xi.expandByPoint(Lu.max));xi.getCenter(i);let r=0;for(let s=0,o=e.count;s<o;s++)Mn.fromBufferAttribute(e,s),r=Math.max(r,i.distanceToSquared(Mn));if(t)for(let s=0,o=t.length;s<o;s++){const a=t[s],l=this.morphTargetsRelative;for(let c=0,u=a.count;c<u;c++)Mn.fromBufferAttribute(a,c),l&&(Ml.fromBufferAttribute(e,c),Mn.add(Ml)),r=Math.max(r,i.distanceToSquared(Mn))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(null===e||void 0===t.position||void 0===t.normal||void 0===t.uv)return void console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");const i=e.array,r=t.position.array,s=t.normal.array,o=t.uv.array,a=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new wn(new Float32Array(4*a),4));const l=this.getAttribute("tangent").array,c=[],u=[];for(let P=0;P<a;P++)c[P]=new E,u[P]=new E;const d=new E,h=new E,f=new E,p=new K,g=new K,m=new K,y=new E,b=new E;function _(P,V,ne){d.fromArray(r,3*P),h.fromArray(r,3*V),f.fromArray(r,3*ne),p.fromArray(o,2*P),g.fromArray(o,2*V),m.fromArray(o,2*ne),h.sub(d),f.sub(d),g.sub(p),m.sub(p);const z=1/(g.x*m.y-m.x*g.y);!isFinite(z)||(y.copy(h).multiplyScalar(m.y).addScaledVector(f,-g.y).multiplyScalar(z),b.copy(f).multiplyScalar(g.x).addScaledVector(h,-m.x).multiplyScalar(z),c[P].add(y),c[V].add(y),c[ne].add(y),u[P].add(b),u[V].add(b),u[ne].add(b))}let v=this.groups;0===v.length&&(v=[{start:0,count:i.length}]);for(let P=0,V=v.length;P<V;++P){const ne=v[P],z=ne.start;for(let j=z,N=z+ne.count;j<N;j+=3)_(i[j+0],i[j+1],i[j+2])}const S=new E,M=new E,I=new E,x=new E;function D(P){I.fromArray(s,3*P),x.copy(I);const V=c[P];S.copy(V),S.sub(I.multiplyScalar(I.dot(V))).normalize(),M.crossVectors(x,V);const z=M.dot(u[P])<0?-1:1;l[4*P]=S.x,l[4*P+1]=S.y,l[4*P+2]=S.z,l[4*P+3]=z}for(let P=0,V=v.length;P<V;++P){const ne=v[P],z=ne.start;for(let j=z,N=z+ne.count;j<N;j+=3)D(i[j+0]),D(i[j+1]),D(i[j+2])}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(void 0!==t){let i=this.getAttribute("normal");if(void 0===i)i=new wn(new Float32Array(3*t.count),3),this.setAttribute("normal",i);else for(let h=0,f=i.count;h<f;h++)i.setXYZ(h,0,0,0);const r=new E,s=new E,o=new E,a=new E,l=new E,c=new E,u=new E,d=new E;if(e)for(let h=0,f=e.count;h<f;h+=3){const p=e.getX(h+0),g=e.getX(h+1),m=e.getX(h+2);r.fromBufferAttribute(t,p),s.fromBufferAttribute(t,g),o.fromBufferAttribute(t,m),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),a.fromBufferAttribute(i,p),l.fromBufferAttribute(i,g),c.fromBufferAttribute(i,m),a.add(u),l.add(u),c.add(u),i.setXYZ(p,a.x,a.y,a.z),i.setXYZ(g,l.x,l.y,l.z),i.setXYZ(m,c.x,c.y,c.z)}else for(let h=0,f=t.count;h<f;h+=3)r.fromBufferAttribute(t,h+0),s.fromBufferAttribute(t,h+1),o.fromBufferAttribute(t,h+2),u.subVectors(o,s),d.subVectors(r,s),u.cross(d),i.setXYZ(h+0,u.x,u.y,u.z),i.setXYZ(h+1,u.x,u.y,u.z),i.setXYZ(h+2,u.x,u.y,u.z);this.normalizeNormals(),i.needsUpdate=!0}}merge(){return console.error("THREE.BufferGeometry.merge() has been removed. Use THREE.BufferGeometryUtils.mergeBufferGeometries() instead."),this}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Mn.fromBufferAttribute(e,t),Mn.normalize(),e.setXYZ(t,Mn.x,Mn.y,Mn.z)}toNonIndexed(){function e(a,l){const c=a.array,u=a.itemSize,d=a.normalized,h=new c.constructor(l.length*u);let f=0,p=0;for(let g=0,m=l.length;g<m;g++){f=a.isInterleavedBufferAttribute?l[g]*a.data.stride+a.offset:l[g]*u;for(let y=0;y<u;y++)h[p++]=c[f++]}return new wn(h,u,d)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new ot,i=this.index.array,r=this.attributes;for(const a in r){const c=e(r[a],i);t.setAttribute(a,c)}const s=this.morphAttributes;for(const a in s){const l=[],c=s[a];for(let u=0,d=c.length;u<d;u++){const f=e(c[u],i);l.push(f)}t.morphAttributes[a]=l}t.morphTargetsRelative=this.morphTargetsRelative;const o=this.groups;for(let a=0,l=o.length;a<l;a++){const c=o[a];t.addGroup(c.start,c.count,c.materialIndex)}return t}toJSON(){const e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){const l=this.parameters;for(const c in l)void 0!==l[c]&&(e[c]=l[c]);return e}e.data={attributes:{}};const t=this.index;null!==t&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const l in i)e.data.attributes[l]=i[l].toJSON(e.data);const r={};let s=!1;for(const l in this.morphAttributes){const c=this.morphAttributes[l],u=[];for(let d=0,h=c.length;d<h;d++)u.push(c[d].toJSON(e.data));u.length>0&&(r[l]=u,s=!0)}s&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const o=this.groups;o.length>0&&(e.data.groups=JSON.parse(JSON.stringify(o)));const a=this.boundingSphere;return null!==a&&(e.data.boundingSphere={center:a.center.toArray(),radius:a.radius}),e}clone(){return(new this.constructor).copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;null!==i&&this.setIndex(i.clone(t));const r=e.attributes;for(const c in r)this.setAttribute(c,r[c].clone(t));const s=e.morphAttributes;for(const c in s){const u=[],d=s[c];for(let h=0,f=d.length;h<f;h++)u.push(d[h].clone(t));this.morphAttributes[c]=u}this.morphTargetsRelative=e.morphTargetsRelative;const o=e.groups;for(let c=0,u=o.length;c<u;c++){const d=o[c];this.addGroup(d.start,d.count,d.materialIndex)}const a=e.boundingBox;null!==a&&(this.boundingBox=a.clone());const l=e.boundingSphere;return null!==l&&(this.boundingSphere=l.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}dispose(){this.dispatchEvent({type:"dispose"})}}const EA=new Ze,El=new $f,Ov=new vl,Us=new E,zs=new E,Vs=new E,Fv=new E,kv=new E,Bv=new E,Zf=new E,Kf=new E,Qf=new E,Jf=new K,ep=new K,tp=new K,Uv=new E,np=new E;class Bn extends bi{constructor(e=new ot,t=new ls){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}raycast(e,t){const i=this.geometry,r=this.material,s=this.matrixWorld;if(void 0===r||(null===i.boundingSphere&&i.computeBoundingSphere(),Ov.copy(i.boundingSphere),Ov.applyMatrix4(s),!1===e.ray.intersectsSphere(Ov))||(EA.copy(s).invert(),El.copy(e.ray).applyMatrix4(EA),null!==i.boundingBox&&!1===El.intersectsBox(i.boundingBox)))return;let o;const a=i.index,l=i.attributes.position,c=i.morphAttributes.position,u=i.morphTargetsRelative,d=i.attributes.uv,h=i.attributes.uv2,f=i.groups,p=i.drawRange;if(null!==a)if(Array.isArray(r))for(let g=0,m=f.length;g<m;g++){const y=f[g],b=r[y.materialIndex];for(let S=Math.max(y.start,p.start),M=Math.min(a.count,Math.min(y.start+y.count,p.start+p.count));S<M;S+=3){const I=a.getX(S),x=a.getX(S+1),D=a.getX(S+2);o=ip(this,b,e,El,l,c,u,d,h,I,x,D),o&&(o.faceIndex=Math.floor(S/3),o.face.materialIndex=y.materialIndex,t.push(o))}}else for(let y=Math.max(0,p.start),b=Math.min(a.count,p.start+p.count);y<b;y+=3){const _=a.getX(y),v=a.getX(y+1),S=a.getX(y+2);o=ip(this,r,e,El,l,c,u,d,h,_,v,S),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}else if(void 0!==l)if(Array.isArray(r))for(let g=0,m=f.length;g<m;g++){const y=f[g],b=r[y.materialIndex];for(let S=Math.max(y.start,p.start),M=Math.min(l.count,Math.min(y.start+y.count,p.start+p.count));S<M;S+=3)o=ip(this,b,e,El,l,c,u,d,h,S,S+1,S+2),o&&(o.faceIndex=Math.floor(S/3),o.face.materialIndex=y.materialIndex,t.push(o))}else for(let y=Math.max(0,p.start),b=Math.min(l.count,p.start+p.count);y<b;y+=3)o=ip(this,r,e,El,l,c,u,d,h,y,y+1,y+2),o&&(o.faceIndex=Math.floor(y/3),t.push(o))}}function ip(n,e,t,i,r,s,o,a,l,c,u,d){Us.fromBufferAttribute(r,c),zs.fromBufferAttribute(r,u),Vs.fromBufferAttribute(r,d);const h=n.morphTargetInfluences;if(s&&h){Zf.set(0,0,0),Kf.set(0,0,0),Qf.set(0,0,0);for(let p=0,g=s.length;p<g;p++){const m=h[p],y=s[p];0!==m&&(Fv.fromBufferAttribute(y,c),kv.fromBufferAttribute(y,u),Bv.fromBufferAttribute(y,d),o?(Zf.addScaledVector(Fv,m),Kf.addScaledVector(kv,m),Qf.addScaledVector(Bv,m)):(Zf.addScaledVector(Fv.sub(Us),m),Kf.addScaledVector(kv.sub(zs),m),Qf.addScaledVector(Bv.sub(Vs),m)))}Us.add(Zf),zs.add(Kf),Vs.add(Qf)}n.isSkinnedMesh&&(n.boneTransform(c,Us),n.boneTransform(u,zs),n.boneTransform(d,Vs));const f=function C6(n,e,t,i,r,s,o,a){let l;if(l=1===e.side?i.intersectTriangle(o,s,r,!0,a):i.intersectTriangle(r,s,o,2!==e.side,a),null===l)return null;np.copy(a),np.applyMatrix4(n.matrixWorld);const c=t.ray.origin.distanceTo(np);return c<t.near||c>t.far?null:{distance:c,point:np.clone(),object:n}}(n,e,t,i,Us,zs,Vs,Uv);if(f){a&&(Jf.fromBufferAttribute(a,c),ep.fromBufferAttribute(a,u),tp.fromBufferAttribute(a,d),f.uv=ur.getUV(Uv,Us,zs,Vs,Jf,ep,tp,new K)),l&&(Jf.fromBufferAttribute(l,c),ep.fromBufferAttribute(l,u),tp.fromBufferAttribute(l,d),f.uv2=ur.getUV(Uv,Us,zs,Vs,Jf,ep,tp,new K));const p={a:c,b:u,c:d,normal:new E,materialIndex:0};ur.getNormal(Us,zs,Vs,p.normal),f.face=p}return f}class Hs extends ot{constructor(e=1,t=1,i=1,r=1,s=1,o=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:s,depthSegments:o};const a=this;r=Math.floor(r),s=Math.floor(s),o=Math.floor(o);const l=[],c=[],u=[],d=[];let h=0,f=0;function p(g,m,y,b,_,v,S,M,I,x,D){const P=v/I,V=S/x,ne=v/2,z=S/2,L=M/2,j=I+1,N=x+1;let U=0,O=0;const $=new E;for(let q=0;q<N;q++){const G=q*V-z;for(let H=0;H<j;H++)$[g]=(H*P-ne)*b,$[m]=G*_,$[y]=L,c.push($.x,$.y,$.z),$[g]=0,$[m]=0,$[y]=M>0?1:-1,u.push($.x,$.y,$.z),d.push(H/I),d.push(1-q/x),U+=1}for(let q=0;q<x;q++)for(let G=0;G<I;G++){const oe=h+G+j*(q+1),te=h+(G+1)+j*(q+1),ue=h+(G+1)+j*q;l.push(h+G+j*q,oe,ue),l.push(oe,te,ue),O+=6}a.addGroup(f,O,D),f+=O,h+=U}p("z","y","x",-1,-1,i,t,e,o,s,0),p("z","y","x",1,-1,i,t,-e,o,s,1),p("x","z","y",1,1,e,i,t,r,o,2),p("x","z","y",1,-1,e,i,-t,r,o,3),p("x","y","z",1,-1,e,t,i,r,s,4),p("x","y","z",-1,-1,e,t,-i,r,s,5),this.setIndex(l),this.setAttribute("position",new Te(c,3)),this.setAttribute("normal",new Te(u,3)),this.setAttribute("uv",new Te(d,2))}static fromJSON(e){return new Hs(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Cl(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];e[t][i]=r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.clone():Array.isArray(r)?r.slice():r}}return e}function Qn(n){const e={};for(let t=0;t<n.length;t++){const i=Cl(n[t]);for(const r in i)e[r]=i[r]}return e}function CA(n){return null===n.getRenderTarget()&&n.outputEncoding===Gt?Sr:Cu}const T6={clone:Cl,merge:Qn};class Gs extends Bo{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,void 0!==e&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Cl(e.uniforms),this.uniformsGroups=function D6(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const o=this.uniforms[r].value;t.uniforms[r]=o&&o.isTexture?{type:"t",value:o.toJSON(e).uuid}:o&&o.isColor?{type:"c",value:o.getHex()}:o&&o.isVector2?{type:"v2",value:o.toArray()}:o&&o.isVector3?{type:"v3",value:o.toArray()}:o&&o.isVector4?{type:"v4",value:o.toArray()}:o&&o.isMatrix3?{type:"m3",value:o.toArray()}:o&&o.isMatrix4?{type:"m4",value:o.toArray()}:{value:o}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;const i={};for(const r in this.extensions)!0===this.extensions[r]&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class zv extends bi{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ze,this.projectionMatrix=new Ze,this.projectionMatrixInverse=new Ze}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return(new this.constructor).copy(this)}}class In extends zv{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=2*Du*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(.5*Ro*this.fov);return.5*this.getFilmHeight()/e}getEffectiveFOV(){return 2*Du*Math.atan(Math.tan(.5*Ro*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}setViewOffset(e,t,i,r,s,o){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(.5*Ro*this.fov)/this.zoom,i=2*t,r=this.aspect*i,s=-.5*r;const o=this.view;if(null!==this.view&&this.view.enabled){const l=o.fullWidth,c=o.fullHeight;s+=o.offsetX*r/l,t-=o.offsetY*i/c,r*=o.width/l,i*=o.height/c}const a=this.filmOffset;0!==a&&(s+=e*a/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+r,t,t-i,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}class P6 extends bi{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i;const r=new In(-90,1,e,t);r.layers=this.layers,r.up.set(0,1,0),r.lookAt(1,0,0),this.add(r);const s=new In(-90,1,e,t);s.layers=this.layers,s.up.set(0,1,0),s.lookAt(-1,0,0),this.add(s);const o=new In(-90,1,e,t);o.layers=this.layers,o.up.set(0,0,-1),o.lookAt(0,1,0),this.add(o);const a=new In(-90,1,e,t);a.layers=this.layers,a.up.set(0,0,1),a.lookAt(0,-1,0),this.add(a);const l=new In(-90,1,e,t);l.layers=this.layers,l.up.set(0,1,0),l.lookAt(0,0,1),this.add(l);const c=new In(-90,1,e,t);c.layers=this.layers,c.up.set(0,1,0),c.lookAt(0,0,-1),this.add(c)}update(e,t){null===this.parent&&this.updateMatrixWorld();const i=this.renderTarget,[r,s,o,a,l,c]=this.children,u=e.getRenderTarget(),d=e.toneMapping,h=e.xr.enabled;e.toneMapping=0,e.xr.enabled=!1;const f=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0),e.render(t,r),e.setRenderTarget(i,1),e.render(t,s),e.setRenderTarget(i,2),e.render(t,o),e.setRenderTarget(i,3),e.render(t,a),e.setRenderTarget(i,4),e.render(t,l),i.texture.generateMipmaps=f,e.setRenderTarget(i,5),e.render(t,c),e.setRenderTarget(u),e.toneMapping=d,e.xr.enabled=h,i.texture.needsPMREMUpdate=!0}}class rp extends ns{constructor(e,t,i,r,s,o,a,l,c,u){super(e=void 0!==e?e:[],t=void 0!==t?t:301,i,r,s,o,a,l,c,u),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class R6 extends No{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1};this.texture=new rp([i,i,i,i,i,i],t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.encoding),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=void 0!==t.generateMipmaps&&t.generateMipmaps,this.texture.minFilter=void 0!==t.minFilter?t.minFilter:an}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i_uniforms={tEquirect:{value:null}},i_vertexShader="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",i_fragmentShader="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",r=new Hs(5,5,5),s=new Gs({name:"CubemapFromEquirect",uniforms:Cl(i_uniforms),vertexShader:i_vertexShader,fragmentShader:i_fragmentShader,side:1,blending:0});s.uniforms.tEquirect.value=t;const o=new Bn(r,s),a=t.minFilter;return 1008===t.minFilter&&(t.minFilter=an),new P6(1,10,this).update(e,o),t.minFilter=a,o.geometry.dispose(),o.material.dispose(),this}clear(e,t,i,r){const s=e.getRenderTarget();for(let o=0;o<6;o++)e.setRenderTarget(this,o),e.clear(t,i,r);e.setRenderTarget(s)}}const Vv=new E,L6=new E,N6=new ai;class Ws{constructor(e=new E(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=Vv.subVectors(i,t).cross(L6.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}intersectLine(e,t){const i=e.delta(Vv),r=this.normal.dot(i);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/r;return s<0||s>1?null:t.copy(i).multiplyScalar(s).add(e.start)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||N6.getNormalMatrix(e),r=this.coplanarPoint(Vv).applyMatrix4(e),s=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return(new this.constructor).copy(this)}}const Al=new vl,sp=new E;class Hv{constructor(e=new Ws,t=new Ws,i=new Ws,r=new Ws,s=new Ws,o=new Ws){this.planes=[e,t,i,r,s,o]}set(e,t,i,r,s,o){const a=this.planes;return a[0].copy(e),a[1].copy(t),a[2].copy(i),a[3].copy(r),a[4].copy(s),a[5].copy(o),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e){const t=this.planes,i=e.elements,r=i[0],s=i[1],o=i[2],a=i[3],l=i[4],c=i[5],u=i[6],d=i[7],h=i[8],f=i[9],p=i[10],g=i[11],m=i[12],y=i[13],b=i[14],_=i[15];return t[0].setComponents(a-r,d-l,g-h,_-m).normalize(),t[1].setComponents(a+r,d+l,g+h,_+m).normalize(),t[2].setComponents(a+s,d+c,g+f,_+y).normalize(),t[3].setComponents(a-s,d-c,g-f,_-y).normalize(),t[4].setComponents(a-o,d-u,g-p,_-b).normalize(),t[5].setComponents(a+o,d+u,g+p,_+b).normalize(),this}intersectsObject(e){const t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),Al.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Al)}intersectsSprite(e){return Al.center.set(0,0,0),Al.radius=.7071067811865476,Al.applyMatrix4(e.matrixWorld),this.intersectsSphere(Al)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if(sp.x=r.normal.x>0?e.max.x:e.min.x,sp.y=r.normal.y>0?e.max.y:e.min.y,sp.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(sp)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return(new this.constructor).copy(this)}}function DA(){let n=null,e=!1,t=null,i=null;function r(s,o){t(s,o),i=n.requestAnimationFrame(r)}return{start:function(){!0!==e&&null!==t&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){n=s}}}function O6(n,e){const t=e.isWebGL2,i=new WeakMap;return{get:function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),i.get(c)},remove:function a(c){c.isInterleavedBufferAttribute&&(c=c.data);const u=i.get(c);u&&(n.deleteBuffer(u.buffer),i.delete(c))},update:function l(c,u){if(c.isGLBufferAttribute){const h=i.get(c);return void((!h||h.version<c.version)&&i.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version}))}c.isInterleavedBufferAttribute&&(c=c.data);const d=i.get(c);void 0===d?i.set(c,function r(c,u){const d=c.array,h=c.usage,f=n.createBuffer();let p;if(n.bindBuffer(u,f),n.bufferData(u,d,h),c.onUploadCallback(),d instanceof Float32Array)p=5126;else if(d instanceof Uint16Array)if(c.isFloat16BufferAttribute){if(!t)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");p=5131}else p=5123;else if(d instanceof Int16Array)p=5122;else if(d instanceof Uint32Array)p=5125;else if(d instanceof Int32Array)p=5124;else if(d instanceof Int8Array)p=5120;else if(d instanceof Uint8Array)p=5121;else{if(!(d instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);p=5121}return{buffer:f,type:p,bytesPerElement:d.BYTES_PER_ELEMENT,version:c.version}}(c,u)):d.version<c.version&&(function s(c,u,d){const h=u.array,f=u.updateRange;n.bindBuffer(d,c),-1===f.count?n.bufferSubData(d,0,h):(t?n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h,f.offset,f.count):n.bufferSubData(d,f.offset*h.BYTES_PER_ELEMENT,h.subarray(f.offset,f.offset+f.count)),f.count=-1),u.onUploadCallback()}(d.buffer,c,u),d.version=c.version)}}}class op extends ot{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const s=e/2,o=t/2,a=Math.floor(i),l=Math.floor(r),c=a+1,u=l+1,d=e/a,h=t/l,f=[],p=[],g=[],m=[];for(let y=0;y<u;y++){const b=y*h-o;for(let _=0;_<c;_++)p.push(_*d-s,-b,0),g.push(0,0,1),m.push(_/a),m.push(1-y/l)}for(let y=0;y<l;y++)for(let b=0;b<a;b++){const v=b+c*(y+1),S=b+1+c*(y+1),M=b+1+c*y;f.push(b+c*y,v,M),f.push(v,S,M)}this.setIndex(f),this.setAttribute("position",new Te(p,3)),this.setAttribute("normal",new Te(g,3)),this.setAttribute("uv",new Te(m,2))}static fromJSON(e){return new op(e.width,e.height,e.widthSegments,e.heightSegments)}}const nt={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\n\tvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\t\tfloat alpha = pow2( roughness );\n\t\tvec3 halfDir = normalize( lightDir + viewDir );\n\t\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\t\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\t\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\t\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\t\tvec3 F = mix( F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence );\n\t\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\t\tfloat D = D_GGX( alpha, dotNH );\n\t\treturn F * ( V * D );\n\t}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\n\tconst mat3 XYZ_TO_REC709 = mat3(\n\t\t 3.2404542, -0.9692660,  0.0556434,\n\t\t-1.5371385,  1.8760108, -0.2040259,\n\t\t-0.4985314,  0.0415560,  1.0572252\n\t);\n\tvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n\t\tvec3 sqrtF0 = sqrt( fresnel0 );\n\t\treturn ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n\t}\n\tvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n\t}\n\tfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n\t\treturn pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n\t}\n\tvec3 evalSensitivity( float OPD, vec3 shift ) {\n\t\tfloat phase = 2.0 * PI * OPD * 1.0e-9;\n\t\tvec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n\t\tvec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n\t\tvec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n\t\tvec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );\n\t\txyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );\n\t\txyz /= 1.0685e-7;\n\t\tvec3 rgb = XYZ_TO_REC709 * xyz;\n\t\treturn rgb;\n\t}\n\tvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n\t\tvec3 I;\n\t\tfloat iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n\t\tfloat sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n\t\tfloat cosTheta2Sq = 1.0 - sinTheta2Sq;\n\t\tif ( cosTheta2Sq < 0.0 ) {\n\t\t\t return vec3( 1.0 );\n\t\t}\n\t\tfloat cosTheta2 = sqrt( cosTheta2Sq );\n\t\tfloat R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n\t\tfloat R12 = F_Schlick( R0, 1.0, cosTheta1 );\n\t\tfloat R21 = R12;\n\t\tfloat T121 = 1.0 - R12;\n\t\tfloat phi12 = 0.0;\n\t\tif ( iridescenceIOR < outsideIOR ) phi12 = PI;\n\t\tfloat phi21 = PI - phi12;\n\t\tvec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );\t\tvec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n\t\tvec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n\t\tvec3 phi23 = vec3( 0.0 );\n\t\tif ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;\n\t\tif ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;\n\t\tif ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;\n\t\tfloat OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n\t\tvec3 phi = vec3( phi21 ) + phi23;\n\t\tvec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n\t\tvec3 r123 = sqrt( R123 );\n\t\tvec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n\t\tvec3 C0 = R12 + Rs;\n\t\tI = C0;\n\t\tvec3 Cm = Rs - T121;\n\t\tfor ( int m = 1; m <= 2; ++ m ) {\n\t\t\tCm *= r123;\n\t\t\tvec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n\t\t\tI += Cm * Sm;\n\t\t}\n\t\treturn max( I, vec3( 0.0 ) );\n\t}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = dFdx( surf_pos.xyz );\n\t\tvec3 vSigmaY = dFdy( surf_pos.xyz );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat luminance( const in vec3 rgb ) {\n\tconst vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );\n\treturn dot( weights, rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define cubeUV_r0 1.0\n\t#define cubeUV_v0 0.339\n\t#define cubeUV_m0 - 2.0\n\t#define cubeUV_r1 0.8\n\t#define cubeUV_v1 0.276\n\t#define cubeUV_m1 - 1.0\n\t#define cubeUV_r4 0.4\n\t#define cubeUV_v4 0.046\n\t#define cubeUV_m4 2.0\n\t#define cubeUV_r5 0.305\n\t#define cubeUV_v5 0.016\n\t#define cubeUV_m5 3.0\n\t#define cubeUV_r6 0.21\n\t#define cubeUV_v6 0.0038\n\t#define cubeUV_m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= cubeUV_r1 ) {\n\t\t\tmip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;\n\t\t} else if ( roughness >= cubeUV_r4 ) {\n\t\t\tmip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;\n\t\t} else if ( roughness >= cubeUV_r5 ) {\n\t\t\tmip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;\n\t\t} else if ( roughness >= cubeUV_r6 ) {\n\t\t\tmip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\tvec2 fw = fwidth( coord ) * 0.5;\n\t\treturn mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_fragment:"LambertMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularStrength = specularStrength;",lights_lambert_pars_fragment:"varying vec3 vViewPosition;\nstruct LambertMaterial {\n\tvec3 diffuseColor;\n\tfloat specularStrength;\n};\nvoid RE_Direct_Lambert( const in IncidentLight directLight, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in GeometricContext geometry, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Lambert\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Lambert",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\tmaterial.ior = ior;\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n\t#ifdef IOR\n\t\tfloat ior;\n\t#endif\n\t#ifdef USE_TRANSMISSION\n\t\tfloat transmission;\n\t\tfloat transmissionAlpha;\n\t\tfloat thickness;\n\t\tfloat attenuationDistance;\n\t\tvec3 attenuationColor;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\n\tfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\n\tif ( material.iridescenceThickness == 0.0 ) {\n\t\tmaterial.iridescence = 0.0;\n\t} else {\n\t\tmaterial.iridescence = saturate( material.iridescence );\n\t}\n\tif ( material.iridescence > 0.0 ) {\n\t\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\t\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n\t}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\tvec4 spotColor;\n\tvec3 spotLightCoord;\n\tbool inSpotLightMap;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX\n\t\t#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS\n\t\t#else\n\t\t#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )\n\t\t#endif\n\t\t#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )\n\t\t\tspotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;\n\t\t\tinSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );\n\t\t\tspotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );\n\t\t\tdirectLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;\n\t\t#endif\n\t\t#undef SPOT_LIGHT_MAP_INDEX\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = dFdx( vViewPosition );\n\tvec3 fdy = dFdy( vViewPosition );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = dFdx( eye_pos.xyz );\n\t\tvec3 q1 = dFdy( eye_pos.xyz );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= material.transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec2 packDepthToRG( in highp float v ) {\n\treturn packDepthToRGBA( v ).yx;\n}\nfloat unpackRGToDepth( const in highp vec2 v ) {\n\treturn unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#if NUM_SPOT_LIGHT_COORDS > 0\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#if NUM_SPOT_LIGHT_MAPS > 0\n  uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#if NUM_SPOT_LIGHT_COORDS > 0\n  uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];\n  varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];\n#endif\n#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#if defined( USE_SHADOWMAP ) || ( NUM_SPOT_LIGHT_COORDS > 0 )\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_COORDS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_COORDS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition;\n\t\t#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\t\tshadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;\n\t\t#endif\n\t\tvSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tmaterial.transmission = transmission;\n\tmaterial.transmissionAlpha = 1.0;\n\tmaterial.thickness = thickness;\n\tmaterial.attenuationDistance = attenuationDistance;\n\tmaterial.attenuationColor = attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tmaterial.transmission *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tmaterial.thickness *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,\n\t\tmaterial.attenuationColor, material.attenuationDistance );\n\tmaterial.transmissionAlpha = mix( material.transmissionAlpha, transmission.a, material.transmission );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, material.transmission );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( isinf( attenuationDistance ) ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nuniform float backgroundIntensity;\nvarying vec2 vUv;\nvoid main() {\n\tvec4 texColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\ttexColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",backgroundCube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",backgroundCube_frag:"#ifdef ENVMAP_TYPE_CUBE\n\tuniform samplerCube envMap;\n#elif defined( ENVMAP_TYPE_CUBE_UV )\n\tuniform sampler2D envMap;\n#endif\nuniform float flipEnvMap;\nuniform float backgroundBlurriness;\nuniform float backgroundIntensity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 texColor = textureCube( envMap, vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 texColor = textureCubeUV( envMap, vWorldDirection, backgroundBlurriness );\n\t#else\n\t\tvec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t#endif\n\ttexColor.rgb *= backgroundIntensity;\n\tgl_FragColor = texColor;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"uniform samplerCube tCube;\nuniform float tFlip;\nuniform float opacity;\nvarying vec3 vWorldDirection;\nvoid main() {\n\tvec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );\n\tgl_FragColor = texColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"#define LAMBERT\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_lambert_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_lambert_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},he={common:{diffuse:{value:new we(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new ai},uv2Transform:{value:new ai},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new K(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new we(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new we(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ai}},sprite:{diffuse:{value:new we(16777215)},opacity:{value:1},center:{value:new K(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new ai}}},wr={basic:{uniforms:Qn([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.fog]),vertexShader:nt.meshbasic_vert,fragmentShader:nt.meshbasic_frag},lambert:{uniforms:Qn([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.fog,he.lights,{emissive:{value:new we(0)}}]),vertexShader:nt.meshlambert_vert,fragmentShader:nt.meshlambert_frag},phong:{uniforms:Qn([he.common,he.specularmap,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.fog,he.lights,{emissive:{value:new we(0)},specular:{value:new we(1118481)},shininess:{value:30}}]),vertexShader:nt.meshphong_vert,fragmentShader:nt.meshphong_frag},standard:{uniforms:Qn([he.common,he.envmap,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.roughnessmap,he.metalnessmap,he.fog,he.lights,{emissive:{value:new we(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:nt.meshphysical_vert,fragmentShader:nt.meshphysical_frag},toon:{uniforms:Qn([he.common,he.aomap,he.lightmap,he.emissivemap,he.bumpmap,he.normalmap,he.displacementmap,he.gradientmap,he.fog,he.lights,{emissive:{value:new we(0)}}]),vertexShader:nt.meshtoon_vert,fragmentShader:nt.meshtoon_frag},matcap:{uniforms:Qn([he.common,he.bumpmap,he.normalmap,he.displacementmap,he.fog,{matcap:{value:null}}]),vertexShader:nt.meshmatcap_vert,fragmentShader:nt.meshmatcap_frag},points:{uniforms:Qn([he.points,he.fog]),vertexShader:nt.points_vert,fragmentShader:nt.points_frag},dashed:{uniforms:Qn([he.common,he.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:nt.linedashed_vert,fragmentShader:nt.linedashed_frag},depth:{uniforms:Qn([he.common,he.displacementmap]),vertexShader:nt.depth_vert,fragmentShader:nt.depth_frag},normal:{uniforms:Qn([he.common,he.bumpmap,he.normalmap,he.displacementmap,{opacity:{value:1}}]),vertexShader:nt.meshnormal_vert,fragmentShader:nt.meshnormal_frag},sprite:{uniforms:Qn([he.sprite,he.fog]),vertexShader:nt.sprite_vert,fragmentShader:nt.sprite_frag},background:{uniforms:{uvTransform:{value:new ai},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:nt.background_vert,fragmentShader:nt.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1}},vertexShader:nt.backgroundCube_vert,fragmentShader:nt.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:nt.cube_vert,fragmentShader:nt.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:nt.equirect_vert,fragmentShader:nt.equirect_frag},distanceRGBA:{uniforms:Qn([he.common,he.displacementmap,{referencePosition:{value:new E},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:nt.distanceRGBA_vert,fragmentShader:nt.distanceRGBA_frag},shadow:{uniforms:Qn([he.lights,he.fog,{color:{value:new we(0)},opacity:{value:1}}]),vertexShader:nt.shadow_vert,fragmentShader:nt.shadow_frag}};wr.physical={uniforms:Qn([wr.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new K(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new we(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new K},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new we(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new we(1,1,1)},specularColorMap:{value:null}}]),vertexShader:nt.meshphysical_vert,fragmentShader:nt.meshphysical_frag};const ap={r:0,b:0,g:0};function N$(n,e,t,i,r,s,o){const a=new we(0);let c,u,l=!0===s?0:1,d=null,h=0,f=null;function g(m,y){m.getRGB(ap,CA(n)),i.buffers.color.setClear(ap.r,ap.g,ap.b,y,o)}return{getClearColor:function(){return a},setClearColor:function(m,y=1){a.set(m),l=y,g(a,l)},getClearAlpha:function(){return l},setClearAlpha:function(m){l=m,g(a,l)},render:function p(m,y){let b=!1,_=!0===y.isScene?y.background:null;_&&_.isTexture&&(_=(y.backgroundBlurriness>0?t:e).get(_));const v=n.xr,S=v.getSession&&v.getSession();S&&"additive"===S.environmentBlendMode&&(_=null),null===_?g(a,l):_&&_.isColor&&(g(_,1),b=!0),(n.autoClear||b)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),_&&(_.isCubeTexture||306===_.mapping)?(void 0===u&&(u=new Bn(new Hs(1,1,1),new Gs({name:"BackgroundCubeMaterial",uniforms:Cl(wr.backgroundCube.uniforms),vertexShader:wr.backgroundCube.vertexShader,fragmentShader:wr.backgroundCube.fragmentShader,side:1,depthTest:!1,depthWrite:!1,fog:!1})),u.geometry.deleteAttribute("normal"),u.geometry.deleteAttribute("uv"),u.onBeforeRender=function(M,I,x){this.matrixWorld.copyPosition(x.matrixWorld)},Object.defineProperty(u.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(u)),u.material.uniforms.envMap.value=_,u.material.uniforms.flipEnvMap.value=_.isCubeTexture&&!1===_.isRenderTargetTexture?-1:1,u.material.uniforms.backgroundBlurriness.value=y.backgroundBlurriness,u.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,(d!==_||h!==_.version||f!==n.toneMapping)&&(u.material.needsUpdate=!0,d=_,h=_.version,f=n.toneMapping),u.layers.enableAll(),m.unshift(u,u.geometry,u.material,0,0,null)):_&&_.isTexture&&(void 0===c&&(c=new Bn(new op(2,2),new Gs({name:"BackgroundMaterial",uniforms:Cl(wr.background.uniforms),vertexShader:wr.background.vertexShader,fragmentShader:wr.background.fragmentShader,side:0,depthTest:!1,depthWrite:!1,fog:!1})),c.geometry.deleteAttribute("normal"),Object.defineProperty(c.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(c)),c.material.uniforms.t2D.value=_,c.material.uniforms.backgroundIntensity.value=y.backgroundIntensity,!0===_.matrixAutoUpdate&&_.updateMatrix(),c.material.uniforms.uvTransform.value.copy(_.matrix),(d!==_||h!==_.version||f!==n.toneMapping)&&(c.material.needsUpdate=!0,d=_,h=_.version,f=n.toneMapping),c.layers.enableAll(),m.unshift(c,c.geometry,c.material,0,0,null))}}}function O$(n,e,t,i){const r=n.getParameter(34921),s=i.isWebGL2?null:e.get("OES_vertex_array_object"),o=i.isWebGL2||null!==s,a={},l=m(null);let c=l,u=!1;function f(L){return i.isWebGL2?n.bindVertexArray(L):s.bindVertexArrayOES(L)}function p(L){return i.isWebGL2?n.deleteVertexArray(L):s.deleteVertexArrayOES(L)}function m(L){const j=[],N=[],U=[];for(let O=0;O<r;O++)j[O]=0,N[O]=0,U[O]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:j,enabledAttributes:N,attributeDivisors:U,object:L,attributes:{},index:null}}function _(){const L=c.newAttributes;for(let j=0,N=L.length;j<N;j++)L[j]=0}function v(L){S(L,0)}function S(L,j){const U=c.enabledAttributes,O=c.attributeDivisors;c.newAttributes[L]=1,0===U[L]&&(n.enableVertexAttribArray(L),U[L]=1),O[L]!==j&&((i.isWebGL2?n:e.get("ANGLE_instanced_arrays"))[i.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](L,j),O[L]=j)}function M(){const L=c.newAttributes,j=c.enabledAttributes;for(let N=0,U=j.length;N<U;N++)j[N]!==L[N]&&(n.disableVertexAttribArray(N),j[N]=0)}function I(L,j,N,U,O,$){!0!==i.isWebGL2||5124!==N&&5125!==N?n.vertexAttribPointer(L,j,N,U,O,$):n.vertexAttribIPointer(L,j,N,O,$)}function ne(){z(),u=!0,c!==l&&(c=l,f(c.object))}function z(){l.geometry=null,l.program=null,l.wireframe=!1}return{setup:function d(L,j,N,U,O){let $=!1;if(o){const q=function g(L,j,N){const U=!0===N.wireframe;let O=a[L.id];void 0===O&&(O={},a[L.id]=O);let $=O[j.id];void 0===$&&($={},O[j.id]=$);let q=$[U];return void 0===q&&(q=m(function h(){return i.isWebGL2?n.createVertexArray():s.createVertexArrayOES()}()),$[U]=q),q}(U,N,j);c!==q&&(c=q,f(c.object)),$=function y(L,j,N,U){const O=c.attributes,$=j.attributes;let q=0;const G=N.getAttributes();for(const H in G)if(G[H].location>=0){const te=O[H];let ue=$[H];if(void 0===ue&&("instanceMatrix"===H&&L.instanceMatrix&&(ue=L.instanceMatrix),"instanceColor"===H&&L.instanceColor&&(ue=L.instanceColor)),void 0===te||te.attribute!==ue||ue&&te.data!==ue.data)return!0;q++}return c.attributesNum!==q||c.index!==U}(L,U,N,O),$&&function b(L,j,N,U){const O={},$=j.attributes;let q=0;const G=N.getAttributes();for(const H in G)if(G[H].location>=0){let te=$[H];void 0===te&&("instanceMatrix"===H&&L.instanceMatrix&&(te=L.instanceMatrix),"instanceColor"===H&&L.instanceColor&&(te=L.instanceColor));const ue={};ue.attribute=te,te&&te.data&&(ue.data=te.data),O[H]=ue,q++}c.attributes=O,c.attributesNum=q,c.index=U}(L,U,N,O)}else{const q=!0===j.wireframe;(c.geometry!==U.id||c.program!==N.id||c.wireframe!==q)&&(c.geometry=U.id,c.program=N.id,c.wireframe=q,$=!0)}null!==O&&t.update(O,34963),($||u)&&(u=!1,function x(L,j,N,U){if(!1===i.isWebGL2&&(L.isInstancedMesh||U.isInstancedBufferGeometry)&&null===e.get("ANGLE_instanced_arrays"))return;_();const O=U.attributes,$=N.getAttributes(),q=j.defaultAttributeValues;for(const G in $){const H=$[G];if(H.location>=0){let oe=O[G];if(void 0===oe&&("instanceMatrix"===G&&L.instanceMatrix&&(oe=L.instanceMatrix),"instanceColor"===G&&L.instanceColor&&(oe=L.instanceColor)),void 0!==oe){const te=oe.normalized,ue=oe.itemSize,Y=t.get(oe);if(void 0===Y)continue;const Me=Y.buffer,ye=Y.type,Ce=Y.bytesPerElement;if(oe.isInterleavedBufferAttribute){const de=oe.data,We=de.stride,ee=oe.offset;if(de.isInstancedInterleavedBuffer){for(let J=0;J<H.locationSize;J++)S(H.location+J,de.meshPerAttribute);!0!==L.isInstancedMesh&&void 0===U._maxInstanceCount&&(U._maxInstanceCount=de.meshPerAttribute*de.count)}else for(let J=0;J<H.locationSize;J++)v(H.location+J);n.bindBuffer(34962,Me);for(let J=0;J<H.locationSize;J++)I(H.location+J,ue/H.locationSize,ye,te,We*Ce,(ee+ue/H.locationSize*J)*Ce)}else{if(oe.isInstancedBufferAttribute){for(let de=0;de<H.locationSize;de++)S(H.location+de,oe.meshPerAttribute);!0!==L.isInstancedMesh&&void 0===U._maxInstanceCount&&(U._maxInstanceCount=oe.meshPerAttribute*oe.count)}else for(let de=0;de<H.locationSize;de++)v(H.location+de);n.bindBuffer(34962,Me);for(let de=0;de<H.locationSize;de++)I(H.location+de,ue/H.locationSize,ye,te,ue*Ce,ue/H.locationSize*de*Ce)}}else if(void 0!==q){const te=q[G];if(void 0!==te)switch(te.length){case 2:n.vertexAttrib2fv(H.location,te);break;case 3:n.vertexAttrib3fv(H.location,te);break;case 4:n.vertexAttrib4fv(H.location,te);break;default:n.vertexAttrib1fv(H.location,te)}}}}M()}(L,j,N,U),null!==O&&n.bindBuffer(34963,t.get(O).buffer))},reset:ne,resetDefaultState:z,dispose:function D(){ne();for(const L in a){const j=a[L];for(const N in j){const U=j[N];for(const O in U)p(U[O].object),delete U[O];delete j[N]}delete a[L]}},releaseStatesOfGeometry:function P(L){if(void 0===a[L.id])return;const j=a[L.id];for(const N in j){const U=j[N];for(const O in U)p(U[O].object),delete U[O];delete j[N]}delete a[L.id]},releaseStatesOfProgram:function V(L){for(const j in a){const N=a[j];if(void 0===N[L.id])continue;const U=N[L.id];for(const O in U)p(U[O].object),delete U[O];delete N[L.id]}},initAttributes:_,enableAttribute:v,disableUnusedAttributes:M}}function F$(n,e,t,i){const r=i.isWebGL2;let s;this.setMode=function o(c){s=c},this.render=function a(c,u){n.drawArrays(s,c,u),t.update(u,s,1)},this.renderInstances=function l(c,u,d){if(0===d)return;let h,f;if(r)h=n,f="drawArraysInstanced";else if(h=e.get("ANGLE_instanced_arrays"),f="drawArraysInstancedANGLE",null===h)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");h[f](s,c,u,d),t.update(u,s,d)}}function k$(n,e,t){let i;function s(I){if("highp"===I){if(n.getShaderPrecisionFormat(35633,36338).precision>0&&n.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";I="mediump"}return"mediump"===I&&n.getShaderPrecisionFormat(35633,36337).precision>0&&n.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}const o=typeof WebGL2RenderingContext<"u"&&n instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&n instanceof WebGL2ComputeRenderingContext;let a=void 0!==t.precision?t.precision:"highp";const l=s(a);l!==a&&(console.warn("THREE.WebGLRenderer:",a,"not supported, using",l,"instead."),a=l);const c=o||e.has("WEBGL_draw_buffers"),u=!0===t.logarithmicDepthBuffer,d=n.getParameter(34930),h=n.getParameter(35660),f=n.getParameter(3379),p=n.getParameter(34076),g=n.getParameter(34921),m=n.getParameter(36347),y=n.getParameter(36348),b=n.getParameter(36349),_=h>0,v=o||e.has("OES_texture_float");return{isWebGL2:o,drawBuffers:c,getMaxAnisotropy:function r(){if(void 0!==i)return i;if(!0===e.has("EXT_texture_filter_anisotropic")){const I=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(I.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i},getMaxPrecision:s,precision:a,logarithmicDepthBuffer:u,maxTextures:d,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:p,maxAttributes:g,maxVertexUniforms:m,maxVaryings:y,maxFragmentUniforms:b,vertexTextures:_,floatFragmentTextures:v,floatVertexTextures:_&&v,maxSamples:o?n.getParameter(36183):0}}function B$(n){const e=this;let t=null,i=0,r=!1,s=!1;const o=new Ws,a=new ai,l={value:null,needsUpdate:!1};function c(){l.value!==t&&(l.value=t,l.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function u(d,h,f,p){const g=null!==d?d.length:0;let m=null;if(0!==g){if(m=l.value,!0!==p||null===m){const y=f+4*g,b=h.matrixWorldInverse;a.getNormalMatrix(b),(null===m||m.length<y)&&(m=new Float32Array(y));for(let _=0,v=f;_!==g;++_,v+=4)o.copy(d[_]).applyMatrix4(b,a),o.normal.toArray(m,v),m[v+3]=o.constant}l.value=m,l.needsUpdate=!0}return e.numPlanes=g,e.numIntersection=0,m}this.uniform=l,this.numPlanes=0,this.numIntersection=0,this.init=function(d,h,f){const p=0!==d.length||h||0!==i||r;return r=h,t=u(d,f,0),i=d.length,p},this.beginShadows=function(){s=!0,u(null)},this.endShadows=function(){s=!1,c()},this.setState=function(d,h,f){const p=d.clippingPlanes,g=d.clipIntersection,m=d.clipShadows,y=n.get(d);if(!r||null===p||0===p.length||s&&!m)s?u(null):c();else{const b=s?0:i,_=4*b;let v=y.clippingState||null;l.value=v,v=u(p,h,_,f);for(let S=0;S!==_;++S)v[S]=t[S];y.clippingState=v,this.numIntersection=g?this.numPlanes:0,this.numPlanes+=b}}}function U$(n){let e=new WeakMap;function t(o,a){return 303===a?o.mapping=301:304===a&&(o.mapping=302),o}function r(o){const a=o.target;a.removeEventListener("dispose",r);const l=e.get(a);void 0!==l&&(e.delete(a),l.dispose())}return{get:function i(o){if(o&&o.isTexture&&!1===o.isRenderTargetTexture){const a=o.mapping;if(303===a||304===a){if(e.has(o))return t(e.get(o).texture,o.mapping);{const l=o.image;if(l&&l.height>0){const c=new R6(l.height/2);return c.fromEquirectangularTexture(n,o),e.set(o,c),o.addEventListener("dispose",r),t(c.texture,o.mapping)}return null}}}return o},dispose:function s(){e=new WeakMap}}}class Gv extends zv{constructor(e=-1,t=1,i=1,r=-1,s=.1,o=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=s,this.far=o,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,s,o){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=s,this.view.height=o,this.updateProjectionMatrix()}clearViewOffset(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let s=i-e,o=i+e,a=r+t,l=r-t;if(null!==this.view&&this.view.enabled){const c=(this.right-this.left)/this.view.fullWidth/this.zoom,u=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=c*this.view.offsetX,o=s+c*this.view.width,a-=u*this.view.offsetY,l=a-u*this.view.height}this.projectionMatrix.makeOrthographic(s,o,a,l,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}const TA=[.125,.215,.35,.446,.526,.582],Wv=new Gv,AA=new we;let jv=null;const zo=(1+Math.sqrt(5))/2,Pl=1/zo,IA=[new E(1,1,1),new E(-1,1,1),new E(1,1,-1),new E(-1,1,-1),new E(0,zo,Pl),new E(0,zo,-Pl),new E(Pl,0,zo),new E(-Pl,0,zo),new E(zo,Pl,0),new E(-zo,Pl,0)];class PA{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){jv=this._renderer.getRenderTarget(),this._setSize(256);const s=this._allocateTargets();return s.depthBuffer=!0,this._sceneToCubeUV(e,i,r,s),t>0&&this._blur(s,0,0,t),this._applyPMREM(s),this._cleanup(s),s}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){null===this._cubemapMaterial&&(this._cubemapMaterial=NA(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){null===this._equirectMaterial&&(this._equirectMaterial=LA(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(jv),e.scissorTest=!1,lp(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSize(301===e.mapping||302===e.mapping?0===e.image.length?16:e.image[0].width||e.image[0].image.width:e.image.width/4),jv=this._renderer.getRenderTarget();const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:an,minFilter:an,generateMipmaps:!1,type:Eu,format:Bi,encoding:Io,depthBuffer:!1},r=RA(e,t,i);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=RA(e,t,i);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=function z$(n){const e=[],t=[],i=[];let r=n;const s=n-4+1+TA.length;for(let o=0;o<s;o++){const a=Math.pow(2,r);t.push(a);let l=1/a;o>n-4?l=TA[o-n+4-1]:0===o&&(l=0),i.push(l);const c=1/(a-2),u=-c,d=1+c,h=[u,u,d,u,d,d,u,u,d,d,u,d],f=6,p=6,g=3,m=2,y=1,b=new Float32Array(g*p*f),_=new Float32Array(m*p*f),v=new Float32Array(y*p*f);for(let M=0;M<f;M++){const I=M%3*2/3-1,x=M>2?0:-1;b.set([I,x,0,I+2/3,x,0,I+2/3,x+1,0,I,x,0,I+2/3,x+1,0,I,x+1,0],g*p*M),_.set(h,m*p*M),v.set([M,M,M,M,M,M],y*p*M)}const S=new ot;S.setAttribute("position",new wn(b,g)),S.setAttribute("uv",new wn(_,m)),S.setAttribute("faceIndex",new wn(v,y)),e.push(S),r>4&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}(s)),this._blurMaterial=function V$(n,e,t){const i=new Float32Array(20),r=new E(0,1,0);return new Gs({name:"SphericalGaussianBlur",defines:{n:20,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}(s,e,t)}return r}_compileMaterial(e){const t=new Bn(this._lodPlanes[0],e);this._renderer.compile(t,Wv)}_sceneToCubeUV(e,t,i,r){const a=new In(90,1,t,i),l=[1,-1,1,1,1,1],c=[1,1,1,-1,-1,-1],u=this._renderer,d=u.autoClear,h=u.toneMapping;u.getClearColor(AA),u.toneMapping=0,u.autoClear=!1;const f=new ls({name:"PMREM.Background",side:1,depthWrite:!1,depthTest:!1}),p=new Bn(new Hs,f);let g=!1;const m=e.background;m?m.isColor&&(f.color.copy(m),e.background=null,g=!0):(f.color.copy(AA),g=!0);for(let y=0;y<6;y++){const b=y%3;0===b?(a.up.set(0,l[y],0),a.lookAt(c[y],0,0)):1===b?(a.up.set(0,0,l[y]),a.lookAt(0,c[y],0)):(a.up.set(0,l[y],0),a.lookAt(0,0,c[y]));const _=this._cubeSize;lp(r,b*_,y>2?_:0,_,_),u.setRenderTarget(r),g&&u.render(p,a),u.render(e,a)}p.geometry.dispose(),p.material.dispose(),u.toneMapping=h,u.autoClear=d,e.background=m}_textureToCubeUV(e,t){const i=this._renderer,r=301===e.mapping||302===e.mapping;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=NA()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=LA());const s=r?this._cubemapMaterial:this._equirectMaterial,o=new Bn(this._lodPlanes[0],s);s.uniforms.envMap.value=e;const l=this._cubeSize;lp(t,0,0,3*l,2*l),i.setRenderTarget(t),i.render(o,Wv)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const s=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]);this._blur(e,r-1,r,s,IA[(r-1)%IA.length])}t.autoClear=i}_blur(e,t,i,r,s){const o=this._pingPongRenderTarget;this._halfBlur(e,o,t,i,r,"latitudinal",s),this._halfBlur(o,e,i,i,r,"longitudinal",s)}_halfBlur(e,t,i,r,s,o,a){const l=this._renderer,c=this._blurMaterial;"latitudinal"!==o&&"longitudinal"!==o&&console.error("blur direction must be either latitudinal or longitudinal!");const d=new Bn(this._lodPlanes[r],c),h=c.uniforms,f=this._sizeLods[i]-1,p=isFinite(s)?Math.PI/(2*f):2*Math.PI/39,g=s/p,m=isFinite(s)?1+Math.floor(3*g):20;m>20&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${m} samples when the maximum is set to 20`);const y=[];let b=0;for(let I=0;I<20;++I){const x=I/g,D=Math.exp(-x*x/2);y.push(D),0===I?b+=D:I<m&&(b+=2*D)}for(let I=0;I<y.length;I++)y[I]=y[I]/b;h.envMap.value=e.texture,h.samples.value=m,h.weights.value=y,h.latitudinal.value="latitudinal"===o,a&&(h.poleAxis.value=a);const{_lodMax:_}=this;h.dTheta.value=p,h.mipInt.value=_-i;const v=this._sizeLods[r];lp(t,3*v*(r>_-4?r-_+4:0),4*(this._cubeSize-v),3*v,2*v),l.setRenderTarget(t),l.render(d,Wv)}}function RA(n,e,t){const i=new No(n,e,t);return i.texture.mapping=306,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function lp(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function LA(){return new Gs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function NA(){return new Gs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:0,depthTest:!1,depthWrite:!1})}function H$(n){let e=new WeakMap,t=null;function s(a){const l=a.target;l.removeEventListener("dispose",s);const c=e.get(l);void 0!==c&&(e.delete(l),c.dispose())}return{get:function i(a){if(a&&a.isTexture){const l=a.mapping,c=303===l||304===l,u=301===l||302===l;if(c||u){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;let d=e.get(a);return null===t&&(t=new PA(n)),d=c?t.fromEquirectangular(a,d):t.fromCubemap(a,d),e.set(a,d),d.texture}if(e.has(a))return e.get(a).texture;{const d=a.image;if(c&&d&&d.height>0||u&&d&&function r(a){let l=0;for(let u=0;u<6;u++)void 0!==a[u]&&l++;return 6===l}(d)){null===t&&(t=new PA(n));const h=c?t.fromEquirectangular(a):t.fromCubemap(a);return e.set(a,h),a.addEventListener("dispose",s),h.texture}return null}}}return a},dispose:function o(){e=new WeakMap,null!==t&&(t.dispose(),t=null)}}}function G$(n){const e={};function t(i){if(void 0!==e[i])return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return null!==t(i)},init:function(i){i.isWebGL2?t("EXT_color_buffer_float"):(t("WEBGL_depth_texture"),t("OES_texture_float"),t("OES_texture_half_float"),t("OES_texture_half_float_linear"),t("OES_standard_derivatives"),t("OES_element_index_uint"),t("OES_vertex_array_object"),t("ANGLE_instanced_arrays")),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture")},get:function(i){const r=t(i);return null===r&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function W$(n,e,t,i){const r={},s=new WeakMap;function o(d){const h=d.target;null!==h.index&&e.remove(h.index);for(const p in h.attributes)e.remove(h.attributes[p]);h.removeEventListener("dispose",o),delete r[h.id];const f=s.get(h);f&&(e.remove(f),s.delete(h)),i.releaseStatesOfGeometry(h),!0===h.isInstancedBufferGeometry&&delete h._maxInstanceCount,t.memory.geometries--}function c(d){const h=[],f=d.index,p=d.attributes.position;let g=0;if(null!==f){const b=f.array;g=f.version;for(let _=0,v=b.length;_<v;_+=3){const S=b[_+0],M=b[_+1],I=b[_+2];h.push(S,M,M,I,I,S)}}else{g=p.version;for(let _=0,v=p.array.length/3-1;_<v;_+=3){const S=_+0,M=_+1,I=_+2;h.push(S,M,M,I,I,S)}}const m=new(uA(h)?MA:wA)(h,1);m.version=g;const y=s.get(d);y&&e.remove(y),s.set(d,m)}return{get:function a(d,h){return!0===r[h.id]||(h.addEventListener("dispose",o),r[h.id]=!0,t.memory.geometries++),h},update:function l(d){const h=d.attributes;for(const p in h)e.update(h[p],34962);const f=d.morphAttributes;for(const p in f){const g=f[p];for(let m=0,y=g.length;m<y;m++)e.update(g[m],34962)}},getWireframeAttribute:function u(d){const h=s.get(d);if(h){const f=d.index;null!==f&&h.version<f.version&&c(d)}else c(d);return s.get(d)}}}function j$(n,e,t,i){const r=i.isWebGL2;let s,a,l;this.setMode=function o(h){s=h},this.setIndex=function c(h){a=h.type,l=h.bytesPerElement},this.render=function u(h,f){n.drawElements(s,f,a,h*l),t.update(f,s,1)},this.renderInstances=function d(h,f,p){if(0===p)return;let g,m;if(r)g=n,m="drawElementsInstanced";else if(g=e.get("ANGLE_instanced_arrays"),m="drawElementsInstancedANGLE",null===g)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");g[m](s,f,a,h*l,p),t.update(f,s,p)}}function $$(n){const t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function r(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function i(s,o,a){switch(t.calls++,o){case 4:t.triangles+=a*(s/3);break;case 1:t.lines+=a*(s/2);break;case 3:t.lines+=a*(s-1);break;case 2:t.lines+=a*s;break;case 0:t.points+=a*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",o)}}}}function q$(n,e){return n[0]-e[0]}function Y$(n,e){return Math.abs(e[1])-Math.abs(n[1])}function X$(n,e,t){const i={},r=new Float32Array(8),s=new WeakMap,o=new Dt,a=[];for(let c=0;c<8;c++)a[c]=[c,0];return{update:function l(c,u,d,h){const f=c.morphTargetInfluences;if(!0===e.isWebGL2){const p=u.morphAttributes.position||u.morphAttributes.normal||u.morphAttributes.color,g=void 0!==p?p.length:0;let m=s.get(u);if(void 0===m||m.count!==g){let j=function(){z.dispose(),s.delete(u),u.removeEventListener("dispose",j)};void 0!==m&&m.texture.dispose();const _=void 0!==u.morphAttributes.position,v=void 0!==u.morphAttributes.normal,S=void 0!==u.morphAttributes.color,M=u.morphAttributes.position||[],I=u.morphAttributes.normal||[],x=u.morphAttributes.color||[];let D=0;!0===_&&(D=1),!0===v&&(D=2),!0===S&&(D=3);let P=u.attributes.position.count*D,V=1;P>e.maxTextureSize&&(V=Math.ceil(P/e.maxTextureSize),P=e.maxTextureSize);const ne=new Float32Array(P*V*4*g),z=new xv(ne,P,V,g);z.type=Rs,z.needsUpdate=!0;const L=4*D;for(let N=0;N<g;N++){const U=M[N],O=I[N],$=x[N],q=P*V*4*N;for(let G=0;G<U.count;G++){const H=G*L;!0===_&&(o.fromBufferAttribute(U,G),ne[q+H+0]=o.x,ne[q+H+1]=o.y,ne[q+H+2]=o.z,ne[q+H+3]=0),!0===v&&(o.fromBufferAttribute(O,G),ne[q+H+4]=o.x,ne[q+H+5]=o.y,ne[q+H+6]=o.z,ne[q+H+7]=0),!0===S&&(o.fromBufferAttribute($,G),ne[q+H+8]=o.x,ne[q+H+9]=o.y,ne[q+H+10]=o.z,ne[q+H+11]=4===$.itemSize?o.w:1)}}m={count:g,texture:z,size:new K(P,V)},s.set(u,m),u.addEventListener("dispose",j)}let y=0;for(let _=0;_<f.length;_++)y+=f[_];const b=u.morphTargetsRelative?1:1-y;h.getUniforms().setValue(n,"morphTargetBaseInfluence",b),h.getUniforms().setValue(n,"morphTargetInfluences",f),h.getUniforms().setValue(n,"morphTargetsTexture",m.texture,t),h.getUniforms().setValue(n,"morphTargetsTextureSize",m.size)}else{const p=void 0===f?0:f.length;let g=i[u.id];if(void 0===g||g.length!==p){g=[];for(let v=0;v<p;v++)g[v]=[v,0];i[u.id]=g}for(let v=0;v<p;v++){const S=g[v];S[0]=v,S[1]=f[v]}g.sort(Y$);for(let v=0;v<8;v++)v<p&&g[v][1]?(a[v][0]=g[v][0],a[v][1]=g[v][1]):(a[v][0]=Number.MAX_SAFE_INTEGER,a[v][1]=0);a.sort(q$);const m=u.morphAttributes.position,y=u.morphAttributes.normal;let b=0;for(let v=0;v<8;v++){const S=a[v],M=S[0],I=S[1];M!==Number.MAX_SAFE_INTEGER&&I?(m&&u.getAttribute("morphTarget"+v)!==m[M]&&u.setAttribute("morphTarget"+v,m[M]),y&&u.getAttribute("morphNormal"+v)!==y[M]&&u.setAttribute("morphNormal"+v,y[M]),r[v]=I,b+=I):(m&&!0===u.hasAttribute("morphTarget"+v)&&u.deleteAttribute("morphTarget"+v),y&&!0===u.hasAttribute("morphNormal"+v)&&u.deleteAttribute("morphNormal"+v),r[v]=0)}const _=u.morphTargetsRelative?1:1-b;h.getUniforms().setValue(n,"morphTargetBaseInfluence",_),h.getUniforms().setValue(n,"morphTargetInfluences",r)}}}}function Z$(n,e,t,i){let r=new WeakMap;function a(l){const c=l.target;c.removeEventListener("dispose",a),t.remove(c.instanceMatrix),null!==c.instanceColor&&t.remove(c.instanceColor)}return{update:function s(l){const c=i.render.frame,d=e.get(l,l.geometry);return r.get(d)!==c&&(e.update(d),r.set(d,c)),l.isInstancedMesh&&(!1===l.hasEventListener("dispose",a)&&l.addEventListener("dispose",a),t.update(l.instanceMatrix,34962),null!==l.instanceColor&&t.update(l.instanceColor,34962)),d},dispose:function o(){r=new WeakMap}}}const OA=new ns,FA=new xv,kA=new fA,BA=new rp,UA=[],zA=[],VA=new Float32Array(16),HA=new Float32Array(9),GA=new Float32Array(4);function Rl(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let s=UA[r];if(void 0===s&&(s=new Float32Array(r),UA[r]=s),0!==e){i.toArray(s,0);for(let o=1,a=0;o!==e;++o)a+=t,n[o].toArray(s,a)}return s}function bn(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function xn(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function cp(n,e){let t=zA[e];void 0===t&&(t=new Int32Array(e),zA[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function K$(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function Q$(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(bn(t,e))return;n.uniform2fv(this.addr,e),xn(t,e)}}function J$(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(void 0!==e.r)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(bn(t,e))return;n.uniform3fv(this.addr,e),xn(t,e)}}function e9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(bn(t,e))return;n.uniform4fv(this.addr,e),xn(t,e)}}function t9(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(bn(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),xn(t,e)}else{if(bn(t,i))return;GA.set(i),n.uniformMatrix2fv(this.addr,!1,GA),xn(t,i)}}function n9(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(bn(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),xn(t,e)}else{if(bn(t,i))return;HA.set(i),n.uniformMatrix3fv(this.addr,!1,HA),xn(t,i)}}function i9(n,e){const t=this.cache,i=e.elements;if(void 0===i){if(bn(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),xn(t,e)}else{if(bn(t,i))return;VA.set(i),n.uniformMatrix4fv(this.addr,!1,VA),xn(t,i)}}function r9(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function s9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(bn(t,e))return;n.uniform2iv(this.addr,e),xn(t,e)}}function o9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(bn(t,e))return;n.uniform3iv(this.addr,e),xn(t,e)}}function a9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(bn(t,e))return;n.uniform4iv(this.addr,e),xn(t,e)}}function l9(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function c9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(bn(t,e))return;n.uniform2uiv(this.addr,e),xn(t,e)}}function u9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(bn(t,e))return;n.uniform3uiv(this.addr,e),xn(t,e)}}function d9(n,e){const t=this.cache;if(void 0!==e.x)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(bn(t,e))return;n.uniform4uiv(this.addr,e),xn(t,e)}}function h9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2D(e||OA,r)}function f9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||kA,r)}function p9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||BA,r)}function m9(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||FA,r)}function y9(n,e){n.uniform1fv(this.addr,e)}function _9(n,e){const t=Rl(e,this.size,2);n.uniform2fv(this.addr,t)}function v9(n,e){const t=Rl(e,this.size,3);n.uniform3fv(this.addr,t)}function b9(n,e){const t=Rl(e,this.size,4);n.uniform4fv(this.addr,t)}function x9(n,e){const t=Rl(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function S9(n,e){const t=Rl(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function w9(n,e){const t=Rl(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function M9(n,e){n.uniform1iv(this.addr,e)}function E9(n,e){n.uniform2iv(this.addr,e)}function C9(n,e){n.uniform3iv(this.addr,e)}function D9(n,e){n.uniform4iv(this.addr,e)}function T9(n,e){n.uniform1uiv(this.addr,e)}function A9(n,e){n.uniform2uiv(this.addr,e)}function I9(n,e){n.uniform3uiv(this.addr,e)}function P9(n,e){n.uniform4uiv(this.addr,e)}function R9(n,e,t){const i=this.cache,r=e.length,s=cp(t,r);bn(i,s)||(n.uniform1iv(this.addr,s),xn(i,s));for(let o=0;o!==r;++o)t.setTexture2D(e[o]||OA,s[o])}function L9(n,e,t){const i=this.cache,r=e.length,s=cp(t,r);bn(i,s)||(n.uniform1iv(this.addr,s),xn(i,s));for(let o=0;o!==r;++o)t.setTexture3D(e[o]||kA,s[o])}function N9(n,e,t){const i=this.cache,r=e.length,s=cp(t,r);bn(i,s)||(n.uniform1iv(this.addr,s),xn(i,s));for(let o=0;o!==r;++o)t.setTextureCube(e[o]||BA,s[o])}function O9(n,e,t){const i=this.cache,r=e.length,s=cp(t,r);bn(i,s)||(n.uniform1iv(this.addr,s),xn(i,s));for(let o=0;o!==r;++o)t.setTexture2DArray(e[o]||FA,s[o])}class k9{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.setValue=function g9(n){switch(n){case 5126:return K$;case 35664:return Q$;case 35665:return J$;case 35666:return e9;case 35674:return t9;case 35675:return n9;case 35676:return i9;case 5124:case 35670:return r9;case 35667:case 35671:return s9;case 35668:case 35672:return o9;case 35669:case 35673:return a9;case 5125:return l9;case 36294:return c9;case 36295:return u9;case 36296:return d9;case 35678:case 36198:case 36298:case 36306:case 35682:return h9;case 35679:case 36299:case 36307:return f9;case 35680:case 36300:case 36308:case 36293:return p9;case 36289:case 36303:case 36311:case 36292:return m9}}(t.type)}}class B9{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.size=t.size,this.setValue=function F9(n){switch(n){case 5126:return y9;case 35664:return _9;case 35665:return v9;case 35666:return b9;case 35674:return x9;case 35675:return S9;case 35676:return w9;case 5124:case 35670:return M9;case 35667:case 35671:return E9;case 35668:case 35672:return C9;case 35669:case 35673:return D9;case 5125:return T9;case 36294:return A9;case 36295:return I9;case 36296:return P9;case 35678:case 36198:case 36298:case 36306:case 35682:return R9;case 35679:case 36299:case 36307:return L9;case 35680:case 36300:case 36308:case 36293:return N9;case 36289:case 36303:case 36311:case 36292:return O9}}(t.type)}}class U9{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let s=0,o=r.length;s!==o;++s){const a=r[s];a.setValue(e,t[a.id],i)}}}const qv=/(\w+)(\])?(\[|\.)?/g;function WA(n,e){n.seq.push(e),n.map[e.id]=e}function z9(n,e,t){const i=n.name,r=i.length;for(qv.lastIndex=0;;){const s=qv.exec(i),o=qv.lastIndex;let a=s[1];const c=s[3];if("]"===s[2]&&(a|=0),void 0===c||"["===c&&o+2===r){WA(t,void 0===c?new k9(a,n,e):new B9(a,n,e));break}{let d=t.map[a];void 0===d&&(d=new U9(a),WA(t,d)),t=d}}}class up{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,35718);for(let r=0;r<i;++r){const s=e.getActiveUniform(t,r);z9(s,e.getUniformLocation(t,s.name),this)}}setValue(e,t,i,r){const s=this.map[t];void 0!==s&&s.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];void 0!==r&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let s=0,o=t.length;s!==o;++s){const a=t[s],l=i[a.id];!1!==l.needsUpdate&&a.setValue(e,l.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,s=e.length;r!==s;++r){const o=e[r];o.id in t&&i.push(o)}return i}}function jA(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}let V9=0;function $A(n,e,t){const i=n.getShaderParameter(e,35713),r=n.getShaderInfoLog(e).trim();if(i&&""===r)return"";const s=/ERROR: 0:(\d+)/.exec(r);if(s){const o=parseInt(s[1]);return t.toUpperCase()+"\n\n"+r+"\n\n"+function H9(n,e){const t=n.split("\n"),i=[],r=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let o=r;o<s;o++){const a=o+1;i.push(`${a===e?">":" "} ${a}: ${t[o]}`)}return i.join("\n")}(n.getShaderSource(e),o)}return r}function W9(n,e){const t=function G9(n){switch(n){case Io:return["Linear","( value )"];case Gt:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",n),["Linear","( value )"]}}(e);return"vec4 "+n+"( vec4 value ) { return LinearTo"+t[0]+t[1]+"; }"}function j9(n,e){let t;switch(e){case 1:t="Linear";break;case 2:t="Reinhard";break;case 3:t="OptimizedCineon";break;case 4:t="ACESFilmic";break;case 5:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function Nu(n){return""!==n}function qA(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function YA(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const X9=/^[ \t]*#include +<([\w\d./]+)>/gm;function Yv(n){return n.replace(X9,Z9)}function Z9(n,e){const t=nt[e];if(void 0===t)throw new Error("Can not resolve #include <"+e+">");return Yv(t)}const K9=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function XA(n){return n.replace(K9,Q9)}function Q9(n,e,t,i){let r="";for(let s=parseInt(e);s<parseInt(t);s++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return r}function ZA(n){let e="precision "+n.precision+" float;\nprecision "+n.precision+" int;";return"highp"===n.precision?e+="\n#define HIGH_PRECISION":"mediump"===n.precision?e+="\n#define MEDIUM_PRECISION":"lowp"===n.precision&&(e+="\n#define LOW_PRECISION"),e}function r7(n,e,t,i){const r=n.getContext(),s=t.defines;let o=t.vertexShader,a=t.fragmentShader;const l=function J9(n){let e="SHADOWMAP_TYPE_BASIC";return 1===n.shadowMapType?e="SHADOWMAP_TYPE_PCF":2===n.shadowMapType?e="SHADOWMAP_TYPE_PCF_SOFT":3===n.shadowMapType&&(e="SHADOWMAP_TYPE_VSM"),e}(t),c=function e7(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case 301:case 302:e="ENVMAP_TYPE_CUBE";break;case 306:e="ENVMAP_TYPE_CUBE_UV"}return e}(t),u=function t7(n){let e="ENVMAP_MODE_REFLECTION";return n.envMap&&302===n.envMapMode&&(e="ENVMAP_MODE_REFRACTION"),e}(t),d=function n7(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case 0:e="ENVMAP_BLENDING_MULTIPLY";break;case 1:e="ENVMAP_BLENDING_MIX";break;case 2:e="ENVMAP_BLENDING_ADD"}return e}(t),h=function i7(n){const e=n.envMapCubeUVHeight;if(null===e)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),112)),texelHeight:i,maxMip:t}}(t),f=t.isWebGL2?"":function $9(n){return[n.extensionDerivatives||n.envMapCubeUVHeight||n.bumpMap||n.tangentSpaceNormalMap||n.clearcoatNormalMap||n.flatShading||"physical"===n.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(n.extensionFragDepth||n.logarithmicDepthBuffer)&&n.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",n.extensionDrawBuffers&&n.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(n.extensionShaderTextureLOD||n.envMap||n.transmission)&&n.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(Nu).join("\n")}(t),p=function q9(n){const e=[];for(const t in n){const i=n[t];!1!==i&&e.push("#define "+t+" "+i)}return e.join("\n")}(s),g=r.createProgram();let m,y,b=t.glslVersion?"#version "+t.glslVersion+"\n":"";t.isRawShaderMaterial?(m=[p].filter(Nu).join("\n"),m.length>0&&(m+="\n"),y=[f,p].filter(Nu).join("\n"),y.length>0&&(y+="\n")):(m=[ZA(t),"#define SHADER_NAME "+t.shaderName,p,t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.supportsVertexTextures?"#define VERTEX_TEXTURES":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+u:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.displacementMap&&t.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&!1===t.flatShading?"#define USE_MORPHNORMALS":"",t.morphColors&&t.isWebGL2?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0&&t.isWebGL2?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(Nu).join("\n"),y=[f,ZA(t),"#define SHADER_NAME "+t.shaderName,p,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+c:"",t.envMap?"#define "+u:"",t.envMap?"#define "+d:"",h?"#define CUBEUV_TEXEL_WIDTH "+h.texelWidth:"",h?"#define CUBEUV_TEXEL_HEIGHT "+h.texelHeight:"",h?"#define CUBEUV_MAX_MIP "+h.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMap&&t.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",t.normalMap&&t.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",t.specularColorMap?"#define USE_SPECULARCOLORMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEENCOLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.vertexTangents?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUvs?"#define USE_UV":"",t.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+l:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.logarithmicDepthBuffer&&t.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",0!==t.toneMapping?"#define TONE_MAPPING":"",0!==t.toneMapping?nt.tonemapping_pars_fragment:"",0!==t.toneMapping?j9("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",nt.encodings_pars_fragment,W9("linearToOutputTexel",t.outputEncoding),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"","\n"].filter(Nu).join("\n")),o=Yv(o),o=qA(o,t),o=YA(o,t),a=Yv(a),a=qA(a,t),a=YA(a,t),o=XA(o),a=XA(a),t.isWebGL2&&!0!==t.isRawShaderMaterial&&(b="#version 300 es\n",m=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+m,y=["#define varying in","300 es"===t.glslVersion?"":"layout(location = 0) out highp vec4 pc_fragColor;","300 es"===t.glslVersion?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+y);const v=b+y+a,S=jA(r,35633,b+m+o),M=jA(r,35632,v);if(r.attachShader(g,S),r.attachShader(g,M),void 0!==t.index0AttributeName?r.bindAttribLocation(g,0,t.index0AttributeName):!0===t.morphTargets&&r.bindAttribLocation(g,0,"position"),r.linkProgram(g),n.debug.checkShaderErrors){const D=r.getProgramInfoLog(g).trim(),P=r.getShaderInfoLog(S).trim(),V=r.getShaderInfoLog(M).trim();let ne=!0,z=!0;if(!1===r.getProgramParameter(g,35714)){ne=!1;const L=$A(r,S,"vertex"),j=$A(r,M,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+D+"\n"+L+"\n"+j)}else""!==D?console.warn("THREE.WebGLProgram: Program Info Log:",D):(""===P||""===V)&&(z=!1);z&&(this.diagnostics={runnable:ne,programLog:D,vertexShader:{log:P,prefix:m},fragmentShader:{log:V,prefix:y}})}let I,x;return r.deleteShader(S),r.deleteShader(M),this.getUniforms=function(){return void 0===I&&(I=new up(r,g)),I},this.getAttributes=function(){return void 0===x&&(x=function Y9(n,e){const t={},i=n.getProgramParameter(e,35721);for(let r=0;r<i;r++){const s=n.getActiveAttrib(e,r),o=s.name;let a=1;35674===s.type&&(a=2),35675===s.type&&(a=3),35676===s.type&&(a=4),t[o]={type:s.type,location:n.getAttribLocation(e,o),locationSize:a}}return t}(r,g)),x},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(g),this.program=void 0},this.name=t.shaderName,this.id=V9++,this.cacheKey=e,this.usedTimes=1,this.program=g,this.vertexShader=S,this.fragmentShader=M,this}let s7=0;class o7{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const i=e.fragmentShader,r=this._getShaderStage(e.vertexShader),s=this._getShaderStage(i),o=this._getShaderCacheForMaterial(e);return!1===o.has(r)&&(o.add(r),r.usedTimes++),!1===o.has(s)&&(o.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,0===i.usedTimes&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return void 0===i&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return void 0===i&&(i=new a7(e),t.set(e,i)),i}}class a7{constructor(e){this.id=s7++,this.code=e,this.usedTimes=0}}function l7(n,e,t,i,r,s,o){const a=new Av,l=new o7,c=[],u=r.isWebGL2,d=r.logarithmicDepthBuffer,h=r.vertexTextures;let f=r.precision;const p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function g(x,D,P,V,ne){const z=V.fog,L=ne.geometry,N=(x.isMeshStandardMaterial?t:e).get(x.envMap||(x.isMeshStandardMaterial?V.environment:null)),U=N&&306===N.mapping?N.image.height:null,O=p[x.type];null!==x.precision&&(f=r.getMaxPrecision(x.precision),f!==x.precision&&console.warn("THREE.WebGLProgram.getParameters:",x.precision,"not supported, using",f,"instead."));const $=L.morphAttributes.position||L.morphAttributes.normal||L.morphAttributes.color,q=void 0!==$?$.length:0;let H,oe,te,ue,G=0;if(void 0!==L.morphAttributes.position&&(G=1),void 0!==L.morphAttributes.normal&&(G=2),void 0!==L.morphAttributes.color&&(G=3),O){const We=wr[O];H=We.vertexShader,oe=We.fragmentShader}else H=x.vertexShader,oe=x.fragmentShader,l.update(x),te=l.getVertexShaderID(x),ue=l.getFragmentShaderID(x);const Y=n.getRenderTarget(),ye=x.clearcoat>0,Ce=x.iridescence>0;return{isWebGL2:u,shaderID:O,shaderName:x.type,vertexShader:H,fragmentShader:oe,defines:x.defines,customVertexShaderID:te,customFragmentShaderID:ue,isRawShaderMaterial:!0===x.isRawShaderMaterial,glslVersion:x.glslVersion,precision:f,instancing:!0===ne.isInstancedMesh,instancingColor:!0===ne.isInstancedMesh&&null!==ne.instanceColor,supportsVertexTextures:h,outputEncoding:null===Y?n.outputEncoding:!0===Y.isXRRenderTarget?Y.texture.encoding:Io,map:!!x.map,matcap:!!x.matcap,envMap:!!N,envMapMode:N&&N.mapping,envMapCubeUVHeight:U,lightMap:!!x.lightMap,aoMap:!!x.aoMap,emissiveMap:!!x.emissiveMap,bumpMap:!!x.bumpMap,normalMap:!!x.normalMap,objectSpaceNormalMap:1===x.normalMapType,tangentSpaceNormalMap:0===x.normalMapType,decodeVideoTexture:!!x.map&&!0===x.map.isVideoTexture&&x.map.encoding===Gt,clearcoat:ye,clearcoatMap:ye&&!!x.clearcoatMap,clearcoatRoughnessMap:ye&&!!x.clearcoatRoughnessMap,clearcoatNormalMap:ye&&!!x.clearcoatNormalMap,iridescence:Ce,iridescenceMap:Ce&&!!x.iridescenceMap,iridescenceThicknessMap:Ce&&!!x.iridescenceThicknessMap,displacementMap:!!x.displacementMap,roughnessMap:!!x.roughnessMap,metalnessMap:!!x.metalnessMap,specularMap:!!x.specularMap,specularIntensityMap:!!x.specularIntensityMap,specularColorMap:!!x.specularColorMap,opaque:!1===x.transparent&&1===x.blending,alphaMap:!!x.alphaMap,alphaTest:x.alphaTest>0,gradientMap:!!x.gradientMap,sheen:x.sheen>0,sheenColorMap:!!x.sheenColorMap,sheenRoughnessMap:!!x.sheenRoughnessMap,transmission:x.transmission>0,transmissionMap:!!x.transmissionMap,thicknessMap:!!x.thicknessMap,combine:x.combine,vertexTangents:!!x.normalMap&&!!L.attributes.tangent,vertexColors:x.vertexColors,vertexAlphas:!0===x.vertexColors&&!!L.attributes.color&&4===L.attributes.color.itemSize,vertexUvs:!!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatMap||x.clearcoatRoughnessMap||x.clearcoatNormalMap||x.iridescenceMap||x.iridescenceThicknessMap||x.displacementMap||x.transmissionMap||x.thicknessMap||x.specularIntensityMap||x.specularColorMap||x.sheenColorMap||x.sheenRoughnessMap),uvsVertexOnly:!(x.map||x.bumpMap||x.normalMap||x.specularMap||x.alphaMap||x.emissiveMap||x.roughnessMap||x.metalnessMap||x.clearcoatNormalMap||x.iridescenceMap||x.iridescenceThicknessMap||x.transmission>0||x.transmissionMap||x.thicknessMap||x.specularIntensityMap||x.specularColorMap||x.sheen>0||x.sheenColorMap||x.sheenRoughnessMap||!x.displacementMap),fog:!!z,useFog:!0===x.fog,fogExp2:z&&z.isFogExp2,flatShading:!!x.flatShading,sizeAttenuation:x.sizeAttenuation,logarithmicDepthBuffer:d,skinning:!0===ne.isSkinnedMesh,morphTargets:void 0!==L.morphAttributes.position,morphNormals:void 0!==L.morphAttributes.normal,morphColors:void 0!==L.morphAttributes.color,morphTargetsCount:q,morphTextureStride:G,numDirLights:D.directional.length,numPointLights:D.point.length,numSpotLights:D.spot.length,numSpotLightMaps:D.spotLightMap.length,numRectAreaLights:D.rectArea.length,numHemiLights:D.hemi.length,numDirLightShadows:D.directionalShadowMap.length,numPointLightShadows:D.pointShadowMap.length,numSpotLightShadows:D.spotShadowMap.length,numSpotLightShadowsWithMaps:D.numSpotLightShadowsWithMaps,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:x.dithering,shadowMapEnabled:n.shadowMap.enabled&&P.length>0,shadowMapType:n.shadowMap.type,toneMapping:x.toneMapped?n.toneMapping:0,physicallyCorrectLights:n.physicallyCorrectLights,premultipliedAlpha:x.premultipliedAlpha,doubleSided:2===x.side,flipSided:1===x.side,useDepthPacking:!!x.depthPacking,depthPacking:x.depthPacking||0,index0AttributeName:x.index0AttributeName,extensionDerivatives:x.extensions&&x.extensions.derivatives,extensionFragDepth:x.extensions&&x.extensions.fragDepth,extensionDrawBuffers:x.extensions&&x.extensions.drawBuffers,extensionShaderTextureLOD:x.extensions&&x.extensions.shaderTextureLOD,rendererExtensionFragDepth:u||i.has("EXT_frag_depth"),rendererExtensionDrawBuffers:u||i.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:u||i.has("EXT_shader_texture_lod"),customProgramCacheKey:x.customProgramCacheKey()}},getProgramCacheKey:function m(x){const D=[];if(x.shaderID?D.push(x.shaderID):(D.push(x.customVertexShaderID),D.push(x.customFragmentShaderID)),void 0!==x.defines)for(const P in x.defines)D.push(P),D.push(x.defines[P]);return!1===x.isRawShaderMaterial&&(function y(x,D){x.push(D.precision),x.push(D.outputEncoding),x.push(D.envMapMode),x.push(D.envMapCubeUVHeight),x.push(D.combine),x.push(D.vertexUvs),x.push(D.fogExp2),x.push(D.sizeAttenuation),x.push(D.morphTargetsCount),x.push(D.morphAttributeCount),x.push(D.numDirLights),x.push(D.numPointLights),x.push(D.numSpotLights),x.push(D.numSpotLightMaps),x.push(D.numHemiLights),x.push(D.numRectAreaLights),x.push(D.numDirLightShadows),x.push(D.numPointLightShadows),x.push(D.numSpotLightShadows),x.push(D.numSpotLightShadowsWithMaps),x.push(D.shadowMapType),x.push(D.toneMapping),x.push(D.numClippingPlanes),x.push(D.numClipIntersection),x.push(D.depthPacking)}(D,x),function b(x,D){a.disableAll(),D.isWebGL2&&a.enable(0),D.supportsVertexTextures&&a.enable(1),D.instancing&&a.enable(2),D.instancingColor&&a.enable(3),D.map&&a.enable(4),D.matcap&&a.enable(5),D.envMap&&a.enable(6),D.lightMap&&a.enable(7),D.aoMap&&a.enable(8),D.emissiveMap&&a.enable(9),D.bumpMap&&a.enable(10),D.normalMap&&a.enable(11),D.objectSpaceNormalMap&&a.enable(12),D.tangentSpaceNormalMap&&a.enable(13),D.clearcoat&&a.enable(14),D.clearcoatMap&&a.enable(15),D.clearcoatRoughnessMap&&a.enable(16),D.clearcoatNormalMap&&a.enable(17),D.iridescence&&a.enable(18),D.iridescenceMap&&a.enable(19),D.iridescenceThicknessMap&&a.enable(20),D.displacementMap&&a.enable(21),D.specularMap&&a.enable(22),D.roughnessMap&&a.enable(23),D.metalnessMap&&a.enable(24),D.gradientMap&&a.enable(25),D.alphaMap&&a.enable(26),D.alphaTest&&a.enable(27),D.vertexColors&&a.enable(28),D.vertexAlphas&&a.enable(29),D.vertexUvs&&a.enable(30),D.vertexTangents&&a.enable(31),D.uvsVertexOnly&&a.enable(32),x.push(a.mask),a.disableAll(),D.fog&&a.enable(0),D.useFog&&a.enable(1),D.flatShading&&a.enable(2),D.logarithmicDepthBuffer&&a.enable(3),D.skinning&&a.enable(4),D.morphTargets&&a.enable(5),D.morphNormals&&a.enable(6),D.morphColors&&a.enable(7),D.premultipliedAlpha&&a.enable(8),D.shadowMapEnabled&&a.enable(9),D.physicallyCorrectLights&&a.enable(10),D.doubleSided&&a.enable(11),D.flipSided&&a.enable(12),D.useDepthPacking&&a.enable(13),D.dithering&&a.enable(14),D.specularIntensityMap&&a.enable(15),D.specularColorMap&&a.enable(16),D.transmission&&a.enable(17),D.transmissionMap&&a.enable(18),D.thicknessMap&&a.enable(19),D.sheen&&a.enable(20),D.sheenColorMap&&a.enable(21),D.sheenRoughnessMap&&a.enable(22),D.decodeVideoTexture&&a.enable(23),D.opaque&&a.enable(24),x.push(a.mask)}(D,x),D.push(n.outputEncoding)),D.push(x.customProgramCacheKey),D.join()},getUniforms:function _(x){const D=p[x.type];let P;return P=D?T6.clone(wr[D].uniforms):x.uniforms,P},acquireProgram:function v(x,D){let P;for(let V=0,ne=c.length;V<ne;V++){const z=c[V];if(z.cacheKey===D){P=z,++P.usedTimes;break}}return void 0===P&&(P=new r7(n,D,x,s),c.push(P)),P},releaseProgram:function S(x){if(0==--x.usedTimes){const D=c.indexOf(x);c[D]=c[c.length-1],c.pop(),x.destroy()}},releaseShaderCache:function M(x){l.remove(x)},programs:c,dispose:function I(){l.dispose()}}}function c7(){let n=new WeakMap;return{get:function e(s){let o=n.get(s);return void 0===o&&(o={},n.set(s,o)),o},remove:function t(s){n.delete(s)},update:function i(s,o,a){n.get(s)[o]=a},dispose:function r(){n=new WeakMap}}}function u7(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function KA(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function QA(){const n=[];let e=0;const t=[],i=[],r=[];function o(d,h,f,p,g,m){let y=n[e];return void 0===y?(y={id:d.id,object:d,geometry:h,material:f,groupOrder:p,renderOrder:d.renderOrder,z:g,group:m},n[e]=y):(y.id=d.id,y.object=d,y.geometry=h,y.material=f,y.groupOrder=p,y.renderOrder=d.renderOrder,y.z=g,y.group=m),e++,y}return{opaque:t,transmissive:i,transparent:r,init:function s(){e=0,t.length=0,i.length=0,r.length=0},push:function a(d,h,f,p,g,m){const y=o(d,h,f,p,g,m);f.transmission>0?i.push(y):!0===f.transparent?r.push(y):t.push(y)},unshift:function l(d,h,f,p,g,m){const y=o(d,h,f,p,g,m);f.transmission>0?i.unshift(y):!0===f.transparent?r.unshift(y):t.unshift(y)},finish:function u(){for(let d=e,h=n.length;d<h;d++){const f=n[d];if(null===f.id)break;f.id=null,f.object=null,f.geometry=null,f.material=null,f.group=null}},sort:function c(d,h){t.length>1&&t.sort(d||u7),i.length>1&&i.sort(h||KA),r.length>1&&r.sort(h||KA)}}}function d7(){let n=new WeakMap;return{get:function e(i,r){const s=n.get(i);let o;return void 0===s?(o=new QA,n.set(i,[o])):r>=s.length?(o=new QA,s.push(o)):o=s[r],o},dispose:function t(){n=new WeakMap}}}function h7(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new E,color:new we};break;case"SpotLight":t={position:new E,direction:new E,color:new we,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new E,color:new we,distance:0,decay:0};break;case"HemisphereLight":t={direction:new E,skyColor:new we,groundColor:new we};break;case"RectAreaLight":t={color:new we,position:new E,halfWidth:new E,halfHeight:new E}}return n[e.id]=t,t}}}let p7=0;function m7(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function g7(n,e){const t=new h7,i=function f7(){const n={};return{get:function(e){if(void 0!==n[e.id])return n[e.id];let t;switch(e.type){case"DirectionalLight":case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new K};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new K,shadowCameraNear:1,shadowCameraFar:1e3}}return n[e.id]=t,t}}}(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0};for(let u=0;u<9;u++)r.probe.push(new E);const s=new E,o=new Ze,a=new Ze;return{setup:function l(u,d){let h=0,f=0,p=0;for(let V=0;V<9;V++)r.probe[V].set(0,0,0);let g=0,m=0,y=0,b=0,_=0,v=0,S=0,M=0,I=0,x=0;u.sort(m7);const D=!0!==d?Math.PI:1;for(let V=0,ne=u.length;V<ne;V++){const z=u[V],L=z.color,j=z.intensity,N=z.distance,U=z.shadow&&z.shadow.map?z.shadow.map.texture:null;if(z.isAmbientLight)h+=L.r*j*D,f+=L.g*j*D,p+=L.b*j*D;else if(z.isLightProbe)for(let O=0;O<9;O++)r.probe[O].addScaledVector(z.sh.coefficients[O],j);else if(z.isDirectionalLight){const O=t.get(z);if(O.color.copy(z.color).multiplyScalar(z.intensity*D),z.castShadow){const $=z.shadow,q=i.get(z);q.shadowBias=$.bias,q.shadowNormalBias=$.normalBias,q.shadowRadius=$.radius,q.shadowMapSize=$.mapSize,r.directionalShadow[g]=q,r.directionalShadowMap[g]=U,r.directionalShadowMatrix[g]=z.shadow.matrix,v++}r.directional[g]=O,g++}else if(z.isSpotLight){const O=t.get(z);O.position.setFromMatrixPosition(z.matrixWorld),O.color.copy(L).multiplyScalar(j*D),O.distance=N,O.coneCos=Math.cos(z.angle),O.penumbraCos=Math.cos(z.angle*(1-z.penumbra)),O.decay=z.decay,r.spot[y]=O;const $=z.shadow;if(z.map&&(r.spotLightMap[I]=z.map,I++,$.updateMatrices(z),z.castShadow&&x++),r.spotLightMatrix[y]=$.matrix,z.castShadow){const q=i.get(z);q.shadowBias=$.bias,q.shadowNormalBias=$.normalBias,q.shadowRadius=$.radius,q.shadowMapSize=$.mapSize,r.spotShadow[y]=q,r.spotShadowMap[y]=U,M++}y++}else if(z.isRectAreaLight){const O=t.get(z);O.color.copy(L).multiplyScalar(j),O.halfWidth.set(.5*z.width,0,0),O.halfHeight.set(0,.5*z.height,0),r.rectArea[b]=O,b++}else if(z.isPointLight){const O=t.get(z);if(O.color.copy(z.color).multiplyScalar(z.intensity*D),O.distance=z.distance,O.decay=z.decay,z.castShadow){const $=z.shadow,q=i.get(z);q.shadowBias=$.bias,q.shadowNormalBias=$.normalBias,q.shadowRadius=$.radius,q.shadowMapSize=$.mapSize,q.shadowCameraNear=$.camera.near,q.shadowCameraFar=$.camera.far,r.pointShadow[m]=q,r.pointShadowMap[m]=U,r.pointShadowMatrix[m]=z.shadow.matrix,S++}r.point[m]=O,m++}else if(z.isHemisphereLight){const O=t.get(z);O.skyColor.copy(z.color).multiplyScalar(j*D),O.groundColor.copy(z.groundColor).multiplyScalar(j*D),r.hemi[_]=O,_++}}b>0&&(e.isWebGL2||!0===n.has("OES_texture_float_linear")?(r.rectAreaLTC1=he.LTC_FLOAT_1,r.rectAreaLTC2=he.LTC_FLOAT_2):!0===n.has("OES_texture_half_float_linear")?(r.rectAreaLTC1=he.LTC_HALF_1,r.rectAreaLTC2=he.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),r.ambient[0]=h,r.ambient[1]=f,r.ambient[2]=p;const P=r.hash;(P.directionalLength!==g||P.pointLength!==m||P.spotLength!==y||P.rectAreaLength!==b||P.hemiLength!==_||P.numDirectionalShadows!==v||P.numPointShadows!==S||P.numSpotShadows!==M||P.numSpotMaps!==I)&&(r.directional.length=g,r.spot.length=y,r.rectArea.length=b,r.point.length=m,r.hemi.length=_,r.directionalShadow.length=v,r.directionalShadowMap.length=v,r.pointShadow.length=S,r.pointShadowMap.length=S,r.spotShadow.length=M,r.spotShadowMap.length=M,r.directionalShadowMatrix.length=v,r.pointShadowMatrix.length=S,r.spotLightMatrix.length=M+I-x,r.spotLightMap.length=I,r.numSpotLightShadowsWithMaps=x,P.directionalLength=g,P.pointLength=m,P.spotLength=y,P.rectAreaLength=b,P.hemiLength=_,P.numDirectionalShadows=v,P.numPointShadows=S,P.numSpotShadows=M,P.numSpotMaps=I,r.version=p7++)},setupView:function c(u,d){let h=0,f=0,p=0,g=0,m=0;const y=d.matrixWorldInverse;for(let b=0,_=u.length;b<_;b++){const v=u[b];if(v.isDirectionalLight){const S=r.directional[h];S.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(y),h++}else if(v.isSpotLight){const S=r.spot[p];S.position.setFromMatrixPosition(v.matrixWorld),S.position.applyMatrix4(y),S.direction.setFromMatrixPosition(v.matrixWorld),s.setFromMatrixPosition(v.target.matrixWorld),S.direction.sub(s),S.direction.transformDirection(y),p++}else if(v.isRectAreaLight){const S=r.rectArea[g];S.position.setFromMatrixPosition(v.matrixWorld),S.position.applyMatrix4(y),a.identity(),o.copy(v.matrixWorld),o.premultiply(y),a.extractRotation(o),S.halfWidth.set(.5*v.width,0,0),S.halfHeight.set(0,.5*v.height,0),S.halfWidth.applyMatrix4(a),S.halfHeight.applyMatrix4(a),g++}else if(v.isPointLight){const S=r.point[f];S.position.setFromMatrixPosition(v.matrixWorld),S.position.applyMatrix4(y),f++}else if(v.isHemisphereLight){const S=r.hemi[m];S.direction.setFromMatrixPosition(v.matrixWorld),S.direction.transformDirection(y),m++}}},state:r}}function JA(n,e){const t=new g7(n,e),i=[],r=[];return{init:function s(){i.length=0,r.length=0},state:{lightsArray:i,shadowsArray:r,lights:t},setupLights:function l(d){t.setup(i,d)},setupLightsView:function c(d){t.setupView(i,d)},pushLight:function o(d){i.push(d)},pushShadow:function a(d){r.push(d)}}}function y7(n,e){let t=new WeakMap;return{get:function i(s,o=0){const a=t.get(s);let l;return void 0===a?(l=new JA(n,e),t.set(s,[l])):o>=a.length?(l=new JA(n,e),a.push(l)):l=a[o],l},dispose:function r(){t=new WeakMap}}}class eI extends Bo{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=3200,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class tI extends Bo{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.referencePosition=new E,this.nearDistance=1,this.farDistance=1e3,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}function b7(n,e,t){let i=new Hv;const r=new K,s=new K,o=new Dt,a=new eI({depthPacking:3201}),l=new tI,c={},u=t.maxTextureSize,d={0:1,1:0,2:2},h=new Gs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new K},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),f=h.clone();f.defines.HORIZONTAL_PASS=1;const p=new ot;p.setAttribute("position",new wn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const g=new Bn(p,h),m=this;function y(v,S){const M=e.update(g);h.defines.VSM_SAMPLES!==v.blurSamples&&(h.defines.VSM_SAMPLES=v.blurSamples,f.defines.VSM_SAMPLES=v.blurSamples,h.needsUpdate=!0,f.needsUpdate=!0),null===v.mapPass&&(v.mapPass=new No(r.x,r.y)),h.uniforms.shadow_pass.value=v.map.texture,h.uniforms.resolution.value=v.mapSize,h.uniforms.radius.value=v.radius,n.setRenderTarget(v.mapPass),n.clear(),n.renderBufferDirect(S,null,M,h,g,null),f.uniforms.shadow_pass.value=v.mapPass.texture,f.uniforms.resolution.value=v.mapSize,f.uniforms.radius.value=v.radius,n.setRenderTarget(v.map),n.clear(),n.renderBufferDirect(S,null,M,f,g,null)}function b(v,S,M,I,x,D){let P=null;const V=!0===M.isPointLight?v.customDistanceMaterial:v.customDepthMaterial;if(P=void 0!==V?V:!0===M.isPointLight?l:a,n.localClippingEnabled&&!0===S.clipShadows&&Array.isArray(S.clippingPlanes)&&0!==S.clippingPlanes.length||S.displacementMap&&0!==S.displacementScale||S.alphaMap&&S.alphaTest>0||S.map&&S.alphaTest>0){const ne=P.uuid,z=S.uuid;let L=c[ne];void 0===L&&(L={},c[ne]=L);let j=L[z];void 0===j&&(j=P.clone(),L[z]=j),P=j}return P.visible=S.visible,P.wireframe=S.wireframe,P.side=3===D?null!==S.shadowSide?S.shadowSide:S.side:null!==S.shadowSide?S.shadowSide:d[S.side],P.alphaMap=S.alphaMap,P.alphaTest=S.alphaTest,P.map=S.map,P.clipShadows=S.clipShadows,P.clippingPlanes=S.clippingPlanes,P.clipIntersection=S.clipIntersection,P.displacementMap=S.displacementMap,P.displacementScale=S.displacementScale,P.displacementBias=S.displacementBias,P.wireframeLinewidth=S.wireframeLinewidth,P.linewidth=S.linewidth,!0===M.isPointLight&&!0===P.isMeshDistanceMaterial&&(P.referencePosition.setFromMatrixPosition(M.matrixWorld),P.nearDistance=I,P.farDistance=x),P}function _(v,S,M,I,x){if(!1===v.visible)return;if(v.layers.test(S.layers)&&(v.isMesh||v.isLine||v.isPoints)&&(v.castShadow||v.receiveShadow&&3===x)&&(!v.frustumCulled||i.intersectsObject(v))){v.modelViewMatrix.multiplyMatrices(M.matrixWorldInverse,v.matrixWorld);const V=e.update(v),ne=v.material;if(Array.isArray(ne)){const z=V.groups;for(let L=0,j=z.length;L<j;L++){const N=z[L],U=ne[N.materialIndex];if(U&&U.visible){const O=b(v,U,I,M.near,M.far,x);n.renderBufferDirect(M,null,V,O,v,N)}}}else if(ne.visible){const z=b(v,ne,I,M.near,M.far,x);n.renderBufferDirect(M,null,V,z,v,null)}}const P=v.children;for(let V=0,ne=P.length;V<ne;V++)_(P[V],S,M,I,x)}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=1,this.render=function(v,S,M){if(!1===m.enabled||!1===m.autoUpdate&&!1===m.needsUpdate||0===v.length)return;const I=n.getRenderTarget(),x=n.getActiveCubeFace(),D=n.getActiveMipmapLevel(),P=n.state;P.setBlending(0),P.buffers.color.setClear(1,1,1,1),P.buffers.depth.setTest(!0),P.setScissorTest(!1);for(let V=0,ne=v.length;V<ne;V++){const z=v[V],L=z.shadow;if(void 0===L){console.warn("THREE.WebGLShadowMap:",z,"has no shadow.");continue}if(!1===L.autoUpdate&&!1===L.needsUpdate)continue;r.copy(L.mapSize);const j=L.getFrameExtents();r.multiply(j),s.copy(L.mapSize),(r.x>u||r.y>u)&&(r.x>u&&(s.x=Math.floor(u/j.x),r.x=s.x*j.x,L.mapSize.x=s.x),r.y>u&&(s.y=Math.floor(u/j.y),r.y=s.y*j.y,L.mapSize.y=s.y)),null===L.map&&(L.map=new No(r.x,r.y,3!==this.type?{minFilter:_n,magFilter:_n}:{}),L.map.texture.name=z.name+".shadowMap",L.camera.updateProjectionMatrix()),n.setRenderTarget(L.map),n.clear();const N=L.getViewportCount();for(let U=0;U<N;U++){const O=L.getViewport(U);o.set(s.x*O.x,s.y*O.y,s.x*O.z,s.y*O.w),P.viewport(o),L.updateMatrices(z,U),i=L.getFrustum(),_(S,M,L.camera,z,this.type)}!0!==L.isPointLightShadow&&3===this.type&&y(L,M),L.needsUpdate=!1}m.needsUpdate=!1,n.setRenderTarget(I,x,D)}}function x7(n,e,t){const i=t.isWebGL2,a=new function r(){let R=!1;const Z=new Dt;let ae=null;const xe=new Dt(0,0,0,0);return{setMask:function(Le){ae!==Le&&!R&&(n.colorMask(Le,Le,Le,Le),ae=Le)},setLocked:function(Le){R=Le},setClear:function(Le,Ct,En,Un,ea){!0===ea&&(Le*=Un,Ct*=Un,En*=Un),Z.set(Le,Ct,En,Un),!1===xe.equals(Z)&&(n.clearColor(Le,Ct,En,Un),xe.copy(Z))},reset:function(){R=!1,ae=null,xe.set(-1,0,0,0)}}},l=new function s(){let R=!1,Z=null,ae=null,xe=null;return{setTest:function(Le){Le?Me(2929):ye(2929)},setMask:function(Le){Z!==Le&&!R&&(n.depthMask(Le),Z=Le)},setFunc:function(Le){if(ae!==Le){switch(Le){case 0:n.depthFunc(512);break;case 1:n.depthFunc(519);break;case 2:n.depthFunc(513);break;case 3:default:n.depthFunc(515);break;case 4:n.depthFunc(514);break;case 5:n.depthFunc(518);break;case 6:n.depthFunc(516);break;case 7:n.depthFunc(517)}ae=Le}},setLocked:function(Le){R=Le},setClear:function(Le){xe!==Le&&(n.clearDepth(Le),xe=Le)},reset:function(){R=!1,Z=null,ae=null,xe=null}}},c=new function o(){let R=!1,Z=null,ae=null,xe=null,Le=null,Ct=null,En=null,Un=null,ea=null;return{setTest:function(zt){R||(zt?Me(2960):ye(2960))},setMask:function(zt){Z!==zt&&!R&&(n.stencilMask(zt),Z=zt)},setFunc:function(zt,hs,Vi){(ae!==zt||xe!==hs||Le!==Vi)&&(n.stencilFunc(zt,hs,Vi),ae=zt,xe=hs,Le=Vi)},setOp:function(zt,hs,Vi){(Ct!==zt||En!==hs||Un!==Vi)&&(n.stencilOp(zt,hs,Vi),Ct=zt,En=hs,Un=Vi)},setLocked:function(zt){R=zt},setClear:function(zt){ea!==zt&&(n.clearStencil(zt),ea=zt)},reset:function(){R=!1,Z=null,ae=null,xe=null,Le=null,Ct=null,En=null,Un=null,ea=null}}},u=new WeakMap,d=new WeakMap;let h={},f={},p=new WeakMap,g=[],m=null,y=!1,b=null,_=null,v=null,S=null,M=null,I=null,x=null,D=!1,P=null,V=null,ne=null,z=null,L=null;const j=n.getParameter(35661);let N=!1,U=0;const O=n.getParameter(7938);-1!==O.indexOf("WebGL")?(U=parseFloat(/^WebGL (\d)/.exec(O)[1]),N=U>=1):-1!==O.indexOf("OpenGL ES")&&(U=parseFloat(/^OpenGL ES (\d)/.exec(O)[1]),N=U>=2);let $=null,q={};const G=n.getParameter(3088),H=n.getParameter(2978),oe=(new Dt).fromArray(G),te=(new Dt).fromArray(H);function ue(R,Z,ae){const xe=new Uint8Array(4),Le=n.createTexture();n.bindTexture(R,Le),n.texParameteri(R,10241,9728),n.texParameteri(R,10240,9728);for(let Ct=0;Ct<ae;Ct++)n.texImage2D(Z+Ct,0,6408,1,1,0,6408,5121,xe);return Le}const Y={};function Me(R){!0!==h[R]&&(n.enable(R),h[R]=!0)}function ye(R){!1!==h[R]&&(n.disable(R),h[R]=!1)}Y[3553]=ue(3553,3553,1),Y[34067]=ue(34067,34069,6),a.setClear(0,0,0,1),l.setClear(1),c.setClear(0),Me(2929),l.setFunc(3),fe(!1),Ge(1),Me(2884),ce(0);const ee={100:32774,101:32778,102:32779};if(i)ee[103]=32775,ee[104]=32776;else{const R=e.get("EXT_blend_minmax");null!==R&&(ee[103]=R.MIN_EXT,ee[104]=R.MAX_EXT)}const J={200:0,201:1,202:768,204:770,210:776,208:774,206:772,203:769,205:771,209:775,207:773};function ce(R,Z,ae,xe,Le,Ct,En,Un){if(0!==R){if(!1===y&&(Me(3042),y=!0),5===R)Le=Le||Z,Ct=Ct||ae,En=En||xe,(Z!==_||Le!==M)&&(n.blendEquationSeparate(ee[Z],ee[Le]),_=Z,M=Le),(ae!==v||xe!==S||Ct!==I||En!==x)&&(n.blendFuncSeparate(J[ae],J[xe],J[Ct],J[En]),v=ae,S=xe,I=Ct,x=En),b=R,D=!1;else if(R!==b||Un!==D){if((100!==_||100!==M)&&(n.blendEquation(32774),_=100,M=100),Un)switch(R){case 1:n.blendFuncSeparate(1,771,1,771);break;case 2:n.blendFunc(1,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",R)}else switch(R){case 1:n.blendFuncSeparate(770,771,1,771);break;case 2:n.blendFunc(770,1);break;case 3:n.blendFuncSeparate(0,769,0,1);break;case 4:n.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",R)}v=null,S=null,I=null,x=null,b=R,D=Un}}else!0===y&&(ye(3042),y=!1)}function fe(R){P!==R&&(n.frontFace(R?2304:2305),P=R)}function Ge(R){0!==R?(Me(2884),R!==V&&n.cullFace(1===R?1029:2===R?1028:1032)):ye(2884),V=R}function Oe(R,Z,ae){R?(Me(32823),(z!==Z||L!==ae)&&(n.polygonOffset(Z,ae),z=Z,L=ae)):ye(32823)}return{buffers:{color:a,depth:l,stencil:c},enable:Me,disable:ye,bindFramebuffer:function Ce(R,Z){return f[R]!==Z&&(n.bindFramebuffer(R,Z),f[R]=Z,i&&(36009===R&&(f[36160]=Z),36160===R&&(f[36009]=Z)),!0)},drawBuffers:function de(R,Z){let ae=g,xe=!1;if(R)if(ae=p.get(Z),void 0===ae&&(ae=[],p.set(Z,ae)),R.isWebGLMultipleRenderTargets){const Le=R.texture;if(ae.length!==Le.length||36064!==ae[0]){for(let Ct=0,En=Le.length;Ct<En;Ct++)ae[Ct]=36064+Ct;ae.length=Le.length,xe=!0}}else 36064!==ae[0]&&(ae[0]=36064,xe=!0);else 1029!==ae[0]&&(ae[0]=1029,xe=!0);xe&&(t.isWebGL2?n.drawBuffers(ae):e.get("WEBGL_draw_buffers").drawBuffersWEBGL(ae))},useProgram:function We(R){return m!==R&&(n.useProgram(R),m=R,!0)},setBlending:ce,setMaterial:function Ee(R,Z){2===R.side?ye(2884):Me(2884);let ae=1===R.side;Z&&(ae=!ae),fe(ae),1===R.blending&&!1===R.transparent?ce(0):ce(R.blending,R.blendEquation,R.blendSrc,R.blendDst,R.blendEquationAlpha,R.blendSrcAlpha,R.blendDstAlpha,R.premultipliedAlpha),l.setFunc(R.depthFunc),l.setTest(R.depthTest),l.setMask(R.depthWrite),a.setMask(R.colorWrite);const xe=R.stencilWrite;c.setTest(xe),xe&&(c.setMask(R.stencilWriteMask),c.setFunc(R.stencilFunc,R.stencilRef,R.stencilFuncMask),c.setOp(R.stencilFail,R.stencilZFail,R.stencilZPass)),Oe(R.polygonOffset,R.polygonOffsetFactor,R.polygonOffsetUnits),!0===R.alphaToCoverage?Me(32926):ye(32926)},setFlipSided:fe,setCullFace:Ge,setLineWidth:function ke(R){R!==ne&&(N&&n.lineWidth(R),ne=R)},setPolygonOffset:Oe,setScissorTest:function Tt(R){R?Me(3089):ye(3089)},activeTexture:function vt(R){void 0===R&&(R=33984+j-1),$!==R&&(n.activeTexture(R),$=R)},bindTexture:function T(R,Z,ae){void 0===ae&&(ae=null===$?33984+j-1:$);let xe=q[ae];void 0===xe&&(xe={type:void 0,texture:void 0},q[ae]=xe),(xe.type!==R||xe.texture!==Z)&&($!==ae&&(n.activeTexture(ae),$=ae),n.bindTexture(R,Z||Y[R]),xe.type=R,xe.texture=Z)},unbindTexture:function w(){const R=q[$];void 0!==R&&void 0!==R.type&&(n.bindTexture(R.type,null),R.type=void 0,R.texture=void 0)},compressedTexImage2D:function W(){try{n.compressedTexImage2D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},compressedTexImage3D:function se(){try{n.compressedTexImage3D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texImage2D:function Se(){try{n.texImage2D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texImage3D:function ve(){try{n.texImage3D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},updateUBOMapping:function ct(R,Z){let ae=d.get(Z);void 0===ae&&(ae=new WeakMap,d.set(Z,ae));let xe=ae.get(R);void 0===xe&&(xe=n.getUniformBlockIndex(Z,R.name),ae.set(R,xe))},uniformBlockBinding:function ft(R,Z){const xe=d.get(Z).get(R);u.get(R)!==xe&&(n.uniformBlockBinding(Z,xe,R.__bindingPointIndex),u.set(R,xe))},texStorage2D:function F(){try{n.texStorage2D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texStorage3D:function _e(){try{n.texStorage3D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texSubImage2D:function le(){try{n.texSubImage2D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},texSubImage3D:function me(){try{n.texSubImage3D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},compressedTexSubImage2D:function He(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},compressedTexSubImage3D:function A(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(R){console.error("THREE.WebGLState:",R)}},scissor:function Pe(R){!1===oe.equals(R)&&(n.scissor(R.x,R.y,R.z,R.w),oe.copy(R))},viewport:function Ie(R){!1===te.equals(R)&&(n.viewport(R.x,R.y,R.z,R.w),te.copy(R))},reset:function At(){n.disable(3042),n.disable(2884),n.disable(2929),n.disable(32823),n.disable(3089),n.disable(2960),n.disable(32926),n.blendEquation(32774),n.blendFunc(1,0),n.blendFuncSeparate(1,0,1,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(513),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(519,0,4294967295),n.stencilOp(7680,7680,7680),n.clearStencil(0),n.cullFace(1029),n.frontFace(2305),n.polygonOffset(0,0),n.activeTexture(33984),n.bindFramebuffer(36160,null),!0===i&&(n.bindFramebuffer(36009,null),n.bindFramebuffer(36008,null)),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),h={},$=null,q={},f={},p=new WeakMap,g=[],m=null,y=!1,b=null,_=null,v=null,S=null,M=null,I=null,x=null,D=!1,P=null,V=null,ne=null,z=null,L=null,oe.set(0,0,n.canvas.width,n.canvas.height),te.set(0,0,n.canvas.width,n.canvas.height),a.reset(),l.reset(),c.reset()}}}function S7(n,e,t,i,r,s,o){const a=r.isWebGL2,l=r.maxTextures,c=r.maxCubemapSize,u=r.maxTextureSize,d=r.maxSamples,h=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,f=!(typeof navigator>"u")&&/OculusBrowser/g.test(navigator.userAgent),p=new WeakMap;let g;const m=new WeakMap;let y=!1;try{y=typeof OffscreenCanvas<"u"&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch{}function b(T,w){return y?new OffscreenCanvas(T,w):Au("canvas")}function _(T,w,W,se){let le=1;if((T.width>se||T.height>se)&&(le=se/Math.max(T.width,T.height)),le<1||!0===w){if(typeof HTMLImageElement<"u"&&T instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&T instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&T instanceof ImageBitmap){const me=w?Bf:Math.floor,He=me(le*T.width),A=me(le*T.height);void 0===g&&(g=b(He,A));const F=W?b(He,A):g;return F.width=He,F.height=A,F.getContext("2d").drawImage(T,0,0,He,A),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+T.width+"x"+T.height+") to ("+He+"x"+A+")."),F}return"data"in T&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+T.width+"x"+T.height+")."),T}return T}function v(T){return gv(T.width)&&gv(T.height)}function M(T,w){return T.generateMipmaps&&w&&T.minFilter!==_n&&T.minFilter!==an}function I(T){n.generateMipmap(T)}function x(T,w,W,se,le=!1){if(!1===a)return w;if(null!==T){if(void 0!==n[T])return n[T];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+T+"'")}let me=w;return 6403===w&&(5126===W&&(me=33326),5131===W&&(me=33325),5121===W&&(me=33321)),33319===w&&(5126===W&&(me=33328),5131===W&&(me=33327),5121===W&&(me=33323)),6408===w&&(5126===W&&(me=34836),5131===W&&(me=34842),5121===W&&(me=se===Gt&&!1===le?35907:32856),32819===W&&(me=32854),32820===W&&(me=32855)),(33325===me||33326===me||33327===me||33328===me||34842===me||34836===me)&&e.get("EXT_color_buffer_float"),me}function D(T,w,W){return!0===M(T,W)||T.isFramebufferTexture&&T.minFilter!==_n&&T.minFilter!==an?Math.log2(Math.max(w.width,w.height))+1:void 0!==T.mipmaps&&T.mipmaps.length>0?T.mipmaps.length:T.isCompressedTexture&&Array.isArray(T.image)?w.mipmaps.length:1}function P(T){return T===_n||1004===T||1005===T?9728:9729}function V(T){const w=T.target;w.removeEventListener("dispose",V),function z(T){const w=i.get(T);if(void 0===w.__webglInit)return;const W=T.source,se=m.get(W);if(se){const le=se[w.__cacheKey];le.usedTimes--,0===le.usedTimes&&L(T),0===Object.keys(se).length&&m.delete(W)}i.remove(T)}(w),w.isVideoTexture&&p.delete(w)}function ne(T){const w=T.target;w.removeEventListener("dispose",ne),function j(T){const w=T.texture,W=i.get(T),se=i.get(w);if(void 0!==se.__webglTexture&&(n.deleteTexture(se.__webglTexture),o.memory.textures--),T.depthTexture&&T.depthTexture.dispose(),T.isWebGLCubeRenderTarget)for(let le=0;le<6;le++)n.deleteFramebuffer(W.__webglFramebuffer[le]),W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer[le]);else{if(n.deleteFramebuffer(W.__webglFramebuffer),W.__webglDepthbuffer&&n.deleteRenderbuffer(W.__webglDepthbuffer),W.__webglMultisampledFramebuffer&&n.deleteFramebuffer(W.__webglMultisampledFramebuffer),W.__webglColorRenderbuffer)for(let le=0;le<W.__webglColorRenderbuffer.length;le++)W.__webglColorRenderbuffer[le]&&n.deleteRenderbuffer(W.__webglColorRenderbuffer[le]);W.__webglDepthRenderbuffer&&n.deleteRenderbuffer(W.__webglDepthRenderbuffer)}if(T.isWebGLMultipleRenderTargets)for(let le=0,me=w.length;le<me;le++){const He=i.get(w[le]);He.__webglTexture&&(n.deleteTexture(He.__webglTexture),o.memory.textures--),i.remove(w[le])}i.remove(w),i.remove(T)}(w)}function L(T){const w=i.get(T);n.deleteTexture(w.__webglTexture),delete m.get(T.source)[w.__cacheKey],o.memory.textures--}let N=0;function q(T,w){const W=i.get(T);if(T.isVideoTexture&&function Tt(T){const w=o.render.frame;p.get(T)!==w&&(p.set(T,w),T.update())}(T),!1===T.isRenderTargetTexture&&T.version>0&&W.__version!==T.version){const se=T.image;if(null===se)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==se.complete)return void ye(W,T,w);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}t.bindTexture(3553,W.__webglTexture,33984+w)}const te={1e3:10497,[Xn]:33071,1002:33648},ue={[_n]:9728,1004:9984,1005:9986,[an]:9729,1007:9985,1008:9987};function Y(T,w,W){if(W?(n.texParameteri(T,10242,te[w.wrapS]),n.texParameteri(T,10243,te[w.wrapT]),(32879===T||35866===T)&&n.texParameteri(T,32882,te[w.wrapR]),n.texParameteri(T,10240,ue[w.magFilter]),n.texParameteri(T,10241,ue[w.minFilter])):(n.texParameteri(T,10242,33071),n.texParameteri(T,10243,33071),(32879===T||35866===T)&&n.texParameteri(T,32882,33071),(w.wrapS!==Xn||w.wrapT!==Xn)&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),n.texParameteri(T,10240,P(w.magFilter)),n.texParameteri(T,10241,P(w.minFilter)),w.minFilter!==_n&&w.minFilter!==an&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===e.has("EXT_texture_filter_anisotropic")){const se=e.get("EXT_texture_filter_anisotropic");if(w.type===Rs&&!1===e.has("OES_texture_float_linear")||!1===a&&w.type===Eu&&!1===e.has("OES_texture_half_float_linear"))return;(w.anisotropy>1||i.get(w).__currentAnisotropy)&&(n.texParameterf(T,se.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(w.anisotropy,r.getMaxAnisotropy())),i.get(w).__currentAnisotropy=w.anisotropy)}}function Me(T,w){let W=!1;void 0===T.__webglInit&&(T.__webglInit=!0,w.addEventListener("dispose",V));const se=w.source;let le=m.get(se);void 0===le&&(le={},m.set(se,le));const me=function $(T){const w=[];return w.push(T.wrapS),w.push(T.wrapT),w.push(T.wrapR||0),w.push(T.magFilter),w.push(T.minFilter),w.push(T.anisotropy),w.push(T.internalFormat),w.push(T.format),w.push(T.type),w.push(T.generateMipmaps),w.push(T.premultiplyAlpha),w.push(T.flipY),w.push(T.unpackAlignment),w.push(T.encoding),w.join()}(w);if(me!==T.__cacheKey){void 0===le[me]&&(le[me]={texture:n.createTexture(),usedTimes:0},o.memory.textures++,W=!0),le[me].usedTimes++;const He=le[T.__cacheKey];void 0!==He&&(le[T.__cacheKey].usedTimes--,0===He.usedTimes&&L(w)),T.__cacheKey=me,T.__webglTexture=le[me].texture}return W}function ye(T,w,W){let se=3553;(w.isDataArrayTexture||w.isCompressedArrayTexture)&&(se=35866),w.isData3DTexture&&(se=32879);const le=Me(T,w),me=w.source;t.bindTexture(se,T.__webglTexture,33984+W);const He=i.get(me);if(me.version!==He.__version||!0===le){t.activeTexture(33984+W),n.pixelStorei(37440,w.flipY),n.pixelStorei(37441,w.premultiplyAlpha),n.pixelStorei(3317,w.unpackAlignment),n.pixelStorei(37443,0);const A=function S(T){return!a&&(T.wrapS!==Xn||T.wrapT!==Xn||T.minFilter!==_n&&T.minFilter!==an)}(w)&&!1===v(w.image);let F=_(w.image,A,!1,u);F=vt(w,F);const _e=v(F)||a,Se=s.convert(w.format,w.encoding);let Ie,ve=s.convert(w.type),Pe=x(w.internalFormat,Se,ve,w.encoding,w.isVideoTexture);Y(se,w,_e);const ct=w.mipmaps,ft=a&&!0!==w.isVideoTexture,At=void 0===He.__version||!0===le,R=D(w,F,_e);if(w.isDepthTexture)Pe=6402,a?Pe=w.type===Rs?36012:w.type===To?33190:w.type===cl?35056:33189:w.type===Rs&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),w.format===Ao&&6402===Pe&&1012!==w.type&&w.type!==To&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),w.type=To,ve=s.convert(w.type)),w.format===ul&&6402===Pe&&(Pe=34041,w.type!==cl&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),w.type=cl,ve=s.convert(w.type))),At&&(ft?t.texStorage2D(3553,1,Pe,F.width,F.height):t.texImage2D(3553,0,Pe,F.width,F.height,0,Se,ve,null));else if(w.isDataTexture)if(ct.length>0&&_e){ft&&At&&t.texStorage2D(3553,R,Pe,ct[0].width,ct[0].height);for(let Z=0,ae=ct.length;Z<ae;Z++)Ie=ct[Z],ft?t.texSubImage2D(3553,Z,0,0,Ie.width,Ie.height,Se,ve,Ie.data):t.texImage2D(3553,Z,Pe,Ie.width,Ie.height,0,Se,ve,Ie.data);w.generateMipmaps=!1}else ft?(At&&t.texStorage2D(3553,R,Pe,F.width,F.height),t.texSubImage2D(3553,0,0,0,F.width,F.height,Se,ve,F.data)):t.texImage2D(3553,0,Pe,F.width,F.height,0,Se,ve,F.data);else if(w.isCompressedTexture)if(w.isCompressedArrayTexture){ft&&At&&t.texStorage3D(35866,R,Pe,ct[0].width,ct[0].height,F.depth);for(let Z=0,ae=ct.length;Z<ae;Z++)Ie=ct[Z],w.format!==Bi?null!==Se?ft?t.compressedTexSubImage3D(35866,Z,0,0,0,Ie.width,Ie.height,F.depth,Se,Ie.data,0,0):t.compressedTexImage3D(35866,Z,Pe,Ie.width,Ie.height,F.depth,0,Ie.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ft?t.texSubImage3D(35866,Z,0,0,0,Ie.width,Ie.height,F.depth,Se,ve,Ie.data):t.texImage3D(35866,Z,Pe,Ie.width,Ie.height,F.depth,0,Se,ve,Ie.data)}else{ft&&At&&t.texStorage2D(3553,R,Pe,ct[0].width,ct[0].height);for(let Z=0,ae=ct.length;Z<ae;Z++)Ie=ct[Z],w.format!==Bi?null!==Se?ft?t.compressedTexSubImage2D(3553,Z,0,0,Ie.width,Ie.height,Se,Ie.data):t.compressedTexImage2D(3553,Z,Pe,Ie.width,Ie.height,0,Ie.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):ft?t.texSubImage2D(3553,Z,0,0,Ie.width,Ie.height,Se,ve,Ie.data):t.texImage2D(3553,Z,Pe,Ie.width,Ie.height,0,Se,ve,Ie.data)}else if(w.isDataArrayTexture)ft?(At&&t.texStorage3D(35866,R,Pe,F.width,F.height,F.depth),t.texSubImage3D(35866,0,0,0,0,F.width,F.height,F.depth,Se,ve,F.data)):t.texImage3D(35866,0,Pe,F.width,F.height,F.depth,0,Se,ve,F.data);else if(w.isData3DTexture)ft?(At&&t.texStorage3D(32879,R,Pe,F.width,F.height,F.depth),t.texSubImage3D(32879,0,0,0,0,F.width,F.height,F.depth,Se,ve,F.data)):t.texImage3D(32879,0,Pe,F.width,F.height,F.depth,0,Se,ve,F.data);else if(w.isFramebufferTexture){if(At)if(ft)t.texStorage2D(3553,R,Pe,F.width,F.height);else{let Z=F.width,ae=F.height;for(let xe=0;xe<R;xe++)t.texImage2D(3553,xe,Pe,Z,ae,0,Se,ve,null),Z>>=1,ae>>=1}}else if(ct.length>0&&_e){ft&&At&&t.texStorage2D(3553,R,Pe,ct[0].width,ct[0].height);for(let Z=0,ae=ct.length;Z<ae;Z++)Ie=ct[Z],ft?t.texSubImage2D(3553,Z,0,0,Se,ve,Ie):t.texImage2D(3553,Z,Pe,Se,ve,Ie);w.generateMipmaps=!1}else ft?(At&&t.texStorage2D(3553,R,Pe,F.width,F.height),t.texSubImage2D(3553,0,0,0,Se,ve,F)):t.texImage2D(3553,0,Pe,Se,ve,F);M(w,_e)&&I(se),He.__version=me.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}function de(T,w,W,se,le){const me=s.convert(W.format,W.encoding),He=s.convert(W.type),A=x(W.internalFormat,me,He,W.encoding);i.get(w).__hasExternalTextures||(32879===le||35866===le?t.texImage3D(le,0,A,w.width,w.height,w.depth,0,me,He,null):t.texImage2D(le,0,A,w.width,w.height,0,me,He,null)),t.bindFramebuffer(36160,T),Oe(w)?h.framebufferTexture2DMultisampleEXT(36160,se,le,i.get(W).__webglTexture,0,ke(w)):(3553===le||le>=34069&&le<=34074)&&n.framebufferTexture2D(36160,se,le,i.get(W).__webglTexture,0),t.bindFramebuffer(36160,null)}function We(T,w,W){if(n.bindRenderbuffer(36161,T),w.depthBuffer&&!w.stencilBuffer){let se=33189;if(W||Oe(w)){const le=w.depthTexture;le&&le.isDepthTexture&&(le.type===Rs?se=36012:le.type===To&&(se=33190));const me=ke(w);Oe(w)?h.renderbufferStorageMultisampleEXT(36161,me,se,w.width,w.height):n.renderbufferStorageMultisample(36161,me,se,w.width,w.height)}else n.renderbufferStorage(36161,se,w.width,w.height);n.framebufferRenderbuffer(36160,36096,36161,T)}else if(w.depthBuffer&&w.stencilBuffer){const se=ke(w);W&&!1===Oe(w)?n.renderbufferStorageMultisample(36161,se,35056,w.width,w.height):Oe(w)?h.renderbufferStorageMultisampleEXT(36161,se,35056,w.width,w.height):n.renderbufferStorage(36161,34041,w.width,w.height),n.framebufferRenderbuffer(36160,33306,36161,T)}else{const se=!0===w.isWebGLMultipleRenderTargets?w.texture:[w.texture];for(let le=0;le<se.length;le++){const me=se[le],He=s.convert(me.format,me.encoding),A=s.convert(me.type),F=x(me.internalFormat,He,A,me.encoding),_e=ke(w);W&&!1===Oe(w)?n.renderbufferStorageMultisample(36161,_e,F,w.width,w.height):Oe(w)?h.renderbufferStorageMultisampleEXT(36161,_e,F,w.width,w.height):n.renderbufferStorage(36161,F,w.width,w.height)}}n.bindRenderbuffer(36161,null)}function J(T){const w=i.get(T),W=!0===T.isWebGLCubeRenderTarget;if(T.depthTexture&&!w.__autoAllocateDepthBuffer){if(W)throw new Error("target.depthTexture not supported in Cube render targets");!function ee(T,w){if(w&&w.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(36160,T),!w.depthTexture||!w.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(w.depthTexture).__webglTexture||w.depthTexture.image.width!==w.width||w.depthTexture.image.height!==w.height)&&(w.depthTexture.image.width=w.width,w.depthTexture.image.height=w.height,w.depthTexture.needsUpdate=!0),q(w.depthTexture,0);const se=i.get(w.depthTexture).__webglTexture,le=ke(w);if(w.depthTexture.format===Ao)Oe(w)?h.framebufferTexture2DMultisampleEXT(36160,36096,3553,se,0,le):n.framebufferTexture2D(36160,36096,3553,se,0);else{if(w.depthTexture.format!==ul)throw new Error("Unknown depthTexture format");Oe(w)?h.framebufferTexture2DMultisampleEXT(36160,33306,3553,se,0,le):n.framebufferTexture2D(36160,33306,3553,se,0)}}(w.__webglFramebuffer,T)}else if(W){w.__webglDepthbuffer=[];for(let se=0;se<6;se++)t.bindFramebuffer(36160,w.__webglFramebuffer[se]),w.__webglDepthbuffer[se]=n.createRenderbuffer(),We(w.__webglDepthbuffer[se],T,!1)}else t.bindFramebuffer(36160,w.__webglFramebuffer),w.__webglDepthbuffer=n.createRenderbuffer(),We(w.__webglDepthbuffer,T,!1);t.bindFramebuffer(36160,null)}function ke(T){return Math.min(d,T.samples)}function Oe(T){const w=i.get(T);return a&&T.samples>0&&!0===e.has("WEBGL_multisampled_render_to_texture")&&!1!==w.__useRenderToTexture}function vt(T,w){const W=T.encoding,se=T.format,le=T.type;return!0===T.isCompressedTexture||!0===T.isVideoTexture||1035===T.format||W!==Io&&(W===Gt?!1===a?!0===e.has("EXT_sRGB")&&se===Bi?(T.format=1035,T.minFilter=an,T.generateMipmaps=!1):w=hA.sRGBToLinear(w):(se!==Bi||le!==Do)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",W)),w}this.allocateTextureUnit=function O(){const T=N;return T>=l&&console.warn("THREE.WebGLTextures: Trying to use "+T+" texture units while this GPU supports only "+l),N+=1,T},this.resetTextureUnits=function U(){N=0},this.setTexture2D=q,this.setTexture2DArray=function G(T,w){const W=i.get(T);T.version>0&&W.__version!==T.version?ye(W,T,w):t.bindTexture(35866,W.__webglTexture,33984+w)},this.setTexture3D=function H(T,w){const W=i.get(T);T.version>0&&W.__version!==T.version?ye(W,T,w):t.bindTexture(32879,W.__webglTexture,33984+w)},this.setTextureCube=function oe(T,w){const W=i.get(T);T.version>0&&W.__version!==T.version?function Ce(T,w,W){if(6!==w.image.length)return;const se=Me(T,w),le=w.source;t.bindTexture(34067,T.__webglTexture,33984+W);const me=i.get(le);if(le.version!==me.__version||!0===se){t.activeTexture(33984+W),n.pixelStorei(37440,w.flipY),n.pixelStorei(37441,w.premultiplyAlpha),n.pixelStorei(3317,w.unpackAlignment),n.pixelStorei(37443,0);const He=w.isCompressedTexture||w.image[0].isCompressedTexture,A=w.image[0]&&w.image[0].isDataTexture,F=[];for(let Z=0;Z<6;Z++)F[Z]=He||A?A?w.image[Z].image:w.image[Z]:_(w.image[Z],!1,!0,c),F[Z]=vt(w,F[Z]);const _e=F[0],Se=v(_e)||a,ve=s.convert(w.format,w.encoding),Pe=s.convert(w.type),Ie=x(w.internalFormat,ve,Pe,w.encoding),ct=a&&!0!==w.isVideoTexture,ft=void 0===me.__version||!0===se;let R,At=D(w,_e,Se);if(Y(34067,w,Se),He){ct&&ft&&t.texStorage2D(34067,At,Ie,_e.width,_e.height);for(let Z=0;Z<6;Z++){R=F[Z].mipmaps;for(let ae=0;ae<R.length;ae++){const xe=R[ae];w.format!==Bi?null!==ve?ct?t.compressedTexSubImage2D(34069+Z,ae,0,0,xe.width,xe.height,ve,xe.data):t.compressedTexImage2D(34069+Z,ae,Ie,xe.width,xe.height,0,xe.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):ct?t.texSubImage2D(34069+Z,ae,0,0,xe.width,xe.height,ve,Pe,xe.data):t.texImage2D(34069+Z,ae,Ie,xe.width,xe.height,0,ve,Pe,xe.data)}}}else{R=w.mipmaps,ct&&ft&&(R.length>0&&At++,t.texStorage2D(34067,At,Ie,F[0].width,F[0].height));for(let Z=0;Z<6;Z++)if(A){ct?t.texSubImage2D(34069+Z,0,0,0,F[Z].width,F[Z].height,ve,Pe,F[Z].data):t.texImage2D(34069+Z,0,Ie,F[Z].width,F[Z].height,0,ve,Pe,F[Z].data);for(let ae=0;ae<R.length;ae++){const Le=R[ae].image[Z].image;ct?t.texSubImage2D(34069+Z,ae+1,0,0,Le.width,Le.height,ve,Pe,Le.data):t.texImage2D(34069+Z,ae+1,Ie,Le.width,Le.height,0,ve,Pe,Le.data)}}else{ct?t.texSubImage2D(34069+Z,0,0,0,ve,Pe,F[Z]):t.texImage2D(34069+Z,0,Ie,ve,Pe,F[Z]);for(let ae=0;ae<R.length;ae++){const xe=R[ae];ct?t.texSubImage2D(34069+Z,ae+1,0,0,ve,Pe,xe.image[Z]):t.texImage2D(34069+Z,ae+1,Ie,ve,Pe,xe.image[Z])}}}M(w,Se)&&I(34067),me.__version=le.version,w.onUpdate&&w.onUpdate(w)}T.__version=w.version}(W,T,w):t.bindTexture(34067,W.__webglTexture,33984+w)},this.rebindTextures=function ce(T,w,W){const se=i.get(T);void 0!==w&&de(se.__webglFramebuffer,T,T.texture,36064,3553),void 0!==W&&J(T)},this.setupRenderTarget=function Ee(T){const w=T.texture,W=i.get(T),se=i.get(w);T.addEventListener("dispose",ne),!0!==T.isWebGLMultipleRenderTargets&&(void 0===se.__webglTexture&&(se.__webglTexture=n.createTexture()),se.__version=w.version,o.memory.textures++);const le=!0===T.isWebGLCubeRenderTarget,me=!0===T.isWebGLMultipleRenderTargets,He=v(T)||a;if(le){W.__webglFramebuffer=[];for(let A=0;A<6;A++)W.__webglFramebuffer[A]=n.createFramebuffer()}else{if(W.__webglFramebuffer=n.createFramebuffer(),me)if(r.drawBuffers){const A=T.texture;for(let F=0,_e=A.length;F<_e;F++){const Se=i.get(A[F]);void 0===Se.__webglTexture&&(Se.__webglTexture=n.createTexture(),o.memory.textures++)}}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(a&&T.samples>0&&!1===Oe(T)){const A=me?w:[w];W.__webglMultisampledFramebuffer=n.createFramebuffer(),W.__webglColorRenderbuffer=[],t.bindFramebuffer(36160,W.__webglMultisampledFramebuffer);for(let F=0;F<A.length;F++){const _e=A[F];W.__webglColorRenderbuffer[F]=n.createRenderbuffer(),n.bindRenderbuffer(36161,W.__webglColorRenderbuffer[F]);const Se=s.convert(_e.format,_e.encoding),ve=s.convert(_e.type),Pe=x(_e.internalFormat,Se,ve,_e.encoding,!0===T.isXRRenderTarget),Ie=ke(T);n.renderbufferStorageMultisample(36161,Ie,Pe,T.width,T.height),n.framebufferRenderbuffer(36160,36064+F,36161,W.__webglColorRenderbuffer[F])}n.bindRenderbuffer(36161,null),T.depthBuffer&&(W.__webglDepthRenderbuffer=n.createRenderbuffer(),We(W.__webglDepthRenderbuffer,T,!0)),t.bindFramebuffer(36160,null)}}if(le){t.bindTexture(34067,se.__webglTexture),Y(34067,w,He);for(let A=0;A<6;A++)de(W.__webglFramebuffer[A],T,w,36064,34069+A);M(w,He)&&I(34067),t.unbindTexture()}else if(me){const A=T.texture;for(let F=0,_e=A.length;F<_e;F++){const Se=A[F],ve=i.get(Se);t.bindTexture(3553,ve.__webglTexture),Y(3553,Se,He),de(W.__webglFramebuffer,T,Se,36064+F,3553),M(Se,He)&&I(3553)}t.unbindTexture()}else{let A=3553;(T.isWebGL3DRenderTarget||T.isWebGLArrayRenderTarget)&&(a?A=T.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),t.bindTexture(A,se.__webglTexture),Y(A,w,He),de(W.__webglFramebuffer,T,w,36064,A),M(w,He)&&I(A),t.unbindTexture()}T.depthBuffer&&J(T)},this.updateRenderTargetMipmap=function fe(T){const w=v(T)||a,W=!0===T.isWebGLMultipleRenderTargets?T.texture:[T.texture];for(let se=0,le=W.length;se<le;se++){const me=W[se];if(M(me,w)){const He=T.isWebGLCubeRenderTarget?34067:3553,A=i.get(me).__webglTexture;t.bindTexture(He,A),I(He),t.unbindTexture()}}},this.updateMultisampleRenderTarget=function Ge(T){if(a&&T.samples>0&&!1===Oe(T)){const w=T.isWebGLMultipleRenderTargets?T.texture:[T.texture],W=T.width,se=T.height;let le=16384;const me=[],He=T.stencilBuffer?33306:36096,A=i.get(T),F=!0===T.isWebGLMultipleRenderTargets;if(F)for(let _e=0;_e<w.length;_e++)t.bindFramebuffer(36160,A.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+_e,36161,null),t.bindFramebuffer(36160,A.__webglFramebuffer),n.framebufferTexture2D(36009,36064+_e,3553,null,0);t.bindFramebuffer(36008,A.__webglMultisampledFramebuffer),t.bindFramebuffer(36009,A.__webglFramebuffer);for(let _e=0;_e<w.length;_e++){me.push(36064+_e),T.depthBuffer&&me.push(He);const Se=void 0!==A.__ignoreDepthValues&&A.__ignoreDepthValues;if(!1===Se&&(T.depthBuffer&&(le|=256),T.stencilBuffer&&(le|=1024)),F&&n.framebufferRenderbuffer(36008,36064,36161,A.__webglColorRenderbuffer[_e]),!0===Se&&(n.invalidateFramebuffer(36008,[He]),n.invalidateFramebuffer(36009,[He])),F){const ve=i.get(w[_e]).__webglTexture;n.framebufferTexture2D(36009,36064,3553,ve,0)}n.blitFramebuffer(0,0,W,se,0,0,W,se,le,9728),f&&n.invalidateFramebuffer(36008,me)}if(t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null),F)for(let _e=0;_e<w.length;_e++){t.bindFramebuffer(36160,A.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(36160,36064+_e,36161,A.__webglColorRenderbuffer[_e]);const Se=i.get(w[_e]).__webglTexture;t.bindFramebuffer(36160,A.__webglFramebuffer),n.framebufferTexture2D(36009,36064+_e,3553,Se,0)}t.bindFramebuffer(36009,A.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=J,this.setupFrameBufferTexture=de,this.useMultisampledRTT=Oe}function w7(n,e,t){const i=t.isWebGL2;return{convert:function r(s,o=null){let a;if(s===Do)return 5121;if(1017===s)return 32819;if(1018===s)return 32820;if(1010===s)return 5120;if(1011===s)return 5122;if(1012===s)return 5123;if(1013===s)return 5124;if(s===To)return 5125;if(s===Rs)return 5126;if(s===Eu)return i?5131:(a=e.get("OES_texture_half_float"),null!==a?a.HALF_FLOAT_OES:null);if(1021===s)return 6406;if(s===Bi)return 6408;if(1024===s)return 6409;if(1025===s)return 6410;if(s===Ao)return 6402;if(s===ul)return 34041;if(1022===s)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(1035===s)return a=e.get("EXT_sRGB"),null!==a?a.SRGB_ALPHA_EXT:null;if(1028===s)return 6403;if(1029===s)return 36244;if(1030===s)return 33319;if(1031===s)return 33320;if(1033===s)return 36249;if(33776===s||33777===s||33778===s||33779===s)if(o===Gt){if(a=e.get("WEBGL_compressed_texture_s3tc_srgb"),null===a)return null;if(33776===s)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(a=e.get("WEBGL_compressed_texture_s3tc"),null===a)return null;if(33776===s)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(33777===s)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(33778===s)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(33779===s)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(35840===s||35841===s||35842===s||35843===s){if(a=e.get("WEBGL_compressed_texture_pvrtc"),null===a)return null;if(35840===s)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(35841===s)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(35842===s)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(35843===s)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(36196===s)return a=e.get("WEBGL_compressed_texture_etc1"),null!==a?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(37492===s||37496===s){if(a=e.get("WEBGL_compressed_texture_etc"),null===a)return null;if(37492===s)return o===Gt?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(37496===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(37808===s||37809===s||37810===s||37811===s||37812===s||37813===s||37814===s||37815===s||37816===s||37817===s||37818===s||37819===s||37820===s||37821===s){if(a=e.get("WEBGL_compressed_texture_astc"),null===a)return null;if(37808===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(37809===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(37810===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(37811===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(37812===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(37813===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(37814===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(37815===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(37816===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(37817===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(37818===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(37819===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(37820===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(37821===s)return o===Gt?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(36492===s){if(a=e.get("EXT_texture_compression_bptc"),null===a)return null;if(36492===s)return o===Gt?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}return s===cl?i?34042:(a=e.get("WEBGL_depth_texture"),null!==a?a.UNSIGNED_INT_24_8_WEBGL:null):void 0!==n[s]?n[s]:null}}}class M7 extends In{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class js extends bi{constructor(){super(),this.isGroup=!0,this.type="Group"}}const E7={type:"move"};class Xv{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return null===this._hand&&(this._hand=new js,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return null===this._targetRay&&(this._targetRay=new js,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new E,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new E),this._targetRay}getGripSpace(){return null===this._grip&&(this._grip=new js,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new E,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new E),this._grip}dispatchEvent(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}update(e,t,i){let r=null,s=null,o=null;const a=this._targetRay,l=this._grip,c=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(c&&e.hand){o=!0;for(const g of e.hand.values()){const m=t.getJointPose(g,i),y=this._getHandJoint(c,g);null!==m&&(y.matrix.fromArray(m.transform.matrix),y.matrix.decompose(y.position,y.rotation,y.scale),y.jointRadius=m.radius),y.visible=null!==m}const h=c.joints["index-finger-tip"].position.distanceTo(c.joints["thumb-tip"].position),f=.02,p=.005;c.inputState.pinching&&h>f+p?(c.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!c.inputState.pinching&&h<=f-p&&(c.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==l&&e.gripSpace&&(s=t.getPose(e.gripSpace,i),null!==s&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1));null!==a&&(r=t.getPose(e.targetRaySpace,i),null===r&&null!==s&&(r=s),null!==r&&(a.matrix.fromArray(r.transform.matrix),a.matrix.decompose(a.position,a.rotation,a.scale),r.linearVelocity?(a.hasLinearVelocity=!0,a.linearVelocity.copy(r.linearVelocity)):a.hasLinearVelocity=!1,r.angularVelocity?(a.hasAngularVelocity=!0,a.angularVelocity.copy(r.angularVelocity)):a.hasAngularVelocity=!1,this.dispatchEvent(E7)))}return null!==a&&(a.visible=null!==r),null!==l&&(l.visible=null!==s),null!==c&&(c.visible=null!==o),this}_getHandJoint(e,t){if(void 0===e.joints[t.jointName]){const i=new js;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}class C7 extends ns{constructor(e,t,i,r,s,o,a,l,c,u){if((u=void 0!==u?u:Ao)!==Ao&&u!==ul)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");void 0===i&&u===Ao&&(i=To),void 0===i&&u===ul&&(i=cl),super(null,r,s,o,a,l,u,i,c),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=void 0!==a?a:_n,this.minFilter=void 0!==l?l:_n,this.flipY=!1,this.generateMipmaps=!1}}class D7 extends Ls{constructor(e,t){super();const i=this;let r=null,s=1,o=null,a="local-floor",l=null,c=null,u=null,d=null,h=null,f=null;const p=t.getContextAttributes();let g=null,m=null;const y=[],b=[],_=new Set,v=new Map,S=new In;S.layers.enable(1),S.viewport=new Dt;const M=new In;M.layers.enable(2),M.viewport=new Dt;const I=[S,M],x=new M7;x.layers.enable(1),x.layers.enable(2);let D=null,P=null;function V(G){const H=b.indexOf(G.inputSource);if(-1===H)return;const oe=y[H];void 0!==oe&&oe.dispatchEvent({type:G.type,data:G.inputSource})}function ne(){r.removeEventListener("select",V),r.removeEventListener("selectstart",V),r.removeEventListener("selectend",V),r.removeEventListener("squeeze",V),r.removeEventListener("squeezestart",V),r.removeEventListener("squeezeend",V),r.removeEventListener("end",ne),r.removeEventListener("inputsourceschange",z);for(let G=0;G<y.length;G++){const H=b[G];null!==H&&(b[G]=null,y[G].disconnect(H))}D=null,P=null,e.setRenderTarget(g),h=null,d=null,u=null,r=null,m=null,q.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function z(G){for(let H=0;H<G.removed.length;H++){const oe=G.removed[H],te=b.indexOf(oe);te>=0&&(b[te]=null,y[te].disconnect(oe))}for(let H=0;H<G.added.length;H++){const oe=G.added[H];let te=b.indexOf(oe);if(-1===te){for(let Y=0;Y<y.length;Y++){if(Y>=b.length){b.push(oe),te=Y;break}if(null===b[Y]){b[Y]=oe,te=Y;break}}if(-1===te)break}const ue=y[te];ue&&ue.connect(oe)}}this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(G){let H=y[G];return void 0===H&&(H=new Xv,y[G]=H),H.getTargetRaySpace()},this.getControllerGrip=function(G){let H=y[G];return void 0===H&&(H=new Xv,y[G]=H),H.getGripSpace()},this.getHand=function(G){let H=y[G];return void 0===H&&(H=new Xv,y[G]=H),H.getHandSpace()},this.setFramebufferScaleFactor=function(G){s=G,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(G){a=G,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return l||o},this.setReferenceSpace=function(G){l=G},this.getBaseLayer=function(){return null!==d?d:h},this.getBinding=function(){return u},this.getFrame=function(){return f},this.getSession=function(){return r},this.setSession=function(){var G=function i8(n){return function(){var e=this,t=arguments;return new Promise(function(i,r){var s=n.apply(e,t);function o(l){D1(s,i,r,o,a,"next",l)}function a(l){D1(s,i,r,o,a,"throw",l)}o(void 0)})}}(function*(H){if(r=H,null!==r){if(g=e.getRenderTarget(),r.addEventListener("select",V),r.addEventListener("selectstart",V),r.addEventListener("selectend",V),r.addEventListener("squeeze",V),r.addEventListener("squeezestart",V),r.addEventListener("squeezeend",V),r.addEventListener("end",ne),r.addEventListener("inputsourceschange",z),!0!==p.xrCompatible&&(yield t.makeXRCompatible()),void 0===r.renderState.layers||!1===e.capabilities.isWebGL2)h=new XRWebGLLayer(r,t,{antialias:void 0!==r.renderState.layers||p.antialias,alpha:p.alpha,depth:p.depth,stencil:p.stencil,framebufferScaleFactor:s}),r.updateRenderState({baseLayer:h}),m=new No(h.framebufferWidth,h.framebufferHeight,{format:Bi,type:Do,encoding:e.outputEncoding,stencilBuffer:p.stencil});else{let oe=null,te=null,ue=null;p.depth&&(ue=p.stencil?35056:33190,oe=p.stencil?ul:Ao,te=p.stencil?cl:To);const Y={colorFormat:32856,depthFormat:ue,scaleFactor:s};u=new XRWebGLBinding(r,t),d=u.createProjectionLayer(Y),r.updateRenderState({layers:[d]}),m=new No(d.textureWidth,d.textureHeight,{format:Bi,type:Do,depthTexture:new C7(d.textureWidth,d.textureHeight,te,void 0,void 0,void 0,void 0,void 0,void 0,oe),stencilBuffer:p.stencil,encoding:e.outputEncoding,samples:p.antialias?4:0}),e.properties.get(m).__ignoreDepthValues=d.ignoreDepthValues}m.isXRRenderTarget=!0,this.setFoveation(1),l=null,o=yield r.requestReferenceSpace(a),q.setContext(r),q.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}});return function(H){return G.apply(this,arguments)}}();const L=new E,j=new E;function U(G,H){null===H?G.matrixWorld.copy(G.matrix):G.matrixWorld.multiplyMatrices(H.matrixWorld,G.matrix),G.matrixWorldInverse.copy(G.matrixWorld).invert()}this.updateCamera=function(G){if(null===r)return;x.near=M.near=S.near=G.near,x.far=M.far=S.far=G.far,(D!==x.near||P!==x.far)&&(r.updateRenderState({depthNear:x.near,depthFar:x.far}),D=x.near,P=x.far);const H=G.parent,oe=x.cameras;U(x,H);for(let ue=0;ue<oe.length;ue++)U(oe[ue],H);x.matrixWorld.decompose(x.position,x.quaternion,x.scale),G.matrix.copy(x.matrix),G.matrix.decompose(G.position,G.quaternion,G.scale);const te=G.children;for(let ue=0,Y=te.length;ue<Y;ue++)te[ue].updateMatrixWorld(!0);2===oe.length?function N(G,H,oe){L.setFromMatrixPosition(H.matrixWorld),j.setFromMatrixPosition(oe.matrixWorld);const te=L.distanceTo(j),ue=H.projectionMatrix.elements,Y=oe.projectionMatrix.elements,Me=ue[14]/(ue[10]-1),ye=ue[14]/(ue[10]+1),Ce=(ue[9]+1)/ue[5],de=(ue[9]-1)/ue[5],We=(ue[8]-1)/ue[0],ee=(Y[8]+1)/Y[0],J=Me*We,ce=Me*ee,Ee=te/(-We+ee),fe=Ee*-We;H.matrixWorld.decompose(G.position,G.quaternion,G.scale),G.translateX(fe),G.translateZ(Ee),G.matrixWorld.compose(G.position,G.quaternion,G.scale),G.matrixWorldInverse.copy(G.matrixWorld).invert();const Ge=Me+Ee,ke=ye+Ee;G.projectionMatrix.makePerspective(J-fe,ce+(te-fe),Ce*ye/ke*Ge,de*ye/ke*Ge,Ge,ke)}(x,S,M):x.projectionMatrix.copy(S.projectionMatrix)},this.getCamera=function(){return x},this.getFoveation=function(){return null!==d?d.fixedFoveation:null!==h?h.fixedFoveation:void 0},this.setFoveation=function(G){null!==d&&(d.fixedFoveation=G),null!==h&&void 0!==h.fixedFoveation&&(h.fixedFoveation=G)},this.getPlanes=function(){return _};let O=null;const q=new DA;q.setAnimationLoop(function $(G,H){if(c=H.getViewerPose(l||o),f=H,null!==c){const oe=c.views;null!==h&&(e.setRenderTargetFramebuffer(m,h.framebuffer),e.setRenderTarget(m));let te=!1;oe.length!==x.cameras.length&&(x.cameras.length=0,te=!0);for(let ue=0;ue<oe.length;ue++){const Y=oe[ue];let Me=null;if(null!==h)Me=h.getViewport(Y);else{const Ce=u.getViewSubImage(d,Y);Me=Ce.viewport,0===ue&&(e.setRenderTargetTextures(m,Ce.colorTexture,d.ignoreDepthValues?void 0:Ce.depthStencilTexture),e.setRenderTarget(m))}let ye=I[ue];void 0===ye&&(ye=new In,ye.layers.enable(ue),ye.viewport=new Dt,I[ue]=ye),ye.matrix.fromArray(Y.transform.matrix),ye.projectionMatrix.fromArray(Y.projectionMatrix),ye.viewport.set(Me.x,Me.y,Me.width,Me.height),0===ue&&x.matrix.copy(ye.matrix),!0===te&&x.cameras.push(ye)}}for(let oe=0;oe<y.length;oe++){const te=b[oe],ue=y[oe];null!==te&&void 0!==ue&&ue.update(te,H,l||o)}if(O&&O(G,H),H.detectedPlanes){i.dispatchEvent({type:"planesdetected",data:H.detectedPlanes});let oe=null;for(const te of _)H.detectedPlanes.has(te)||(null===oe&&(oe=[]),oe.push(te));if(null!==oe)for(const te of oe)_.delete(te),v.delete(te),i.dispatchEvent({type:"planeremoved",data:te});for(const te of H.detectedPlanes)if(_.has(te)){const ue=v.get(te);te.lastChangedTime>ue&&(v.set(te,te.lastChangedTime),i.dispatchEvent({type:"planechanged",data:te}))}else _.add(te),v.set(te,H.lastChangedTime),i.dispatchEvent({type:"planeadded",data:te})}f=null}),this.setAnimationLoop=function(G){O=G},this.dispose=function(){}}}function T7(n,e){function r(g,m){g.opacity.value=m.opacity,m.color&&g.diffuse.value.copy(m.color),m.emissive&&g.emissive.value.copy(m.emissive).multiplyScalar(m.emissiveIntensity),m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.bumpMap&&(g.bumpMap.value=m.bumpMap,g.bumpScale.value=m.bumpScale,1===m.side&&(g.bumpScale.value*=-1)),m.displacementMap&&(g.displacementMap.value=m.displacementMap,g.displacementScale.value=m.displacementScale,g.displacementBias.value=m.displacementBias),m.emissiveMap&&(g.emissiveMap.value=m.emissiveMap),m.normalMap&&(g.normalMap.value=m.normalMap,g.normalScale.value.copy(m.normalScale),1===m.side&&g.normalScale.value.negate()),m.specularMap&&(g.specularMap.value=m.specularMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest);const y=e.get(m).envMap;if(y&&(g.envMap.value=y,g.flipEnvMap.value=y.isCubeTexture&&!1===y.isRenderTargetTexture?-1:1,g.reflectivity.value=m.reflectivity,g.ior.value=m.ior,g.refractionRatio.value=m.refractionRatio),m.lightMap){g.lightMap.value=m.lightMap;const v=!0!==n.physicallyCorrectLights?Math.PI:1;g.lightMapIntensity.value=m.lightMapIntensity*v}let b,_;m.aoMap&&(g.aoMap.value=m.aoMap,g.aoMapIntensity.value=m.aoMapIntensity),m.map?b=m.map:m.specularMap?b=m.specularMap:m.displacementMap?b=m.displacementMap:m.normalMap?b=m.normalMap:m.bumpMap?b=m.bumpMap:m.roughnessMap?b=m.roughnessMap:m.metalnessMap?b=m.metalnessMap:m.alphaMap?b=m.alphaMap:m.emissiveMap?b=m.emissiveMap:m.clearcoatMap?b=m.clearcoatMap:m.clearcoatNormalMap?b=m.clearcoatNormalMap:m.clearcoatRoughnessMap?b=m.clearcoatRoughnessMap:m.iridescenceMap?b=m.iridescenceMap:m.iridescenceThicknessMap?b=m.iridescenceThicknessMap:m.specularIntensityMap?b=m.specularIntensityMap:m.specularColorMap?b=m.specularColorMap:m.transmissionMap?b=m.transmissionMap:m.thicknessMap?b=m.thicknessMap:m.sheenColorMap?b=m.sheenColorMap:m.sheenRoughnessMap&&(b=m.sheenRoughnessMap),void 0!==b&&(b.isWebGLRenderTarget&&(b=b.texture),!0===b.matrixAutoUpdate&&b.updateMatrix(),g.uvTransform.value.copy(b.matrix)),m.aoMap?_=m.aoMap:m.lightMap&&(_=m.lightMap),void 0!==_&&(_.isWebGLRenderTarget&&(_=_.texture),!0===_.matrixAutoUpdate&&_.updateMatrix(),g.uv2Transform.value.copy(_.matrix))}return{refreshFogUniforms:function t(g,m){m.color.getRGB(g.fogColor.value,CA(n)),m.isFog?(g.fogNear.value=m.near,g.fogFar.value=m.far):m.isFogExp2&&(g.fogDensity.value=m.density)},refreshMaterialUniforms:function i(g,m,y,b,_){m.isMeshBasicMaterial||m.isMeshLambertMaterial?r(g,m):m.isMeshToonMaterial?(r(g,m),function u(g,m){m.gradientMap&&(g.gradientMap.value=m.gradientMap)}(g,m)):m.isMeshPhongMaterial?(r(g,m),function c(g,m){g.specular.value.copy(m.specular),g.shininess.value=Math.max(m.shininess,1e-4)}(g,m)):m.isMeshStandardMaterial?(r(g,m),function d(g,m){g.roughness.value=m.roughness,g.metalness.value=m.metalness,m.roughnessMap&&(g.roughnessMap.value=m.roughnessMap),m.metalnessMap&&(g.metalnessMap.value=m.metalnessMap),e.get(m).envMap&&(g.envMapIntensity.value=m.envMapIntensity)}(g,m),m.isMeshPhysicalMaterial&&function h(g,m,y){g.ior.value=m.ior,m.sheen>0&&(g.sheenColor.value.copy(m.sheenColor).multiplyScalar(m.sheen),g.sheenRoughness.value=m.sheenRoughness,m.sheenColorMap&&(g.sheenColorMap.value=m.sheenColorMap),m.sheenRoughnessMap&&(g.sheenRoughnessMap.value=m.sheenRoughnessMap)),m.clearcoat>0&&(g.clearcoat.value=m.clearcoat,g.clearcoatRoughness.value=m.clearcoatRoughness,m.clearcoatMap&&(g.clearcoatMap.value=m.clearcoatMap),m.clearcoatRoughnessMap&&(g.clearcoatRoughnessMap.value=m.clearcoatRoughnessMap),m.clearcoatNormalMap&&(g.clearcoatNormalScale.value.copy(m.clearcoatNormalScale),g.clearcoatNormalMap.value=m.clearcoatNormalMap,1===m.side&&g.clearcoatNormalScale.value.negate())),m.iridescence>0&&(g.iridescence.value=m.iridescence,g.iridescenceIOR.value=m.iridescenceIOR,g.iridescenceThicknessMinimum.value=m.iridescenceThicknessRange[0],g.iridescenceThicknessMaximum.value=m.iridescenceThicknessRange[1],m.iridescenceMap&&(g.iridescenceMap.value=m.iridescenceMap),m.iridescenceThicknessMap&&(g.iridescenceThicknessMap.value=m.iridescenceThicknessMap)),m.transmission>0&&(g.transmission.value=m.transmission,g.transmissionSamplerMap.value=y.texture,g.transmissionSamplerSize.value.set(y.width,y.height),m.transmissionMap&&(g.transmissionMap.value=m.transmissionMap),g.thickness.value=m.thickness,m.thicknessMap&&(g.thicknessMap.value=m.thicknessMap),g.attenuationDistance.value=m.attenuationDistance,g.attenuationColor.value.copy(m.attenuationColor)),g.specularIntensity.value=m.specularIntensity,g.specularColor.value.copy(m.specularColor),m.specularIntensityMap&&(g.specularIntensityMap.value=m.specularIntensityMap),m.specularColorMap&&(g.specularColorMap.value=m.specularColorMap)}(g,m,_)):m.isMeshMatcapMaterial?(r(g,m),function f(g,m){m.matcap&&(g.matcap.value=m.matcap)}(g,m)):m.isMeshDepthMaterial?r(g,m):m.isMeshDistanceMaterial?(r(g,m),function p(g,m){g.referencePosition.value.copy(m.referencePosition),g.nearDistance.value=m.nearDistance,g.farDistance.value=m.farDistance}(g,m)):m.isMeshNormalMaterial?r(g,m):m.isLineBasicMaterial?(function s(g,m){g.diffuse.value.copy(m.color),g.opacity.value=m.opacity}(g,m),m.isLineDashedMaterial&&function o(g,m){g.dashSize.value=m.dashSize,g.totalSize.value=m.dashSize+m.gapSize,g.scale.value=m.scale}(g,m)):m.isPointsMaterial?function a(g,m,y,b){let _;g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.size.value=m.size*y,g.scale.value=.5*b,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest),m.map?_=m.map:m.alphaMap&&(_=m.alphaMap),void 0!==_&&(!0===_.matrixAutoUpdate&&_.updateMatrix(),g.uvTransform.value.copy(_.matrix))}(g,m,y,b):m.isSpriteMaterial?function l(g,m){let y;g.diffuse.value.copy(m.color),g.opacity.value=m.opacity,g.rotation.value=m.rotation,m.map&&(g.map.value=m.map),m.alphaMap&&(g.alphaMap.value=m.alphaMap),m.alphaTest>0&&(g.alphaTest.value=m.alphaTest),m.map?y=m.map:m.alphaMap&&(y=m.alphaMap),void 0!==y&&(!0===y.matrixAutoUpdate&&y.updateMatrix(),g.uvTransform.value.copy(y.matrix))}(g,m):m.isShadowMaterial?(g.color.value.copy(m.color),g.opacity.value=m.opacity):m.isShaderMaterial&&(m.uniformsNeedUpdate=!1)}}}function A7(n,e,t,i){let r={},s={},o=[];const a=t.isWebGL2?n.getParameter(35375):0;function f(b,_,v){const S=b.value;if(void 0===v[_])return v[_]="number"==typeof S?S:S.clone(),!0;if("number"==typeof S){if(v[_]!==S)return v[_]=S,!0}else{const M=v[_];if(!1===M.equals(S))return M.copy(S),!0}return!1}function g(b){const _=b.value,v={boundary:0,storage:0};return"number"==typeof _?(v.boundary=4,v.storage=4):_.isVector2?(v.boundary=8,v.storage=8):_.isVector3||_.isColor?(v.boundary=16,v.storage=12):_.isVector4?(v.boundary=16,v.storage=16):_.isMatrix3?(v.boundary=48,v.storage=48):_.isMatrix4?(v.boundary=64,v.storage=64):_.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",_),v}function m(b){const _=b.target;_.removeEventListener("dispose",m);const v=o.indexOf(_.__bindingPointIndex);o.splice(v,1),n.deleteBuffer(r[_.id]),delete r[_.id],delete s[_.id]}return{bind:function l(b,_){i.uniformBlockBinding(b,_.program)},update:function c(b,_){let v=r[b.id];void 0===v&&(function p(b){const _=b.uniforms;let v=0;let M=0;for(let I=0,x=_.length;I<x;I++){const D=_[I],P=g(D);if(D.__data=new Float32Array(P.storage/Float32Array.BYTES_PER_ELEMENT),D.__offset=v,I>0){M=v%16;const V=16-M;0!==M&&V-P.boundary<0&&(v+=16-M,D.__offset=v)}v+=P.storage}M=v%16,M>0&&(v+=16-M),b.__size=v,b.__cache={}}(b),v=function u(b){const _=function d(){for(let b=0;b<a;b++)if(-1===o.indexOf(b))return o.push(b),b;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}();b.__bindingPointIndex=_;const v=n.createBuffer(),S=b.__size,M=b.usage;return n.bindBuffer(35345,v),n.bufferData(35345,S,M),n.bindBuffer(35345,null),n.bindBufferBase(35345,_,v),v}(b),r[b.id]=v,b.addEventListener("dispose",m)),i.updateUBOMapping(b,_.program);const M=e.render.frame;s[b.id]!==M&&(function h(b){const v=b.uniforms,S=b.__cache;n.bindBuffer(35345,r[b.id]);for(let M=0,I=v.length;M<I;M++){const x=v[M];if(!0===f(x,M,S)){const D=x.value,P=x.__offset;"number"==typeof D?(x.__data[0]=D,n.bufferSubData(35345,P,x.__data)):(x.value.isMatrix3?(x.__data[0]=x.value.elements[0],x.__data[1]=x.value.elements[1],x.__data[2]=x.value.elements[2],x.__data[3]=x.value.elements[0],x.__data[4]=x.value.elements[3],x.__data[5]=x.value.elements[4],x.__data[6]=x.value.elements[5],x.__data[7]=x.value.elements[0],x.__data[8]=x.value.elements[6],x.__data[9]=x.value.elements[7],x.__data[10]=x.value.elements[8],x.__data[11]=x.value.elements[0]):D.toArray(x.__data),n.bufferSubData(35345,P,x.__data))}}n.bindBuffer(35345,null)}(b),s[b.id]=M)},dispose:function y(){for(const b in r)n.deleteBuffer(r[b]);o=[],r={},s={}}}}function nI(n={}){this.isWebGLRenderer=!0;const e=void 0!==n.canvas?n.canvas:function I7(){const n=Au("canvas");return n.style.display="block",n}(),t=void 0!==n.context?n.context:null,i=void 0===n.depth||n.depth,r=void 0===n.stencil||n.stencil,s=void 0!==n.antialias&&n.antialias,o=void 0===n.premultipliedAlpha||n.premultipliedAlpha,a=void 0!==n.preserveDrawingBuffer&&n.preserveDrawingBuffer,l=void 0!==n.powerPreference?n.powerPreference:"default",c=void 0!==n.failIfMajorPerformanceCaveat&&n.failIfMajorPerformanceCaveat;let u;u=null!==t?t.getContextAttributes().alpha:void 0!==n.alpha&&n.alpha;let d=null,h=null;const f=[],p=[];this.domElement=e,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=Io,this.physicallyCorrectLights=!1,this.toneMapping=0,this.toneMappingExposure=1;const g=this;let m=!1,y=0,b=0,_=null,v=-1,S=null;const M=new Dt,I=new Dt;let x=null,D=e.width,P=e.height,V=1,ne=null,z=null;const L=new Dt(0,0,D,P),j=new Dt(0,0,D,P);let N=!1;const U=new Hv;let O=!1,$=!1,q=null;const G=new Ze,H=new K,oe=new E,te={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function ue(){return null===_?V:1}let ye,Ce,de,We,ee,J,ce,Ee,fe,Ge,ke,Oe,Tt,vt,T,w,W,se,le,me,He,A,F,_e,Y=t;function Me(C,B){for(let X=0;X<C.length;X++){const Q=e.getContext(C[X],B);if(null!==Q)return Q}return null}try{const C={alpha:!0,depth:i,stencil:r,antialias:s,premultipliedAlpha:o,preserveDrawingBuffer:a,powerPreference:l,failIfMajorPerformanceCaveat:c};if("setAttribute"in e&&e.setAttribute("data-engine","three.js r147"),e.addEventListener("webglcontextlost",Pe,!1),e.addEventListener("webglcontextrestored",Ie,!1),e.addEventListener("webglcontextcreationerror",ct,!1),null===Y){const B=["webgl2","webgl","experimental-webgl"];if(!0===g.isWebGL1Renderer&&B.shift(),Y=Me(B,C),null===Y)throw Me(B)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===Y.getShaderPrecisionFormat&&(Y.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(C){throw console.error("THREE.WebGLRenderer: "+C.message),C}function Se(){ye=new G$(Y),Ce=new k$(Y,ye,n),ye.init(Ce),A=new w7(Y,ye,Ce),de=new x7(Y,ye,Ce),We=new $$,ee=new c7,J=new S7(Y,ye,de,ee,Ce,A,We),ce=new U$(g),Ee=new H$(g),fe=new O6(Y,Ce),F=new O$(Y,ye,fe,Ce),Ge=new W$(Y,fe,We,F),ke=new Z$(Y,Ge,fe,We),le=new X$(Y,Ce,J),w=new B$(ee),Oe=new l7(g,ce,Ee,ye,Ce,F,w),Tt=new T7(g,ee),vt=new d7,T=new y7(ye,Ce),se=new N$(g,ce,Ee,de,ke,u,o),W=new b7(g,ke,Ce),_e=new A7(Y,We,Ce,de),me=new F$(Y,ye,We,Ce),He=new j$(Y,ye,We,Ce),We.programs=Oe.programs,g.capabilities=Ce,g.extensions=ye,g.properties=ee,g.renderLists=vt,g.shadowMap=W,g.state=de,g.info=We}Se();const ve=new D7(g,Y);function Pe(C){C.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function Ie(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;const C=We.autoReset,B=W.enabled,X=W.autoUpdate,k=W.needsUpdate,Q=W.type;Se(),We.autoReset=C,W.enabled=B,W.autoUpdate=X,W.needsUpdate=k,W.type=Q}function ct(C){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",C.statusMessage)}function ft(C){const B=C.target;B.removeEventListener("dispose",ft),function At(C){(function R(C){const B=ee.get(C).programs;void 0!==B&&(B.forEach(function(X){Oe.releaseProgram(X)}),C.isShaderMaterial&&Oe.releaseShaderCache(C))})(C),ee.remove(C)}(B)}this.xr=ve,this.getContext=function(){return Y},this.getContextAttributes=function(){return Y.getContextAttributes()},this.forceContextLoss=function(){const C=ye.get("WEBGL_lose_context");C&&C.loseContext()},this.forceContextRestore=function(){const C=ye.get("WEBGL_lose_context");C&&C.restoreContext()},this.getPixelRatio=function(){return V},this.setPixelRatio=function(C){void 0!==C&&(V=C,this.setSize(D,P,!1))},this.getSize=function(C){return C.set(D,P)},this.setSize=function(C,B,X){ve.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(D=C,P=B,e.width=Math.floor(C*V),e.height=Math.floor(B*V),!1!==X&&(e.style.width=C+"px",e.style.height=B+"px"),this.setViewport(0,0,C,B))},this.getDrawingBufferSize=function(C){return C.set(D*V,P*V).floor()},this.setDrawingBufferSize=function(C,B,X){D=C,P=B,V=X,e.width=Math.floor(C*X),e.height=Math.floor(B*X),this.setViewport(0,0,C,B)},this.getCurrentViewport=function(C){return C.copy(M)},this.getViewport=function(C){return C.copy(L)},this.setViewport=function(C,B,X,k){C.isVector4?L.set(C.x,C.y,C.z,C.w):L.set(C,B,X,k),de.viewport(M.copy(L).multiplyScalar(V).floor())},this.getScissor=function(C){return C.copy(j)},this.setScissor=function(C,B,X,k){C.isVector4?j.set(C.x,C.y,C.z,C.w):j.set(C,B,X,k),de.scissor(I.copy(j).multiplyScalar(V).floor())},this.getScissorTest=function(){return N},this.setScissorTest=function(C){de.setScissorTest(N=C)},this.setOpaqueSort=function(C){ne=C},this.setTransparentSort=function(C){z=C},this.getClearColor=function(C){return C.copy(se.getClearColor())},this.setClearColor=function(){se.setClearColor.apply(se,arguments)},this.getClearAlpha=function(){return se.getClearAlpha()},this.setClearAlpha=function(){se.setClearAlpha.apply(se,arguments)},this.clear=function(C=!0,B=!0,X=!0){let k=0;C&&(k|=16384),B&&(k|=256),X&&(k|=1024),Y.clear(k)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){e.removeEventListener("webglcontextlost",Pe,!1),e.removeEventListener("webglcontextrestored",Ie,!1),e.removeEventListener("webglcontextcreationerror",ct,!1),vt.dispose(),T.dispose(),ee.dispose(),ce.dispose(),Ee.dispose(),ke.dispose(),F.dispose(),_e.dispose(),Oe.dispose(),ve.dispose(),ve.removeEventListener("sessionstart",xe),ve.removeEventListener("sessionend",Le),q&&(q.dispose(),q=null),Ct.stop()},this.renderBufferDirect=function(C,B,X,k,Q,Be){null===B&&(B=te);const Ye=Q.isMesh&&Q.matrixWorld.determinant()<0,rt=function cee(C,B,X,k,Q){!0!==B.isScene&&(B=te),J.resetTextureUnits();const Be=B.fog,rt=null===_?g.outputEncoding:!0===_.isXRRenderTarget?_.texture.encoding:Io,at=(k.isMeshStandardMaterial?Ee:ce).get(k.envMap||(k.isMeshStandardMaterial?B.environment:null)),bt=!0===k.vertexColors&&!!X.attributes.color&&4===X.attributes.color.itemSize,pt=!!k.normalMap&&!!X.attributes.tangent,mt=!!X.morphAttributes.position,cn=!!X.morphAttributes.normal,Si=!!X.morphAttributes.color,fs=k.toneMapped?g.toneMapping:0,ta=X.morphAttributes.position||X.morphAttributes.normal||X.morphAttributes.color,un=void 0!==ta?ta.length:0,gt=ee.get(k),J0=h.state.lights;!0!==O||!0!==$&&C===S||w.setState(k,C,C===S&&k.id===v);let Cn=!1;k.version===gt.__version?(gt.needsLights&&gt.lightsStateVersion!==J0.state.version||gt.outputEncoding!==rt||Q.isInstancedMesh&&!1===gt.instancing||!Q.isInstancedMesh&&!0===gt.instancing||Q.isSkinnedMesh&&!1===gt.skinning||!Q.isSkinnedMesh&&!0===gt.skinning||gt.envMap!==at||!0===k.fog&&gt.fog!==Be||void 0!==gt.numClippingPlanes&&(gt.numClippingPlanes!==w.numPlanes||gt.numIntersection!==w.numIntersection)||gt.vertexAlphas!==bt||gt.vertexTangents!==pt||gt.morphTargets!==mt||gt.morphNormals!==cn||gt.morphColors!==Si||gt.toneMapping!==fs||!0===Ce.isWebGL2&&gt.morphTargetsCount!==un)&&(Cn=!0):(Cn=!0,gt.__version=k.version);let na=gt.currentProgram;!0===Cn&&(na=Vi(k,B,Q));let dR=!1,cd=!1,eb=!1;const ti=na.getUniforms(),ia=gt.uniforms;if(de.useProgram(na.program)&&(dR=!0,cd=!0,eb=!0),k.id!==v&&(v=k.id,cd=!0),dR||S!==C){if(ti.setValue(Y,"projectionMatrix",C.projectionMatrix),Ce.logarithmicDepthBuffer&&ti.setValue(Y,"logDepthBufFC",2/(Math.log(C.far+1)/Math.LN2)),S!==C&&(S=C,cd=!0,eb=!0),k.isShaderMaterial||k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshStandardMaterial||k.envMap){const wi=ti.map.cameraPosition;void 0!==wi&&wi.setValue(Y,oe.setFromMatrixPosition(C.matrixWorld))}(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial)&&ti.setValue(Y,"isOrthographic",!0===C.isOrthographicCamera),(k.isMeshPhongMaterial||k.isMeshToonMaterial||k.isMeshLambertMaterial||k.isMeshBasicMaterial||k.isMeshStandardMaterial||k.isShaderMaterial||k.isShadowMaterial||Q.isSkinnedMesh)&&ti.setValue(Y,"viewMatrix",C.matrixWorldInverse)}if(Q.isSkinnedMesh){ti.setOptional(Y,Q,"bindMatrix"),ti.setOptional(Y,Q,"bindMatrixInverse");const wi=Q.skeleton;wi&&(Ce.floatVertexTextures?(null===wi.boneTexture&&wi.computeBoneTexture(),ti.setValue(Y,"boneTexture",wi.boneTexture,J),ti.setValue(Y,"boneTextureSize",wi.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}const tb=X.morphAttributes;if((void 0!==tb.position||void 0!==tb.normal||void 0!==tb.color&&!0===Ce.isWebGL2)&&le.update(Q,X,k,na),(cd||gt.receiveShadow!==Q.receiveShadow)&&(gt.receiveShadow=Q.receiveShadow,ti.setValue(Y,"receiveShadow",Q.receiveShadow)),k.isMeshGouraudMaterial&&null!==k.envMap&&(ia.envMap.value=at,ia.flipEnvMap.value=at.isCubeTexture&&!1===at.isRenderTargetTexture?-1:1),cd&&(ti.setValue(Y,"toneMappingExposure",g.toneMappingExposure),gt.needsLights&&function uee(C,B){C.ambientLightColor.needsUpdate=B,C.lightProbe.needsUpdate=B,C.directionalLights.needsUpdate=B,C.directionalLightShadows.needsUpdate=B,C.pointLights.needsUpdate=B,C.pointLightShadows.needsUpdate=B,C.spotLights.needsUpdate=B,C.spotLightShadows.needsUpdate=B,C.rectAreaLights.needsUpdate=B,C.hemisphereLights.needsUpdate=B}(ia,eb),Be&&!0===k.fog&&Tt.refreshFogUniforms(ia,Be),Tt.refreshMaterialUniforms(ia,k,V,P,q),up.upload(Y,gt.uniformsList,ia,J)),k.isShaderMaterial&&!0===k.uniformsNeedUpdate&&(up.upload(Y,gt.uniformsList,ia,J),k.uniformsNeedUpdate=!1),k.isSpriteMaterial&&ti.setValue(Y,"center",Q.center),ti.setValue(Y,"modelViewMatrix",Q.modelViewMatrix),ti.setValue(Y,"normalMatrix",Q.normalMatrix),ti.setValue(Y,"modelMatrix",Q.matrixWorld),k.isShaderMaterial||k.isRawShaderMaterial){const wi=k.uniformsGroups;for(let nb=0,hee=wi.length;nb<hee;nb++)if(Ce.isWebGL2){const hR=wi[nb];_e.update(hR,na),_e.bind(hR,na)}else console.warn("THREE.WebGLRenderer: Uniform Buffer Objects can only be used with WebGL 2.")}return na}(C,B,X,k,Q);de.setMaterial(k,Ye);let at=X.index,bt=1;!0===k.wireframe&&(at=Ge.getWireframeAttribute(X),bt=2);const pt=X.drawRange,mt=X.attributes.position;let cn=pt.start*bt,Si=(pt.start+pt.count)*bt;null!==Be&&(cn=Math.max(cn,Be.start*bt),Si=Math.min(Si,(Be.start+Be.count)*bt)),null!==at?(cn=Math.max(cn,0),Si=Math.min(Si,at.count)):null!=mt&&(cn=Math.max(cn,0),Si=Math.min(Si,mt.count));const fs=Si-cn;if(fs<0||fs===1/0)return;F.setup(Q,k,rt,X,at);let ta,un=me;if(null!==at&&(ta=fe.get(at),un=He,un.setIndex(ta)),Q.isMesh)!0===k.wireframe?(de.setLineWidth(k.wireframeLinewidth*ue()),un.setMode(1)):un.setMode(4);else if(Q.isLine){let gt=k.linewidth;void 0===gt&&(gt=1),de.setLineWidth(gt*ue()),un.setMode(Q.isLineSegments?1:Q.isLineLoop?2:3)}else Q.isPoints?un.setMode(0):Q.isSprite&&un.setMode(4);if(Q.isInstancedMesh)un.renderInstances(cn,fs,Q.count);else if(X.isInstancedBufferGeometry){const J0=Math.min(X.instanceCount,void 0!==X._maxInstanceCount?X._maxInstanceCount:1/0);un.renderInstances(cn,fs,J0)}else un.render(cn,fs)},this.compile=function(C,B){function X(k,Q,Be){!0===k.transparent&&2===k.side?(k.side=1,k.needsUpdate=!0,Vi(k,Q,Be),k.side=0,k.needsUpdate=!0,Vi(k,Q,Be),k.side=2):Vi(k,Q,Be)}h=T.get(C),h.init(),p.push(h),C.traverseVisible(function(k){k.isLight&&k.layers.test(B.layers)&&(h.pushLight(k),k.castShadow&&h.pushShadow(k))}),h.setupLights(g.physicallyCorrectLights),C.traverse(function(k){const Q=k.material;if(Q)if(Array.isArray(Q))for(let Be=0;Be<Q.length;Be++)X(Q[Be],C,k);else X(Q,C,k)}),p.pop(),h=null};let Z=null;function xe(){Ct.stop()}function Le(){Ct.start()}const Ct=new DA;function En(C,B,X,k){if(!1===C.visible)return;if(C.layers.test(B.layers))if(C.isGroup)X=C.renderOrder;else if(C.isLOD)!0===C.autoUpdate&&C.update(B);else if(C.isLight)h.pushLight(C),C.castShadow&&h.pushShadow(C);else if(C.isSprite){if(!C.frustumCulled||U.intersectsSprite(C)){k&&oe.setFromMatrixPosition(C.matrixWorld).applyMatrix4(G);const Ye=ke.update(C),rt=C.material;rt.visible&&d.push(C,Ye,rt,X,oe.z,null)}}else if((C.isMesh||C.isLine||C.isPoints)&&(C.isSkinnedMesh&&C.skeleton.frame!==We.render.frame&&(C.skeleton.update(),C.skeleton.frame=We.render.frame),!C.frustumCulled||U.intersectsObject(C))){k&&oe.setFromMatrixPosition(C.matrixWorld).applyMatrix4(G);const Ye=ke.update(C),rt=C.material;if(Array.isArray(rt)){const at=Ye.groups;for(let bt=0,pt=at.length;bt<pt;bt++){const mt=at[bt],cn=rt[mt.materialIndex];cn&&cn.visible&&d.push(C,Ye,cn,X,oe.z,mt)}}else rt.visible&&d.push(C,Ye,rt,X,oe.z,null)}const Be=C.children;for(let Ye=0,rt=Be.length;Ye<rt;Ye++)En(Be[Ye],B,X,k)}function Un(C,B,X,k){const Q=C.opaque,Be=C.transmissive,Ye=C.transparent;h.setupLightsView(X),Be.length>0&&function ea(C,B,X){const k=Ce.isWebGL2;null===q&&(q=new No(1,1,{generateMipmaps:!0,type:ye.has("EXT_color_buffer_half_float")?Eu:Do,minFilter:1008,samples:k&&!0===s?4:0})),g.getDrawingBufferSize(H),k?q.setSize(H.x,H.y):q.setSize(Bf(H.x),Bf(H.y));const Q=g.getRenderTarget();g.setRenderTarget(q),g.clear();const Be=g.toneMapping;g.toneMapping=0,zt(C,B,X),g.toneMapping=Be,J.updateMultisampleRenderTarget(q),J.updateRenderTargetMipmap(q),g.setRenderTarget(Q)}(Q,B,X),k&&de.viewport(M.copy(k)),Q.length>0&&zt(Q,B,X),Be.length>0&&zt(Be,B,X),Ye.length>0&&zt(Ye,B,X),de.buffers.depth.setTest(!0),de.buffers.depth.setMask(!0),de.buffers.color.setMask(!0),de.setPolygonOffset(!1)}function zt(C,B,X){const k=!0===B.isScene?B.overrideMaterial:null;for(let Q=0,Be=C.length;Q<Be;Q++){const Ye=C[Q],rt=Ye.object,at=Ye.geometry,bt=null===k?Ye.material:k,pt=Ye.group;rt.layers.test(X.layers)&&hs(rt,B,X,at,bt,pt)}}function hs(C,B,X,k,Q,Be){C.onBeforeRender(g,B,X,k,Q,Be),C.modelViewMatrix.multiplyMatrices(X.matrixWorldInverse,C.matrixWorld),C.normalMatrix.getNormalMatrix(C.modelViewMatrix),Q.onBeforeRender(g,B,X,k,C,Be),!0===Q.transparent&&2===Q.side?(Q.side=1,Q.needsUpdate=!0,g.renderBufferDirect(X,B,k,Q,C,Be),Q.side=0,Q.needsUpdate=!0,g.renderBufferDirect(X,B,k,Q,C,Be),Q.side=2):g.renderBufferDirect(X,B,k,Q,C,Be),C.onAfterRender(g,B,X,k,Q,Be)}function Vi(C,B,X){!0!==B.isScene&&(B=te);const k=ee.get(C),Q=h.state.lights,Ye=Q.state.version,rt=Oe.getParameters(C,Q.state,h.state.shadowsArray,B,X),at=Oe.getProgramCacheKey(rt);let bt=k.programs;k.environment=C.isMeshStandardMaterial?B.environment:null,k.fog=B.fog,k.envMap=(C.isMeshStandardMaterial?Ee:ce).get(C.envMap||k.environment),void 0===bt&&(C.addEventListener("dispose",ft),bt=new Map,k.programs=bt);let pt=bt.get(at);if(void 0!==pt){if(k.currentProgram===pt&&k.lightsStateVersion===Ye)return uR(C,rt),pt}else rt.uniforms=Oe.getUniforms(C),C.onBuild(X,rt,g),C.onBeforeCompile(rt,g),pt=Oe.acquireProgram(rt,at),bt.set(at,pt),k.uniforms=rt.uniforms;const mt=k.uniforms;(!C.isShaderMaterial&&!C.isRawShaderMaterial||!0===C.clipping)&&(mt.clippingPlanes=w.uniform),uR(C,rt),k.needsLights=function dee(C){return C.isMeshLambertMaterial||C.isMeshToonMaterial||C.isMeshPhongMaterial||C.isMeshStandardMaterial||C.isShadowMaterial||C.isShaderMaterial&&!0===C.lights}(C),k.lightsStateVersion=Ye,k.needsLights&&(mt.ambientLightColor.value=Q.state.ambient,mt.lightProbe.value=Q.state.probe,mt.directionalLights.value=Q.state.directional,mt.directionalLightShadows.value=Q.state.directionalShadow,mt.spotLights.value=Q.state.spot,mt.spotLightShadows.value=Q.state.spotShadow,mt.rectAreaLights.value=Q.state.rectArea,mt.ltc_1.value=Q.state.rectAreaLTC1,mt.ltc_2.value=Q.state.rectAreaLTC2,mt.pointLights.value=Q.state.point,mt.pointLightShadows.value=Q.state.pointShadow,mt.hemisphereLights.value=Q.state.hemi,mt.directionalShadowMap.value=Q.state.directionalShadowMap,mt.directionalShadowMatrix.value=Q.state.directionalShadowMatrix,mt.spotShadowMap.value=Q.state.spotShadowMap,mt.spotLightMatrix.value=Q.state.spotLightMatrix,mt.spotLightMap.value=Q.state.spotLightMap,mt.pointShadowMap.value=Q.state.pointShadowMap,mt.pointShadowMatrix.value=Q.state.pointShadowMatrix);const cn=pt.getUniforms(),Si=up.seqWithValue(cn.seq,mt);return k.currentProgram=pt,k.uniformsList=Si,pt}function uR(C,B){const X=ee.get(C);X.outputEncoding=B.outputEncoding,X.instancing=B.instancing,X.skinning=B.skinning,X.morphTargets=B.morphTargets,X.morphNormals=B.morphNormals,X.morphColors=B.morphColors,X.morphTargetsCount=B.morphTargetsCount,X.numClippingPlanes=B.numClippingPlanes,X.numIntersection=B.numClipIntersection,X.vertexAlphas=B.vertexAlphas,X.vertexTangents=B.vertexTangents,X.toneMapping=B.toneMapping}Ct.setAnimationLoop(function ae(C){Z&&Z(C)}),typeof self<"u"&&Ct.setContext(self),this.setAnimationLoop=function(C){Z=C,ve.setAnimationLoop(C),null===C?Ct.stop():Ct.start()},ve.addEventListener("sessionstart",xe),ve.addEventListener("sessionend",Le),this.render=function(C,B){if(void 0===B||!0===B.isCamera){if(!0!==m){if(!0===C.matrixWorldAutoUpdate&&C.updateMatrixWorld(),null===B.parent&&!0===B.matrixWorldAutoUpdate&&B.updateMatrixWorld(),!0===ve.enabled&&!0===ve.isPresenting&&(!0===ve.cameraAutoUpdate&&ve.updateCamera(B),B=ve.getCamera()),!0===C.isScene&&C.onBeforeRender(g,C,B,_),h=T.get(C,p.length),h.init(),p.push(h),G.multiplyMatrices(B.projectionMatrix,B.matrixWorldInverse),U.setFromProjectionMatrix(G),$=this.localClippingEnabled,O=w.init(this.clippingPlanes,$,B),d=vt.get(C,f.length),d.init(),f.push(d),En(C,B,0,g.sortObjects),d.finish(),!0===g.sortObjects&&d.sort(ne,z),!0===O&&w.beginShadows(),W.render(h.state.shadowsArray,C,B),!0===O&&w.endShadows(),!0===this.info.autoReset&&this.info.reset(),se.render(d,C),h.setupLights(g.physicallyCorrectLights),B.isArrayCamera){const k=B.cameras;for(let Q=0,Be=k.length;Q<Be;Q++){const Ye=k[Q];Un(d,C,Ye,Ye.viewport)}}else Un(d,C,B);null!==_&&(J.updateMultisampleRenderTarget(_),J.updateRenderTargetMipmap(_)),!0===C.isScene&&C.onAfterRender(g,C,B),F.resetDefaultState(),v=-1,S=null,p.pop(),h=p.length>0?p[p.length-1]:null,f.pop(),d=f.length>0?f[f.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return y},this.getActiveMipmapLevel=function(){return b},this.getRenderTarget=function(){return _},this.setRenderTargetTextures=function(C,B,X){ee.get(C.texture).__webglTexture=B,ee.get(C.depthTexture).__webglTexture=X;const k=ee.get(C);k.__hasExternalTextures=!0,k.__hasExternalTextures&&(k.__autoAllocateDepthBuffer=void 0===X,k.__autoAllocateDepthBuffer||!0===ye.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),k.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(C,B){const X=ee.get(C);X.__webglFramebuffer=B,X.__useDefaultFramebuffer=void 0===B},this.setRenderTarget=function(C,B=0,X=0){_=C,y=B,b=X;let k=!0,Q=null,Be=!1,Ye=!1;if(C){const at=ee.get(C);void 0!==at.__useDefaultFramebuffer?(de.bindFramebuffer(36160,null),k=!1):void 0===at.__webglFramebuffer?J.setupRenderTarget(C):at.__hasExternalTextures&&J.rebindTextures(C,ee.get(C.texture).__webglTexture,ee.get(C.depthTexture).__webglTexture);const bt=C.texture;(bt.isData3DTexture||bt.isDataArrayTexture||bt.isCompressedArrayTexture)&&(Ye=!0);const pt=ee.get(C).__webglFramebuffer;C.isWebGLCubeRenderTarget?(Q=pt[B],Be=!0):Q=Ce.isWebGL2&&C.samples>0&&!1===J.useMultisampledRTT(C)?ee.get(C).__webglMultisampledFramebuffer:pt,M.copy(C.viewport),I.copy(C.scissor),x=C.scissorTest}else M.copy(L).multiplyScalar(V).floor(),I.copy(j).multiplyScalar(V).floor(),x=N;if(de.bindFramebuffer(36160,Q)&&Ce.drawBuffers&&k&&de.drawBuffers(C,Q),de.viewport(M),de.scissor(I),de.setScissorTest(x),Be){const at=ee.get(C.texture);Y.framebufferTexture2D(36160,36064,34069+B,at.__webglTexture,X)}else if(Ye){const at=ee.get(C.texture);Y.framebufferTextureLayer(36160,36064,at.__webglTexture,X||0,B||0)}v=-1},this.readRenderTargetPixels=function(C,B,X,k,Q,Be,Ye){if(!C||!C.isWebGLRenderTarget)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let rt=ee.get(C).__webglFramebuffer;if(C.isWebGLCubeRenderTarget&&void 0!==Ye&&(rt=rt[Ye]),rt){de.bindFramebuffer(36160,rt);try{const at=C.texture,bt=at.format,pt=at.type;if(bt!==Bi&&A.convert(bt)!==Y.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");const mt=pt===Eu&&(ye.has("EXT_color_buffer_half_float")||Ce.isWebGL2&&ye.has("EXT_color_buffer_float"));if(!(pt===Do||A.convert(pt)===Y.getParameter(35738)||pt===Rs&&(Ce.isWebGL2||ye.has("OES_texture_float")||ye.has("WEBGL_color_buffer_float"))||mt))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");B>=0&&B<=C.width-k&&X>=0&&X<=C.height-Q&&Y.readPixels(B,X,k,Q,A.convert(bt),A.convert(pt),Be)}finally{const at=null!==_?ee.get(_).__webglFramebuffer:null;de.bindFramebuffer(36160,at)}}},this.copyFramebufferToTexture=function(C,B,X=0){const k=Math.pow(2,-X),Q=Math.floor(B.image.width*k),Be=Math.floor(B.image.height*k);J.setTexture2D(B,0),Y.copyTexSubImage2D(3553,X,0,0,C.x,C.y,Q,Be),de.unbindTexture()},this.copyTextureToTexture=function(C,B,X,k=0){const Q=B.image.width,Be=B.image.height,Ye=A.convert(X.format),rt=A.convert(X.type);J.setTexture2D(X,0),Y.pixelStorei(37440,X.flipY),Y.pixelStorei(37441,X.premultiplyAlpha),Y.pixelStorei(3317,X.unpackAlignment),B.isDataTexture?Y.texSubImage2D(3553,k,C.x,C.y,Q,Be,Ye,rt,B.image.data):B.isCompressedTexture?Y.compressedTexSubImage2D(3553,k,C.x,C.y,B.mipmaps[0].width,B.mipmaps[0].height,Ye,B.mipmaps[0].data):Y.texSubImage2D(3553,k,C.x,C.y,Ye,rt,B.image),0===k&&X.generateMipmaps&&Y.generateMipmap(3553),de.unbindTexture()},this.copyTextureToTexture3D=function(C,B,X,k,Q=0){if(g.isWebGL1Renderer)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");const Be=C.max.x-C.min.x+1,Ye=C.max.y-C.min.y+1,rt=C.max.z-C.min.z+1,at=A.convert(k.format),bt=A.convert(k.type);let pt;if(k.isData3DTexture)J.setTexture3D(k,0),pt=32879;else{if(!k.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");J.setTexture2DArray(k,0),pt=35866}Y.pixelStorei(37440,k.flipY),Y.pixelStorei(37441,k.premultiplyAlpha),Y.pixelStorei(3317,k.unpackAlignment);const mt=Y.getParameter(3314),cn=Y.getParameter(32878),Si=Y.getParameter(3316),fs=Y.getParameter(3315),ta=Y.getParameter(32877),un=X.isCompressedTexture?X.mipmaps[0]:X.image;Y.pixelStorei(3314,un.width),Y.pixelStorei(32878,un.height),Y.pixelStorei(3316,C.min.x),Y.pixelStorei(3315,C.min.y),Y.pixelStorei(32877,C.min.z),X.isDataTexture||X.isData3DTexture?Y.texSubImage3D(pt,Q,B.x,B.y,B.z,Be,Ye,rt,at,bt,un.data):X.isCompressedArrayTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),Y.compressedTexSubImage3D(pt,Q,B.x,B.y,B.z,Be,Ye,rt,at,un.data)):Y.texSubImage3D(pt,Q,B.x,B.y,B.z,Be,Ye,rt,at,bt,un),Y.pixelStorei(3314,mt),Y.pixelStorei(32878,cn),Y.pixelStorei(3316,Si),Y.pixelStorei(3315,fs),Y.pixelStorei(32877,ta),0===Q&&k.generateMipmaps&&Y.generateMipmap(pt),de.unbindTexture()},this.initTexture=function(C){C.isCubeTexture?J.setTextureCube(C,0):C.isData3DTexture?J.setTexture3D(C,0):C.isDataArrayTexture||C.isCompressedArrayTexture?J.setTexture2DArray(C,0):J.setTexture2D(C,0),de.unbindTexture()},this.resetState=function(){y=0,b=0,_=null,de.reset(),F.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}(class P7 extends nI{}).prototype.isWebGL1Renderer=!0;class iI extends bi{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.backgroundBlurriness=this.backgroundBlurriness),1!==this.backgroundIntensity&&(t.backgroundIntensity=this.backgroundIntensity),t}get autoUpdate(){return console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate}set autoUpdate(e){console.warn("THREE.Scene: autoUpdate was renamed to matrixWorldAutoUpdate in r144."),this.matrixWorldAutoUpdate=e}}class ei extends Bo{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new we(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const _I=new E,vI=new E,bI=new Ze,e0=new $f,gp=new vl;class Bl extends bi{constructor(e=new ot,t=new ei){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[0];for(let r=1,s=t.count;r<s;r++)_I.fromBufferAttribute(t,r-1),vI.fromBufferAttribute(t,r),i[r]=i[r-1],i[r]+=_I.distanceTo(vI);e.setAttribute("lineDistance",new Te(i,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const i=this.geometry,r=this.matrixWorld,s=e.params.Line.threshold,o=i.drawRange;if(null===i.boundingSphere&&i.computeBoundingSphere(),gp.copy(i.boundingSphere),gp.applyMatrix4(r),gp.radius+=s,!1===e.ray.intersectsSphere(gp))return;bI.copy(r).invert(),e0.copy(e.ray).applyMatrix4(bI);const a=s/((this.scale.x+this.scale.y+this.scale.z)/3),l=a*a,c=new E,u=new E,d=new E,h=new E,f=this.isLineSegments?2:1,p=i.index,m=i.attributes.position;if(null!==p)for(let _=Math.max(0,o.start),v=Math.min(p.count,o.start+o.count)-1;_<v;_+=f){const S=p.getX(_),M=p.getX(_+1);if(c.fromBufferAttribute(m,S),u.fromBufferAttribute(m,M),e0.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const x=e.ray.origin.distanceTo(h);x<e.near||x>e.far||t.push({distance:x,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}else for(let _=Math.max(0,o.start),v=Math.min(m.count,o.start+o.count)-1;_<v;_+=f){if(c.fromBufferAttribute(m,_),u.fromBufferAttribute(m,_+1),e0.distanceSqToSegment(c,u,h,d)>l)continue;h.applyMatrix4(this.matrixWorld);const M=e.ray.origin.distanceTo(h);M<e.near||M>e.far||t.push({distance:M,point:d.clone().applyMatrix4(this.matrixWorld),index:_,face:null,faceIndex:null,object:this})}}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(void 0!==r){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,o=r.length;s<o;s++){const a=r[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[a]=s}}}}}const xI=new E,SI=new E;class Vu extends Bl{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(null===e.index){const t=e.attributes.position,i=[];for(let r=0,s=t.count;r<s;r+=2)xI.fromBufferAttribute(t,r),SI.fromBufferAttribute(t,r+1),i[r]=0===r?0:i[r-1],i[r+1]=i[r]+xI.distanceTo(SI);e.setAttribute("lineDistance",new Te(i,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}const Sp=new E,wp=new E,p0=new E,Mp=new ur;class m0 extends ot{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},null!==e){const r=Math.pow(10,4),s=Math.cos(Ro*t),o=e.getIndex(),a=e.getAttribute("position"),l=o?o.count:a.count,c=[0,0,0],u=["a","b","c"],d=new Array(3),h={},f=[];for(let p=0;p<l;p+=3){o?(c[0]=o.getX(p),c[1]=o.getX(p+1),c[2]=o.getX(p+2)):(c[0]=p,c[1]=p+1,c[2]=p+2);const{a:g,b:m,c:y}=Mp;if(g.fromBufferAttribute(a,c[0]),m.fromBufferAttribute(a,c[1]),y.fromBufferAttribute(a,c[2]),Mp.getNormal(p0),d[0]=`${Math.round(g.x*r)},${Math.round(g.y*r)},${Math.round(g.z*r)}`,d[1]=`${Math.round(m.x*r)},${Math.round(m.y*r)},${Math.round(m.z*r)}`,d[2]=`${Math.round(y.x*r)},${Math.round(y.y*r)},${Math.round(y.z*r)}`,d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(let b=0;b<3;b++){const _=(b+1)%3,v=d[b],S=d[_],M=Mp[u[b]],I=Mp[u[_]],x=`${v}_${S}`,D=`${S}_${v}`;D in h&&h[D]?(p0.dot(h[D].normal)<=s&&(f.push(M.x,M.y,M.z),f.push(I.x,I.y,I.z)),h[D]=null):x in h||(h[x]={index0:c[b],index1:c[_],normal:p0.clone()})}}for(const p in h)if(h[p]){const{index0:g,index1:m}=h[p];Sp.fromBufferAttribute(a,g),wp.fromBufferAttribute(a,m),f.push(Sp.x,Sp.y,Sp.z),f.push(wp.x,wp.y,wp.z)}this.setAttribute("position",new Te(f,3))}}}class Yu extends ot{constructor(e=1,t=32,i=16,r=0,s=2*Math.PI,o=0,a=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:s,thetaStart:o,thetaLength:a},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const l=Math.min(o+a,Math.PI);let c=0;const u=[],d=new E,h=new E,f=[],p=[],g=[],m=[];for(let y=0;y<=i;y++){const b=[],_=y/i;let v=0;0==y&&0==o?v=.5/t:y==i&&l==Math.PI&&(v=-.5/t);for(let S=0;S<=t;S++){const M=S/t;d.x=-e*Math.cos(r+M*s)*Math.sin(o+_*a),d.y=e*Math.cos(o+_*a),d.z=e*Math.sin(r+M*s)*Math.sin(o+_*a),p.push(d.x,d.y,d.z),h.copy(d).normalize(),g.push(h.x,h.y,h.z),m.push(M+v,1-_),b.push(c++)}u.push(b)}for(let y=0;y<i;y++)for(let b=0;b<t;b++){const _=u[y][b+1],v=u[y][b],S=u[y+1][b],M=u[y+1][b+1];(0!==y||o>0)&&f.push(_,v,M),(y!==i-1||l<Math.PI)&&f.push(v,S,M)}this.setIndex(f),this.setAttribute("position",new Te(p,3)),this.setAttribute("normal",new Te(g,3)),this.setAttribute("uv",new Te(m,2))}static fromJSON(e){return new Yu(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}function zi(n,e,t){return C0(n)?new n.constructor(n.subarray(e,void 0!==t?t:n.length)):n.slice(e,t)}function Go(n,e,t){return!n||!t&&n.constructor===e?n:"number"==typeof e.BYTES_PER_ELEMENT?new e(n):Array.prototype.slice.call(n)}function C0(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}class Ap{constructor(e,t,i,r){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=void 0!==r?r:new t.constructor(i),this.sampleValues=t,this.valueSize=i,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let i=this._cachedIndex,r=t[i],s=t[i-1];e:{t:{let o;n:{i:if(!(e<r)){for(let a=i+2;;){if(void 0===r){if(e<s)break i;return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}if(i===a)break;if(s=r,r=t[++i],e<r)break t}o=t.length;break n}if(e>=s)break e;{const a=t[1];e<a&&(i=2,s=a);for(let l=i-2;;){if(void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(i===l)break;if(r=s,s=t[--i-1],e>=s)break t}o=i,i=0}}for(;i<o;){const a=i+o>>>1;e<t[a]?o=a:i=a+1}if(r=t[i],s=t[i-1],void 0===s)return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return i=t.length,this._cachedIndex=i,this.copySampleValue_(i-1)}this._cachedIndex=i,this.intervalChanged_(i,s,r)}return this.interpolate_(i,s,e,r)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,i=this.sampleValues,r=this.valueSize,s=e*r;for(let o=0;o!==r;++o)t[o]=i[s+o];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class Lq extends Ap{constructor(e,t,i,r){super(e,t,i,r),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:2400,endingEnd:2400}}intervalChanged_(e,t,i){const r=this.parameterPositions;let s=e-2,o=e+1,a=r[s],l=r[o];if(void 0===a)switch(this.getSettings_().endingStart){case 2401:s=e,a=2*t-i;break;case 2402:s=r.length-2,a=t+r[s]-r[s+1];break;default:s=e,a=i}if(void 0===l)switch(this.getSettings_().endingEnd){case 2401:o=e,l=2*i-t;break;case 2402:o=1,l=i+r[1]-r[0];break;default:o=e-1,l=t}const c=.5*(i-t),u=this.valueSize;this._weightPrev=c/(t-a),this._weightNext=c/(l-i),this._offsetPrev=s*u,this._offsetNext=o*u}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=this._offsetPrev,d=this._offsetNext,h=this._weightPrev,f=this._weightNext,p=(i-t)/(r-t),g=p*p,m=g*p,y=-h*m+2*h*g-h*p,b=(1+h)*m+(-1.5-2*h)*g+(-.5+h)*p+1,_=(-1-f)*m+(1.5+f)*g+.5*p,v=f*m-f*g;for(let S=0;S!==a;++S)s[S]=y*o[u+S]+b*o[c+S]+_*o[l+S]+v*o[d+S];return s}}class zI extends Ap{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=e*a,c=l-a,u=(i-t)/(r-t),d=1-u;for(let h=0;h!==a;++h)s[h]=o[c+h]*d+o[l+h]*u;return s}}class Nq extends Ap{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e){return this.copySampleValue_(e-1)}}class Er{constructor(e,t,i,r){if(void 0===e)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===t||0===t.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Go(t,this.TimeBufferType),this.values=Go(i,this.ValueBufferType),this.setInterpolation(r||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let i;if(t.toJSON!==this.toJSON)i=t.toJSON(e);else{i={name:e.name,times:Go(e.times,Array),values:Go(e.values,Array)};const r=e.getInterpolation();r!==e.DefaultInterpolation&&(i.interpolation=r)}return i.type=e.ValueTypeName,i}InterpolantFactoryMethodDiscrete(e){return new Nq(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new zI(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new Lq(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case 2300:t=this.InterpolantFactoryMethodDiscrete;break;case 2301:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){const i="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(i);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",i),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return 2300;case this.InterpolantFactoryMethodLinear:return 2301;case this.InterpolantFactoryMethodSmooth:return 2302}}getValueSize(){return this.values.length/this.times.length}shift(e){if(0!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]+=e}return this}scale(e){if(1!==e){const t=this.times;for(let i=0,r=t.length;i!==r;++i)t[i]*=e}return this}trim(e,t){const i=this.times,r=i.length;let s=0,o=r-1;for(;s!==r&&i[s]<e;)++s;for(;-1!==o&&i[o]>t;)--o;if(++o,0!==s||o!==r){s>=o&&(o=Math.max(o,1),s=o-1);const a=this.getValueSize();this.times=zi(i,s,o),this.values=zi(this.values,s*a,o*a)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const i=this.times,r=this.values,s=i.length;0===s&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let o=null;for(let a=0;a!==s;a++){const l=i[a];if("number"==typeof l&&isNaN(l)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,a,l),e=!1;break}if(null!==o&&o>l){console.error("THREE.KeyframeTrack: Out of order keys.",this,a,l,o),e=!1;break}o=l}if(void 0!==r&&C0(r))for(let a=0,l=r.length;a!==l;++a){const c=r[a];if(isNaN(c)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,a,c),e=!1;break}}return e}optimize(){const e=zi(this.times),t=zi(this.values),i=this.getValueSize(),r=2302===this.getInterpolation(),s=e.length-1;let o=1;for(let a=1;a<s;++a){let l=!1;const c=e[a];if(c!==e[a+1]&&(1!==a||c!==e[0]))if(r)l=!0;else{const d=a*i,h=d-i,f=d+i;for(let p=0;p!==i;++p){const g=t[d+p];if(g!==t[h+p]||g!==t[f+p]){l=!0;break}}}if(l){if(a!==o){e[o]=e[a];const d=a*i,h=o*i;for(let f=0;f!==i;++f)t[h+f]=t[d+f]}++o}}if(s>0){e[o]=e[s];for(let a=s*i,l=o*i,c=0;c!==i;++c)t[l+c]=t[a+c];++o}return o!==e.length?(this.times=zi(e,0,o),this.values=zi(t,0,o*i)):(this.times=e,this.values=t),this}clone(){const e=zi(this.times,0),t=zi(this.values,0),r=new(0,this.constructor)(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}Er.prototype.TimeBufferType=Float32Array,Er.prototype.ValueBufferType=Float32Array,Er.prototype.DefaultInterpolation=2301;class Vl extends Er{}Vl.prototype.ValueTypeName="bool",Vl.prototype.ValueBufferType=Array,Vl.prototype.DefaultInterpolation=2300,Vl.prototype.InterpolantFactoryMethodLinear=void 0,Vl.prototype.InterpolantFactoryMethodSmooth=void 0;(class VI extends Er{}).prototype.ValueTypeName="color";(class Ip extends Er{}).prototype.ValueTypeName="number";class Oq extends Ap{constructor(e,t,i,r){super(e,t,i,r)}interpolate_(e,t,i,r){const s=this.resultBuffer,o=this.sampleValues,a=this.valueSize,l=(i-t)/(r-t);let c=e*a;for(let u=c+a;c!==u;c+=4)Kn.slerpFlat(s,0,o,c-a,o,c,l);return s}}class Xu extends Er{InterpolantFactoryMethodLinear(e){return new Oq(this.times,this.values,this.getValueSize(),e)}}Xu.prototype.ValueTypeName="quaternion",Xu.prototype.DefaultInterpolation=2301,Xu.prototype.InterpolantFactoryMethodSmooth=void 0;class Hl extends Er{}Hl.prototype.ValueTypeName="string",Hl.prototype.ValueBufferType=Array,Hl.prototype.DefaultInterpolation=2300,Hl.prototype.InterpolantFactoryMethodLinear=void 0,Hl.prototype.InterpolantFactoryMethodSmooth=void 0;(class Pp extends Er{}).prototype.ValueTypeName="vector";class Uq extends Error{constructor(e,t){super(e),this.response=t}}const R0="\\[\\]\\.:\\/",rY=new RegExp("["+R0+"]","g"),L0="[^"+R0+"]",sY="[^"+R0.replace("\\.","")+"]",uY=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",L0)+/(WCOD+)?/.source.replace("WCOD",sY)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",L0)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",L0)+"$"),dY=["material","materials","bones","map"];class hY{constructor(e,t,i){const r=i||kt.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,r)}getValue(e,t){this.bind();const r=this._bindings[this._targetGroup.nCachedObjects_];void 0!==r&&r.getValue(e,t)}setValue(e,t){const i=this._bindings;for(let r=this._targetGroup.nCachedObjects_,s=i.length;r!==s;++r)i[r].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,i=e.length;t!==i;++t)e[t].unbind()}}let kt=(()=>{class n{constructor(t,i,r){this.path=i,this.parsedPath=r||n.parseTrackName(i),this.node=n.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(t,i,r){return t&&t.isAnimationObjectGroup?new n.Composite(t,i,r):new n(t,i,r)}static sanitizeNodeName(t){return t.replace(/\s/g,"_").replace(rY,"")}static parseTrackName(t){const i=uY.exec(t);if(null===i)throw new Error("PropertyBinding: Cannot parse trackName: "+t);const r={nodeName:i[2],objectName:i[3],objectIndex:i[4],propertyName:i[5],propertyIndex:i[6]},s=r.nodeName&&r.nodeName.lastIndexOf(".");if(void 0!==s&&-1!==s){const o=r.nodeName.substring(s+1);-1!==dY.indexOf(o)&&(r.nodeName=r.nodeName.substring(0,s),r.objectName=o)}if(null===r.propertyName||0===r.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+t);return r}static findNode(t,i){if(void 0===i||""===i||"."===i||-1===i||i===t.name||i===t.uuid)return t;if(t.skeleton){const r=t.skeleton.getBoneByName(i);if(void 0!==r)return r}if(t.children){const r=function(o){for(let a=0;a<o.length;a++){const l=o[a];if(l.name===i||l.uuid===i)return l;const c=r(l.children);if(c)return c}return null},s=r(t.children);if(s)return s}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(t,i){t[i]=this.targetObject[this.propertyName]}_getValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)t[i++]=r[s]}_getValue_arrayElement(t,i){t[i]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(t,i){this.resolvedProperty.toArray(t,i)}_setValue_direct(t,i){this.targetObject[this.propertyName]=t[i]}_setValue_direct_setNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(t,i){this.targetObject[this.propertyName]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++]}_setValue_array_setNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(t,i){const r=this.resolvedProperty;for(let s=0,o=r.length;s!==o;++s)r[s]=t[i++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(t,i){this.resolvedProperty[this.propertyIndex]=t[i]}_setValue_arrayElement_setNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty[this.propertyIndex]=t[i],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(t,i){this.resolvedProperty.fromArray(t,i)}_setValue_fromArray_setNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(t,i){this.resolvedProperty.fromArray(t,i),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(t,i){this.bind(),this.getValue(t,i)}_setValue_unbound(t,i){this.bind(),this.setValue(t,i)}bind(){let t=this.node;const i=this.parsedPath,r=i.objectName,s=i.propertyName;let o=i.propertyIndex;if(t||(t=n.findNode(this.rootNode,i.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!t)return void console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");if(r){let u=i.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(let d=0;d<t.length;d++)if(t[d].name===u){u=d;break}break;case"map":if("map"in t){t=t.map;break}if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.map)return void console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);t=t.material.map;break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==u){if(void 0===t[u])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[u]}}const a=t[s];if(void 0===a)return void console.error("THREE.PropertyBinding: Trying to update property for track: "+i.nodeName+"."+s+" but it wasn't found.",t);let l=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?l=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(void 0!==o){if("morphTargetInfluences"===s){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[o]&&(o=t.morphTargetDictionary[o])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=o}else void 0!==a.fromArray&&void 0!==a.toArray?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=s;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}return n.Composite=hY,n})();kt.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},kt.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},kt.prototype.GetterByBindingType=[kt.prototype._getValue_direct,kt.prototype._getValue_array,kt.prototype._getValue_arrayElement,kt.prototype._getValue_toArray],kt.prototype.SetterByBindingTypeAndVersioning=[[kt.prototype._setValue_direct,kt.prototype._setValue_direct_setNeedsUpdate,kt.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_array,kt.prototype._setValue_array_setNeedsUpdate,kt.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_arrayElement,kt.prototype._setValue_arrayElement_setNeedsUpdate,kt.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kt.prototype._setValue_fromArray,kt.prototype._setValue_fromArray_setNeedsUpdate,kt.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]],new Float32Array(1);class nP{constructor(e,t,i=0,r=1/0){this.ray=new $f(e,t),this.near=i,this.far=r,this.camera=null,this.layers=new Av,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}intersectObject(e,t=!0,i=[]){return N0(e,this,i,t),i.sort(iP),i}intersectObjects(e,t=!0,i=[]){for(let r=0,s=e.length;r<s;r++)N0(e[r],this,i,t);return i.sort(iP),i}}function iP(n,e){return n.distance-e.distance}function N0(n,e,t,i){if(n.layers.test(e.layers)&&n.raycast(e,t),!0===i){const r=n.children;for(let s=0,o=r.length;s<o;s++)N0(r[s],e,t,!0)}}class rP{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(en(t/this.radius,-1,1))),this}clone(){return(new this.constructor).copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"147"}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__="147");const pP={type:"change"},k0={type:"start"},mP={type:"end"};class bY extends Ls{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new E,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:0,MIDDLE:1,RIGHT:2},this.touches={ONE:0,TWO:2},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return a.phi},this.getAzimuthalAngle=function(){return a.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(A){A.addEventListener("keydown",vt),this._domElementKeyEvents=A},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(pP),i.update(),s=r.NONE},this.update=function(){const A=new E,F=(new Kn).setFromUnitVectors(e.up,new E(0,1,0)),_e=F.clone().invert(),Se=new E,ve=new Kn,Pe=2*Math.PI;return function(){const ct=i.object.position;A.copy(ct).sub(i.target),A.applyQuaternion(F),a.setFromVector3(A),i.autoRotate&&s===r.NONE&&D(function I(){return 2*Math.PI/60/60*i.autoRotateSpeed}()),i.enableDamping?(a.theta+=l.theta*i.dampingFactor,a.phi+=l.phi*i.dampingFactor):(a.theta+=l.theta,a.phi+=l.phi);let ft=i.minAzimuthAngle,At=i.maxAzimuthAngle;return isFinite(ft)&&isFinite(At)&&(ft<-Math.PI?ft+=Pe:ft>Math.PI&&(ft-=Pe),At<-Math.PI?At+=Pe:At>Math.PI&&(At-=Pe),a.theta=ft<=At?Math.max(ft,Math.min(At,a.theta)):a.theta>(ft+At)/2?Math.max(ft,a.theta):Math.min(At,a.theta)),a.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,a.phi)),a.makeSafe(),a.radius*=c,a.radius=Math.max(i.minDistance,Math.min(i.maxDistance,a.radius)),!0===i.enableDamping?i.target.addScaledVector(u,i.dampingFactor):i.target.add(u),A.setFromSpherical(a),A.applyQuaternion(_e),ct.copy(i.target).add(A),i.object.lookAt(i.target),!0===i.enableDamping?(l.theta*=1-i.dampingFactor,l.phi*=1-i.dampingFactor,u.multiplyScalar(1-i.dampingFactor)):(l.set(0,0,0),u.set(0,0,0)),c=1,!!(d||Se.distanceToSquared(i.object.position)>o||8*(1-ve.dot(i.object.quaternion))>o)&&(i.dispatchEvent(pP),Se.copy(i.object.position),ve.copy(i.object.quaternion),d=!1,!0)}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",W),i.domElement.removeEventListener("pointerdown",ce),i.domElement.removeEventListener("pointercancel",Ge),i.domElement.removeEventListener("wheel",Tt),i.domElement.removeEventListener("pointermove",Ee),i.domElement.removeEventListener("pointerup",fe),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",vt)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let s=r.NONE;const o=1e-6,a=new rP,l=new rP;let c=1;const u=new E;let d=!1;const h=new K,f=new K,p=new K,g=new K,m=new K,y=new K,b=new K,_=new K,v=new K,S=[],M={};function x(){return Math.pow(.95,i.zoomSpeed)}function D(A){l.theta-=A}function P(A){l.phi-=A}const V=function(){const A=new E;return function(_e,Se){A.setFromMatrixColumn(Se,0),A.multiplyScalar(-_e),u.add(A)}}(),ne=function(){const A=new E;return function(_e,Se){!0===i.screenSpacePanning?A.setFromMatrixColumn(Se,1):(A.setFromMatrixColumn(Se,0),A.crossVectors(i.object.up,A)),A.multiplyScalar(_e),u.add(A)}}(),z=function(){const A=new E;return function(_e,Se){const ve=i.domElement;if(i.object.isPerspectiveCamera){A.copy(i.object.position).sub(i.target);let Ie=A.length();Ie*=Math.tan(i.object.fov/2*Math.PI/180),V(2*_e*Ie/ve.clientHeight,i.object.matrix),ne(2*Se*Ie/ve.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(V(_e*(i.object.right-i.object.left)/i.object.zoom/ve.clientWidth,i.object.matrix),ne(Se*(i.object.top-i.object.bottom)/i.object.zoom/ve.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function L(A){i.object.isPerspectiveCamera?c/=A:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*A)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function j(A){i.object.isPerspectiveCamera?c*=A:i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/A)),i.object.updateProjectionMatrix(),d=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function N(A){h.set(A.clientX,A.clientY)}function O(A){g.set(A.clientX,A.clientY)}function te(){1===S.length?h.set(S[0].pageX,S[0].pageY):h.set(.5*(S[0].pageX+S[1].pageX),.5*(S[0].pageY+S[1].pageY))}function ue(){1===S.length?g.set(S[0].pageX,S[0].pageY):g.set(.5*(S[0].pageX+S[1].pageX),.5*(S[0].pageY+S[1].pageY))}function Y(){const A=S[0].pageX-S[1].pageX,F=S[0].pageY-S[1].pageY,_e=Math.sqrt(A*A+F*F);b.set(0,_e)}function Ce(A){if(1==S.length)f.set(A.pageX,A.pageY);else{const _e=He(A);f.set(.5*(A.pageX+_e.x),.5*(A.pageY+_e.y))}p.subVectors(f,h).multiplyScalar(i.rotateSpeed);const F=i.domElement;D(2*Math.PI*p.x/F.clientHeight),P(2*Math.PI*p.y/F.clientHeight),h.copy(f)}function de(A){if(1===S.length)m.set(A.pageX,A.pageY);else{const F=He(A);m.set(.5*(A.pageX+F.x),.5*(A.pageY+F.y))}y.subVectors(m,g).multiplyScalar(i.panSpeed),z(y.x,y.y),g.copy(m)}function We(A){const F=He(A),_e=A.pageX-F.x,Se=A.pageY-F.y,ve=Math.sqrt(_e*_e+Se*Se);_.set(0,ve),v.set(0,Math.pow(_.y/b.y,i.zoomSpeed)),L(v.y),b.copy(_)}function ce(A){!1!==i.enabled&&(0===S.length&&(i.domElement.setPointerCapture(A.pointerId),i.domElement.addEventListener("pointermove",Ee),i.domElement.addEventListener("pointerup",fe)),function se(A){S.push(A)}(A),"touch"===A.pointerType?function T(A){switch(me(A),S.length){case 1:switch(i.touches.ONE){case 0:if(!1===i.enableRotate)return;te(),s=r.TOUCH_ROTATE;break;case 1:if(!1===i.enablePan)return;ue(),s=r.TOUCH_PAN;break;default:s=r.NONE}break;case 2:switch(i.touches.TWO){case 2:if(!1===i.enableZoom&&!1===i.enablePan)return;(function Me(){i.enableZoom&&Y(),i.enablePan&&ue()})(),s=r.TOUCH_DOLLY_PAN;break;case 3:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function ye(){i.enableZoom&&Y(),i.enableRotate&&te()})(),s=r.TOUCH_DOLLY_ROTATE;break;default:s=r.NONE}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(k0)}(A):function ke(A){let F;switch(A.button){case 0:F=i.mouseButtons.LEFT;break;case 1:F=i.mouseButtons.MIDDLE;break;case 2:F=i.mouseButtons.RIGHT;break;default:F=-1}switch(F){case 1:if(!1===i.enableZoom)return;(function U(A){b.set(A.clientX,A.clientY)})(A),s=r.DOLLY;break;case 0:if(A.ctrlKey||A.metaKey||A.shiftKey){if(!1===i.enablePan)return;O(A),s=r.PAN}else{if(!1===i.enableRotate)return;N(A),s=r.ROTATE}break;case 2:if(A.ctrlKey||A.metaKey||A.shiftKey){if(!1===i.enableRotate)return;N(A),s=r.ROTATE}else{if(!1===i.enablePan)return;O(A),s=r.PAN}break;default:s=r.NONE}s!==r.NONE&&i.dispatchEvent(k0)}(A))}function Ee(A){!1!==i.enabled&&("touch"===A.pointerType?function w(A){switch(me(A),s){case r.TOUCH_ROTATE:if(!1===i.enableRotate)return;Ce(A),i.update();break;case r.TOUCH_PAN:if(!1===i.enablePan)return;de(A),i.update();break;case r.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;(function ee(A){i.enableZoom&&We(A),i.enablePan&&de(A)})(A),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;(function J(A){i.enableZoom&&We(A),i.enableRotate&&Ce(A)})(A),i.update();break;default:s=r.NONE}}(A):function Oe(A){switch(s){case r.ROTATE:if(!1===i.enableRotate)return;!function $(A){f.set(A.clientX,A.clientY),p.subVectors(f,h).multiplyScalar(i.rotateSpeed);const F=i.domElement;D(2*Math.PI*p.x/F.clientHeight),P(2*Math.PI*p.y/F.clientHeight),h.copy(f),i.update()}(A);break;case r.DOLLY:if(!1===i.enableZoom)return;!function q(A){_.set(A.clientX,A.clientY),v.subVectors(_,b),v.y>0?L(x()):v.y<0&&j(x()),b.copy(_),i.update()}(A);break;case r.PAN:if(!1===i.enablePan)return;!function G(A){m.set(A.clientX,A.clientY),y.subVectors(m,g).multiplyScalar(i.panSpeed),z(y.x,y.y),g.copy(m),i.update()}(A)}}(A))}function fe(A){le(A),0===S.length&&(i.domElement.releasePointerCapture(A.pointerId),i.domElement.removeEventListener("pointermove",Ee),i.domElement.removeEventListener("pointerup",fe)),i.dispatchEvent(mP),s=r.NONE}function Ge(A){le(A)}function Tt(A){!1===i.enabled||!1===i.enableZoom||s!==r.NONE||(A.preventDefault(),i.dispatchEvent(k0),function H(A){A.deltaY<0?j(x()):A.deltaY>0&&L(x()),i.update()}(A),i.dispatchEvent(mP))}function vt(A){!1===i.enabled||!1===i.enablePan||function oe(A){let F=!1;switch(A.code){case i.keys.UP:A.ctrlKey||A.metaKey||A.shiftKey?P(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):z(0,i.keyPanSpeed),F=!0;break;case i.keys.BOTTOM:A.ctrlKey||A.metaKey||A.shiftKey?P(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):z(0,-i.keyPanSpeed),F=!0;break;case i.keys.LEFT:A.ctrlKey||A.metaKey||A.shiftKey?D(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):z(i.keyPanSpeed,0),F=!0;break;case i.keys.RIGHT:A.ctrlKey||A.metaKey||A.shiftKey?D(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):z(-i.keyPanSpeed,0),F=!0}F&&(A.preventDefault(),i.update())}(A)}function W(A){!1!==i.enabled&&A.preventDefault()}function le(A){delete M[A.pointerId];for(let F=0;F<S.length;F++)if(S[F].pointerId==A.pointerId)return void S.splice(F,1)}function me(A){let F=M[A.pointerId];void 0===F&&(F=new K,M[A.pointerId]=F),F.set(A.pageX,A.pageY)}function He(A){return M[(A.pointerId===S[0].pointerId?S[1]:S[0]).pointerId]}i.domElement.addEventListener("contextmenu",W),i.domElement.addEventListener("pointerdown",ce),i.domElement.addEventListener("pointercancel",Ge),i.domElement.addEventListener("wheel",Tt,{passive:!1}),this.update()}}var Ku=function(){var n=0,e=document.createElement("div");function t(u){return e.appendChild(u.dom),u}function i(u){for(var d=0;d<e.children.length;d++)e.children[d].style.display=d===u?"block":"none";n=u}e.style.cssText="position:fixed;top:0;left:0;cursor:pointer;opacity:0.9;z-index:10000",e.addEventListener("click",function(u){u.preventDefault(),i(++n%e.children.length)},!1);var r=(performance||Date).now(),s=r,o=0,a=t(new Ku.Panel("FPS","#0ff","#002")),l=t(new Ku.Panel("MS","#0f0","#020"));if(self.performance&&self.performance.memory)var c=t(new Ku.Panel("MB","#f08","#201"));return i(0),{REVISION:16,dom:e,addPanel:t,showPanel:i,begin:function(){r=(performance||Date).now()},end:function(){o++;var u=(performance||Date).now();if(l.update(u-r,200),u>=s+1e3&&(a.update(1e3*o/(u-s),100),s=u,o=0,c)){var d=performance.memory;c.update(d.usedJSHeapSize/1048576,d.jsHeapSizeLimit/1048576)}return u},update:function(){r=this.end()},domElement:e,setMode:i}};Ku.Panel=function(n,e,t){var i=1/0,r=0,s=Math.round,o=s(window.devicePixelRatio||1),a=80*o,l=48*o,c=3*o,u=2*o,d=3*o,h=15*o,f=74*o,p=30*o,g=document.createElement("canvas");g.width=a,g.height=l,g.style.cssText="width:80px;height:48px";var m=g.getContext("2d");return m.font="bold "+9*o+"px Helvetica,Arial,sans-serif",m.textBaseline="top",m.fillStyle=t,m.fillRect(0,0,a,l),m.fillStyle=e,m.fillText(n,c,u),m.fillRect(d,h,f,p),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(d,h,f,p),{dom:g,update:function(y,b){i=Math.min(i,y),r=Math.max(r,y),m.fillStyle=t,m.globalAlpha=1,m.fillRect(0,0,a,h),m.fillStyle=e,m.fillText(s(y)+" "+n+" ("+s(i)+"-"+s(r)+")",c,u),m.drawImage(g,d+o,h,f-o,p,d,h,f-o,p),m.fillRect(d+f-o,h,o,p),m.fillStyle=t,m.globalAlpha=.9,m.fillRect(d+f-o,h,o,s((1-y/b)*p))}}};const xY=Ku;class Xo{constructor(){this.statsEnabled=!1,this.deallocationLogger=!1,this.renderer=new nI({}),this.raycaster=new nP,this.mouseOverPosition=new K,this.mouseClickPosition=new K,this.stats=xY(),this.webGLInfo=this.renderer.info,this.canvas=this.renderer.domElement,this.raycaster.params.Line.threshold=.1}getWebGLInfo(){return this.webGLInfo}getSimplifiedWebGLInfo(){const t=this.webGLInfo.render;return`geometries: ${this.webGLInfo.memory.geometries}, triangles: ${t.triangles}, lines: ${t.lines}`}getCanvas(){return this.canvas}getScene(){return this.scene}setScene(){this.scene=new iI}getCamera(){return this.camera}setCamera(e){e?this.camera=e:(this.camera=new In(75,window.innerWidth/window.innerHeight,.1,20),this.camera.position.set(2,0,5)),this.setOrbitControl()}getOrbitControl(){return this.orbitControl}setOrbitControl(){this.orbitControl=new bY(this.camera,this.canvas),this.orbitControl.enablePan=!1,this.orbitControl.enableZoom=!1,this.orbitControl.enableRotate=!0,this.orbitControl.minAzimuthAngle=-Mo(43),this.orbitControl.maxAzimuthAngle=Mo(43),this.orbitControl.minPolarAngle=Mo(90),this.orbitControl.maxPolarAngle=Mo(90)}getRenderer(){return this.renderer}render(){this.renderer.render(this.scene,this.camera),this.stats.update()}raycast(e,t=!1,i,r){return this.raycaster.setFromCamera(r,i),this.raycaster.intersectObjects(e,t)}getStats(){return this.stats}centerO3D(e){(new Ns).setFromObject(e).getCenter(e.position).negate()}getO3DSize(e){const t=new E;return(new Ns).setFromObject(e).getSize(t)}animate(e){this.reqAnimationFr=requestAnimationFrame(this.animate.bind(this,e)),e?.(),this.render()}cancelAnimation(){this.reqAnimationFr&&cancelAnimationFrame(this.reqAnimationFr)}cleanUp(e,t){(t||this.scene)?.traverse(r=>{(r instanceof Bn||r instanceof Bl||r instanceof Vu)&&(this.deallocationLogger&&console.log(`${e} geometry disposed (${r.geometry.uuid})`),r.geometry.dispose(),r.material&&(r.material instanceof Bo&&(this.cleanUpTextures(e,r.material),this.deallocationLogger&&console.log(`${e} material disposed (${r.material.uuid})`),r.material.dispose()),r.material instanceof Array&&r.material.forEach(s=>{this.cleanUpTextures(e,s),this.deallocationLogger&&console.log(`${e} material disposed (${s.uuid})`),s.dispose()})))})}onWindowResize(){this.camera.aspect=window.innerWidth/window.innerHeight,this.camera?.updateProjectionMatrix(),this.renderer.setSize(window.innerWidth,window.innerHeight),this.render()}onMouseClick(e,t,i){if(this.mouseClickPosition){this.calcMousePosition(this.mouseClickPosition,e);const r=this.raycast(t,void 0,this.camera,this.mouseClickPosition);r?.length&&i(r[0].object)}}onDragMove(e,t,i){if(this.mouseOverPosition){this.calcMousePosition(this.mouseOverPosition,e);const r=this.raycast(t,void 0,this.camera,this.mouseOverPosition);r?.length?i(r[0].object):i()}}cleanUpTextures(e,t){Object.keys(t).forEach(i=>{if(t[i]instanceof ns){const r=t[i];r.source?.data instanceof ImageBitmap&&(this.deallocationLogger&&console.log(`${e} imageBitmap closed (${r.source.uuid})`),r.source.data.close()),this.deallocationLogger&&console.log(`${e} texture disposed (${r.uuid})`),r.dispose()}})}calcMousePosition(e,t){const i=this.canvas.getBoundingClientRect();e.x=(t.clientX-i.left)/this.canvas.clientWidth*2-1,e.y=-(t.clientY-i.top)/this.canvas.clientHeight*2+1}}function SY(n,e){1&n&&(Xe(0,"button",21)(1,"span"),ht(2,"img",22),lt()())}function wY(n,e){if(1&n&&(Xe(0,"button",23),qt(1,"async"),Xe(2,"span"),ht(3,"img",24),lt()()),2&n){let i;Et("disabled",!(null!=(i=Yt(1,1,Oc().gameStateService.gameStateStream))&&i.mine))}}function MY(n,e){if(1&n&&(ht(0,"img",25),qt(1,"async")),2&n){let i;Et("src","assets/icons/mine_"+(null==(i=Yt(1,1,Oc().gameStateService.gameStateStream))||null==i.mine?null:i.mine.quality)+".svg",oo)}}function EY(n,e){1&n&&(Zi(0),ht(1,"img",30),Ki())}function CY(n,e){1&n&&(Zi(0),ht(1,"img",31),Ki())}function DY(n,e){1&n&&(Zi(0),ht(1,"img",32),Ki())}function TY(n,e){1&n&&(Zi(0),ht(1,"img",33),Ki())}function AY(n,e){1&n&&(Zi(0),ht(1,"img",34),Ki())}function IY(n,e){1&n&&(Zi(0),ht(1,"img",35),Ki())}function PY(n,e){1&n&&(Zi(0),ht(1,"img",36),Ki())}function RY(n,e){1&n&&(Zi(0),ht(1,"img",37),Ki())}function LY(n,e){if(1&n&&(Xe(0,"div",26)(1,"div",27)(2,"div",28),si(3,EY,2,0,"ng-container",29),qt(4,"async"),si(5,CY,2,0,"ng-container",29),qt(6,"async"),lt(),Xe(7,"div",28),si(8,DY,2,0,"ng-container",29),qt(9,"async"),si(10,TY,2,0,"ng-container",29),qt(11,"async"),lt(),Xe(12,"div",28),si(13,AY,2,0,"ng-container",29),qt(14,"async"),si(15,IY,2,0,"ng-container",29),qt(16,"async"),lt(),Xe(17,"div",28),si(18,PY,2,0,"ng-container",29),qt(19,"async"),si(20,RY,2,0,"ng-container",29),qt(21,"async"),lt()()()),2&n){const t=Oc();let i,r,s,o,a,l,c,u;Et("@appInfoPanelInOutAnimation",void 0),_t(3),Et("ngIf",null==(i=Yt(4,9,t.gameStateService.gameStateStream))||null==i.inventory?null:i.inventory.worker),_t(2),Et("ngIf",null==(r=Yt(6,11,t.gameStateService.gameStateStream))||null==r.inventory?null:r.inventory.dynamite),_t(3),Et("ngIf",null==(s=Yt(9,13,t.gameStateService.gameStateStream))||null==s.inventory?null:s.inventory.map),_t(2),Et("ngIf",null==(o=Yt(11,15,t.gameStateService.gameStateStream))||null==o.inventory?null:o.inventory.compass),_t(3),Et("ngIf",null==(a=Yt(14,17,t.gameStateService.gameStateStream))||null==a.inventory?null:a.inventory.wagon),_t(2),Et("ngIf",null==(l=Yt(16,19,t.gameStateService.gameStateStream))||null==l.inventory?null:l.inventory.barrow),_t(3),Et("ngIf",null==(c=Yt(19,21,t.gameStateService.gameStateStream))||null==c.inventory?null:c.inventory.shovel2),_t(2),Et("ngIf",null==(u=Yt(21,23,t.gameStateService.gameStateStream))||null==u.inventory?null:u.inventory.shovel1)}}Xo.\u0275fac=function(e){return new(e||Xo)},Xo.\u0275prov=Ae({token:Xo,factory:Xo.\u0275fac,providedIn:"root"});class Qu{constructor(e,t,i){this.gameStateService=e,this.threeHelperService=t,this.router=i,this.title="mine-out",this.lastUrlSegment="",this.isInfoPanelOpened=!1,this.statsDivDefaultSize=80,this.subscriptions=[]}ngOnInit(){this.subscriptions.push(this.router.events.pipe(Xt(e=>{e instanceof As&&(this.lastUrlSegment=(n=>{const e=n.lastIndexOf("/");return n.substring(e+1)})(this.router.url))})).subscribe())}ngAfterViewInit(){if(this.threeHelperService.statsEnabled){const e=document.querySelector(".app"),t=this.threeHelperService.getStats().dom;t.id="three__stats",e.appendChild(t),this.statsDiv=e.querySelector("#three__stats"),this.statsDiv.style.top="4px",this.statsDiv.style.left=window.innerWidth-this.statsDivDefaultSize+"px",this.subscriptions.push(wo(window,"resize").pipe(Xt(()=>this.onWindowResize())).subscribe())}}ngOnDestroy(){this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[]}triggerInfoPanel(){this.isInfoPanelOpened=!this.isInfoPanelOpened}onWindowResize(){this.statsDiv.style.left=window.innerWidth-this.statsDivDefaultSize+"px"}}Qu.\u0275fac=function(e){return new(e||Qu)(Re(Jr),Re(Xo),Re(Yn))},Qu.\u0275cmp=oa({type:Qu,selectors:[["app-root"]],decls:38,vars:20,consts:[[1,"app"],[1,"app__actions"],[1,"flex","items-center","gap-4"],[1,"app-text"],["src","assets/icons/exchange-rate.svg",1,"app-img"],[1,"app-button","primary-bg","primary-bg-darken"],["src","assets/icons/cog.svg",1,"app-img"],["src","assets/icons/gold.svg",1,"app-img"],["class","app-button primary-bg primary-bg-darken primary-bg-lighten","routerLink","/shop",4,"ngIf"],["class","app-button primary-bg primary-bg-darken primary-bg-lighten","routerLink","/mine",3,"disabled",4,"ngIf"],["src","assets/icons/coins.svg",1,"app-img"],[1,"app-button","primary-bg","primary-bg-darken","primary-bg-lighten",3,"disabled","click"],["src","assets/icons/convert.svg",1,"app-img"],[1,"app__info-panel"],[1,"app__info-panel_control"],[1,"app-img"],[3,"src",4,"ngIf"],[1,"app-button","primary-bg","primary-bg-darken","primary-bg-lighten",3,"click"],[1,"app-img","items-center","justify-center"],["src","assets/icons/info.svg",1,"app-img"],["class","app__info-panel_wrapper primary-bg-opacity-50",4,"ngIf"],["routerLink","/shop",1,"app-button","primary-bg","primary-bg-darken","primary-bg-lighten"],["src","assets/icons/shopping.svg",1,"app-img"],["routerLink","/mine",1,"app-button","primary-bg","primary-bg-darken","primary-bg-lighten",3,"disabled"],["src","assets/icons/mine.svg",1,"app-img"],[3,"src"],[1,"app__info-panel_wrapper","primary-bg-opacity-50"],[1,"app__info-panel_content","text-primary"],[1,"app__info-panel_content-item"],[4,"ngIf"],["src","assets/icons/worker.svg",1,"app-img"],["src","assets/icons/dynamite.svg",1,"app-img"],["src","assets/icons/map.svg",1,"app-img"],["src","assets/icons/compass.svg",1,"app-img"],["src","assets/icons/wagon.svg",1,"app-img"],["src","assets/icons/barrow.svg",1,"app-img"],["src","assets/icons/shovel2.svg",1,"app-img"],["src","assets/icons/shovel1.svg",1,"app-img"]],template:function(e,t){if(1&e&&(Xe(0,"div",0),ht(1,"router-outlet"),Xe(2,"div",1)(3,"div",2)(4,"div",3),Br(5),qt(6,"async"),lt(),ht(7,"img",4),Xe(8,"button",5)(9,"span"),ht(10,"img",6),lt()()(),Xe(11,"div",2)(12,"div",3),Br(13),qt(14,"async"),lt(),ht(15,"img",7),si(16,SY,3,0,"button",8),si(17,wY,4,3,"button",9),lt(),Xe(18,"div",2)(19,"div",3),Br(20),qt(21,"async"),lt(),ht(22,"img",10),Xe(23,"button",11),Qi("click",function(){return t.gameStateService.exchange()}),qt(24,"async"),qt(25,"async"),Xe(26,"span"),ht(27,"img",12),lt()()()(),Xe(28,"div",13)(29,"div",14)(30,"div",2)(31,"div",15),si(32,MY,2,3,"img",16),qt(33,"async"),lt(),Xe(34,"button",17),Qi("click",function(){return t.triggerInfoPanel()}),Xe(35,"span",18),ht(36,"img",19),lt()()()(),si(37,LY,22,25,"div",20),lt()()),2&e){let i,r,s,o,a;_t(5),Ua(null==(i=Yt(6,8,t.gameStateService.gameStateStream))?null:i.exchangeRate),_t(8),Ua(null==(r=Yt(14,10,t.gameStateService.gameStateStream))?null:r.gold),_t(3),Et("ngIf","mine"===t.lastUrlSegment),_t(1),Et("ngIf","shop"===t.lastUrlSegment),_t(3),Ua(null==(s=Yt(21,12,t.gameStateService.gameStateStream))?null:s.coins),_t(3),Et("disabled",((null==(o=Yt(24,14,t.gameStateService.gameStateStream))?null:o.coins)||0)<((null==(o=Yt(25,16,t.gameStateService.gameStateStream))?null:o.exchangeRate)||0)),_t(9),Et("ngIf",null==(a=Yt(33,18,t.gameStateService.gameStateStream))?null:a.mine),_t(5),Et("ngIf",t.isInfoPanelOpened)}},dependencies:[G_,Df,UC,Vy],styles:[".app-text[_ngcontent-%COMP%]{min-width:3rem;text-align:right;color:var(--app-color-primary);font-size:2rem;line-height:3rem;font-weight:700}.app-img[_ngcontent-%COMP%]{display:flex;width:2.5rem;height:2.5rem}.app-info-img[_ngcontent-%COMP%]{display:flex;width:2rem;height:2rem}.app-button[_ngcontent-%COMP%]{max-height:3.125rem;padding:.25rem .5rem;border:0;border-top-left-radius:.5rem;border-bottom-left-radius:.5rem}.app-button[_ngcontent-%COMP%]:enabled{cursor:pointer}.app__actions[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:2px;position:fixed;top:3.5rem;right:0}.app__info-panel[_ngcontent-%COMP%]{display:flex;position:fixed;top:calc(12.5rem + 6px);right:7rem}.app__info-panel_control[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:2px;position:fixed}.app__info-panel_wrapper[_ngcontent-%COMP%]{display:flex;align-items:flex-end;justify-content:center;position:relative;left:7rem;width:5.75rem;height:11.25rem;border-bottom-left-radius:.5rem}@media only screen and (max-height: 656px){.app__info-panel_wrapper[_ngcontent-%COMP%]{width:11.25rem;height:5.75rem}}.app__info-panel_content[_ngcontent-%COMP%]{display:flex;flex-direction:row;flex-wrap:wrap;gap:.25rem;padding:.25rem}.app__info-panel_content-item[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;gap:.25rem;width:5.25rem}"],data:{animation:[function jV(n,e){return{type:7,name:n,definitions:e,options:{}}}("appInfoPanelInOutAnimation",[vD(":enter",[jr({width:0}),zh(".app__info-panel_content",jr({opacity:0})),Uh("250ms ease-out",jr({width:"*"})),zh(".app__info-panel_content",Uh("100ms ease-in",jr({opacity:1})))]),vD(":leave",[zh(".app__info-panel_content",jr({opacity:1})),zh(".app__info-panel_content",Uh("100ms ease-out",jr({opacity:0}))),Uh("250ms ease-in",jr({width:0}))])])]}});class Zo{constructor(e,t){this.router=e,this.gameStateService=t}canActivate(){const e=this.gameStateService.getMine();return!!(e&&e.rounds>0)||this.router.parseUrl("/")}}Zo.\u0275fac=function(e){return new(e||Zo)(pe(Yn),pe(Jr))},Zo.\u0275prov=Ae({token:Zo,factory:Zo.\u0275fac});const Wl=new Ws,Ys=new nP,Ju=new K,gP=new E,Vp=new E,B0=new E,yP=new Ze;class NY extends Ls{constructor(e,t,i){super(),i.style.touchAction="none";let r=null,s=null;const o=[],a=this;function l(){i.addEventListener("pointermove",f),i.addEventListener("pointerdown",p),i.addEventListener("pointerup",g),i.addEventListener("pointerleave",g)}function c(){i.removeEventListener("pointermove",f),i.removeEventListener("pointerdown",p),i.removeEventListener("pointerup",g),i.removeEventListener("pointerleave",g),i.style.cursor=""}function f(y){if(!1!==a.enabled){if(m(y),Ys.setFromCamera(Ju,t),r)return Ys.ray.intersectPlane(Wl,Vp)&&r.position.copy(Vp.sub(gP).applyMatrix4(yP)),void a.dispatchEvent({type:"drag",object:r});if("mouse"===y.pointerType||"pen"===y.pointerType)if(o.length=0,Ys.setFromCamera(Ju,t),Ys.intersectObjects(e,!0,o),o.length>0){const b=o[0].object;Wl.setFromNormalAndCoplanarPoint(t.getWorldDirection(Wl.normal),B0.setFromMatrixPosition(b.matrixWorld)),s!==b&&null!==s&&(a.dispatchEvent({type:"hoveroff",object:s}),i.style.cursor="auto",s=null),s!==b&&(a.dispatchEvent({type:"hoveron",object:b}),i.style.cursor="pointer",s=b)}else null!==s&&(a.dispatchEvent({type:"hoveroff",object:s}),i.style.cursor="auto",s=null)}}function p(y){!1!==a.enabled&&(m(y),o.length=0,Ys.setFromCamera(Ju,t),Ys.intersectObjects(e,!0,o),o.length>0&&(r=!0===a.transformGroup?e[0]:o[0].object,Wl.setFromNormalAndCoplanarPoint(t.getWorldDirection(Wl.normal),B0.setFromMatrixPosition(r.matrixWorld)),Ys.ray.intersectPlane(Wl,Vp)&&(yP.copy(r.parent.matrixWorld).invert(),gP.copy(Vp).sub(B0.setFromMatrixPosition(r.matrixWorld))),i.style.cursor="move",a.dispatchEvent({type:"dragstart",object:r})))}function g(){!1!==a.enabled&&(r&&(a.dispatchEvent({type:"dragend",object:r}),r=null),i.style.cursor=s?"pointer":"auto")}function m(y){const b=i.getBoundingClientRect();Ju.x=(y.clientX-b.left)/b.width*2-1,Ju.y=-(y.clientY-b.top)/b.height*2+1}l(),this.enabled=!0,this.transformGroup=!1,this.activate=l,this.deactivate=c,this.dispose=function u(){c()},this.getObjects=function d(){return e},this.getRaycaster=function h(){return Ys}}}class ed{constructor(e,t){this.threeHelperService=e,this.gameStateService=t,this.transformerState=this.gameStateService.getTransformerState(),this.maxTransformerSide=this.gameStateService.getMaxTransformerSide(),this.mine=this.gameStateService.getMine(),this.mergedStoreSize=this.gameStateService.getMergedStoreSize(),this.isMergedStoreFull=!1,this.dragTargets=[],this.transformerPositions=[],this.mineablesQuantity=10,this.mineables=[],this.mineablesMap={},this.fixXPosFromCamera=-9,this.fixYPosFromCamera=-6,this.fixZPosFromCamera=-10,this.storeSize=this.gameStateService.getStoreSize(),this.mineableStore=[],this.mineablesStoreMap={},this.mergedStore=[],this.mergedStoreMaps={},this.pickables=[],this.grabbedMineableParentUUID="",this.lastHighlightedStoreElUUID="",this.subscriptions=[],this.dragSubscriptions=[],this.renderer=this.threeHelperService.getRenderer(),this.threeHelperService.setCamera(),this.threeHelperService.setScene(),this.scene=this.threeHelperService.getScene(),this.camera=this.threeHelperService.getCamera(),this.orbitControl=this.threeHelperService.getOrbitControl()}ngOnInit(){this.setTransformer(),this.buildMineables(),this.camera?.add(...this.mineables),this.buildMineableStore(this.storeSize),this.camera?.add(...this.mineableStore),this.mergedStoreSize&&(this.buildMergedStore(this.mergedStoreSize),this.camera?.add(...this.mergedStore)),this.scene?.add(this.camera),this.renderer.setSize(window.innerWidth,window.innerHeight),this.setDragControl()}ngAfterViewInit(){document.querySelector(".mine")?.appendChild(this.renderer.domElement),this.mineableDragToStream=wo(window,"mousemove").pipe(Xt(t=>this.threeHelperService.onDragMove(t,this.dragTargets,this.onDragMove.bind(this)))),this.subscriptions.push(wo(window,"resize").pipe(Xt(()=>this.threeHelperService.onWindowResize())).subscribe()),this.threeHelperService.animate(this.animateFn.bind(this))}ngOnDestroy(){this.resetDragControl(),this.subscriptions.forEach(e=>e.unsubscribe()),this.subscriptions=[],this.threeHelperService.cancelAnimation(),this.threeHelperService.cleanUp("mine"),this.scene?.clear(),this.mine&&this.gameStateService.setMineRounds(-1),this.gameStateService.setTransformerState({...this.transformerState,isEmpty:!0,isFull:!1,quality:0})}mining(){this.resetDragControl(),this.mineables.forEach(e=>{const t=this.mineablesMap[e.uuid];if(t.occupied){const i=e.children.find(r=>r.uuid!==t.wireframe.uuid);this.pickables=this.pickables.filter(r=>r.uuid!==i?.uuid),i?.removeFromParent(),this.threeHelperService.cleanUp("mine mineable",i||void 0)}this.getMineable(e),t.occupied=!0,t.wireframe.material.color.set(65280)}),this.gameStateService.setMineRounds(-1),this.setDragControl()}transformerSize(){const e=this.transformerState.side,i=e+1>this.gameStateService.getMaxTransformerSide()?2:e+1;this.transformerState.side=i,this.transformerState.size=i*i*i,this.setTransformer()}transform(e=!1){const t=this.transformerState.quality;if(this.resetDragControl(),this.transformer?.children?.forEach(i=>{this.pickables=this.pickables.filter(r=>r.uuid!==i.uuid),this.threeHelperService.cleanUp("transformer mineable",i)}),this.transformer?.clear(),this.transformerState.isFull=!1,this.transformerState.isEmpty=!0,this.transformerState.quality=0,this.transformerPositions.forEach(i=>i.mineableUUID=""),e){const i=Object.values(this.mergedStoreMaps).find(r=>!r.occupied);i.wireframe.material.color.set(6538714),i.occupied=!0,this.getMineable(i.wireframe.parent,t),this.isMergedStoreFull=!Object.values(this.mergedStoreMaps).some(r=>!r.occupied)}else this.calcTransformerMinablesValue(t);this.setTransformerWireframeColor(8422792),this.setDragControl()}calcTransformerMinablesValue(e){const t=this.transformerState.side;2===t?this.gameStateService.addCoins(e*this.transformerState.size):this.gameStateService.addGold(e*(3===t?1:3))}setTransformer(){this.transformer&&(this.threeHelperService.cleanUp("transformer",this.transformer.parent||void 0),this.transformer.parent?.removeFromParent()),this.transformerPositions=[],this.generateTransformerPositions(this.transformerState.side),4===this.transformerState.side?(this.camera.position.set(2,0,7),this.orbitControl?.update()):(this.camera.position.set(2,0,5),this.orbitControl?.update());const e=this.getCubeCustomWireframe(this.transformerState.side,8422792);this.transformer=this.getCube(this.transformerState.side,void 0,0),this.scene?.add(e.add(this.transformer))}generateTransformerPositions(e=2){const t=e%2==0?e/2-.5:1;for(let i=-t;i<=t;i++)for(let r=-t;r<=t;r++)for(let s=-t;s<=t;s++)this.transformerPositions.push({position:new E(i,r,s),mineableUUID:""})}setDragControl(){this.dragControl=new NY(this.pickables,this.camera,this.threeHelperService.getCanvas()),this.dragControl.getRaycaster().params.Line.threshold=.1,this.subscribeToDragControlEvents()}resetDragControl(){this.unsubscribeToDragControlEvents(),this.dragControl?.deactivate()}subscribeToDragControlEvents(){this.dragSubscriptions=[wo(this.dragControl,"dragstart").pipe(Xt(e=>this.onDragStart(e))).subscribe(),wo(this.dragControl,"dragend").pipe(Xt(e=>this.onDragEnd())).subscribe()]}unsubscribeToDragControlEvents(){this.dragSubscriptions.forEach(e=>e.unsubscribe()),this.dragSubscriptions=[]}setMineableHoldersState(){const e=this.grabbedMineableParentUUID===this.transformer?.uuid,t=this.lastHighlightedStoreElUUID?this.lastHighlightedStoreElUUID===this.transformer?.parent?.uuid:void 0,i=this.mineablesMap[this.grabbedMineableParentUUID]?this.mineablesMap[this.grabbedMineableParentUUID]:this.mineablesStoreMap[this.grabbedMineableParentUUID]?this.mineablesStoreMap[this.grabbedMineableParentUUID]:this.mergedStoreMaps[this.grabbedMineableParentUUID];this.lastHighlightedStoreElUUID?(!e&&t?this.mineableFromMineOrStoreToTransformer(i):t||this.mineableFromMineOrStoreOrTransformerToStore(i,e),this.lastHighlightedStoreElUUID=""):e||this.resetOriginalProps(i),this.resetOriginalPosition(e,t),this.setTransformerState(),this.pickedMineable=void 0,this.grabbedMineableParentUUID=""}mineableFromMineOrStoreToTransformer(e){const t=this.findEmptyPositionIdx();if(-1!==t){this.pickedMineable?.removeFromParent();const i=this.transformerPositions[t].position;if(this.pickedMineable?.position.set(i.x,i.y,i.z),this.transformer?.add(this.pickedMineable),this.transformerPositions[t].mineableUUID=this.pickedMineable?.uuid||"",e.occupied=!1,e.merged){const r=this.getMineableQuality(this.pickedMineable);for(let s=0;s<7;s++){const o=this.findEmptyPositionIdx(),a=this.transformerPositions[o].position,l=this.getMineable(this.transformer,r);l.position.set(a.x,a.y,a.z),this.transformerPositions[o].mineableUUID=l.uuid}this.isMergedStoreFull=!Object.values(this.mergedStoreMaps).some(s=>!s.occupied)}}else this.setTransformerWireframeColor(65280),this.resetOriginalProps(e)}mineableFromMineOrStoreOrTransformerToStore(e,t){this.pickedMineable?.removeFromParent();const i=this.mineablesStoreMap[this.lastHighlightedStoreElUUID];i.wireframe.parent.add(this.pickedMineable),e?e.occupied=!1:t&&(this.transformerPositions.find(s=>s.mineableUUID===this.pickedMineable?.uuid).mineableUUID=""),i.occupied=!0}resetOriginalProps(e){e.wireframe.material.color.set(e.merged?6538714:65280),e.occupied=!0}resetOriginalPosition(e,t){if(e&&(t||void 0===t)){const i=this.transformerPositions.find(r=>r.mineableUUID===this.pickedMineable?.uuid)?.position;i&&this.pickedMineable?.position.set(i.x,i.y,i.z)}else(!t||this.transformerState.isFull)&&this.pickedMineable?.position.set(0,0,0)}setTransformerState(){const e=this.transformerPositions.filter(t=>t.mineableUUID);this.transformerState.isFull=e.length===this.transformerState.size,this.transformerState.isEmpty=!e.length,this.transformerState.isEmpty?this.transformerState.quality=0:!this.transformerState.quality&&e.length>0&&(this.transformerState.quality=this.getMineableQuality(this.pickedMineable)),this.transformerState.isFull||this.setTransformerWireframeColor(8422792)}findEmptyPositionIdx(){let e=!1,t=-1;for(let i=0;i<this.transformerPositions.length&&!e;i++)e=!this.transformerPositions[i].mineableUUID,t=i;return e?t:-1}setTransformerWireframeColor(e){this.transformer?.parent.material.color.set(e)}getCubeCustomWireframe(e=1,t=65280){const i=new Hs(e,e,e),r=new m0(i),s=new ei({color:t});return new Vu(r,s)}getCube(e=1,t=65280,i=.25){const r=new Hs(e,e,e),s=new ls({color:t,opacity:i,transparent:!0,depthWrite:!1,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1});return new Bn(r,s)}getCustomSphere(e){let t;if(e)t=e+1;else{const c=Math.random()<.5?0:1;t=this.mine.qualities[c]+1}const i=new Yu(1/4,2*t,t),r=new ls({color:6538714,transparent:!0,opacity:.9,polygonOffset:!0,polygonOffsetFactor:1,polygonOffsetUnits:1}),s=new Bn(i,r),o=new m0(i),a=new ei({color:6538714}),l=new Vu(o,a);return s.add(l),s}buildStoreElement(){const e=new js,t=this.getCubeCustomWireframe(void 0,8422792),i=this.getCube(void 0,void 0,0);return e.add(t,i),this.mineablesStoreMap[e.uuid]={cube:i,wireframe:t,occupied:!1},e}buildMineableStore(e=3){const t=e<=6?e:6,i=e>6&&e<=12?e-6:e>12?6:0,r=e>12&&e<=18?e-12:0;let s=6;for(let o=0;o<e;o++){const a=this.buildStoreElement();let l=new E;6===o?s=6:12===o&&(s=5),o<t?l=new E(this.fixXPosFromCamera,s,this.fixZPosFromCamera):o<t+i?l=new E(this.fixXPosFromCamera+2,s,this.fixZPosFromCamera):o<t+i+r&&(l=new E(-s,Math.abs(this.fixYPosFromCamera),this.fixZPosFromCamera)),a.position.add(l),this.mineablesStoreMap[a.uuid].position=l,this.mineableStore.push(a),s-=2}}buildMergedStoreElement(){const e=new js,t=this.getCubeCustomWireframe(void 0,8422792);return e.add(t),this.mergedStoreMaps[e.uuid]={wireframe:t,occupied:!1,merged:!0},e}buildMergedStore(e=0){let t=4;for(let i=0;i<e;i++){const r=this.buildMergedStoreElement();let s=new E;s=new E(this.fixXPosFromCamera+15,t,this.fixZPosFromCamera),r.position.add(s),this.mergedStoreMaps[r.uuid].position=s,this.mergedStore.push(r),t-=2}}getMineable(e,t){const i=this.getCube();return i.add(this.getCustomSphere(t)),e.add(i),this.pickables.push(i),i}buildMineable(){const e=new js,t=this.getCubeCustomWireframe();return e.add(t),this.getMineable(e),this.mineablesMap[e.uuid]={wireframe:t,occupied:!0},e}buildMineables(){for(let e=-(this.mineablesQuantity-1);e<=this.mineablesQuantity-1;e+=2){const t=this.buildMineable(),i=new E(e,this.fixYPosFromCamera,this.fixZPosFromCamera);t.position.add(i),this.mineablesMap[t.uuid].position=i,t.rotateX(Mo(-15)),t.rotateY(Mo(15)),this.mineables.push(t)}}getMineableQuality(e){return e.children[0].geometry.parameters.heightSegments-1}onDragStart(e){this.threeHelperService.getOrbitControl().enableRotate=!1,this.grabbedMineableParentUUID=e.object.parent?.uuid||"",this.pickedMineable=e.object;const t=this.mineablesMap[this.grabbedMineableParentUUID],i=this.mineablesStoreMap[this.grabbedMineableParentUUID],r=this.mergedStoreMaps[this.grabbedMineableParentUUID];t?t.wireframe.material.color.set(8422792):i?(i.wireframe.material.color.set(8422792),i.occupied=!1):r&&(r.wireframe.material.color.set(8422792),r.occupied=!1),this.setDragTargets(),this.mineableDragToSubscription=this.mineableDragToStream?.subscribe()}setDragTargets(){const e=this.mergedStoreMaps[this.grabbedMineableParentUUID];this.dragTargets=e?.merged?[]:Object.values(this.mineablesStoreMap).filter(r=>!r.occupied).map(r=>r.cube);const t=this.getMineableQuality(this.pickedMineable),i=this.transformerPositions.filter(r=>!r.mineableUUID).length;!this.transformerState.isFull&&(t===this.transformerState.quality||!this.transformerState.quality)&&(!e||e&&(this.transformerState.side<4&&this.transformerState.isEmpty||4===this.transformerState.side&&i>=8))&&this.dragTargets.push(this.transformer)}onDragMove(e){if(e&&e.uuid===this.transformer?.uuid)this.setTransformerWireframeColor(65280),this.lastHighlightedStoreElUUID=this.transformer.parent?.uuid||"";else if(e){const t=this.mineablesStoreMap[e.parent?.uuid||""];this.lastHighlightedStoreElUUID=e.parent?.uuid||"",t.wireframe.material.color.set(65280)}else this.lastHighlightedStoreElUUID&&(this.lastHighlightedStoreElUUID="");this.removeHighlight(this.lastHighlightedStoreElUUID)}removeHighlight(e){!e&&!this.transformerState.isFull&&this.setTransformerWireframeColor(8422792),Object.values(this.mineablesStoreMap).forEach(t=>{if(!t.occupied&&t.cube.parent?.uuid!==e){const i=t.wireframe.material;8422792!==i.color.getHex()&&i.color.set(8422792)}})}onDragEnd(){this.mineableDragToSubscription?.unsubscribe(),this.setMineableHoldersState(),this.threeHelperService.getOrbitControl().enableRotate=!0}animateFn(){this.mineables.forEach(e=>{this.mineablesMap[e.uuid].occupied&&this.grabbedMineableParentUUID!==e?.uuid&&e.rotateY(Mo(.5))})}}ed.\u0275fac=function(e){return new(e||ed)(Re(Xo),Re(Jr))},ed.\u0275cmp=oa({type:ed,selectors:[["app-mine"]],decls:18,vars:5,consts:[[1,"mine"],[1,"mine__control"],[1,"flex","items-center","gap-4"],[1,"mine-text"],["src","assets/icons/diamond.svg",1,"mine-img"],[1,"mine__control_button","primary-bg","primary-bg-darken","primary-bg-lighten",3,"disabled","click"],["src","assets/icons/pick.svg",1,"mine-img"],["src","assets/icons/resize.svg",1,"mine-img"],["src","assets/icons/transform.svg",1,"mine-img"],["src","assets/icons/merge.svg",1,"mine-img"]],template:function(e,t){1&e&&(ht(0,"div",0),Xe(1,"div",1)(2,"div",2)(3,"div",3),Br(4),lt(),ht(5,"img",4),Xe(6,"button",5),Qi("click",function(){return t.mining()}),Xe(7,"span"),ht(8,"img",6),lt()()(),Xe(9,"button",5),Qi("click",function(){return t.transformerSize()}),Xe(10,"span"),ht(11,"img",7),lt()(),Xe(12,"button",5),Qi("click",function(){return t.transform()}),Xe(13,"span"),ht(14,"img",8),lt()(),Xe(15,"button",5),Qi("click",function(){return t.transform(!0)}),Xe(16,"span"),ht(17,"img",9),lt()()()),2&e&&(_t(4),Ua(null==t.mine?null:t.mine.rounds),_t(2),Et("disabled",!(null!=t.mine&&t.mine.rounds)),_t(3),Et("disabled",!t.transformerState.isEmpty||2===t.maxTransformerSide),_t(3),Et("disabled",!t.transformerState.isFull),_t(3),Et("disabled",!t.transformerState.isFull||2!==t.transformerState.side||t.isMergedStoreFull||0===t.mergedStoreSize))},styles:[".mine-text[_ngcontent-%COMP%]{min-width:3rem;text-align:right;color:var(--app-color-primary);font-size:2rem;line-height:3rem;font-weight:700}.mine-img[_ngcontent-%COMP%]{display:flex;width:2.5rem;height:2.5rem}.mine__control[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:2px;position:fixed;bottom:10rem;right:0}.mine__control_button[_ngcontent-%COMP%]{max-height:3.125rem;padding:.25rem .5rem;border:0;border-top-left-radius:.5rem;border-bottom-left-radius:.5rem}.mine__control_button[_ngcontent-%COMP%]:enabled{cursor:pointer}"]});const _P=function kY(n,e){return n===e||n!=n&&e!=e},Hp=function BY(n,e){for(var t=n.length;t--;)if(_P(n[t][0],e))return t;return-1};var zY=Array.prototype.splice;function jl(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}jl.prototype.clear=function OY(){this.__data__=[],this.size=0},jl.prototype.delete=function VY(n){var e=this.__data__,t=Hp(e,n);return!(t<0||(t==e.length-1?e.pop():zY.call(e,t,1),--this.size,0))},jl.prototype.get=function GY(n){var e=this.__data__,t=Hp(e,n);return t<0?void 0:e[t][1]},jl.prototype.has=function jY(n){return Hp(this.__data__,n)>-1},jl.prototype.set=function qY(n,e){var t=this.__data__,i=Hp(t,n);return i<0?(++this.size,t.push([n,e])):t[i][1]=e,this};const Gp=jl,vP="object"==typeof global&&global&&global.Object===Object&&global;var rX="object"==typeof self&&self&&self.Object===Object&&self;const Cr=vP||rX||Function("return this")(),$l=Cr.Symbol;var bP=Object.prototype,aX=bP.hasOwnProperty,lX=bP.toString,td=$l?$l.toStringTag:void 0;var hX=Object.prototype.toString;var xP=$l?$l.toStringTag:void 0;const nd=function yX(n){return null==n?void 0===n?"[object Undefined]":"[object Null]":xP&&xP in Object(n)?function cX(n){var e=aX.call(n,td),t=n[td];try{n[td]=void 0;var i=!0}catch{}var r=lX.call(n);return i&&(e?n[td]=t:delete n[td]),r}(n):function fX(n){return hX.call(n)}(n)},id=function _X(n){var e=typeof n;return null!=n&&("object"==e||"function"==e)},SP=function wX(n){if(!id(n))return!1;var e=nd(n);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e};var n,MX=Cr["__core-js_shared__"],wP=(n=/[^.]+$/.exec(MX&&MX.keys&&MX.keys.IE_PROTO||""))?"Symbol(src)_1."+n:"";var TX=Function.prototype.toString;const Ko=function AX(n){if(null!=n){try{return TX.call(n)}catch{}try{return n+""}catch{}}return""};var PX=/^\[object .+?Constructor\]$/,FX=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const BX=function kX(n){return!(!id(n)||function EX(n){return!!wP&&wP in n}(n))&&(SP(n)?FX:PX).test(Ko(n))},Qo=function VX(n,e){var t=function UX(n,e){return n?.[e]}(n,e);return BX(t)?t:void 0},rd=Qo(Cr,"Map"),sd=Qo(Object,"create");var ZX=Object.prototype.hasOwnProperty;var eZ=Object.prototype.hasOwnProperty;function ql(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}ql.prototype.clear=function WX(){this.__data__=sd?sd(null):{},this.size=0},ql.prototype.delete=function $X(n){var e=this.has(n)&&delete this.__data__[n];return this.size-=e?1:0,e},ql.prototype.get=function KX(n){var e=this.__data__;if(sd){var t=e[n];return"__lodash_hash_undefined__"===t?void 0:t}return ZX.call(e,n)?e[n]:void 0},ql.prototype.has=function tZ(n){var e=this.__data__;return sd?void 0!==e[n]:eZ.call(e,n)},ql.prototype.set=function rZ(n,e){var t=this.__data__;return this.size+=this.has(n)?0:1,t[n]=sd&&void 0===e?"__lodash_hash_undefined__":e,this};const MP=ql,Wp=function uZ(n,e){var t=n.__data__;return function lZ(n){var e=typeof n;return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==n:null===n}(e)?t["string"==typeof e?"string":"hash"]:t.map};function Yl(n){var e=-1,t=null==n?0:n.length;for(this.clear();++e<t;){var i=n[e];this.set(i[0],i[1])}}Yl.prototype.clear=function oZ(){this.size=0,this.__data__={hash:new MP,map:new(rd||Gp),string:new MP}},Yl.prototype.delete=function dZ(n){var e=Wp(this,n).delete(n);return this.size-=e?1:0,e},Yl.prototype.get=function fZ(n){return Wp(this,n).get(n)},Yl.prototype.has=function mZ(n){return Wp(this,n).has(n)},Yl.prototype.set=function yZ(n,e){var t=Wp(this,n),i=t.size;return t.set(n,e),this.size+=t.size==i?0:1,this};const vZ=Yl;function Xl(n){var e=this.__data__=new Gp(n);this.size=e.size}Xl.prototype.clear=function XY(){this.__data__=new Gp,this.size=0},Xl.prototype.delete=function KY(n){var e=this.__data__,t=e.delete(n);return this.size=e.size,t},Xl.prototype.get=function JY(n){return this.__data__.get(n)},Xl.prototype.has=function tX(n){return this.__data__.has(n)},Xl.prototype.set=function xZ(n,e){var t=this.__data__;if(t instanceof Gp){var i=t.__data__;if(!rd||i.length<199)return i.push([n,e]),this.size=++t.size,this;t=this.__data__=new vZ(i)}return t.set(n,e),this.size=t.size,this};const wZ=Xl;var CZ=function(){try{var n=Qo(Object,"defineProperty");return n({},"",{}),n}catch{}}();const EP=CZ,CP=function DZ(n,e,t){"__proto__"==e&&EP?EP(n,e,{configurable:!0,enumerable:!0,value:t,writable:!0}):n[e]=t};var AZ=Object.prototype.hasOwnProperty;const DP=function IZ(n,e,t){var i=n[e];(!AZ.call(n,e)||!_P(i,t)||void 0===t&&!(e in n))&&CP(n,e,t)},jp=function PZ(n,e,t,i){var r=!t;t||(t={});for(var s=-1,o=e.length;++s<o;){var a=e[s],l=i?i(t[a],n[a],a,t,n):void 0;void 0===l&&(l=n[a]),r?CP(t,a,l):DP(t,a,l)}return t},od=function NZ(n){return null!=n&&"object"==typeof n},TP=function FZ(n){return od(n)&&"[object Arguments]"==nd(n)};var AP=Object.prototype,kZ=AP.hasOwnProperty,BZ=AP.propertyIsEnumerable,UZ=TP(function(){return arguments}())?TP:function(n){return od(n)&&kZ.call(n,"callee")&&!BZ.call(n,"callee")};const zZ=UZ,z0=Array.isArray;var IP="object"==typeof exports&&exports&&!exports.nodeType&&exports,PP=IP&&"object"==typeof module&&module&&!module.nodeType&&module,RP=PP&&PP.exports===IP?Cr.Buffer:void 0;const LP=(RP?RP.isBuffer:void 0)||function HZ(){return!1};var YZ=/^(?:0|[1-9]\d*)$/;const ZZ=function XZ(n,e){var t=typeof n;return!!(e=e??9007199254740991)&&("number"==t||"symbol"!=t&&YZ.test(n))&&n>-1&&n%1==0&&n<e},NP=function QZ(n){return"number"==typeof n&&n>-1&&n%1==0&&n<=9007199254740991};var Bt={};Bt["[object Float32Array]"]=Bt["[object Float64Array]"]=Bt["[object Int8Array]"]=Bt["[object Int16Array]"]=Bt["[object Int32Array]"]=Bt["[object Uint8Array]"]=Bt["[object Uint8ClampedArray]"]=Bt["[object Uint16Array]"]=Bt["[object Uint32Array]"]=!0,Bt["[object Arguments]"]=Bt["[object Array]"]=Bt["[object ArrayBuffer]"]=Bt["[object Boolean]"]=Bt["[object DataView]"]=Bt["[object Date]"]=Bt["[object Error]"]=Bt["[object Function]"]=Bt["[object Map]"]=Bt["[object Number]"]=Bt["[object Object]"]=Bt["[object RegExp]"]=Bt["[object Set]"]=Bt["[object String]"]=Bt["[object WeakMap]"]=!1;const V0=function EK(n){return function(e){return n(e)}};var OP="object"==typeof exports&&exports&&!exports.nodeType&&exports,ad=OP&&"object"==typeof module&&module&&!module.nodeType&&module,H0=ad&&ad.exports===OP&&vP.process;const Zl=function(){try{return ad&&ad.require&&ad.require("util").types||H0&&H0.binding&&H0.binding("util")}catch{}}();var FP=Zl&&Zl.isTypedArray;const AK=FP?V0(FP):function wK(n){return od(n)&&NP(n.length)&&!!Bt[nd(n)]};var PK=Object.prototype.hasOwnProperty;const kP=function RK(n,e){var t=z0(n),i=!t&&zZ(n),r=!t&&!i&&LP(n),s=!t&&!i&&!r&&AK(n),o=t||i||r||s,a=o?function RZ(n,e){for(var t=-1,i=Array(n);++t<n;)i[t]=e(t);return i}(n.length,String):[],l=a.length;for(var c in n)(e||PK.call(n,c))&&(!o||!("length"==c||r&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ZZ(c,l)))&&a.push(c);return a};var LK=Object.prototype;const G0=function NK(n){var e=n&&n.constructor;return n===("function"==typeof e&&e.prototype||LK)},BP=function OK(n,e){return function(t){return n(e(t))}},kK=BP(Object.keys,Object);var UK=Object.prototype.hasOwnProperty;const UP=function HK(n){return null!=n&&NP(n.length)&&!SP(n)},W0=function GK(n){return UP(n)?kP(n):function zK(n){if(!G0(n))return kK(n);var e=[];for(var t in Object(n))UK.call(n,t)&&"constructor"!=t&&e.push(t);return e}(n)};var XK=Object.prototype.hasOwnProperty;const KK=function ZK(n){if(!id(n))return function $K(n){var e=[];if(null!=n)for(var t in Object(n))e.push(t);return e}(n);var e=G0(n),t=[];for(var i in n)"constructor"==i&&(e||!XK.call(n,i))||t.push(i);return t},j0=function QK(n){return UP(n)?kP(n,!0):KK(n)};var zP="object"==typeof exports&&exports&&!exports.nodeType&&exports,VP=zP&&"object"==typeof module&&module&&!module.nodeType&&module,HP=VP&&VP.exports===zP?Cr.Buffer:void 0,GP=HP?HP.allocUnsafe:void 0;const WP=function lQ(){return[]};var uQ=Object.prototype.propertyIsEnumerable,jP=Object.getOwnPropertySymbols,dQ=jP?function(n){return null==n?[]:(n=Object(n),function oQ(n,e){for(var t=-1,i=null==n?0:n.length,r=0,s=[];++t<i;){var o=n[t];e(o,t,n)&&(s[r++]=o)}return s}(jP(n),function(e){return uQ.call(n,e)}))}:WP;const $0=dQ,$P=function pQ(n,e){for(var t=-1,i=e.length,r=n.length;++t<i;)n[r+t]=e[t];return n},qP=BP(Object.getPrototypeOf,Object);var yQ=Object.getOwnPropertySymbols?function(n){for(var e=[];n;)$P(e,$0(n)),n=qP(n);return e}:WP;const YP=yQ,XP=function bQ(n,e,t){var i=e(n);return z0(n)?i:$P(i,t(n))},SQ=function xQ(n){return XP(n,W0,$0)},MQ=function wQ(n){return XP(n,j0,YP)},q0=Qo(Cr,"DataView"),Y0=Qo(Cr,"Promise"),X0=Qo(Cr,"Set"),Z0=Qo(Cr,"WeakMap");var ZP="[object Map]",KP="[object Promise]",QP="[object Set]",JP="[object WeakMap]",eR="[object DataView]",IQ=Ko(q0),PQ=Ko(rd),RQ=Ko(Y0),LQ=Ko(X0),NQ=Ko(Z0),Jo=nd;(q0&&Jo(new q0(new ArrayBuffer(1)))!=eR||rd&&Jo(new rd)!=ZP||Y0&&Jo(Y0.resolve())!=KP||X0&&Jo(new X0)!=QP||Z0&&Jo(new Z0)!=JP)&&(Jo=function(n){var e=nd(n),t="[object Object]"==e?n.constructor:void 0,i=t?Ko(t):"";if(i)switch(i){case IQ:return eR;case PQ:return ZP;case RQ:return KP;case LQ:return QP;case NQ:return JP}return e});const K0=Jo;var FQ=Object.prototype.hasOwnProperty;const tR=Cr.Uint8Array,Q0=function zQ(n){var e=new n.constructor(n.byteLength);return new tR(e).set(new tR(n)),e};var GQ=/\w*$/;var nR=$l?$l.prototype:void 0,iR=nR?nR.valueOf:void 0;const gJ=function mJ(n,e,t){var i=n.constructor;switch(e){case"[object ArrayBuffer]":return Q0(n);case"[object Boolean]":case"[object Date]":return new i(+n);case"[object DataView]":return function VQ(n,e){var t=e?Q0(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.byteLength)}(n,t);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return function YQ(n,e){var t=e?Q0(n.buffer):n.buffer;return new n.constructor(t,n.byteOffset,n.length)}(n,t);case"[object Map]":case"[object Set]":return new i;case"[object Number]":case"[object String]":return new i(n);case"[object RegExp]":return function WQ(n){var e=new n.constructor(n.source,GQ.exec(n));return e.lastIndex=n.lastIndex,e}(n);case"[object Symbol]":return function $Q(n){return iR?Object(iR.call(n)):{}}(n)}};var rR=Object.create,yJ=function(){function n(){}return function(e){if(!id(e))return{};if(rR)return rR(e);n.prototype=e;var t=new n;return n.prototype=void 0,t}}();const _J=yJ;var sR=Zl&&Zl.isMap;const EJ=sR?V0(sR):function SJ(n){return od(n)&&"[object Map]"==K0(n)};var oR=Zl&&Zl.isSet;const IJ=oR?V0(oR):function DJ(n){return od(n)&&"[object Set]"==K0(n)};var aR="[object Arguments]",lR="[object Function]",cR="[object Object]",Ot={};Ot[aR]=Ot["[object Array]"]=Ot["[object ArrayBuffer]"]=Ot["[object DataView]"]=Ot["[object Boolean]"]=Ot["[object Date]"]=Ot["[object Float32Array]"]=Ot["[object Float64Array]"]=Ot["[object Int8Array]"]=Ot["[object Int16Array]"]=Ot["[object Int32Array]"]=Ot["[object Map]"]=Ot["[object Number]"]=Ot[cR]=Ot["[object RegExp]"]=Ot["[object Set]"]=Ot["[object String]"]=Ot["[object Symbol]"]=Ot["[object Uint8Array]"]=Ot["[object Uint8ClampedArray]"]=Ot["[object Uint16Array]"]=Ot["[object Uint32Array]"]=!0,Ot["[object Error]"]=Ot[lR]=Ot["[object WeakMap]"]=!1;const iee=function $p(n,e,t,i,r,s){var o,a=1&e,l=2&e,c=4&e;if(t&&(o=r?t(n,i,r,s):t(n)),void 0!==o)return o;if(!id(n))return n;var u=z0(n);if(u){if(o=function kQ(n){var e=n.length,t=new n.constructor(e);return e&&"string"==typeof n[0]&&FQ.call(n,"index")&&(t.index=n.index,t.input=n.input),t}(n),!a)return function rQ(n,e){var t=-1,i=n.length;for(e||(e=Array(i));++t<i;)e[t]=n[t];return e}(n,o)}else{var d=K0(n),h=d==lR||"[object GeneratorFunction]"==d;if(LP(n))return function nQ(n,e){if(e)return n.slice();var t=n.length,i=GP?GP(t):new n.constructor(t);return n.copy(i),i}(n,a);if(d==cR||d==aR||h&&!r){if(o=l||h?{}:function vJ(n){return"function"!=typeof n.constructor||G0(n)?{}:_J(qP(n))}(n),!a)return l?function _Q(n,e){return jp(n,YP(n),e)}(n,function JK(n,e){return n&&jp(e,j0(e),n)}(o,n)):function hQ(n,e){return jp(n,$0(n),e)}(n,function WK(n,e){return n&&jp(e,W0(e),n)}(o,n))}else{if(!Ot[d])return r?n:{};o=gJ(n,d,a)}}s||(s=new wZ);var f=s.get(n);if(f)return f;s.set(n,o),IJ(n)?n.forEach(function(m){o.add($p(m,e,t,m,n,s))}):EJ(n)&&n.forEach(function(m,y){o.set(y,$p(m,e,t,y,n,s))});var g=u?void 0:(c?l?MQ:SQ:l?j0:W0)(n);return function MZ(n,e){for(var t=-1,i=null==n?0:n.length;++t<i&&!1!==e(n[t],t,n););}(g||n,function(m,y){g&&(m=n[y=m]),DP(o,y,$p(m,e,t,y,n,s))}),o};function aee(n,e){if(1&n){const t=function Rw(){return re()}();Xe(0,"div",15)(1,"div",10)(2,"div",11),ht(3,"img",12),lt(),ht(4,"p",16),lt(),Xe(5,"div",10)(6,"p",13),Br(7),lt(),Xe(8,"button",14),Qi("click",function(){const s=function Jb(n){return $e.lFrame.contextLView=n,n[8]}(t).$implicit;return function ex(n){return $e.lFrame.contextLView=null,n}(Oc().triggerItem(s))}),qt(9,"async"),Xe(10,"span",2),ht(11,"img",12),lt()()()()}if(2&n){const t=e.$implicit;_t(3),Et("src","assets/icons/"+t.name+".svg",oo),_t(1),Et("innerHtml",t.description,SS),_t(3),kc("",t.price," gold"),_t(1),Et("disabled",!Yt(9,5,t.available)&&!t.checked),_t(3),Et("src","assets/icons/basket"+(t.checked?"-checked":"-plus")+".svg",oo)}}class ld{constructor(e){this.gameStateService=e,this.availableItems=[],this.currStoreSize=this.gameStateService.getStoreSize(),this.currMergedStoreSize=this.gameStateService.getMergedStoreSize(),this.currTransformerSide=this.gameStateService.getMaxTransformerSide(),this.defaultMineQualities=["low","medium","high"],this.defaultMines=this.gameStateService.getDeafultMines(),this.hasCurrMine=!!this.gameStateService.getMine(),this.inventory=this.gameStateService.getInventory(),this.storeSize={description:"The <strong>container</strong> expands the mine's container. It can only be purchased if no mine<br>has been purchased yet. If it is selected, a mine must also be selected.",price:Math.pow(2,Math.ceil((this.currStoreSize-5)/3)),rounds:0},this.mergedStoreSize={description:"The <strong>merged item container</strong> expands the mine's container. It can only be purchased<br>if no mine has been purchased yet. If it is selected, a mine must also be selected.",price:32,rounds:0},this.shopItems={shovel1:{description:"A <strong>shovel</strong> helps one dig faster. Mineable rounds +2<br>A person can only use one shovel at a time.",price:1,rounds:2,requires:"",dependents:["shovel2","barrow","wagon"]},shovel2:{description:"A <strong>second shovel</strong> helps another dig faster. Mineable rounds +2 (+barrow +wagon)<br>An existing shovel is required to purchase it. (A worker may find this tool useful.)",price:1,rounds:0,requires:"shovel1"},barrow:{description:"The <strong>barrow</strong> helps to carry away the excavated soil. Mineable rounds +2<br>A shovel is required to purchase it.",price:2,rounds:2,requires:"shovel1"},wagon:{description:"The <strong>wagon</strong> helps to carry even more excavated soil. Mineable rounds +3<br>A shovel is required to purchase it.",price:3,rounds:3,requires:"shovel1"},map:{description:"The <strong>map</strong> helps to find areas with richer mineral content. Mineable rounds +5<br>It can only be purchased for one mine at a time.",price:1,rounds:5,requires:"",dependents:["compass"]},compass:{description:"The <strong>compass</strong> increases the effectiveness of the map. Mineable rounds +5<br>A map is required to purchase it.",price:2,rounds:0,requires:"map"},dynamite:{description:"<strong>Dynamite</strong> helps to break up rock quickly. Mineable rounds +7<br>It can only be purchased for one mine at a time.",price:1,rounds:7,requires:""},worker:{description:"Hire a <strong>worker</strong>. He helps mining. Increases efficiency. Mineable rounds +5<br>It can only be purchased for one mine at a time.",price:2,rounds:5,requires:""}}}ngOnInit(){this.initShop()}triggerItem(e){let t=!0;e.name?.startsWith("mine_")&&e.checked?t=!this.availableItems.filter(i=>!i.name?.startsWith("mine_")&&"storeSize"!==i.name).some(i=>i.checked):e.dependents&&e.dependents.forEach(i=>{t=t&&!this.availableItems.find(r=>r.name===i)?.checked}),t&&(e.checked=!e.checked,this.gameStateService.setCredit(e.checked?-1*e.price:e.price))}purchaseItems(){this.gameStateService.addGold(-1*(this.gameStateService.getGold()-this.gameStateService.getCredit())),this.availableItems.forEach(e=>{if(e.checked)if("storeSize"===e.name)this.gameStateService.setStoreSize(),this.currStoreSize+=1;else if("mergedStoreSize"===e.name)this.gameStateService.setMergedStoreSize(),this.currMergedStoreSize+=1;else if("transformerSide"===e.name)this.gameStateService.setMaxTransformerSide(),this.currTransformerSide+=1;else if(e.name?.startsWith("mine_")){const t=e.name.replace("mine_",""),i=function see(n){return iee(n,4)}(this.defaultMines.find(r=>r.quality===t));this.gameStateService.setMine(i,this.shopItems),this.hasCurrMine=!0}else{const t=e.name;let i=e.rounds;"worker"===t?i+=(this.availableItems.find(a=>"shovel2"===a.name)?.checked||this.inventory.shovel2?2:0)+(this.availableItems.find(a=>"barrow"===a.name)?.checked||this.inventory.barrow?2:0)+(this.availableItems.find(a=>"wagon"===a.name)?.checked||this.inventory.wagon?3:0):"map"===t&&(i+=this.availableItems.find(r=>"compass"===r.name)?.checked||this.inventory.compass?5:0),this.gameStateService.setInventory(t),this.gameStateService.setMineRounds(i),this.inventory=this.gameStateService.getInventory()}}),this.availableItems=[],this.initShop()}initShop(){this.setTransformerSide(),this.setStoreSize(),this.setMines(),this.setInventoryItems()}setTransformerSide(){if(18===this.currStoreSize&&2===this.currTransformerSide||5===this.currMergedStoreSize&&3===this.currTransformerSide){const e=2===this.currTransformerSide?32:64;this.availableItems.push({price:e,name:"transformerSide",description:"The <strong>expander</strong> expands the mine's transformer.<br>It can only be selected if a mine is also has been selected.",rounds:0,available:this.gameStateService.gameStateStream.pipe(Je(t=>!t.mine&&t.credit>=e&&this.availableItems.filter(i=>i.name?.startsWith("mine_")).some(i=>i.checked))),checked:!1})}}setStoreSize(){this.currStoreSize<18?this.availableItems.push({...this.storeSize,price:Math.pow(2,Math.ceil((this.currStoreSize-5)/3)),name:"storeSize",available:this.gameStateService.gameStateStream.pipe(Je(e=>!e.mine&&e.credit>=this.storeSize.price)),checked:!1}):this.currMergedStoreSize<5&&this.availableItems.push({...this.mergedStoreSize,name:"mergedStoreSize",available:this.gameStateService.gameStateStream.pipe(Je(e=>!e.mine&&e.credit>=this.mergedStoreSize.price)),checked:!1})}setMines(){this.hasCurrMine||this.defaultMines.forEach(e=>{const t=this.defaultMineQualities[Math.floor(e.qualities[0]/2)],i="low"===t?1:"medium"===t?3:5,r={price:i,name:`mine_${t}`,description:`A <strong>mine</strong> where ${t} quality gems can be mined.<br>It is not possible to buy tools without an existing mine or a mine you want to buy.`,rounds:10,available:this.gameStateService.gameStateStream.pipe(Je(s=>s.credit>=i&&this.availableItems.filter(o=>o.name?.startsWith("mine_")).every(o=>!o.checked))),checked:!1};this.availableItems.push(r)})}setInventoryItems(){Object.keys(this.inventory).forEach(e=>{const i=this.shopItems[e].price;if(!this.inventory[e]){const r=this.shopItems[e],s=r.requires,o={price:i,name:e,description:r.description,rounds:r.rounds,available:this.gameStateService.gameStateStream.pipe(Je(a=>a.credit>=i&&(!s||this.inventory[s]||!!this.availableItems.find(l=>l.name===s)?.checked)&&(this.hasCurrMine||this.availableItems.filter(l=>l.name?.startsWith("mine_")).some(l=>l.checked)))),dependents:r.dependents,checked:!1};this.availableItems.push(o)}})}}ld.\u0275fac=function(e){return new(e||ld)(Re(Jr))},ld.\u0275cmp=oa({type:ld,selectors:[["app-shop"]],decls:28,vars:13,consts:[[1,"shop"],[1,"shop__header"],[1,"shop-img"],["src","assets/icons/shop.svg"],[1,"shop__header_title"],[1,"shop__list"],[1,"shop__list_stock","primary-bg-opacity-25","no-scrollbar"],["class","shop__list_item primary-bg-opacity-50",4,"ngFor","ngForOf"],[1,"shop__list_total","primary-bg-opacity-25"],[1,"shop__list_item","primary-bg-opacity-50","w-full"],[1,"shop__list_item-half"],[1,"shop__list-img"],[3,"src"],[1,"shop__list-text"],[1,"shop__list_button","primary-bg","primary-bg-darken","primary-bg-lighten",3,"disabled","click"],[1,"shop__list_item","primary-bg-opacity-50"],[1,"shop__list-text",3,"innerHtml"]],template:function(e,t){if(1&e&&(Xe(0,"div",0)(1,"div",1)(2,"div",2),ht(3,"img",3),lt(),Xe(4,"div",4),Br(5,"Welcome to the store!"),lt(),Xe(6,"div",2),ht(7,"img",3),lt()(),Xe(8,"div",5)(9,"div",6),si(10,aee,12,7,"div",7),lt(),Xe(11,"div",8)(12,"div",9)(13,"div",10)(14,"div",11),ht(15,"img",12),lt(),Xe(16,"p",13),Br(17,"Total:"),lt()(),Xe(18,"div",10)(19,"p",13),Br(20),qt(21,"async"),qt(22,"async"),lt(),Xe(23,"button",14),Qi("click",function(){return t.purchaseItems()}),qt(24,"async"),qt(25,"async"),Xe(26,"span",2),ht(27,"img",12),lt()()()()()()()),2&e){let i,r;_t(10),Et("ngForOf",t.availableItems),_t(5),Et("src","assets/icons/bill.svg",oo),_t(5),kc("",((null==(i=Yt(21,5,t.gameStateService.gameStateStream))?null:i.gold)||0)-((null==(i=Yt(22,7,t.gameStateService.gameStateStream))?null:i.credit)||0)," gold"),_t(3),Et("disabled",(null==(r=Yt(24,9,t.gameStateService.gameStateStream))?null:r.gold)===(null==(r=Yt(25,11,t.gameStateService.gameStateStream))?null:r.credit)||(t.currStoreSize<18||t.currMergedStoreSize<5)&&t.availableItems[0].checked&&!t.availableItems[1].checked&&!t.availableItems[2].checked&&!t.availableItems[3].checked),_t(4),Et("src","assets/icons/cashier.svg",oo)}},dependencies:[kC,Vy],styles:[".shop[_ngcontent-%COMP%]{min-height:100vh;background-color:var(--app-color-bg);display:flex;flex-direction:column}.shop-img[_ngcontent-%COMP%]{display:flex;width:2.5rem;height:2.5rem}.shop__header[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;gap:5rem;height:3.5rem}.shop__header_title[_ngcontent-%COMP%]{font-size:2rem;line-height:2.5rem;font-weight:700}.shop__list[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;padding-left:2rem;padding-right:12rem}.shop__list-text[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;line-height:1.5rem;font-weight:500}.shop__list-img[_ngcontent-%COMP%]{display:flex;width:4rem;height:4rem}.shop__list_item[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;padding:.5% 1%;border:2px solid var(--app-color-primary);border-radius:.5rem}.shop__list_item-half[_ngcontent-%COMP%]{display:flex;align-items:center;gap:2.5rem}.shop__list_button[_ngcontent-%COMP%]{max-height:3.125rem;padding:.25rem .5rem;border:0;border-radius:.5rem}.shop__list_button[_ngcontent-%COMP%]:enabled{cursor:pointer}.shop__list_busket[_ngcontent-%COMP%]{display:flex;width:2.5rem;height:2.5rem;cursor:pointer}.shop__list_stock[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:1rem;height:75vh;padding:.5% 1%;overflow:auto;border:2px solid var(--app-color-primary);border-radius:.5rem}@media only screen and (max-height: 800px){.shop__list_stock[_ngcontent-%COMP%]{height:60vh}}.shop__list_total[_ngcontent-%COMP%]{display:flex;padding:.5% 1%;border:2px solid var(--app-color-primary);border-radius:.5rem}"]});const lee=[{path:"mine",component:ed,canActivate:[Zo]},{path:"shop",component:ld}];class Kl{}Kl.\u0275fac=function(e){return new(e||Kl)},Kl.\u0275mod=ji({type:Kl}),Kl.\u0275inj=Ci({imports:[Tf.forChild(lee),Tf]});class Ql{}Ql.\u0275fac=function(e){return new(e||Ql)},Ql.\u0275mod=ji({type:Ql}),Ql.\u0275inj=Ci({providers:[Zo],imports:[GC,Kl]});class Jl{}Jl.\u0275fac=function(e){return new(e||Jl)},Jl.\u0275mod=ji({type:Jl,bootstrap:[Qu]}),Jl.\u0275inj=Ci({imports:[nl,fD,W4,Ql,h5.forRoot({prefix:"mine-out-",caseSensitive:!0})]}),NV().bootstrapModule(Jl).catch(n=>console.error(n))}},yt=>{yt(yt.s=733)}]);